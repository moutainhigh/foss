<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.stv.MvrNplrEntityDao" >
  <resultMap id="BaseResultMap" type="com.deppon.foss.module.settlement.closing.api.shared.domain.MvrNplrEntity" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="PERIOD" property="period" jdbcType="VARCHAR" />
    <result column="PRODUCT_CODE" property="productCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_CODE" property="customerCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="ORIG_ORG_CODE" property="origOrgCode" jdbcType="VARCHAR" />
    <result column="ORIG_ORG_NAME" property="origOrgName" jdbcType="VARCHAR" />
    <result column="DEST_ORG_CODE" property="destOrgCode" jdbcType="VARCHAR" />
    <result column="DEST_ORG_NAME" property="destOrgName" jdbcType="VARCHAR" />
    <result column="ORIG_UNIFIED_CODE" property="origUnifiedCode" jdbcType="VARCHAR" />
    <result column="DEST_UNIFIED_CODE" property="destUnifiedCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_TYPE" property="customerType" jdbcType="VARCHAR" />
    <result column="UROP_DEST_CH_NPOD" property="uropDestChNpod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CD_NPOD" property="uropDestCdNpod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CH_POD" property="uropDestChPod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CD_POD" property="uropDestCdPod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CH_NPOD" property="urtpDestChNpod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CD_NPOD" property="urtpDestCdNpod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CH_POD" property="urtpDestChPod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CD_POD" property="urtpDestCdPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVO_POD" property="plCostWoDestRcvoPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVO_NPOD" property="plCostWoDestRcvoNpod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVT_POD" property="plCostWoDestRcvtPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVT_NPOD" property="plCostWoDestRcvtNpod" jdbcType="DECIMAL" />
    <result column="PL_COST_ENTRY" property="plCostEntry" jdbcType="DECIMAL" />
    <result column="PL_COST_CONFIRM" property="plCostConfirm" jdbcType="DECIMAL" />
    <result column="PL_COST_NCONFIRM" property="plCostNconfirm" jdbcType="DECIMAL" />
    <result column="PL_COST_PAY_APPLY" property="plCostPayApply" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVT_POD" property="plDrWoDestRcvtPod" jdbcType="DECIMAL" />
    <result column="PL_DR_CH" property="plDrCh" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVO_POD" property="plDrWoDestRcvoPod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVO_NPOD" property="plDrWoDestRcvoNpod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVT_NPOD" property="plDrWoDestRcvtNpod" jdbcType="DECIMAL" />
    <result column="PL_DR_CD" property="plDrCd" jdbcType="DECIMAL" />
    <result column="PL_DR_PAY_APPLY" property="plDrPayApply" jdbcType="DECIMAL" />
    
    <result column="PL_COST_OP_CRM" property="plCostOpCrm" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_OR" property="plDrWoOr" jdbcType="DECIMAL" />
    <result column="POR_ENTRY" property="porEntry" jdbcType="DECIMAL" />
    <result column="UR_POR_CH" property="urPorCh" jdbcType="DECIMAL" />
    <result column="UR_POR_CD" property="urPorCd" jdbcType="DECIMAL" />
    <result column="POP_WO_DRO_POD" property="popWoDroPod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRO_NPOD" property="popWoDroNpod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRT_POD" property="popWoDrtPod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRT_NPOD" property="popWoDrtNpod" jdbcType="DECIMAL" />
    <result column="POCP_WO_OR" property="pocpWoOr" jdbcType="DECIMAL" />
  </resultMap>
  
  <resultMap id="MvrNplrDtoResultMap" type="com.deppon.foss.module.settlement.closing.api.shared.dto.MvrNplrDto" >
    <result column="COUNT" property="count" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CH_NPOD" property="uropDestChNpod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CD_NPOD" property="uropDestCdNpod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CH_POD" property="uropDestChPod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CD_POD" property="uropDestCdPod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CH_NPOD" property="urtpDestChNpod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CD_NPOD" property="urtpDestCdNpod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CH_POD" property="urtpDestChPod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CD_POD" property="urtpDestCdPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVO_POD" property="plCostWoDestRcvoPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVO_NPOD" property="plCostWoDestRcvoNpod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVT_POD" property="plCostWoDestRcvtPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVT_NPOD" property="plCostWoDestRcvtNpod" jdbcType="DECIMAL" />
    <result column="PL_COST_ENTRY" property="plCostEntry" jdbcType="DECIMAL" />
    <result column="PL_COST_CONFIRM" property="plCostConfirm" jdbcType="DECIMAL" />
    <result column="PL_COST_NCONFIRM" property="plCostNconfirm" jdbcType="DECIMAL" />
    <result column="PL_COST_PAY_APPLY" property="plCostPayApply" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVT_POD" property="plDrWoDestRcvtPod" jdbcType="DECIMAL" />
    <result column="PL_DR_CH" property="plDrCh" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVO_POD" property="plDrWoDestRcvoPod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVO_NPOD" property="plDrWoDestRcvoNpod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVT_NPOD" property="plDrWoDestRcvtNpod" jdbcType="DECIMAL" />
    <result column="PL_DR_CD" property="plDrCd" jdbcType="DECIMAL" />
    <result column="PL_DR_PAY_APPLY" property="plDrPayApply" jdbcType="DECIMAL" />
    
    <result column="PL_COST_OP_CRM" property="plCostOpCrm" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_OR" property="plDrWoOr" jdbcType="DECIMAL" />
    <result column="POR_ENTRY" property="porEntry" jdbcType="DECIMAL" />
    <result column="UR_POR_CH" property="urPorCh" jdbcType="DECIMAL" />
    <result column="UR_POR_CD" property="urPorCd" jdbcType="DECIMAL" />
    <result column="POP_WO_DRO_POD" property="popWoDroPod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRO_NPOD" property="popWoDroNpod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRT_POD" property="popWoDrtPod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRT_NPOD" property="popWoDrtNpod" jdbcType="DECIMAL" />
    <result column="POCP_WO_OR" property="pocpWoOr" jdbcType="DECIMAL" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    ID, PERIOD, PRODUCT_CODE, CUSTOMER_CODE, CUSTOMER_NAME, ORIG_ORG_CODE, ORIG_ORG_NAME, 
    DEST_ORG_CODE, DEST_ORG_NAME, ORIG_UNIFIED_CODE, DEST_UNIFIED_CODE,
    CUSTOMER_TYPE, 
    UROP_DEST_CH_NPOD / 100              UROP_DEST_CH_NPOD,         
	UROP_DEST_CD_NPOD / 100              UROP_DEST_CD_NPOD,        
	UROP_DEST_CH_POD / 100               UROP_DEST_CH_POD,         
	UROP_DEST_CD_POD / 100               UROP_DEST_CD_POD,         
	URTP_DEST_CH_NPOD / 100              URTP_DEST_CH_NPOD,        
	URTP_DEST_CD_NPOD / 100              URTP_DEST_CD_NPOD,        
	URTP_DEST_CH_POD / 100               URTP_DEST_CH_POD,         
	URTP_DEST_CD_POD / 100               URTP_DEST_CD_POD,         
	PL_COST_WO_DEST_RCVO_POD / 100       PL_COST_WO_DEST_RCVO_POD, 
	PL_COST_WO_DEST_RCVO_NPOD / 100      PL_COST_WO_DEST_RCVO_NPOD,
	PL_COST_WO_DEST_RCVT_POD / 100       PL_COST_WO_DEST_RCVT_POD, 
	PL_COST_WO_DEST_RCVT_NPOD / 100      PL_COST_WO_DEST_RCVT_NPOD,
	PL_COST_ENTRY / 100                  PL_COST_ENTRY,            
	PL_COST_CONFIRM / 100                PL_COST_CONFIRM,          
	PL_COST_NCONFIRM / 100               PL_COST_NCONFIRM,         
	PL_COST_PAY_APPLY / 100              PL_COST_PAY_APPLY,        
	PL_DR_WO_DEST_RCVT_POD / 100         PL_DR_WO_DEST_RCVT_POD,   
	PL_DR_CH / 100                       PL_DR_CH,                 
	PL_DR_WO_DEST_RCVO_POD / 100         PL_DR_WO_DEST_RCVO_POD,   
	PL_DR_WO_DEST_RCVO_NPOD / 100        PL_DR_WO_DEST_RCVO_NPOD,  
	PL_DR_WO_DEST_RCVT_NPOD / 100        PL_DR_WO_DEST_RCVT_NPOD,  
	PL_DR_CD / 100                       PL_DR_CD,                 
	PL_DR_PAY_APPLY / 100                PL_DR_PAY_APPLY, 
	
	PL_COST_OP_CRM / 100                PL_COST_OP_CRM,
	PL_DR_WO_OR / 100                PL_DR_WO_OR,
	POR_ENTRY / 100                POR_ENTRY,
	UR_POR_CH / 100                UR_POR_CH,
	UR_POR_CD / 100                UR_POR_CD,
	POP_WO_DRO_POD / 100                POP_WO_DRO_POD,
	POP_WO_DRO_NPOD / 100                POP_WO_DRO_NPOD,
	POP_WO_DRT_POD / 100                POP_WO_DRT_POD,
	POP_WO_DRT_NPOD / 100                POP_WO_DRT_NPOD,
	POCP_WO_OR / 100                POCP_WO_OR   
  </sql>
  
  <sql id="Base_Total_List" >
	COUNT(ID) COUNT,
	SUM(UROP_DEST_CH_NPOD) / 100              UROP_DEST_CH_NPOD,         
	SUM(UROP_DEST_CD_NPOD) / 100              UROP_DEST_CD_NPOD,        
	SUM(UROP_DEST_CH_POD) / 100               UROP_DEST_CH_POD,         
	SUM(UROP_DEST_CD_POD) / 100               UROP_DEST_CD_POD,         
	SUM(URTP_DEST_CH_NPOD) / 100              URTP_DEST_CH_NPOD,        
	SUM(URTP_DEST_CD_NPOD) / 100              URTP_DEST_CD_NPOD,        
	SUM(URTP_DEST_CH_POD) / 100               URTP_DEST_CH_POD,         
	SUM(URTP_DEST_CD_POD) / 100               URTP_DEST_CD_POD,         
	SUM(PL_COST_WO_DEST_RCVO_POD) / 100       PL_COST_WO_DEST_RCVO_POD, 
	SUM(PL_COST_WO_DEST_RCVO_NPOD) / 100      PL_COST_WO_DEST_RCVO_NPOD,
	SUM(PL_COST_WO_DEST_RCVT_POD) / 100       PL_COST_WO_DEST_RCVT_POD, 
	SUM(PL_COST_WO_DEST_RCVT_NPOD) / 100      PL_COST_WO_DEST_RCVT_NPOD,
	SUM(PL_COST_ENTRY) / 100                  PL_COST_ENTRY,            
	SUM(PL_COST_CONFIRM) / 100                PL_COST_CONFIRM,          
	SUM(PL_COST_NCONFIRM) / 100               PL_COST_NCONFIRM,         
	SUM(PL_COST_PAY_APPLY) / 100              PL_COST_PAY_APPLY,        
	SUM(PL_DR_WO_DEST_RCVT_POD) / 100         PL_DR_WO_DEST_RCVT_POD,   
	SUM(PL_DR_CH) / 100                       PL_DR_CH,                 
	SUM(PL_DR_WO_DEST_RCVO_POD) / 100         PL_DR_WO_DEST_RCVO_POD,   
	SUM(PL_DR_WO_DEST_RCVO_NPOD) / 100        PL_DR_WO_DEST_RCVO_NPOD,  
	SUM(PL_DR_WO_DEST_RCVT_NPOD) / 100        PL_DR_WO_DEST_RCVT_NPOD,  
	SUM(PL_DR_CD) / 100                       PL_DR_CD,                 
	SUM(PL_DR_PAY_APPLY) / 100                PL_DR_PAY_APPLY,
	
	SUM(PL_COST_OP_CRM) / 100                PL_COST_OP_CRM,
	SUM(PL_DR_WO_OR) / 100                PL_DR_WO_OR,
	SUM(POR_ENTRY) / 100                POR_ENTRY,
	SUM(UR_POR_CH) / 100                UR_POR_CH,
	SUM(UR_POR_CD) / 100                UR_POR_CD,
	SUM(POP_WO_DRO_POD) / 100                POP_WO_DRO_POD,
	SUM(POP_WO_DRO_NPOD) / 100                POP_WO_DRO_NPOD,
	SUM(POP_WO_DRT_POD) / 100                POP_WO_DRT_POD,
	SUM(POP_WO_DRT_NPOD) / 100                POP_WO_DRT_NPOD,
	SUM(POCP_WO_OR) / 100                POCP_WO_OR
  </sql>
  
    <!-- 查询条件 -->
	<sql id="condition_expression">
		<!-- 业务类型 -->
		 
		<if test="productCodeList != null">
		and t.PRODUCT_CODE in
		<foreach collection="productCodeList" index="index" item="item" open="(" separator="," close=")">  
		#{item,jdbcType=VARCHAR}
		</foreach>	
		</if>
		
	    <!-- 客户编码 -->
		<if test="customerCode != null">
			and t.CUSTOMER_CODE =#{customerCode,jdbcType=VARCHAR}
		</if>
	    <!-- 始发部门编码 -->
		<if test="origOrgCode != null">
			and t.ORIG_ORG_CODE =#{origOrgCode,jdbcType=VARCHAR}
		</if>
	    <!-- 到达部门编码
		<if test="destOrgCode != null">
			and DEST_ORG_CODE =#{destOrgCode,jdbcType=VARCHAR}
		</if> -->	
		
		<!-- 到达部门加入数据权限  -->
	    <!-- <if test="userCode != null and userCode != ''">
		   and exists (select 1
	         from bse.mv_bas_user_org_auth_view uov
	        where uov.emp_code = #{userCode}
	          and uov.Org_Code = t.DEST_ORG_CODE
		          <if test="destOrgCode != null and destOrgCode != '' ">
		          and uov.Org_Code = #{destOrgCode,jdbcType=VARCHAR}
		          </if> 
	          )
	    </if> -->
	    
	</sql>
  
  <select id="selectByConditions" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select /*结算-凭证报表-根据条件查询专线到达月报表*/
    <include refid="Base_Column_List" />
    from STV.T_STL_MVR_NPLR t
    where t.PERIOD = #{period,jdbcType=VARCHAR}
    <!-- 引入查询条件 -->
	<include refid="condition_expression" />		
  </select>
  
  <select id="selectTotalByConditions" resultMap="MvrNplrDtoResultMap" parameterType="java.util.Map" >
    select /*结算-凭证报表-根据条件查询专线到达月报表总条数，总金额*/
    <include refid="Base_Total_List" />
    from STV.T_STL_MVR_NPLR t
    where t.PERIOD = #{period,jdbcType=VARCHAR}
    <!-- 引入查询条件 -->
	<include refid="condition_expression" />		
  </select>
  
</mapper>