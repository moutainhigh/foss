<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.stv.MvrNpliEntityDao" >
  <resultMap id="BaseResultMap" type="com.deppon.foss.module.settlement.closing.api.shared.domain.MvrNpliEntity" >
    <result column="ID" property="id" jdbcType="VARCHAR" />
    <result column="PERIOD" property="period" jdbcType="VARCHAR" />
    <result column="PRODUCT_CODE" property="productCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_CODE" property="customerCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="ORG_CODE" property="orgCode" jdbcType="VARCHAR" />
    <result column="ORG_NAME" property="orgName" jdbcType="VARCHAR" />
    <result column="ORG_TYPE" property="orgType" jdbcType="CHAR" />
    <result column="ORG_UNIFIED_CODE" property="orgUnifiedCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_TYPE" property="customerType" jdbcType="VARCHAR" />
    <result column="INVOICE_MARK" property="invoiceMark" jdbcType="VARCHAR" />
    <result column="UROP_DEST_CH_NPOD" property="uropDestChNpod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CH_POD" property="uropDestChPod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CD_NPOD" property="urtpDestCdNpod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CD_POD" property="urtpDestCdPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVT_NPOD" property="plCostWoDestRcvtNpod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVT_POD" property="plDrWoDestRcvtPod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CD_NPOD" property="uropDestCdNpod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CD_POD" property="uropDestCdPod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CH_NPOD" property="urtpDestChNpod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CH_POD" property="urtpDestChPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVO_POD" property="plCostWoDestRcvoPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVO_NPOD" property="plCostWoDestRcvoNpod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVT_POD" property="plCostWoDestRcvtPod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVO_POD" property="plDrWoDestRcvoPod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVO_NPOD" property="plDrWoDestRcvoNpod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVT_NPOD" property="plDrWoDestRcvtNpod" jdbcType="DECIMAL" />
    
    <result column="POP_WO_DRO_POD" property="popWoDroPod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRO_NPOD" property="popWoDroNpod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRT_POD" property="popWoDrtPod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRT_NPOD" property="popWoDrtNpod" jdbcType="DECIMAL" />
  </resultMap>
  
  <resultMap id="MvrNpliDtoResultMap" type="com.deppon.foss.module.settlement.closing.api.shared.dto.MvrNpliDto" >
    <result column="COUNT" property="count" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CH_NPOD" property="uropDestChNpod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CH_POD" property="uropDestChPod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CD_NPOD" property="urtpDestCdNpod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CD_POD" property="urtpDestCdPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVT_NPOD" property="plCostWoDestRcvtNpod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVT_POD" property="plDrWoDestRcvtPod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CD_NPOD" property="uropDestCdNpod" jdbcType="DECIMAL" />
    <result column="UROP_DEST_CD_POD" property="uropDestCdPod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CH_NPOD" property="urtpDestChNpod" jdbcType="DECIMAL" />
    <result column="URTP_DEST_CH_POD" property="urtpDestChPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVO_POD" property="plCostWoDestRcvoPod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVO_NPOD" property="plCostWoDestRcvoNpod" jdbcType="DECIMAL" />
    <result column="PL_COST_WO_DEST_RCVT_POD" property="plCostWoDestRcvtPod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVO_POD" property="plDrWoDestRcvoPod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVO_NPOD" property="plDrWoDestRcvoNpod" jdbcType="DECIMAL" />
    <result column="PL_DR_WO_DEST_RCVT_NPOD" property="plDrWoDestRcvtNpod" jdbcType="DECIMAL" />
    
    <result column="POP_WO_DRO_POD" property="popWoDroPod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRO_NPOD" property="popWoDroNpod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRT_POD" property="popWoDrtPod" jdbcType="DECIMAL" />
    <result column="POP_WO_DRT_NPOD" property="popWoDrtNpod" jdbcType="DECIMAL" />
  </resultMap>  
  
  <sql id="Base_Column_List" >
	  ID, PERIOD, PRODUCT_CODE, 
	      CUSTOMER_CODE, CUSTOMER_NAME, ORG_CODE, 
	      ORG_NAME, ORG_TYPE, ORG_UNIFIED_CODE, 
	      CUSTOMER_TYPE, INVOICE_MARK, 
	      UROP_DEST_CH_NPOD / 100           UROP_DEST_CH_NPOD,        
		  UROP_DEST_CH_POD / 100            UROP_DEST_CH_POD,         
		  URTP_DEST_CD_NPOD / 100           URTP_DEST_CD_NPOD,        
		  URTP_DEST_CD_POD / 100            URTP_DEST_CD_POD,         
		  PL_COST_WO_DEST_RCVT_NPOD / 100   PL_COST_WO_DEST_RCVT_NPOD,
		  PL_DR_WO_DEST_RCVT_POD / 100      PL_DR_WO_DEST_RCVT_POD,   
		  UROP_DEST_CD_NPOD / 100           UROP_DEST_CD_NPOD,        
		  UROP_DEST_CD_POD / 100            UROP_DEST_CD_POD,         
		  URTP_DEST_CH_NPOD / 100           URTP_DEST_CH_NPOD,        
		  URTP_DEST_CH_POD / 100            URTP_DEST_CH_POD,         
		  PL_COST_WO_DEST_RCVO_POD / 100    PL_COST_WO_DEST_RCVO_POD, 
		  PL_COST_WO_DEST_RCVO_NPOD / 100   PL_COST_WO_DEST_RCVO_NPOD,
		  PL_COST_WO_DEST_RCVT_POD / 100    PL_COST_WO_DEST_RCVT_POD, 
		  PL_DR_WO_DEST_RCVO_POD / 100      PL_DR_WO_DEST_RCVO_POD,   
		  PL_DR_WO_DEST_RCVO_NPOD / 100     PL_DR_WO_DEST_RCVO_NPOD,  
		  PL_DR_WO_DEST_RCVT_NPOD / 100     PL_DR_WO_DEST_RCVT_NPOD,
		  
		  POP_WO_DRO_POD / 100 POP_WO_DRO_POD,
		  POP_WO_DRO_NPOD / 100 POP_WO_DRO_NPOD,
		  POP_WO_DRT_POD / 100 POP_WO_DRT_POD,
		  POP_WO_DRT_NPOD / 100 POP_WO_DRT_NPOD  
  </sql>
  
  <sql id="Base_Total_List" >
	COUNT(ID) COUNT,
	SUM(UROP_DEST_CH_NPOD ) / 100           UROP_DEST_CH_NPOD,        
	SUM(UROP_DEST_CH_POD ) / 100            UROP_DEST_CH_POD,         
	SUM(URTP_DEST_CD_NPOD ) / 100           URTP_DEST_CD_NPOD,        
	SUM(URTP_DEST_CD_POD ) / 100            URTP_DEST_CD_POD,         
	SUM(PL_COST_WO_DEST_RCVT_NPOD ) / 100   PL_COST_WO_DEST_RCVT_NPOD,
	SUM(PL_DR_WO_DEST_RCVT_POD ) / 100      PL_DR_WO_DEST_RCVT_POD,   
	SUM(UROP_DEST_CD_NPOD ) / 100           UROP_DEST_CD_NPOD,        
	SUM(UROP_DEST_CD_POD ) / 100            UROP_DEST_CD_POD,         
	SUM(URTP_DEST_CH_NPOD ) / 100           URTP_DEST_CH_NPOD,        
	SUM(URTP_DEST_CH_POD ) / 100            URTP_DEST_CH_POD,         
	SUM(PL_COST_WO_DEST_RCVO_POD ) / 100    PL_COST_WO_DEST_RCVO_POD, 
	SUM(PL_COST_WO_DEST_RCVO_NPOD ) / 100   PL_COST_WO_DEST_RCVO_NPOD,
	SUM(PL_COST_WO_DEST_RCVT_POD ) / 100    PL_COST_WO_DEST_RCVT_POD, 
	SUM(PL_DR_WO_DEST_RCVO_POD ) / 100      PL_DR_WO_DEST_RCVO_POD,   
	SUM(PL_DR_WO_DEST_RCVO_NPOD ) / 100     PL_DR_WO_DEST_RCVO_NPOD,  
	SUM(PL_DR_WO_DEST_RCVT_NPOD ) / 100     PL_DR_WO_DEST_RCVT_NPOD,
	
	SUM(POP_WO_DRO_POD) / 100 POP_WO_DRO_POD,
	SUM(POP_WO_DRO_NPOD) / 100 POP_WO_DRO_NPOD,
	SUM(POP_WO_DRT_POD) / 100 POP_WO_DRT_POD,
	SUM(POP_WO_DRT_NPOD) / 100 POP_WO_DRT_NPOD 
  </sql>
  
      <!-- 查询条件 -->
	<sql id="condition_expression">
		<!-- 业务类型 -->
		 
		<if test="customerCode!=null and customerCode!=''">
			AND t.CUSTOMER_CODE = #{customerCode,jdbcType=VARCHAR} <!-- 客户不为空时，根据客户编码过滤 -->
		</if>
	   	<if test="orgCode!=null and orgCode!=''">
			AND t.ORG_CODE = #{orgCode,jdbcType=VARCHAR}
		</if>
		<if test="orgType!=null and orgType!=''">
			AND t.ORG_TYPE = #{orgType,jdbcType=VARCHAR}
		</if>
	    
	</sql>
  
  <select id="selectByConditions" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select /*结算-凭证报表-根据条件查询专线到达月报表*/
    <include refid="Base_Column_List" />
    from STV.T_STL_MVR_NPLI t
    where t.PERIOD = #{period,jdbcType=VARCHAR}
    <!-- 引入查询条件 -->
	<include refid="condition_expression" />		
  </select>
  
  <select id="selectTotalByConditions" resultMap="MvrNpliDtoResultMap" parameterType="java.util.Map" >
    select /*结算-凭证报表-根据条件查询专线到达月报表总条数，总金额*/
    <include refid="Base_Total_List" />
    from STV.T_STL_MVR_NPLI t
    where t.PERIOD = #{period,jdbcType=VARCHAR}
    <!-- 引入查询条件 -->
	<include refid="condition_expression" />		
  </select>
 
</mapper>