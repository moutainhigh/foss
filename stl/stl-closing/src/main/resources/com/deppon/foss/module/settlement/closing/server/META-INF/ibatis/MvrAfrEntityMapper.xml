<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.stv.MvrAfrEntityMapper" >
  <resultMap id="BaseResultMap" type="com.deppon.foss.module.settlement.closing.api.shared.domain.MvrAfrEntity" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="PERIOD" property="period" jdbcType="VARCHAR" />
    <result column="PRODUCT_CODE" property="productCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_CODE" property="customerCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="ORIG_ORG_CODE" property="origOrgCode" jdbcType="VARCHAR" />
    <result column="ORIG_ORG_NAME" property="origOrgName" jdbcType="VARCHAR" />
    <result column="DEST_ORG_CODE" property="destOrgCode" jdbcType="VARCHAR" />
    <result column="DEST_ORG_NAME" property="destOrgName" jdbcType="VARCHAR" />
    <result column="ORIG_UNIFIED_CODE" property="origUnifiedCode" jdbcType="VARCHAR" />
    <result column="DEST_UNIFIED_CODE" property="destUnifiedCode" jdbcType="VARCHAR" />
    <result column="VOUCHER_BEGIN_TIME" property="voucherBeginTime" jdbcType="TIMESTAMP" />
    <result column="VOUCHER_END_TIME" property="voucherEndTime" jdbcType="TIMESTAMP" />
    <result column="CUSTOMER_TYPE" property="customerType" jdbcType="VARCHAR" />
    <result column="UR_DEST_CH_NPOD" property="urDestChNpod" jdbcType="DECIMAL" />
    <result column="UR_DEST_CD_NPOD" property="urDestCdNpod" jdbcType="DECIMAL" />
    <result column="UR_DEST_CH_POD" property="urDestChPod" jdbcType="DECIMAL" />
    <result column="UR_DEST_CD_POD" property="urDestCdPod" jdbcType="DECIMAL" />
    <result column="AIR_COST_COM_CONFIRM" property="airCostComConfirm" jdbcType="DECIMAL" />
    <result column="AIR_COST_ORIG_AGENCY_CFM" property="airCostOrigAgencyCfm" jdbcType="DECIMAL" />
    <result column="AIR_COST_DEST_AGENCY_GEN" property="airCostDestAgencyGen" jdbcType="DECIMAL" />
    <result column="AIR_COST_DEST_AGENCY_CFM" property="airCostDestAgencyCfm" jdbcType="DECIMAL" />
    <result column="AIR_COST_DEST_AGENCY_NCFM" property="airCostDestAgencyNcfm" jdbcType="DECIMAL" />
    <result column="AIR_COST_OTHER_CONFIRM" property="airCostOtherConfirm" jdbcType="DECIMAL" />
    <result column="AIR_COST_PAY_APPLY" property="airCostPayApply" jdbcType="DECIMAL" />
    <result column="OTH_ENTRY" property="othEntry" jdbcType="DECIMAL" />
    <result column="OTH_RCV_CH" property="othRcvCh" jdbcType="DECIMAL" />
    <result column="OTH_RCV_CD" property="othRcvCd" jdbcType="DECIMAL" />
    <result column="AIR_DR_DEST_RCV_POD" property="airDrDestRcvPod" jdbcType="DECIMAL" />
    <result column="AIR_DR_DEST_RCV_NPOD" property="airDrDestRcvNpod" jdbcType="DECIMAL" />
    <result column="AIR_DR_CH" property="airDrCh" jdbcType="DECIMAL" />
    <result column="AIR_DR_CD" property="airDrCd" jdbcType="DECIMAL" />
    <result column="AIR_DR_WO_OTHER_RCV" property="airDrWoOtherRcv" jdbcType="DECIMAL" />
    <result column="AIR_DR_WO_COD_RCV_POD" property="airDrWoCodRcvPod" jdbcType="DECIMAL" />
    <result column="AIR_DR_WO_COD_RCV_NPOD" property="airDrWoCodRcvNpod" jdbcType="DECIMAL" />
    <result column="AIR_DR_PAY_APPLY" property="airDrPayApply" jdbcType="DECIMAL" />
    <result column="AIR_PR_AGENCY_WO_DEST_RCV_POD" property="airPrAgencyWoDestRcvPod" jdbcType="DECIMAL" />
    <result column="AIR_PR_AGENCY_WO_DEST_RCV_NPOD" property="airPrAgencyWoDestRcvNpod" jdbcType="DECIMAL" />
    <result column="AIR_PR_OT_WO_DEST_RCV_POD" property="airPrOtWoDestRcvPod" jdbcType="DECIMAL" />
    <result column="AIR_PR_OTH_WO_DEST_RCV_NPOD" property="airPrOthWoDestRcvNpod" jdbcType="DECIMAL" />
    <result column="AIR_PR_OTH_WO_OTH_RCV" property="airPrOthWoOthRcv" jdbcType="DECIMAL" />
    <result column="AIR_COD_CH_POD" property="airCodChPod" jdbcType="DECIMAL" />
    <result column="AIR_COD_CD_POD" property="airCodCdPod" jdbcType="DECIMAL" />
    <result column="AIR_COD_POD_WO_COD" property="airCodPodWoCod" jdbcType="DECIMAL" />
    <result column="AIR_COD_NPOD_WO_COD" property="airCodNpodWoCod" jdbcType="DECIMAL" />
    <result column="AIR_COD_CH_NPOD" property="airCodChNpod" jdbcType="DECIMAL" />
    <result column="AIR_COD_CD_NPOD" property="airCodCdNpod" jdbcType="DECIMAL" />
    <result column="AIR_COD_WO_AGENCY_PAY_POD" property="airCodWoAgencyPayPod" jdbcType="DECIMAL" />
    <result column="AIR_COD_WO_OTH_PAY_COD" property="airCodWoOthPayCod" jdbcType="DECIMAL" />
    <result column="AIR_COD_WO_AGENCY_PAY_NPOD" property="airCodWoAgencyPayNpod" jdbcType="DECIMAL" />
    <result column="AIR_COD_WO_OTH_NPOD" property="airCodWoOthNpod" jdbcType="DECIMAL" />
    <result column="APT_COM" property="aptCom" jdbcType="DECIMAL" />
    <result column="APT_WO_COM_PAY" property="aptWoComPay" jdbcType="DECIMAL" />
    <result column="APT_WO_OTH_PAY" property="aptWoOthPay" jdbcType="DECIMAL" />
    <result column="BDR_WO_OTH_RCV" property="bdrWoOthRcv" jdbcType="DECIMAL" />
  </resultMap>
  <sql id="Base_Column_List" >
    ID, PERIOD, PRODUCT_CODE, CUSTOMER_CODE, CUSTOMER_NAME, ORIG_ORG_CODE, ORIG_ORG_NAME, 
    DEST_ORG_CODE, DEST_ORG_NAME, ORIG_UNIFIED_CODE, DEST_UNIFIED_CODE, VOUCHER_BEGIN_TIME, 
    VOUCHER_END_TIME, CUSTOMER_TYPE,
    UR_DEST_CH_NPOD / 100 UR_DEST_CH_NPOD, 
    UR_DEST_CD_NPOD / 100 UR_DEST_CD_NPOD, 
    UR_DEST_CH_POD / 100 UR_DEST_CH_POD, 
    UR_DEST_CD_POD / 100 UR_DEST_CD_POD, 
    AIR_COST_COM_CONFIRM / 100 AIR_COST_COM_CONFIRM, 
    AIR_COST_ORIG_AGENCY_CFM /100 AIR_COST_ORIG_AGENCY_CFM, 
    AIR_COST_DEST_AGENCY_GEN / 100 AIR_COST_DEST_AGENCY_GEN, 
    AIR_COST_DEST_AGENCY_CFM / 100 AIR_COST_DEST_AGENCY_CFM, 
    AIR_COST_DEST_AGENCY_NCFM / 100 AIR_COST_DEST_AGENCY_NCFM, 
    AIR_COST_OTHER_CONFIRM / 100 AIR_COST_OTHER_CONFIRM, 
    AIR_COST_PAY_APPLY / 100 AIR_COST_PAY_APPLY, 
    OTH_ENTRY / 100 OTH_ENTRY, 
    OTH_RCV_CH / 100 OTH_RCV_CH, 
    OTH_RCV_CD / 100 OTH_RCV_CD, 
    AIR_DR_DEST_RCV_POD / 100 AIR_DR_DEST_RCV_POD, 
    AIR_DR_DEST_RCV_NPOD / 100 AIR_DR_DEST_RCV_NPOD, 
    AIR_DR_CH / 100 AIR_DR_CH, 
    AIR_DR_CD /100 AIR_DR_CD, 
    AIR_DR_WO_OTHER_RCV / 100 AIR_DR_WO_OTHER_RCV, 
    AIR_DR_WO_COD_RCV_POD / 100 AIR_DR_WO_COD_RCV_POD, 
    AIR_DR_WO_COD_RCV_NPOD / 100 AIR_DR_WO_COD_RCV_NPOD,
     AIR_DR_PAY_APPLY / 100 AIR_DR_PAY_APPLY, 
    AIR_PR_AGENCY_WO_DEST_RCV_POD / 100 airPrAgencyWoDestRcvPod,
    AIR_PR_AGENCY_WO_DEST_RCV_NPOD / 100 AIR_PR_AGENCY_WO_DEST_RCV_NPOD, 
    AIR_PR_OT_WO_DEST_RCV_POD / 100 AIR_PR_OT_WO_DEST_RCV_POD, 
    AIR_PR_OTH_WO_DEST_RCV_NPOD / 100 airPrOthWoDestRcvNpod, 
    AIR_PR_OTH_WO_OTH_RCV / 100 AIR_PR_OTH_WO_OTH_RCV, 
    AIR_COD_CH_POD / 100 AIR_COD_CH_POD, 
    AIR_COD_CD_POD / 100 AIR_COD_CD_POD, 
    AIR_COD_POD_WO_COD / 100 AIR_COD_POD_WO_COD, 
    AIR_COD_NPOD_WO_COD / 100 AIR_COD_NPOD_WO_COD, 
    AIR_COD_CH_NPOD / 100 AIR_COD_CH_NPOD, 
    AIR_COD_CD_NPOD / 100 AIR_COD_CD_NPOD, 
    AIR_COD_WO_AGENCY_PAY_POD / 100 AIR_COD_WO_AGENCY_PAY_POD, 
    AIR_COD_WO_OTH_PAY_COD / 100 AIR_COD_WO_OTH_PAY_COD, 
    AIR_COD_WO_AGENCY_PAY_NPOD / 100 AIR_COD_WO_AGENCY_PAY_NPOD, 
    AIR_COD_WO_OTH_NPOD / 100 AIR_COD_WO_OTH_NPOD, APT_COM / 100 APT_COM, 
    APT_WO_COM_PAY / 100 APT_WO_COM_PAY, APT_WO_OTH_PAY / 100 APT_WO_OTH_PAY, 
    BDR_WO_OTH_RCV / 100 BDR_WO_OTH_RCV
  </sql>
  
  <!-- 按条件查询列表 -->
  <select id="selectListByConditions" resultMap="BaseResultMap" parameterType="com.deppon.foss.module.settlement.closing.api.shared.dto.MvrAfrDto" >
    SELECT  /*结算-凭证报表-根据条件查询始发空运月报表*/
    <include refid="Base_Column_List" />
    FROM STV.T_STL_MVR_AFR T
    <where>
    	<!-- 期间 -->
    	T.PERIOD = #{period,jdbcType=VARCHAR}
    	
    	<!-- 业务类型 -->
    	<if test="productCode != null and productCode != ''">
    		AND T.PRODUCT_CODE = #{productCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 客户 -->
    	<if test="customerCode != null and customerCode != ''">
    		AND T.CUSTOMER_CODE = #{customerCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 始发部门 -->
    	<if test="origOrgCode != null and origOrgCode != ''">
    		AND T.ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 到达部门 
    	<if test="destOrgCode !=null and destOrgCode != ''">
    		AND T.DEST_ORG_CODE = #{destOrgCode,jdbcType=VARCHAR}
    	</if> -->
    	
    	<!-- 到达部门加入数据权限  -->
	    <if test="userCode != null and userCode != ''">
		  and exists (select 1
	         from bse.mv_bas_user_org_auth_view uov
	        where uov.emp_code = #{userCode}
	          and uov.Org_Code = t.DEST_ORG_CODE
		          <if test="destOrgCode != null and destOrgCode != '' ">
		          and uov.Org_Code = #{destOrgCode,jdbcType=VARCHAR}
		          </if> 
	          ) 
	    </if>
	    
    </where>
  </select>
  
  <!-- 按条件查询汇总 -->
  <select id="selectTotalByConditions" resultType="com.deppon.foss.module.settlement.closing.api.shared.dto.MvrAfrDto" parameterType="com.deppon.foss.module.settlement.closing.api.shared.dto.MvrAfrDto" >
    SELECT /*结算-凭证报表-根据条件查询始发空运月报表总条数，总金额*/
    	--总条数
    	COUNT(1) COUNT,
		SUM(T.UR_DEST_CH_NPOD / 100) urDestChNpod, 
    	SUM(T.UR_DEST_CD_NPOD / 100) urDestCdNpod, 
    	SUM(T.UR_DEST_CH_POD / 100) urDestChPod, 
    	SUM(T.UR_DEST_CD_POD / 100) urDestCdPod, 
    	SUM(T.AIR_COST_COM_CONFIRM / 100) airCostComConfirm, 
	    SUM(T.AIR_COST_ORIG_AGENCY_CFM /100) airCostOrigAgencyCfm, 
	    SUM(T.AIR_COST_DEST_AGENCY_GEN / 100) airCostDestAgencyGen, 
	    SUM(T.AIR_COST_DEST_AGENCY_CFM / 100) airCostDestAgencyCfm, 
	    SUM(T.AIR_COST_DEST_AGENCY_NCFM / 100) airCostDestAgencyNcfm, 
	    SUM(T.AIR_COST_OTHER_CONFIRM / 100) airCostOtherConfirm, 
	    SUM(T.AIR_COST_PAY_APPLY / 100) airCostPayApply, 
	    SUM(T.OTH_ENTRY / 100) othEntry, 
	    SUM(T.OTH_RCV_CH / 100) othRcvCh, 
	    SUM(T.OTH_RCV_CD / 100) othRcvCd, 
	    SUM(T.AIR_DR_DEST_RCV_POD / 100) airDrDestRcvPod, 
	    SUM(T.AIR_DR_DEST_RCV_NPOD / 100) airDrDestRcvNpod, 
	    SUM(T.AIR_DR_CH / 100) airDrCh, 
	    SUM(T.AIR_DR_CD /100) airDrCd, 
	    SUM(T.AIR_DR_WO_OTHER_RCV / 100) airDrWoOtherRcv, 
	    SUM(T.AIR_DR_WO_COD_RCV_POD / 100) airDrWoCodRcvPod, 
	    SUM(T.AIR_DR_WO_COD_RCV_NPOD / 100) airDrWoCodRcvNpod,
	    SUM(T.AIR_DR_PAY_APPLY / 100) airDrPayApply, 
	    SUM(T.AIR_PR_AGENCY_WO_DEST_RCV_POD / 100) airPrAgencyWoDestRcvPod,
	    SUM(T.AIR_PR_AGENCY_WO_DEST_RCV_NPOD / 100) airPrAgencyWoDestRcvNpod, 
	    SUM(T.AIR_PR_OT_WO_DEST_RCV_POD / 100) airPrOtWoDestRcvPod, 
	    SUM(T.AIR_PR_OTH_WO_DEST_RCV_NPOD / 100) airPrOthWoDestRcvNpod, 
	    SUM(T.AIR_PR_OTH_WO_OTH_RCV / 100) airPrOthWoOthRcv, 
	    SUM(T.AIR_COD_CH_POD / 100) airCodChPod, 
	    SUM(T.AIR_COD_CD_POD / 100) airCodCdPod, 
	    SUM(T.AIR_COD_POD_WO_COD / 100) airCodPodWoCod, 
	    SUM(T.AIR_COD_NPOD_WO_COD / 100) airCodNpodWoCod, 
	    SUM(T.AIR_COD_CH_NPOD / 100) airCodChNpod, 
	    SUM(T.AIR_COD_CD_NPOD / 100) airCodCdNpod, 
	    SUM(T.AIR_COD_WO_AGENCY_PAY_POD / 100) airCodWoAgencyPayPod, 
	    SUM(T.AIR_COD_WO_OTH_PAY_COD / 100) airCodWoOthPayCod, 
	    SUM(T.AIR_COD_WO_AGENCY_PAY_NPOD / 100) airCodWoAgencyPayNpod, 
	    SUM(T.AIR_COD_WO_OTH_NPOD / 100) airCodWoOthNpod, 
	    SUM(T.APT_COM / 100) aptCom, 
	    SUM(T.APT_WO_COM_PAY / 100) aptWoComPay, 
	    SUM(T.APT_WO_OTH_PAY / 100) aptWoOthPay, 
	    SUM(T.BDR_WO_OTH_RCV / 100) bdrWoOthRcv

    FROM STV.T_STL_MVR_AFR T
    <where>
    	<!-- 期间 -->
    	T.PERIOD = #{period,jdbcType=VARCHAR}
    	
    	<!-- 业务类型 -->
    	<if test="productCode != null and productCode != ''">
    		AND T.PRODUCT_CODE = #{productCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 客户 -->
    	<if test="customerCode != null and customerCode != ''">
    		AND T.CUSTOMER_CODE = #{customerCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 始发部门 -->
    	<if test="origOrgCode != null and origOrgCode != ''">
    		AND T.ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 到达部门
    	<if test="destOrgCode !=null and destOrgCode != ''">
    		AND T.DEST_ORG_CODE = #{destOrgCode,jdbcType=VARCHAR}
    	</if> -->
    	
    	<!-- 到达部门加入数据权限  -->
	    <if test="userCode != null and userCode != ''">
		  and exists (select 1
	         from bse.mv_bas_user_org_auth_view uov
	        where uov.emp_code = #{userCode}
	          and uov.Org_Code = t.DEST_ORG_CODE
		          <if test="destOrgCode != null and destOrgCode != '' ">
		          and uov.Org_Code = #{destOrgCode,jdbcType=VARCHAR}
		          </if> 
	          ) 
	    </if>
    </where>
  </select>
</mapper>