<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.stv.MvrLddEntityMapper" >
  <resultMap id="BaseResultMap" type="com.deppon.foss.module.settlement.closing.api.shared.domain.MvrLddEntity" >
    <result column="ID" property="id" jdbcType="VARCHAR" />
    <result column="PERIOD" property="period" jdbcType="VARCHAR" />
    <result column="PRODUCT_CODE" property="productCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_CODE" property="customerCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="ORIG_ORG_CODE" property="origOrgCode" jdbcType="VARCHAR" />
    <result column="ORIG_ORG_NAME" property="origOrgName" jdbcType="VARCHAR" />
    <result column="DEST_ORG_CODE" property="destOrgCode" jdbcType="VARCHAR" />
    <result column="DEST_ORG_NAME" property="destOrgName" jdbcType="VARCHAR" />
    <result column="ORIG_UNIFIED_CODE" property="origUnifiedCode" jdbcType="VARCHAR" />
    <result column="DEST_UNIFIED_CODE" property="destUnifiedCode" jdbcType="VARCHAR" />
    <result column="VOUCHER_BEGIN_TIME" property="voucherBeginTime" jdbcType="TIMESTAMP" />
    <result column="VOUCHER_END_TIME" property="voucherEndTime" jdbcType="TIMESTAMP" />
    <result column="CUSTOMER_TYPE" property="customerType" jdbcType="VARCHAR" />
    <result column="LAND_COST_AGENCY_GEN" property="landCostAgencyGen" jdbcType="DECIMAL" />
    <result column="LAND_COST_AGENCY_CFM" property="landCostAgencyCfm" jdbcType="DECIMAL" />
    <result column="LAND_COST_AGENCY_NCFM" property="landCostAgencyNcfm" jdbcType="DECIMAL" />
    <result column="LAND_COST_OTHER_CONFIRM" property="landCostOtherConfirm" jdbcType="DECIMAL" />
    <result column="LAND_COST_PAY_APPLY" property="landCostPayApply" jdbcType="DECIMAL" />
    <result column="LAND_OTH_ENTRY" property="landOthEntry" jdbcType="DECIMAL" />
    <result column="LAND_OTH_RCV_CH" property="landOthRcvCh" jdbcType="DECIMAL" />
    <result column="LAND_OTH_RCV_CD" property="landOthRcvCd" jdbcType="DECIMAL" />
    <result column="LAND_COD_CH_POD" property="landCodChPod" jdbcType="DECIMAL" />
    <result column="LAND_COD_CD_POD" property="landCodCdPod" jdbcType="DECIMAL" />
    <result column="LAND_COD_POD_WO_COD" property="landCodPodWoCod" jdbcType="DECIMAL" />
    <result column="LAND_COD_NPOD_WO_COD" property="landCodNpodWoCod" jdbcType="DECIMAL" />
    <result column="LAND_COD_CH_NPOD" property="landCodChNpod" jdbcType="DECIMAL" />
    <result column="LAND_COD_CD_NPOD" property="landCodCdNpod" jdbcType="DECIMAL" />
    <result column="LAND_COD_WO_AGENCY_PAY_POD" property="landCodWoAgencyPayPod" jdbcType="DECIMAL" />
    <result column="LAND_COD_WO_OTH_PAY_COD" property="landCodWoOthPayCod" jdbcType="DECIMAL" />
    <result column="LAND_COD_WO_AGENCY_PAY_NPOD" property="landCodWoAgencyPayNpod" jdbcType="DECIMAL" />
    <result column="LAND_COD_WO_OTH_NPOD" property="landCodWoOthNpod" jdbcType="DECIMAL" />
    <result column="LAND_BDR_WO_OTH_RCV" property="landBdrWoOthRcv" jdbcType="DECIMAL" />
    <result column="LAND_UR_DEST_CH_NPOD" property="landUrDestChNpod" jdbcType="DECIMAL" />
    <result column="LAND_UR_DEST_CD_NPOD" property="landUrDestCdNpod" jdbcType="DECIMAL" />
    <result column="LAND_UR_DEST_CH_POD" property="landUrDestChPod" jdbcType="DECIMAL" />
    <result column="LAND_UR_DEST_CD_POD" property="landUrDestCdPod" jdbcType="DECIMAL" />
    <result column="LAND_PR_AGENCY_WO_DEST_RCV_POD" property="landPrAgencyWoDestRcvPod" jdbcType="DECIMAL" />
    <result column="LAND_PR_AGENCY_WO_DEST_RCV_NP" property="landPrAgencyWoDestRcvNp" jdbcType="DECIMAL" />
    <result column="LAND_PR_OT_WO_DEST_RCV_POD" property="landPrOtWoDestRcvPod" jdbcType="DECIMAL" />
    <result column="LAND_PR_OTH_WO_DEST_RCV_NPOD" property="landPrOthWoDestRcvNpod" jdbcType="DECIMAL" />
    <result column="LAND_PR_OTH_WO_OTH_RCV" property="landPrOthWoOthRcv" jdbcType="DECIMAL" />
    <result column="LAND_DR_DEST_RCV_POD" property="landDrDestRcvPod" jdbcType="DECIMAL" />
    <result column="LAND_DR_DEST_RCV_NPOD" property="landDrDestRcvNpod" jdbcType="DECIMAL" />
    <result column="LAND_DR_CH" property="landDrCh" jdbcType="DECIMAL" />
    <result column="LAND_DR_CD" property="landDrCd" jdbcType="DECIMAL" />
    <result column="LAND_DR_WO_OTHER_RCV" property="landDrWoOtherRcv" jdbcType="DECIMAL" />
    <result column="LAND_DR_WO_COD_RCV_POD" property="landDrWoCodRcvPod" jdbcType="DECIMAL" />
    <result column="LAND_DR_WO_COD_RCV_NPOD" property="landDrWoCodRcvNpod" jdbcType="DECIMAL" />
    <result column="LAND_DR_PAY_APPLY" property="landDrPayApply" jdbcType="DECIMAL" />
    <result column="LAND_APT_COM" property="landAptCom" jdbcType="DECIMAL" />
    <result column="LAND_APT_WO_COM_PAY" property="landAptWoComPay" jdbcType="DECIMAL" />
    <result column="LAND_APT_WO_OTH_PAY" property="landAptWoOthPay" jdbcType="DECIMAL" />
  </resultMap>
  
   <sql id="Base_Column_List" >
	   ID,
	   PERIOD,
	   PRODUCT_CODE,
	   CUSTOMER_CODE,
	   CUSTOMER_NAME,
	   ORIG_ORG_CODE,
	   ORIG_ORG_NAME,
	   DEST_ORG_CODE,
	   DEST_ORG_NAME,
	   ORIG_UNIFIED_CODE,
	   DEST_UNIFIED_CODE,
	   VOUCHER_BEGIN_TIME,
	   VOUCHER_END_TIME,
	   CUSTOMER_TYPE,
	   LAND_COST_AGENCY_GEN/100 LAND_COST_AGENCY_GEN,
	   LAND_COST_AGENCY_CFM/100 LAND_COST_AGENCY_CFM,
	   LAND_COST_AGENCY_NCFM/100 LAND_COST_AGENCY_NCFM,
	   LAND_COST_OTHER_CONFIRM/100 LAND_COST_OTHER_CONFIRM,
	   LAND_COST_PAY_APPLY/100 LAND_COST_PAY_APPLY,
	   LAND_OTH_ENTRY/100 LAND_OTH_ENTRY,
	   LAND_OTH_RCV_CH/100 LAND_OTH_RCV_CH, 
	   LAND_OTH_RCV_CD/100 LAND_OTH_RCV_CD,
	   LAND_COD_CH_POD/100 LAND_COD_CH_POD,
	   LAND_COD_CD_POD/100 LAND_COD_CD_POD,
	   LAND_COD_POD_WO_COD/100 LAND_COD_POD_WO_COD,
	   LAND_COD_NPOD_WO_COD/100 LAND_COD_NPOD_WO_COD,
	   LAND_COD_CH_NPOD/100 LAND_COD_CH_NPOD,
	   LAND_COD_CD_NPOD/100 LAND_COD_CD_NPOD,
	   LAND_COD_WO_AGENCY_PAY_POD/100 LAND_COD_WO_AGENCY_PAY_POD,
	   LAND_COD_WO_OTH_PAY_COD/100 LAND_COD_WO_OTH_PAY_COD,
	   LAND_COD_WO_AGENCY_PAY_NPOD/100 LAND_COD_WO_AGENCY_PAY_NPOD,
	   LAND_COD_WO_OTH_NPOD/100 LAND_COD_WO_OTH_NPOD,
	   LAND_BDR_WO_OTH_RCV/100 LAND_BDR_WO_OTH_RCV,
	   LAND_UR_DEST_CH_NPOD/100 LAND_UR_DEST_CH_NPOD,
	   LAND_UR_DEST_CD_NPOD/100 LAND_UR_DEST_CD_NPOD,
	   LAND_UR_DEST_CH_POD/100 LAND_UR_DEST_CH_POD,
	   LAND_UR_DEST_CD_POD/100 LAND_UR_DEST_CD_POD,
	   LAND_PR_AGENCY_WO_DEST_RCV_POD/100 LAND_PR_AGENCY_WO_DEST_RCV_POD,
	   LAND_PR_AGENCY_WO_DEST_RCV_NP/100 LAND_PR_AGENCY_WO_DEST_RCV_NP,
	   LAND_PR_OT_WO_DEST_RCV_POD/100 LAND_PR_OT_WO_DEST_RCV_POD,
	   LAND_PR_OTH_WO_DEST_RCV_NPOD/100 LAND_PR_OTH_WO_DEST_RCV_NPOD,
	   LAND_PR_OTH_WO_OTH_RCV/100 LAND_PR_OTH_WO_OTH_RCV,
	   LAND_DR_DEST_RCV_POD/100 LAND_DR_DEST_RCV_POD,
	   LAND_DR_DEST_RCV_NPOD/100 LAND_DR_DEST_RCV_NPOD,
	   LAND_DR_CH/100 LAND_DR_CH,
	   LAND_DR_CD/100 LAND_DR_CD,
	   LAND_DR_WO_OTHER_RCV/100 LAND_DR_WO_OTHER_RCV,
	   LAND_DR_WO_COD_RCV_POD/100 LAND_DR_WO_COD_RCV_POD,
	   LAND_DR_WO_COD_RCV_NPOD/100 LAND_DR_WO_COD_RCV_NPOD,
	   LAND_DR_PAY_APPLY/100 LAND_DR_PAY_APPLY,
	   LAND_APT_COM/100 LAND_APT_COM,
	   LAND_APT_WO_COM_PAY/100 LAND_APT_WO_COM_PAY,
	   LAND_APT_WO_OTH_PAY/100 LAND_APT_WO_OTH_PAY
  </sql>
  
  <!-- 按条件查询列表 -->
  <select id="selectListByConditions" resultMap="BaseResultMap" parameterType="com.deppon.foss.module.settlement.closing.api.shared.dto.MvrLddDto" >
    SELECT  /*结算-凭证报表-根据条件查询始发快递代理月报表*/
    <include refid="Base_Column_List" />
    FROM STV.T_STL_MVR_LDD T
    <where>
    	<!-- 期间 -->
    	T.PERIOD = #{period,jdbcType=VARCHAR}
    	
    	<!-- 业务类型 -->
    	<if test="productCode != null and productCode != ''">
    		AND T.PRODUCT_CODE = #{productCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 客户 -->
    	<if test="customerCode != null and customerCode != ''">
    		AND T.CUSTOMER_CODE = #{customerCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 始发部门 -->
    	<if test="origOrgCode != null and origOrgCode != ''">
    		AND T.ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR}
    	</if>

    	<!-- 到达部门加入数据权限  -->
	    <if test="userCode != null and userCode != ''">
		  and exists (select 1
	         from bse.mv_bas_user_org_auth_view uov
	        where uov.emp_code = #{userCode}
	          and uov.Org_Code = t.DEST_ORG_CODE
		          <if test="destOrgCode != null and destOrgCode != '' ">
		          and uov.Org_Code = #{destOrgCode,jdbcType=VARCHAR}
		          </if> 
	          ) 
	    </if>
	    
    </where>
  </select>
  
  <!-- 按条件查询汇总 -->
  <select id="selectTotalByConditions" resultType="com.deppon.foss.module.settlement.closing.api.shared.dto.MvrLddDto" parameterType="com.deppon.foss.module.settlement.closing.api.shared.dto.MvrLddDto" >
    SELECT /*结算-凭证报表-根据条件查询始发快递代理月报表总条数，总金额*/
    	--总条数
       COUNT(1) count,
	   SUM(LAND_COST_AGENCY_GEN/100) landCostAgencyGen,
	   SUM(LAND_COST_AGENCY_CFM/100) landCostAgencyCfm,
	   SUM(LAND_COST_AGENCY_NCFM/100) landCostAgencyNcfm,
	   SUM(LAND_COST_OTHER_CONFIRM/100) landCostOtherConfirm,
	   SUM(LAND_COST_PAY_APPLY/100) landCostPayApply,
	   SUM(LAND_OTH_ENTRY/100) landOthEntry, 
	   SUM(LAND_OTH_RCV_CH/100) landOthRcvCh,
	   SUM(LAND_OTH_RCV_CD/100) landOthRcvCd,
	   SUM(LAND_COD_CH_POD/100) landCodChPod,
	   SUM(LAND_COD_CD_POD/100) landCodCdPod,
	   SUM(LAND_COD_POD_WO_COD/100) landCodPodWoCod,
	   SUM(LAND_COD_NPOD_WO_COD/100) landCodNpodWoCod,
	   SUM(LAND_COD_CH_NPOD/100) landCodChNpod,
	   SUM(LAND_COD_CD_NPOD/100) landCodCdNpod,
	   SUM(LAND_COD_WO_AGENCY_PAY_POD/100) landCodWoAgencyPayPod,
	   SUM(LAND_COD_WO_OTH_PAY_COD/100) landCodWoOthPayCod,
	   SUM(LAND_COD_WO_AGENCY_PAY_NPOD/100) landCodWoAgencyPayNpod,
	   SUM(LAND_COD_WO_OTH_NPOD/100) landCodWoOthNpod,
	   SUM(LAND_BDR_WO_OTH_RCV/100) landBdrWoOthRcv,
	   SUM(LAND_UR_DEST_CH_NPOD/100) landUrDestChNpod,
	   SUM(LAND_UR_DEST_CD_NPOD/100) landUrDestCdNpod,
	   SUM(LAND_UR_DEST_CH_POD/100) landUrDestChPod,
	   SUM(LAND_UR_DEST_CD_POD/100) landUrDestCdPod,
	   SUM(LAND_PR_AGENCY_WO_DEST_RCV_POD/100) landPrAgencyWoDestRcvPod,
	   SUM(LAND_PR_AGENCY_WO_DEST_RCV_NP/100) landPrAgencyWoDestRcvNp,
	   SUM(LAND_PR_OT_WO_DEST_RCV_POD/100) landPrOtWoDestRcvPod,
	   SUM(LAND_PR_OTH_WO_DEST_RCV_NPOD/100) landPrOthWoDestRcvNpod,
	   SUM(LAND_PR_OTH_WO_OTH_RCV/100) landPrOthWoOthRcv,
	   SUM(LAND_DR_DEST_RCV_POD/100) landDrDestRcvPod,
	   SUM(LAND_DR_DEST_RCV_NPOD/100) landDrDestRcvNpod,
	   SUM(LAND_DR_CH/100) landDrCh,
	   SUM(LAND_DR_CD/100) landDrCd,
	   SUM(LAND_DR_WO_OTHER_RCV/100) landDrWoOtherRcv,
	   SUM(LAND_DR_WO_COD_RCV_POD/100) landDrWoCodRcvPod,
	   SUM(LAND_DR_WO_COD_RCV_NPOD/100) landDrWoCodRcvNpod,
	   SUM(LAND_DR_PAY_APPLY/100) landDrPayApply,
	   SUM(LAND_APT_COM/100) landAptCom,
	   SUM(LAND_APT_WO_COM_PAY/100) landAptWoComPay,
	   SUM(LAND_APT_WO_OTH_PAY/100) landAptWoOthPay
    FROM STV.T_STL_MVR_LDD T
    <where>
    	<!-- 期间 -->
    	T.PERIOD = #{period,jdbcType=VARCHAR}
    	
    	<!-- 业务类型 -->
    	<if test="productCode != null and productCode != ''">
    		AND T.PRODUCT_CODE = #{productCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 客户 -->
    	<if test="customerCode != null and customerCode != ''">
    		AND T.CUSTOMER_CODE = #{customerCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 始发部门 -->
    	<if test="origOrgCode != null and origOrgCode != ''">
    		AND T.ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR}
    	</if>
    	
    	<!-- 到达部门加入数据权限  -->
	    <if test="userCode != null and userCode != ''">
		  and exists (select 1
	         from bse.mv_bas_user_org_auth_view uov
	        where uov.emp_code = #{userCode}
	          and uov.Org_Code = t.DEST_ORG_CODE
		          <if test="destOrgCode != null and destOrgCode != '' ">
		          and uov.Org_Code = #{destOrgCode,jdbcType=VARCHAR}
		          </if> 
	          ) 
	    </if>
    </where>
 </select>
</mapper>