<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.stl.BillReceivableEntityDao">
	<resultMap id="BaseResultMap"
		type="com.deppon.foss.module.settlement.common.api.shared.domain.BillReceivableEntity">
		<id column="ID" property="id" jdbcType="VARCHAR" />
		<result column="RECEIVABLE_NO" property="receivableNo"
			jdbcType="VARCHAR" />
		<result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
		<result column="WAYBILL_ID" property="waybillId" jdbcType="VARCHAR" />
		<result column="CREATE_TYPE" property="createType" jdbcType="VARCHAR" />
		<result column="SOURCE_BILL_NO" property="sourceBillNo"
			jdbcType="VARCHAR" />
		<result column="SOURCE_BILL_TYPE" property="sourceBillType"
			jdbcType="VARCHAR" />
		<result column="BILL_TYPE" property="billType" jdbcType="VARCHAR" />
		<result column="RECEIVABLE_ORG_CODE" property="receivableOrgCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVABLE_ORG_NAME" property="receivableOrgName"
			jdbcType="VARCHAR" />
		<result column="GENERATING_ORG_CODE" property="generatingOrgCode"
			jdbcType="VARCHAR" />
		<result column="GENERATING_ORG_NAME" property="generatingOrgName"
			jdbcType="VARCHAR" />
		<result column="GENERATING_COM_CODE" property="generatingComCode"
			jdbcType="VARCHAR" />
		<result column="GENERATING_COM_NAME" property="generatingComName"
			jdbcType="VARCHAR" />
		<result column="DUNNING_ORG_CODE" property="dunningOrgCode"
			jdbcType="VARCHAR" />
		<result column="DUNNING_ORG_NAME" property="dunningOrgName"
			jdbcType="VARCHAR" />
		<result column="ORIG_ORG_CODE" property="origOrgCode" jdbcType="VARCHAR" />
		<result column="ORIG_ORG_NAME" property="origOrgName" jdbcType="VARCHAR" />
		<result column="DEST_ORG_CODE" property="destOrgCode" jdbcType="VARCHAR" />
		<result column="DEST_ORG_NAME" property="destOrgName" jdbcType="VARCHAR" />
		<result column="CUSTOMER_CODE" property="customerCode"
			jdbcType="VARCHAR" />
		<result column="CUSTOMER_NAME" property="customerName"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_CODE" property="deliveryCustomerCode"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_NAME" property="deliveryCustomerName"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CODE" property="receiveCustomerCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_NAME" property="receiveCustomerName"
			jdbcType="VARCHAR" />
		<result column="AMOUNT" property="amount" jdbcType="DECIMAL" />
		<result column="VERIFY_AMOUNT" property="verifyAmount"
			jdbcType="DECIMAL" />
		<result column="UNVERIFY_AMOUNT" property="unverifyAmount"
			jdbcType="DECIMAL" />
		<result column="CURRENCY_CODE" property="currencyCode"
			jdbcType="VARCHAR" />
		<result column="BUSINESS_DATE" property="businessDate"
			jdbcType="TIMESTAMP" />
		<result column="ACCOUNT_DATE" property="accountDate" jdbcType="TIMESTAMP" />
		<result column="CONREVEN_DATE" property="conrevenDate"
			jdbcType="TIMESTAMP" />
		<result column="PAYMENT_TYPE" property="paymentType" jdbcType="VARCHAR" />
		<result column="PRODUCT_CODE" property="productCode" jdbcType="VARCHAR" />
		<result column="PRODUCT_ID" property="productId" jdbcType="VARCHAR" />
		<result column="TRANSPORT_FEE" property="transportFee"
			jdbcType="DECIMAL" />
		<result column="PICKUP_FEE" property="pickupFee" jdbcType="DECIMAL" />
		<result column="DELIVERY_GOODS_FEE" property="deliveryGoodsFee"
			jdbcType="DECIMAL" />
		<result column="PACKAGING_FEE" property="packagingFee"
			jdbcType="DECIMAL" />
		<result column="COD_FEE" property="codFee" jdbcType="DECIMAL" />
		<result column="INSURANCE_FEE" property="insuranceFee"
			jdbcType="DECIMAL" />
		<result column="OTHER_FEE" property="otherFee" jdbcType="DECIMAL" />
		<result column="VALUE_ADD_FEE" property="valueAddFee" jdbcType="DECIMAL" />
		<result column="PROMOTIONS_FEE" property="promotionsFee"
			jdbcType="DECIMAL" />
		<result column="GOODS_NAME" property="goodsName" jdbcType="VARCHAR" />
		<result column="BILL_WEIGHT" property="billWeight" jdbcType="DECIMAL" />
		<result column="RECEIVE_METHOD" property="receiveMethod"
			jdbcType="VARCHAR" />
		<result column="CUSTOMER_PICKUP_ORG_CODE" property="customerPickupOrgCode"
			jdbcType="VARCHAR" />
		<result column="GOODS_QTY_TOTAL" property="goodsQtyTotal"
			jdbcType="DECIMAL" />
		<result column="GOODS_VOLUME_TOTAL" property="goodsVolumeTotal"
			jdbcType="DECIMAL" />
		<result column="TARGET_ORG_CODE" property="targetOrgCode"
			jdbcType="VARCHAR" />
		<result column="VERSION_NO" property="versionNo" jdbcType="DECIMAL" />
		<result column="ACTIVE" property="active" jdbcType="CHAR" />
		<result column="IS_RED_BACK" property="isRedBack" jdbcType="CHAR" />
		<result column="IS_INIT" property="isInit" jdbcType="CHAR" />
		<result column="CREATE_USER_CODE" property="createUserCode"
			jdbcType="VARCHAR" />
		<result column="CREATE_USER_NAME" property="createUserName"
			jdbcType="VARCHAR" />
		<result column="CREATE_ORG_CODE" property="createOrgCode"
			jdbcType="VARCHAR" />
		<result column="CREATE_ORG_NAME" property="createOrgName"
			jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		<result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
		<result column="MODIFY_USER_CODE" property="modifyUserCode"
			jdbcType="VARCHAR" />
		<result column="MODIFY_USER_NAME" property="modifyUserName"
			jdbcType="VARCHAR" />
		<result column="STATEMENT_BILL_NO" property="statementBillNo"
			jdbcType="VARCHAR" />
		<result column="UNLOCK_DATE_TIME" property="unlockDateTime"
			jdbcType="TIMESTAMP" />
		<result column="LOCK_CUSTOMER_CODE" property="lockCustomerCode"
			jdbcType="VARCHAR" />
		<result column="LOCK_CUSTOMER_NAME" property="lockCustomerName"
			jdbcType="VARCHAR" />
		<result column="COLLECTION_TYPE" property="collectionType"
			jdbcType="VARCHAR" />
		<result column="AUDIT_USER_CODE" property="auditUserCode"
			jdbcType="VARCHAR" />
		<result column="AUDIT_USER_NAME" property="auditUserName"
			jdbcType="VARCHAR" />
		<result column="APPROVE_STATUS" property="approveStatus"
			jdbcType="VARCHAR" />
		<result column="AUDIT_DATE" property="auditDate" jdbcType="TIMESTAMP" />
		<result column="NOTES" property="notes" jdbcType="VARCHAR" />
		<result column="STAMP" property="stamp" jdbcType="CHAR" />
		<result column="EXPRESS_ORIG_ORG_CODE" property="expressOrigOrgCode" jdbcType="VARCHAR" />
	    <result column="EXPRESS_ORIG_ORG_NAME" property="expressOrigOrgName" jdbcType="VARCHAR" />
	    <result column="EXPRESS_DEST_ORG_CODE" property="expressDestOrgCode" jdbcType="VARCHAR" />
	    <result column="EXPRESS_DEST_ORG_NAME" property="expressDestOrgName" jdbcType="VARCHAR" />
	
		<result column="INVOICE_MARK" property="invoiceMark" jdbcType="VARCHAR" />
        <result column="UNIFIED_SETTLEMENT" property="unifiedSettlement" jdbcType="VARCHAR"/>
        <result column="CONTRACT_ORG_CODE" property="contractOrgCode" jdbcType="VARCHAR"/>
        <result column="CONTRACT_ORG_NAME" property="contractOrgName" jdbcType="VARCHAR"/>
        <result column="IS_DISCOUNT" property="isDiscount" jdbcType="VARCHAR"/>
        <result column="WITHHOLD_STATUS" property="withholdStatus" jdbcType="VARCHAR"/>
	</resultMap>
	
	<resultMap id="waybillReceivableDtoResultMap"
		type="com.deppon.foss.module.settlement.common.api.shared.dto.WaybillReceivableDto">
		
		<result column="AMOUNT" property="amount" jdbcType="DECIMAL" />
		<result column="VERIFY_AMOUNT" property="verAmount"
			jdbcType="DECIMAL" />
		<result column="UNVERIFY_AMOUNT" property="unverAmount"
			jdbcType="DECIMAL" />
		<result column="COD_AMOUNT" property="codAmount"
			jdbcType="DECIMAL" />
		<result column="INSURANCE_AMOUNT" property="insuranceAmount"
			jdbcType="DECIMAL" />
		<result column="TRASPORT_AMOUNT" property="transportAmount"
			jdbcType="DECIMAL" />
	    <result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
	</resultMap>
	
	<sql id="Base_Column_List">
		ID, RECEIVABLE_NO, WAYBILL_NO, WAYBILL_ID, CREATE_TYPE, SOURCE_BILL_NO,
		SOURCE_BILL_TYPE,
		BILL_TYPE, RECEIVABLE_ORG_CODE, RECEIVABLE_ORG_NAME, GENERATING_ORG_CODE,
		GENERATING_ORG_NAME,
		GENERATING_COM_CODE, GENERATING_COM_NAME, DUNNING_ORG_CODE, DUNNING_ORG_NAME,
		ORIG_ORG_CODE,
		ORIG_ORG_NAME, DEST_ORG_CODE, DEST_ORG_NAME, CUSTOMER_CODE,
		CUSTOMER_NAME,DELIVERY_CUSTOMER_CODE,DELIVERY_CUSTOMER_NAME,
		RECEIVE_CUSTOMER_CODE,RECEIVE_CUSTOMER_NAME,
		AMOUNT/100 AMOUNT, VERIFY_AMOUNT/100 VERIFY_AMOUNT, UNVERIFY_AMOUNT/100
		UNVERIFY_AMOUNT,
		CURRENCY_CODE, BUSINESS_DATE, ACCOUNT_DATE, CONREVEN_DATE, PAYMENT_TYPE,
		PRODUCT_CODE,
		PRODUCT_ID, 
		TRANSPORT_FEE/100 TRANSPORT_FEE,PICKUP_FEE/100 PICKUP_FEE,
		DELIVERY_GOODS_FEE/100 DELIVERY_GOODS_FEE, PACKAGING_FEE/100
		PACKAGING_FEE,
		COD_FEE/100 COD_FEE, INSURANCE_FEE/100 INSURANCE_FEE, OTHER_FEE/100 OTHER_FEE,
		VALUE_ADD_FEE/100 VALUE_ADD_FEE, PROMOTIONS_FEE/100 PROMOTIONS_FEE,
		GOODS_NAME,
		BILL_WEIGHT,RECEIVE_METHOD,CUSTOMER_PICKUP_ORG_CODE,GOODS_QTY_TOTAL,
		GOODS_VOLUME_TOTAL, TARGET_ORG_CODE, VERSION_NO,
		ACTIVE, IS_RED_BACK, IS_INIT, CREATE_USER_CODE, CREATE_USER_NAME,
		CREATE_ORG_CODE,
		CREATE_ORG_NAME, CREATE_TIME, MODIFY_TIME, MODIFY_USER_CODE, MODIFY_USER_NAME,
		STATEMENT_BILL_NO,
		UNLOCK_DATE_TIME, LOCK_CUSTOMER_CODE, LOCK_CUSTOMER_NAME,
		COLLECTION_TYPE, AUDIT_USER_CODE, AUDIT_USER_NAME,
		APPROVE_STATUS, AUDIT_DATE, NOTES,STAMP,
		EXPRESS_ORIG_ORG_CODE,EXPRESS_ORIG_ORG_NAME,EXPRESS_DEST_ORG_CODE,EXPRESS_DEST_ORG_NAME,INVOICE_MARK
		,UNIFIED_SETTLEMENT
		,CONTRACT_ORG_CODE
		,CONTRACT_ORG_NAME,IS_DISCOUNT
		,WITHHOLD_STATUS
	</sql>
	
	<insert id="insert"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillReceivableEntity">
		insert into /*结算-应收单-新增应收单*/ STL.T_STL_BILL_RECEIVABLE (ID, RECEIVABLE_NO, WAYBILL_NO,
		WAYBILL_ID, CREATE_TYPE, SOURCE_BILL_NO,
		SOURCE_BILL_TYPE, BILL_TYPE, RECEIVABLE_ORG_CODE,
		RECEIVABLE_ORG_NAME, GENERATING_ORG_CODE, GENERATING_ORG_NAME,
		GENERATING_COM_CODE, GENERATING_COM_NAME, DUNNING_ORG_CODE,
		DUNNING_ORG_NAME, ORIG_ORG_CODE, ORIG_ORG_NAME,
		DEST_ORG_CODE, DEST_ORG_NAME, CUSTOMER_CODE,
		CUSTOMER_NAME,DELIVERY_CUSTOMER_CODE,DELIVERY_CUSTOMER_NAME,
		RECEIVE_CUSTOMER_CODE,RECEIVE_CUSTOMER_NAME,
		AMOUNT, VERIFY_AMOUNT,
		UNVERIFY_AMOUNT, CURRENCY_CODE, BUSINESS_DATE,
		ACCOUNT_DATE, CONREVEN_DATE, PAYMENT_TYPE,
		PRODUCT_CODE, PRODUCT_ID, TRANSPORT_FEE,PICKUP_FEE, DELIVERY_GOODS_FEE,
		PACKAGING_FEE, COD_FEE, INSURANCE_FEE,
		OTHER_FEE, VALUE_ADD_FEE, PROMOTIONS_FEE,
		GOODS_NAME, BILL_WEIGHT,
		RECEIVE_METHOD,CUSTOMER_PICKUP_ORG_CODE,GOODS_QTY_TOTAL,
		GOODS_VOLUME_TOTAL, TARGET_ORG_CODE, VERSION_NO,
		ACTIVE, IS_RED_BACK, IS_INIT,
		CREATE_USER_CODE, CREATE_USER_NAME, CREATE_ORG_CODE,
		CREATE_ORG_NAME, CREATE_TIME, MODIFY_TIME,
		MODIFY_USER_CODE, MODIFY_USER_NAME, STATEMENT_BILL_NO,
		UNLOCK_DATE_TIME, LOCK_CUSTOMER_CODE,
		LOCK_CUSTOMER_NAME,
		COLLECTION_TYPE,  AUDIT_USER_CODE,
		AUDIT_USER_NAME, APPROVE_STATUS, AUDIT_DATE, NOTES,
		EXPRESS_ORIG_ORG_CODE,EXPRESS_ORIG_ORG_NAME,EXPRESS_DEST_ORG_CODE,EXPRESS_DEST_ORG_NAME,INVOICE_MARK
		,UNIFIED_SETTLEMENT
		,CONTRACT_ORG_CODE,
		CONTRACT_ORG_NAME,
		WITHHOLD_STATUS)
		values (#{id,jdbcType=VARCHAR}, #{receivableNo,jdbcType=VARCHAR},
		#{waybillNo,jdbcType=VARCHAR},
		#{waybillId,jdbcType=VARCHAR}, #{createType,jdbcType=VARCHAR}, #{sourceBillNo,jdbcType=VARCHAR},
		#{sourceBillType,jdbcType=VARCHAR}, #{billType,jdbcType=VARCHAR},
		#{receivableOrgCode,jdbcType=VARCHAR},
		#{receivableOrgName,jdbcType=VARCHAR},
		#{generatingOrgCode,jdbcType=VARCHAR},
		#{generatingOrgName,jdbcType=VARCHAR},
		#{generatingComCode,jdbcType=VARCHAR},
		#{generatingComName,jdbcType=VARCHAR},
		#{dunningOrgCode,jdbcType=VARCHAR},
		#{dunningOrgName,jdbcType=VARCHAR}, #{origOrgCode,jdbcType=VARCHAR},
		#{origOrgName,jdbcType=VARCHAR},
		#{destOrgCode,jdbcType=VARCHAR}, #{destOrgName,jdbcType=VARCHAR}, #{customerCode,jdbcType=VARCHAR},
		#{customerName,jdbcType=VARCHAR},#{deliveryCustomerCode,jdbcType=VARCHAR},#{deliveryCustomerName,jdbcType=VARCHAR},
		#{receiveCustomerCode,jdbcType=VARCHAR},#{receiveCustomerName,jdbcType=VARCHAR},
		#{amount,jdbcType=DECIMAL}*100, #{verifyAmount,jdbcType=DECIMAL}*100,
		#{unverifyAmount,jdbcType=DECIMAL}*100,
		#{currencyCode,jdbcType=VARCHAR}, #{businessDate,jdbcType=TIMESTAMP},
		#{accountDate,jdbcType=TIMESTAMP}, #{conrevenDate,jdbcType=TIMESTAMP},
		#{paymentType,jdbcType=VARCHAR},
		#{productCode,jdbcType=VARCHAR}, #{productId,jdbcType=VARCHAR}, 
		#{transportFee,jdbcType=DECIMAL}*100,#{pickupFee,jdbcType=DECIMAL}*100,
		#{deliveryGoodsFee,jdbcType=DECIMAL}*100,
		#{packagingFee,jdbcType=DECIMAL}*100, #{codFee,jdbcType=DECIMAL}*100,
		#{insuranceFee,jdbcType=DECIMAL}*100,
		#{otherFee,jdbcType=DECIMAL}*100, #{valueAddFee,jdbcType=DECIMAL}*100,
		#{promotionsFee,jdbcType=DECIMAL}*100,#{goodsName,jdbcType=VARCHAR},
		#{billWeight,jdbcType=DECIMAL},
		#{receiveMethod,jdbcType=VARCHAR}, #{customerPickupOrgCode,jdbcType=VARCHAR},
		#{goodsQtyTotal,jdbcType=DECIMAL},
		#{goodsVolumeTotal,jdbcType=DECIMAL},
		#{targetOrgCode,jdbcType=VARCHAR}, #{versionNo,jdbcType=DECIMAL},
		#{active,jdbcType=CHAR}, #{isRedBack,jdbcType=CHAR},
		#{isInit,jdbcType=CHAR},
		#{createUserCode,jdbcType=VARCHAR}, #{createUserName,jdbcType=VARCHAR},
		#{createOrgCode,jdbcType=VARCHAR},
		#{createOrgName,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, #{modifyTime,jdbcType=TIMESTAMP},
		#{modifyUserCode,jdbcType=VARCHAR},
		#{modifyUserName,jdbcType=VARCHAR},
		#{statementBillNo,jdbcType=VARCHAR},
		#{unlockDateTime,jdbcType=TIMESTAMP},
		#{lockCustomerCode,jdbcType=VARCHAR},
		#{lockCustomerName,jdbcType=VARCHAR},
		#{collectionType,jdbcType=VARCHAR},
	     #{auditUserCode,jdbcType=VARCHAR},
		#{auditUserName,jdbcType=VARCHAR}, #{approveStatus,jdbcType=VARCHAR},
		#{auditDate,jdbcType=TIMESTAMP},
		#{notes,jdbcType=VARCHAR},
		#{expressOrigOrgCode,jdbcType=VARCHAR},#{expressOrigOrgName,jdbcType=VARCHAR},#{expressDestOrgCode,jdbcType=VARCHAR},#{expressDestOrgName,jdbcType=VARCHAR}
		,#{invoiceMark,jdbcType=VARCHAR}
		,#{unifiedSettlement,jdbcType=VARCHAR}
		,#{contractOrgCode,jdbcType=VARCHAR}
		,#{contractOrgName,jdbcType=CHAR}
		,#{withholdStatus,jdbcType=CHAR}
		)
	</insert>

	<update id="updateByPrimaryKey"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillReceivableEntity">
		update /*结算-应收单-根据ID更新应收单*/ STL.T_STL_BILL_RECEIVABLE
		set RECEIVABLE_NO = #{receivableNo,jdbcType=VARCHAR},
		WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR},
		WAYBILL_ID = #{waybillId,jdbcType=VARCHAR},
		CREATE_TYPE = #{createType,jdbcType=VARCHAR},
		SOURCE_BILL_NO = #{sourceBillNo,jdbcType=VARCHAR},
		SOURCE_BILL_TYPE = #{sourceBillType,jdbcType=VARCHAR},
		BILL_TYPE = #{billType,jdbcType=VARCHAR},
		RECEIVABLE_ORG_CODE = #{receivableOrgCode,jdbcType=VARCHAR},
		RECEIVABLE_ORG_NAME = #{receivableOrgName,jdbcType=VARCHAR},
		GENERATING_ORG_CODE = #{generatingOrgCode,jdbcType=VARCHAR},
		GENERATING_ORG_NAME = #{generatingOrgName,jdbcType=VARCHAR},
		GENERATING_COM_CODE = #{generatingComCode,jdbcType=VARCHAR},
		GENERATING_COM_NAME = #{generatingComName,jdbcType=VARCHAR},
		DUNNING_ORG_CODE = #{dunningOrgCode,jdbcType=VARCHAR},
		DUNNING_ORG_NAME = #{dunningOrgName,jdbcType=VARCHAR},
		ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR},
		ORIG_ORG_NAME = #{origOrgName,jdbcType=VARCHAR},
		DEST_ORG_CODE = #{destOrgCode,jdbcType=VARCHAR},
		DEST_ORG_NAME = #{destOrgName,jdbcType=VARCHAR},
		CUSTOMER_CODE = #{customerCode,jdbcType=VARCHAR},
		CUSTOMER_NAME = #{customerName,jdbcType=VARCHAR},
		DELIVERY_CUSTOMER_CODE = #{deliveryCustomerCode,jdbcType=VARCHAR},
		DELIVERY_CUSTOMER_NAME = #{deliveryCustomerName,jdbcType=VARCHAR},
		RECEIVE_CUSTOMER_CODE = #{receiveCustomerCode,jdbcType=VARCHAR},
		RECEIVE_CUSTOMER_NAME = #{receiveCustomerName,jdbcType=VARCHAR},
		AMOUNT = #{amount,jdbcType=DECIMAL}*100,
		VERIFY_AMOUNT = #{verifyAmount,jdbcType=DECIMAL}*100,
		UNVERIFY_AMOUNT = #{unverifyAmount,jdbcType=DECIMAL}*100,
		CURRENCY_CODE = #{currencyCode,jdbcType=VARCHAR},
		BUSINESS_DATE = #{businessDate,jdbcType=TIMESTAMP},
		ACCOUNT_DATE = #{accountDate,jdbcType=TIMESTAMP},
		CONREVEN_DATE = #{conrevenDate,jdbcType=TIMESTAMP},
		PAYMENT_TYPE = #{paymentType,jdbcType=VARCHAR},
		PRODUCT_CODE = #{productCode,jdbcType=VARCHAR},
		PRODUCT_ID = #{productId,jdbcType=VARCHAR},
		TRANSPORT_FEE = #{transportFee,jdbcType=DECIMAL}*100,
		PICKUP_FEE = #{pickupFee,jdbcType=DECIMAL}*100,
		DELIVERY_GOODS_FEE = #{deliveryGoodsFee,jdbcType=DECIMAL}*100,
		PACKAGING_FEE = #{packagingFee,jdbcType=DECIMAL}*100,
		COD_FEE = #{codFee,jdbcType=DECIMAL}*100,
		INSURANCE_FEE = #{insuranceFee,jdbcType=DECIMAL}*100,
		OTHER_FEE = #{otherFee,jdbcType=DECIMAL}*100,
		VALUE_ADD_FEE = #{valueAddFee,jdbcType=DECIMAL}*100,
		PROMOTIONS_FEE = #{promotionsFee,jdbcType=DECIMAL}*100,
		GOODS_NAME = #{goodsName,jdbcType=VARCHAR},
		BILL_WEIGHT = #{billWeight,jdbcType=DECIMAL},
		RECEIVE_METHOD=#{receiveMethod,jdbcType=VARCHAR},
		CUSTOMER_PICKUP_ORG_CODE=#{customerPickupOrgCode,jdbcType=VARCHAR},
		GOODS_QTY_TOTAL=#{goodsQtyTotal,jdbcType=DECIMAL},
		GOODS_VOLUME_TOTAL = #{goodsVolumeTotal,jdbcType=DECIMAL},
		TARGET_ORG_CODE = #{targetOrgCode,jdbcType=VARCHAR},
		VERSION_NO = #{versionNo,jdbcType=DECIMAL},
		ACTIVE = #{active,jdbcType=CHAR},
		IS_RED_BACK = #{isRedBack,jdbcType=CHAR},
		IS_INIT = #{isInit,jdbcType=CHAR},
		CREATE_USER_CODE = #{createUserCode,jdbcType=VARCHAR},
		CREATE_USER_NAME = #{createUserName,jdbcType=VARCHAR},
		CREATE_ORG_CODE = #{createOrgCode,jdbcType=VARCHAR},
		CREATE_ORG_NAME = #{createOrgName,jdbcType=VARCHAR},
		CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
		MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
		MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
		MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
		STATEMENT_BILL_NO = #{statementBillNo,jdbcType=VARCHAR},
		UNLOCK_DATE_TIME = #{unlockDateTime,jdbcType=TIMESTAMP},
		LOCK_CUSTOMER_CODE = #{lockCustomerCode,jdbcType=VARCHAR},
		LOCK_CUSTOMER_NAME = #{lockCustomerName,jdbcType=VARCHAR},
		COLLECTION_TYPE = #{collectionType,jdbcType=VARCHAR},
		AUDIT_USER_CODE = #{auditUserCode,jdbcType=VARCHAR},
		AUDIT_USER_NAME = #{auditUserName,jdbcType=VARCHAR},
		APPROVE_STATUS = #{approveStatus,jdbcType=VARCHAR},
		AUDIT_DATE = #{auditDate,jdbcType=TIMESTAMP},
		NOTES = #{notes,jdbcType=VARCHAR}
		where ID = #{id,jdbcType=VARCHAR}
	</update>
	
	<!-- 修改应收单扣款状态 -->
	<update id="updateByWithholdStatus"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillReceivableEntity">
		UPDATE /*结算-应收单-修改应收单扣款状态*/ STL.T_STL_BILL_RECEIVABLE
		SET VERSION_NO = VERSION_NO + 1,
		ACTIVE = #{active,jdbcType=CHAR},
		WITHHOLD_STATUS = #{withholdStatus,jdbcType=VARCHAR},
		MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
		MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
		MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP}
		WHERE ID = #{id,jdbcType=VARCHAR}
		AND VERSION_NO = #{versionNo,jdbcType=DECIMAL}
	</update>

	<!-- 修改应收单为无效状态，增加作废状态 -->
	<update id="updateByWriteBack"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillReceivableEntity">
		UPDATE /*结算-应收单-修改应收单为无效状态，增加作废状态*/ STL.T_STL_BILL_RECEIVABLE
		SET VERSION_NO = VERSION_NO + 1,
		ACTIVE = #{active,jdbcType=CHAR},
		MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
		MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
		NOTES = NOTES || #{notes,jdbcType=VARCHAR},
		MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP}
		WHERE ID = #{id,jdbcType=VARCHAR}
		AND VERSION_NO = #{versionNo,jdbcType=DECIMAL}
	</update>

	<!-- 核销应收单 -->
	<update id="updateByWriteoff"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillWriteoffAmountDto">
		UPDATE /*结算-应收单-核销应收单*/ STL.T_STL_BILL_RECEIVABLE
		SET VERSION_NO = VERSION_NO + 1,
		MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
		VERIFY_AMOUNT = VERIFY_AMOUNT + #{writeoffAmount,jdbcType=DECIMAL}*100,
		UNVERIFY_AMOUNT = UNVERIFY_AMOUNT -
		#{writeoffAmount,jdbcType=DECIMAL}*100
		WHERE ID = #{id,jdbcType=VARCHAR}
		and VERSION_NO = #{versionNo,jdbcType=DECIMAL}
	</update>

	<!-- (反确认)确认收入日期 -->
	<update id="updateByConfirmIncome"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillReceivableEntity">
		UPDATE /*结算-应收单-(反确认)确认收入日期*/ STL.T_STL_BILL_RECEIVABLE
		SET VERSION_NO = VERSION_NO + 1,
		CONREVEN_DATE = #{conrevenDate,jdbcType=TIMESTAMP},
		MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
		MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
		MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP}
		WHERE ID = #{id,jdbcType=VARCHAR}
		and VERSION_NO = #{versionNo,jdbcType=DECIMAL}
	</update>

	<!-- 审核反审核空运其他应收单 -->
	<update id="updateBillReceivableByAirAudit"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableDto">
		UPDATE /*结算-应收单-审核反审核空运其他应收单*/ STL.T_STL_BILL_RECEIVABLE SET 
		<if test="statementBillNo!=null and statementBillNo!=''">
			STATEMENT_BILL_NO = #{statementBillNo,jdbcType=VARCHAR},
		</if>
		VERSION_NO = VERSION_NO+1,
		AUDIT_USER_CODE = #{auditUserCode,jdbcType=VARCHAR},
		AUDIT_USER_NAME = #{auditUserName,jdbcType=VARCHAR},
		APPROVE_STATUS = #{approveStatus,jdbcType=VARCHAR},
		AUDIT_DATE = #{auditDate,jdbcType=TIMESTAMP},
		MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
		MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
		MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR} 
		WHERE (ID,VERSION_NO) IN
		<foreach collection="billReceivables" index="index" item="item"
			open="(" separator="," close=")">
			(#{item.id},#{item.versionNo})
		</foreach>
		AND ACTIVE=#{active,jdbcType=VARCHAR} AND
		BILL_TYPE=#{billType,jdbcType=VARCHAR}
		AND APPROVE_STATUS=#{conApproveStatus}<!-- 加上审核/未审核限制条件 -->
	</update>

	<!-- 锁定/解锁应收单 -->
	<update id="updateBillReceivableByLock"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableDto">
		UPDATE /*结算-应收单-锁定/解锁应收单*/ STL.T_STL_BILL_RECEIVABLE SET VERSION_NO = VERSION_NO+1,
		UNLOCK_DATE_TIME=#{unlockDateTime,jdbcType=TIMESTAMP},
		LOCK_CUSTOMER_CODE = #{lockCustomerCode,jdbcType=VARCHAR},
		LOCK_CUSTOMER_NAME = #{lockCustomerName,jdbcType=VARCHAR},
		MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
		MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
		MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR}
		WHERE (ID,VERSION_NO) IN
		<foreach collection="billReceivables" index="index" item="item"
			open="(" separator="," close=")">
			(#{item.id},#{item.versionNo})
		</foreach>
		AND ACTIVE=#{active,jdbcType=VARCHAR}
	</update>


    <!-- 修改应收单扣款状态:扣款失败,扣款成功 -->
    <update id="updateBillReceivableWithholdStatus"
            parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillReceivableEntity">
        UPDATE  STL.T_STL_BILL_RECEIVABLE
        SET WITHHOLD_STATUS = #{withholdStatus,jdbcType=VARCHAR}
        WHERE ID = #{id,jdbcType=VARCHAR}
        and RECEIVABLE_NO = #{receivableNo,jdbcType=VARCHAR}
    </update>


	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		select /*结算-应收单-根据ID查询应收单*/
		<include refid="Base_Column_List" />
		from STL.T_STL_BILL_RECEIVABLE
		where ID = #{id,jdbcType=VARCHAR}
	</select>

	<!-- 根据ID与分区键查询应收单 -->
	<select id="selectPartitionsByIds" resultMap="BaseResultMap"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableDto">
		SELECT /*结算-应收单-根据ID与分区键查询应收单*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE
		WHERE (ID) IN
		<foreach collection="billReceivables" index="index" item="item"
			open="(" separator="," close=")">
			(#{item.id})
		</foreach>
		<if test="active!=null and active!=''">
			AND ACTIVE=#{active}
		</if>
	</select>

	<!-- 根据应收单与分区键查询应收单 -->
	<select id="selectPartitionsByReceivableNos" resultMap="BaseResultMap"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableDto">
		SELECT /*结算-应收单-根据应收单与分区键查询应收单*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE
		WHERE (RECEIVABLE_NO) IN
		<foreach collection="billReceivables" index="index" item="item"
			open="(" separator="," close=")">
			(#{item.receivableNo})
		</foreach>
		<if test="active!=null and active!=''">
			AND ACTIVE=#{active}
		</if>
	</select>

	<!-- 根据应收单号查询应收单信息 -->
	<select id="selectByReceivableNos" resultMap="BaseResultMap"
		parameterType="java.util.Map">
		SELECT /*结算-应收单-根据应收单号查询应收单信息*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE WHERE RECEIVABLE_NO IN
		<foreach collection="receivableNos" index="index" item="item"
			open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="active!=null and active!='' ">
			AND ACTIVE=#{active}
		</if>
		AND BILL_TYPE NOT IN ('PDR','POR','PDFR','PP','PTF','PER','POFR')
	</select>

	<!-- 根据来源单号查询应收单信息 -->
	<select id="selectBySourceBillNos" resultMap="BaseResultMap"
		parameterType="java.util.Map">
		SELECT /*结算-应收单-根据来源单号查询应收单信息*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE WHERE SOURCE_BILL_NO IN
		<foreach collection="sourceBillNos" index="index" item="item"
			open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="active!=null and active!='' ">
			AND ACTIVE=#{active}
		</if>
		<if test="sourceBillType!=null and sourceBillType!='' ">
			AND SOURCE_BILL_TYPE=#{sourceBillType}
		</if>
	</select>
	<!-- 根据条件查询月结应收单 -->
	<select id="selectMonthlyStatement" resultMap="BaseResultMap"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableConditionDto">
		SELECT /*结算-应收单-根据条件查询各种应收单*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE
		WHERE 
		<if test="waybillNo!=null and waybillNo!=''">
				WAYBILL_NO=#{waybillNo}
			</if>
		AND PAYMENT_TYPE=#{paymentType}		
		AND ACTIVE=#{active}
		 AND IS_RED_BACK = #{isRedBack}
		<if test="billTypes!=null">
			AND BILL_TYPE IN
			<foreach collection="billTypes" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		</select>

	<!-- 根据条件查询各种应收单 -->
	<select id="selectByCondition" resultMap="BaseResultMap"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableConditionDto">
		SELECT /*结算-应收单-根据条件查询各种应收单*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE
		WHERE 
		<choose>
			<when
				test="waybillNo!=null and waybillNo!='' and sourceBillNo!=null and sourceBillNo!='' ">
				WAYBILL_NO=#{waybillNo} AND SOURCE_BILL_NO=#{sourceBillNo}
			</when>
			<when test="waybillNo!=null and waybillNo!=''">
				WAYBILL_NO=#{waybillNo}
			</when>
			<when test="receivableNo!=null and receivableNo!=''">
				RECEIVABLE_NO=#{receivableNo}
			</when>
			<when test="sourceBillNo!=null and sourceBillNo!=''">
				SOURCE_BILL_NO=#{sourceBillNo}
			</when>
			<otherwise>
				1=0
			</otherwise>
		</choose>
		 AND ACTIVE=#{active}
		 AND IS_RED_BACK = #{isRedBack}
		<if test="billTypes!=null">
			AND BILL_TYPE IN
			<foreach collection="billTypes" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="verify!=null and verify!=''"><!--  不为空的情况下，查询已核销金额大于0的应收单   -->
			AND DECODE(VERIFY_AMOUNT,0,NULL,VERIFY_AMOUNT)>0 <!-- 已核销金额大于0 -->
		</if>
		<if test="orgCode!=null and orgCode!=''"><!-- 应收部门编码 -->
			AND RECEIVABLE_ORG_CODE=#{orgCode}
		</if>
		<if test="sourceBillType!=null and sourceBillType!='' ">
			AND SOURCE_BILL_TYPE=#{sourceBillType}
		</if>
		<if test="partailLineAgentCode!=null and partailLineAgentCode!='' "><!-- 偏线外发代理编码 -->
			AND CUSTOMER_CODE=#{partailLineAgentCode}
		</if>
	</select>


	<!-- 根据条件查询各种应收单的金额信息 -->
	<select id="selectReceivableAmountByCondition" resultMap="BaseResultMap"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableConditionDto">
		SELECT /*结算-应收单-根据条件查询各种应收单的金额信息*/ WAYBILL_NO,AMOUNT/100 AMOUNT,VERIFY_AMOUNT/100
		VERIFY_AMOUNT,UNVERIFY_AMOUNT/100 UNVERIFY_AMOUNT,BILL_TYPE
		FROM STL.T_STL_BILL_RECEIVABLE
		WHERE WAYBILL_NO=#{waybillNo} <!-- 运单号不能为空  -->
		AND ACTIVE=#{active} 
		AND IS_RED_BACK =#{isRedBack}
		<if test="billTypes!=null">
			AND BILL_TYPE IN
			<foreach collection="billTypes" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="sourceBillType!=null and sourceBillType!='' ">
			AND SOURCE_BILL_TYPE=#{sourceBillType}
		</if>
	</select>


	<!-- 根据运单号和外发单号、代理编码查询应收单 -->
	<select id="selectReceivableByExternalBillNo" resultType="int"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableConditionDto">
		SELECT /*结算-应收单-根据运单号和外发单号、代理编码查询应收单*/ COUNT(REC.ID) COUNTS
		FROM STL.T_STL_BILL_RECEIVABLE REC
		WHERE REC.WAYBILL_NO=#{waybillNo} 
		AND REC.SOURCE_BILL_NO=#{externalBillNo}
		AND REC.ACTIVE=#{active} 
		AND REC.IS_RED_BACK = #{isRedBack}
		<if test="partailLineAgentCode!=null and partailLineAgentCode!=''">
			AND REC.CUSTOMER_CODE=#{partailLineAgentCode}
		</if>
		<if test="orgCode!=null and orgCode!=''"><!-- 应收部门编码 -->
			AND REC.RECEIVABLE_ORG_CODE=#{orgCode}
		</if>
		<if test="billTypes!=null">
			AND REC.BILL_TYPE IN
			<foreach collection="billTypes" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
	</select>
	
	<!-- 批量修改应收单的对账单号  -->
	<update id="updateBatchByMakeStatement"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableDto">
		UPDATE /*结算-应收单-批量修改应收单的对账单号*/ STL.T_STL_BILL_RECEIVABLE 
		SET VERSION_NO = VERSION_NO + 1,
		STATEMENT_BILL_NO = #{statementBillNo,jdbcType=VARCHAR},
		MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
		MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
   		MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR}
		WHERE (ID,VERSION_NO) IN
		<foreach collection="billReceivables" index="index" item="item"
			open="(" separator="," close=")">
			(#{item.id},#{item.versionNo})
		</foreach>
		AND ACTIVE=#{active,jdbcType=VARCHAR} <!-- 必填项   -->
	</update>
	
	<select id="selectByWaybillNosAndOrgCodes" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT /*结算-应收单-根据运单号集合和部门编码查询应收单*/
    <include refid="Base_Column_List" />
    FROM STL.T_STL_BILL_RECEIVABLE T  WHERE
	WAYBILL_NO IN
	<foreach collection="waybillNos"  index="index" item="item"  open="(" separator="," close=")">  
		     #{item} 
	</foreach>	
	 <if test="active!=null and active!='' ">
		AND ACTIVE=#{active}
	</if> 
	AND BILL_TYPE NOT IN ('PDR','POR','PDFR','PP','PTF','PER','POFR')
	AND	EXISTS (SELECT ORG_CODE
					FROM BSE.MV_BAS_USER_ORG_AUTH_VIEW V 
				 WHERE V.EMP_CODE = #{currentInfo.empCode}
							 AND ( 
								T.RECEIVABLE_ORG_CODE = V.ORG_CODE OR <!-- 应收单可以按照应收部门进行查询   -->
								T.GENERATING_ORG_CODE = V.ORG_CODE OR <!-- 或应收单收入部门编码   -->
								T.ORIG_ORG_CODE = V.ORG_CODE <!-- 或应收单的始发部门进行查询  -->
							 )
        )
  </select>


  <select  id="selectReceivableAmountByWaybillNo"  resultMap="waybillReceivableDtoResultMap" parameterType="java.util.Map" >
		SELECT /*结算-应收单-根据运单号查询应收单金额*/ WAYBILL_NO,AMOUNT/100 AMOUNT, VERIFY_AMOUNT/100 VERIFY_AMOUNT, UNVERIFY_AMOUNT/100
		UNVERIFY_AMOUNT  FROM STL.T_STL_BILL_RECEIVABLE WHERE
		WAYBILL_NO=#{waybillNo}
		AND BILL_TYPE=#{billType}
		AND ACTIVE=#{active} AND IS_RED_BACK=#{isRedBack}
		AND UNVERIFY_AMOUNT>0  <!-- 未核销金额大于0 -->
  </select>
  
  
  <select id="selectByWaybillNosOrSourceBillNosAndTypes" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT /*结算-应收单-根据运单号、来源单号、单据类型查询应收单*/
    <include refid="Base_Column_List" />
    FROM STL.T_STL_BILL_RECEIVABLE  WHERE
    <!--  运单号集合或来源单号集合不能同时为空   -->
    <choose>
			<when  test="waybillNos!=null ">
				WAYBILL_NO IN
				<foreach collection="waybillNos" index="index" item="item" open="(" separator="," close=")">
          			 #{item}
        		</foreach>
			</when>
			<when test="sourceBillNos!=null ">
				SOURCE_BILL_NO IN
				<foreach collection="sourceBillNos" index="index" item="item" open="(" separator="," close=")">
          			 #{item}
        		</foreach>
			</when>
			<otherwise>
				1=0
			</otherwise>
	</choose>
	AND ACTIVE=#{active,jdbcType=CHAR} 
    AND IS_RED_BACK = #{isRedBack,jdbcType=CHAR}
    <if test="billTypes!=null ">
      AND BILL_TYPE IN	
        <foreach collection="billTypes" index="index" item="item" open="(" separator="," close=")">
          	 #{item}
        </foreach>
    </if>
    <if test="sourceBillType!=null and sourceBillType!=''">
    	AND SOURCE_BILL_TYPE=#{sourceBillType,jdbcType=VARCHAR}
    </if>
  </select>
  
  <select  id="selectReceivableAmountByCustomerCode"  resultMap="BaseResultMap" parameterType="java.util.Map" >
		SELECT /*结算-应收单-根据客户编码查询应收单金额*/
		 <include refid="Base_Column_List" />
		  FROM STL.T_STL_BILL_RECEIVABLE WHERE
		CUSTOMER_CODE=#{customerCode}
		AND ACTIVE=#{active} AND IS_RED_BACK=#{isRedBack}
		AND UNVERIFY_AMOUNT>0  <!-- 未核销金额大于0 -->
		order by ACCOUNT_DATE ASC
  </select>
  
  <select id="selectBySourceBillNOsAndOrgCodes" resultMap="BaseResultMap"
		parameterType="java.util.Map">
		SELECT /*结算-应收单-根据来源单号和部门编码查询应收单*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE T WHERE SOURCE_BILL_NO IN
		<foreach collection="sourceBillNos" index="index" item="item"
			open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="active!=null and active!='' ">
			AND ACTIVE=#{active}
		</if>
		<if test="sourceBillType!=null and sourceBillType!='' ">
			AND SOURCE_BILL_TYPE=#{sourceBillType}
		</if>
		AND BILL_TYPE NOT IN ('PDR','POR','PDFR','PP','PTF','PER','POFR')
		AND EXISTS (SELECT ORG_CODE
					FROM BSE.MV_BAS_USER_ORG_AUTH_VIEW V 
				 WHERE V.EMP_CODE = #{currentInfo.empCode}
							 AND ( 
								T.RECEIVABLE_ORG_CODE = V.ORG_CODE OR <!-- 应收单可以按照应收部门进行查询   -->
								T.GENERATING_ORG_CODE = V.ORG_CODE OR <!-- 或应收单收入部门编码   -->
								T.ORIG_ORG_CODE = V.ORG_CODE <!-- 或应收单的始发部门进行查询  -->
							 )
        )
	</select>
	<!-- 锁定应收单 -->
	<select id="updateByUnlockDate" parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableOnlineQueryDto" >
		UPDATE STL.T_STL_BILL_RECEIVABLE
		SET
		UNLOCK_DATE_TIME = SYSDATE+#{lockTime}/60/24,
		LOCK_CUSTOMER_CODE = #{customerCode,jdbcType=VARCHAR},
		VERSION_NO=VERSION_NO+1
		<where>
		RECEIVABLE_NO = #{receivableNo,jdbcType=VARCHAR} 
		AND DECODE(UNVERIFY_AMOUNT,0,NULL,UNVERIFY_AMOUNT)>0 
		</where>
	</select>
	
	<!-- 批量标记/反标记应收单 -->
	<update id="updateStampByNumbers"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableDto">
		UPDATE /*批量标记/反标记应收单*/ STL.T_STL_BILL_RECEIVABLE 
		SET VERSION_NO = VERSION_NO + 1,
		STAMP= #{stamp,jdbcType=VARCHAR},
		MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
		MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
   		MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR}
		WHERE (ID,VERSION_NO) IN
		<foreach collection="billReceivables" index="index" item="item"
			open="(" separator="," close=")">
			(#{item.id},#{item.versionNo})
		</foreach>
	</update>

	<!-- 根据应收单号查询应收单信息 -->
	<select id="selectByReceivableNosAndOrgCodes" resultMap="BaseResultMap"
		parameterType="java.util.Map">
		SELECT /*结算-应收单-根据应收单号和部门编码查询应收单信息(*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE T WHERE RECEIVABLE_NO IN
		<foreach collection="receivableNos" index="index" item="item"
			open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="active!=null and active!='' ">
			AND ACTIVE=#{active}
		</if>
		AND BILL_TYPE NOT IN ('PDR','POR','PDFR','PP','PTF','PER','POFR')
		AND	EXISTS (SELECT ORG_CODE
					FROM BSE.MV_BAS_USER_ORG_AUTH_VIEW V 
				 WHERE V.EMP_CODE = #{currentInfo.empCode}
							 AND ( 
								T.RECEIVABLE_ORG_CODE = V.ORG_CODE OR <!-- 应收单可以按照应收部门进行查询   -->
								T.GENERATING_ORG_CODE = V.ORG_CODE OR <!-- 或应收单收入部门编码   -->
								T.ORIG_ORG_CODE = V.ORG_CODE <!-- 或应收单的始发部门进行查询  -->
							 )
        )
	</select>

	<select id="selectMinTimebyCondition" resultType="date" 
	parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillReceivableConditionDto" >
	SELECT
		MIN (RE.BUSINESS_DATE) 
		FROM  STL.T_STL_BILL_RECEIVABLE RE 
		WHERE
		RE.ACTIVE='Y'
		<if test="orgCode != null">
		AND RE.RECEIVABLE_ORG_CODE = #{orgCode}		
		</if>
		<if test="customerCode != null">
		AND RE.CUSTOMER_CODE = #{customerCode}
		</if>
		<if test="billTypes != null">
		AND RE.BILL_TYPE IN 
		<foreach collection="billTypes" index="index" item="item" open="(" separator="," close=")">
          	 #{item}
        </foreach>
		</if>
		<if test="paymentType != null">
		AND RE.PAYMENT_TYPE = #{paymentType}
		</if>
		<if test="sourceBillType != null">
		AND RE.SOURCE_BILL_TYPE = #{sourceBillType}
		</if>	
		<!-- <if test="waybillNo != null">
		<![CDATA[AND RE.WAYBILL_NO <>]]> #{waybillNo}
		</if> -->
		<![CDATA[AND RE.UNVERIFY_AMOUNT> 0]]>			
	
	</select>
	
	<!-- 根据运单单号查询应收单信息 -->
	<select id="selectByWayBillNos" resultMap="BaseResultMap"
		parameterType="java.util.Map">
		SELECT /*结算-应收单-根据来源单号查询应收单信息*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE WHERE WAYBILL_NO IN
		<foreach collection="waybillNos" index="index" item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		AND ACTIVE='Y'
		AND SOURCE_BILL_TYPE='W'
		AND BILL_TYPE IN ('OR','DR','DL','CR','AAC','DLC')
	</select>
	
		<!-- 根据运单单号查询是否已经支付 -->
	<select id="selectIsOrPayByBillNo" resultType="int"
		parameterType="java.util.Map">
			SELECT /*结算-根据运单单号查询是否已经支付 */  COUNT(1) 
			    FROM STL.T_STL_BILL_RECEIVABLE RE
			    JOIN STL.T_STL_BILL_WRITEOFF WR ON WR.END_NO = RE.RECEIVABLE_NO
			    JOIN STL.T_STL_BILL_REPAYMENT PAYMENT ON PAYMENT.REPAYMENT_NO = WR.BEGIN_NO 
			 WHERE 1=1 
			 <if test="billTypes != null and billTypes.length >0">
			 			AND RE.BILL_TYPE IN
				 <foreach collection="billTypes" index="index"  item="item" open="(" separator="," close=")">
				 		#{item} 
				 </foreach>
			 </if>
			 <if test="wayBillNo != null and wayBillNo !='' ">
			 		AND RE.WAYBILL_NO = #{wayBillNo}
			 </if>
			 <if test="actualPayType !=null and actualPayType !='' ">
			       AND PAYMENT.PAYMENT_TYPE = #{actualPayType}
			 </if>
			    AND RE.ACTIVE = 'Y'
			    AND PAYMENT.ACTIVE = 'Y'
			    AND WR.ACTIVE = 'Y'
	</select>

    <!-- 根据运单单号与应收类型查询唯一的应收单信息 -->
    <select id="selectByWayBillNoAndBillType" resultMap="BaseResultMap"
            parameterType="java.util.Map">
        SELECT /*结算-应收单-根据来源单号查询应收单信息*/
        <include refid="Base_Column_List" />
        FROM STL.T_STL_BILL_RECEIVABLE
        WHERE WAYBILL_NO = #{wayBillNo}
        AND BILL_TYPE = #{billType}
        AND ACTIVE = #{active}
    </select>

	<!-- 根据应收单单号修改对账单单号-->
	<update id="updateByReceivableNo" parameterType="java.util.Map">
		UPDATE /*根据 应收单修改对账单单号*/
		 STL.T_STL_BILL_RECEIVABLE
		 SET  STATEMENT_BILL_NO= #{statementBillNo}
		 WHERE ACTIVE='Y'
		   AND RECEIVABLE_NO IN
			<foreach collection="receivableNoList" item="receivableNoList" open="(" close=")" separator="," >
				#{receivableNoList}
			</foreach>
	</update>
	
	<select id="queryReceivableByStatementBillNo" resultMap="BaseResultMap"	parameterType="java.util.List">
		SELECT /*结算-应收单-根据对账单号查询应收单信息*/
        <include refid="Base_Column_List" />
          FROM STL.T_STL_BILL_RECEIVABLE R
		 WHERE R.STATEMENT_BILL_NO IN
		 	<foreach collection="list" item="item" open="(" close=")" separator="," >
				#{item}
			</foreach>
		   AND R.ACTIVE = 'Y'
		   AND R.UNVERIFY_AMOUNT > 0
	</select>
	<select id="queryReceivableBySBNO" resultMap="BaseResultMap"	parameterType="java.util.List">
		SELECT /*结算-应收单-根据对账单号查询应收单信息*/
        <include refid="Base_Column_List" />
          FROM STL.T_STL_BILL_RECEIVABLE R
		 WHERE R.STATEMENT_BILL_NO IN
		 	<foreach collection="list" item="item" open="(" close=")" separator="," >
				#{item}
			</foreach>
		   AND R.ACTIVE = 'Y'
	</select>

	<select id="queryReceivableByStatementBillNoAuto" resultMap="BaseResultMap"	parameterType="java.lang.String">
		SELECT /*结算-应收单-根据对账单号查询应收单信息*/
        <include refid="Base_Column_List" />
          FROM STL.T_STL_BILL_RECEIVABLE R
		 WHERE R.STATEMENT_BILL_NO = #{statementBillNo,jdbcType=VARCHAR}
		   AND R.ACTIVE = 'Y'
		   AND R.UNVERIFY_AMOUNT > 0
	</select>
	
	<!-- 根据应收单号查询应收单信息核销反核销用 -->
	<select id="queryBillReceivableByReceivableNO" resultMap="BaseResultMap" parameterType="java.util.Map">
		SELECT /*结算-应收单-根据应收单号查询应收单信息核销反核销用*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE 
		WHERE RECEIVABLE_NO  = #{receivableNo}
		  AND ACTIVE=#{active}
	</select>
	
	<!-- 根据查询条件校验合伙人应收单是否重复 -->
	<select id="checkReceivableBillRepeated" resultMap="BaseResultMap" parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillReceivableEntity">
		SELECT /*结算-应收单-根据来源编号、客户编码、金额、单据子类型查询合伙人应收单是否重复*/
		<include refid="Base_Column_List" />
		FROM STL.T_STL_BILL_RECEIVABLE R
		<where>
			<if test="sourceBillNo!=null and sourceBillNo!=''">
				AND R.SOURCE_BILL_NO=#{sourceBillNo}
			</if>
			<if test="billType!=null and billType!=''">
				AND R.BILL_TYPE=#{billType}
			</if>
			<if test="customerCode != null and customerCode!=''">
				AND R.CUSTOMER_CODE=#{customerCode}
			</if>
			<if test="amount!=null">
				AND R.AMOUNT = #{amount}
			</if>
			<if test="active!=null and active!='' ">
				AND R.ACTIVE=#{active}
			</if>
			<if test="isRedBack!=null and isRedBack!='' ">
				AND R.IS_RED_BACK=#{isRedBack}
			</if>
		</where>
	</select>

	<!--根据传入的运单号查询其所有应收单已核销金额总和-->
	<select id="queryReceivableVeryfyAmountsByWaybill" resultMap="BaseResultMap"	parameterType="java.util.List">
		SELECT /*结算-应收单-根据运单号查询其应收单已核心金额之和信息*/
			DISTINCT S.WAYBILL_NO,
			(SELECT SUM(T.VERIFY_AMOUNT)/100
			FROM STL.T_STL_BILL_RECEIVABLE T
			WHERE T.WAYBILL_NO = S.WAYBILL_NO
			AND T.ACTIVE='Y'
		    AND T.SOURCE_BILL_TYPE='W'
			AND T.BILL_TYPE IN ('DR','CR')
			AND T.IS_RED_BACK='N') VERIFY_AMOUNT
			FROM STL.T_STL_BILL_RECEIVABLE S
			WHERE S.WAYBILL_NO IN
		<foreach collection="list" item="item" open="(" close=")" separator="," >
			#{item}
		</foreach>
			AND S.ACTIVE = 'Y'
			AND S.BILL_TYPE IN ('DR','CR')
			AND S.IS_RED_BACK ='N'
			AND S.SOURCE_BILL_TYPE='W'
	</select>
</mapper>