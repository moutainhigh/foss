<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.stl.VtsEffectPayableDao">

	<resultMap id="VtsBaseResultMap"
		type="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillEntity">
		<id column="ID" property="id" jdbcType="VARCHAR" />
		<result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
		<result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
		<result column="ORDER_CHANNEL" property="orderChannel"
			jdbcType="VARCHAR" />
		<result column="order_paid_method" property="orderPaidMethod"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_ID" property="deliveryCustomerId"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_CODE" property="deliveryCustomerCode"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_NAME" property="deliveryCustomerName"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_MOBILEPHONE" property="deliveryCustomerMobilephone"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_PHONE" property="deliveryCustomerPhone"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_CONTACT" property="deliveryCustomerContact"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_NATION_CODE" property="deliveryCustomerNationCode"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_PROV_CODE" property="deliveryCustomerProvCode"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_CITY_CODE" property="deliveryCustomerCityCode"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_DIST_CODE" property="deliveryCustomerDistCode"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_ADDRESS" property="deliveryCustomerAddress"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_ID" property="receiveCustomerId"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CODE" property="receiveCustomerCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_NAME" property="receiveCustomerName"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_MOBILEPHONE" property="receiveCustomerMobilephone"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_PHONE" property="receiveCustomerPhone"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CONTACT" property="receiveCustomerContact"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_NATION_CODE" property="receiveCustomerNationCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_PROV_CODE" property="receiveCustomerProvCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CITY_CODE" property="receiveCustomerCityCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_DIST_CODE" property="receiveCustomerDistCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_ADDRESS" property="receiveCustomerAddress"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_ORG_CODE" property="receiveOrgCode"
			jdbcType="VARCHAR" />
		<result column="PRODUCT_ID" property="productId" jdbcType="VARCHAR" />
		<result column="PRODUCT_CODE" property="productCode" jdbcType="VARCHAR" />
		<result column="RECEIVE_METHOD" property="receiveMethod"
			jdbcType="VARCHAR" />
		<result column="CUSTOMER_PICKUP_ORG_CODE" property="customerPickupOrgCode"
			jdbcType="VARCHAR" />
		<result column="LOAD_METHOD" property="loadMethod" jdbcType="VARCHAR" />
		<result column="TARGET_ORG_CODE" property="targetOrgCode"
			jdbcType="VARCHAR" />
		<result column="PICKUP_TO_DOOR" property="pickupToDoor"
			jdbcType="CHAR" />
		<result column="DRIVER_CODE" property="driverCode" jdbcType="VARCHAR" />
		<result column="PICKUP_CENTRALIZED" property="pickupCentralized"
			jdbcType="CHAR" />
		<result column="LOAD_LINE_CODE" property="loadLineCode"
			jdbcType="VARCHAR" />
		<result column="LOAD_ORG_CODE" property="loadOrgCode" jdbcType="VARCHAR" />
		<result column="LAST_LOAD_ORG_CODE" property="lastLoadOrgCode"
			jdbcType="VARCHAR" />
		<result column="PRE_DEPARTURE_TIME" property="preDepartureTime"
			jdbcType="TIMESTAMP" />
		<result column="PRE_CUSTOMER_PICKUP_TIME" property="preCustomerPickupTime"
			jdbcType="TIMESTAMP" />
		<result column="CAR_DIRECT_DELIVERY" property="carDirectDelivery"
			jdbcType="CHAR" />
		<result column="GOODS_NAME" property="goodsName" jdbcType="VARCHAR" />
		<result column="GOODS_QTY_TOTAL" property="goodsQtyTotal"
			jdbcType="DECIMAL" />
		<result column="GOODS_WEIGHT_TOTAL" property="goodsWeightTotal"
			jdbcType="DECIMAL" />
		<result column="GOODS_VOLUME_TOTAL" property="goodsVolumeTotal"
			jdbcType="DECIMAL" />
		<result column="GOODS_SIZE" property="goodsSize" jdbcType="VARCHAR"
			typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="GOODS_TYPE_CODE" property="goodsTypeCode"
			jdbcType="VARCHAR" />
		<result column="PRECIOUS_GOODS" property="preciousGoods"
			jdbcType="CHAR" />
		<result column="SPECIAL_SHAPED_GOODS" property="specialShapedGoods"
			jdbcType="CHAR" />
		<result column="OUTER_NOTES" property="outerNotes" jdbcType="VARCHAR"
			typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="INNER_NOTES" property="innerNotes" jdbcType="VARCHAR"
			typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="GOODS_PACKAGE" property="goodsPackage"
			jdbcType="VARCHAR" />
		<result column="INSURANCE_AMOUNT" property="insuranceAmount"
			jdbcType="DECIMAL" />
		<result column="COD_AMOUNT" property="codAmount" jdbcType="DECIMAL" />
		<result column="COD_RATE" property="codRate" jdbcType="DECIMAL" />
		<result column="COD_FEE" property="codFee" jdbcType="DECIMAL" />
		<result column="REFUND_TYPE" property="refundType" jdbcType="VARCHAR" />
		<result column="RETURN_BILL_TYPE" property="returnBillType"
			jdbcType="VARCHAR" />
		<result column="SECRET_PREPAID" property="secretPrepaid"
			jdbcType="CHAR" />
		<result column="TO_PAY_AMOUNT" property="toPayAmount" jdbcType="DECIMAL" />
		<result column="PRE_PAY_AMOUNT" property="prePayAmount"
			jdbcType="DECIMAL" />
		<result column="DELIVERY_GOODS_FEE" property="deliveryGoodsFee"
			jdbcType="DECIMAL" />
		<result column="OTHER_FEE" property="otherFee" jdbcType="DECIMAL" />
		<result column="PACKAGE_FEE" property="packageFee" jdbcType="DECIMAL" />
		<result column="PROMOTIONS_FEE" property="promotionsFee"
			jdbcType="DECIMAL" />
		<result column="BILLING_TYPE" property="billingType" jdbcType="VARCHAR" />
		<result column="TRANSPORT_FEE" property="transportFee"
			jdbcType="DECIMAL" />
		<result column="VALUE_ADD_FEE" property="valueAddFee" jdbcType="DECIMAL" />
		<result column="PAID_METHOD" property="paidMethod" jdbcType="VARCHAR" />
		<result column="ARRIVE_TYPE" property="arriveType" jdbcType="VARCHAR" />
		<result column="ACTIVE" property="active" jdbcType="CHAR" />
		<result column="FORBIDDEN_LINE" property="forbiddenLine"
			jdbcType="CHAR" />
		<result column="FREIGHT_METHOD" property="freightMethod"
			jdbcType="VARCHAR" />
		<result column="FLIGHT_SHIFT" property="flightShift" jdbcType="VARCHAR" />
		<result column="TOTAL_FEE" property="totalFee" jdbcType="DECIMAL" />
		<result column="PROMOTIONS_CODE" property="promotionsCode"
			jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		<result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
		<result column="BILL_TIME" property="billTime" jdbcType="TIMESTAMP" />
		<result column="CREATE_USER_CODE" property="createUserCode"
			jdbcType="VARCHAR" />
		<result column="MODIFY_USER_CODE" property="modifyUserCode"
			jdbcType="VARCHAR" />
		<result column="CREATE_ORG_CODE" property="createOrgCode"
			jdbcType="VARCHAR" />
		<result column="MODIFY_ORG_CODE" property="modifyOrgCode"
			jdbcType="VARCHAR" />
		<result column="REF_ID" property="refId" jdbcType="VARCHAR" />
		<result column="REF_CODE" property="refCode" jdbcType="VARCHAR" />
		<result column="CURRENCY_CODE" property="currencyCode"
			jdbcType="VARCHAR" />
		<result column="IS_WHOLE_VEHICLE" property="isWholeVehicle"
			jdbcType="CHAR" />
		<result column="WHOLE_VEHICLE_APPFEE" property="wholeVehicleAppfee"
			jdbcType="DECIMAL" />
		<result column="WHOLE_VEHICLE_ACTUALFEE" property="wholeVehicleActualfee"
			jdbcType="DECIMAL" />
		<result column="ACCOUNT_NAME" property="accountName" jdbcType="VARCHAR" />
		<result column="ACCOUNT_CODE" property="accountCode" jdbcType="VARCHAR" />
		<result column="ACCOUNT_BANK" property="accountBank" jdbcType="VARCHAR" />
		<result column="BILL_WEIGHT" property="billWeight" jdbcType="DECIMAL" />
		<result column="PICKUP_FEE" property="pickupFee" jdbcType="DECIMAL" />
		<result column="SERVICE_FEE" property="serviceFee" jdbcType="DECIMAL" />
		<result column="PRE_ARRIVE_TIME" property="preArriveTime"
			jdbcType="TIMESTAMP" />
		<result column="TRANSPORT_TYPE" property="transportType"
			jdbcType="VARCHAR" />
		<result column="ADD_TIME" property="addTime" jdbcType="TIMESTAMP" />
		<result column="INSURANCE_RATE" property="insuranceRate"
			jdbcType="DECIMAL" />
		<result column="INSURANCE_FEE" property="insuranceFee"
			jdbcType="DECIMAL" />
		<result column="UNIT_PRICE" property="unitPrice" jdbcType="DECIMAL" />
		<result column="CONTACT_ADDRESS_ID" property="contactAddressId"
			jdbcType="VARCHAR" />
		<result column="FLIGHT_NUMBER_TYPE" property="flightNumberType"
			jdbcType="VARCHAR" />
		<result column="COLLECTION_DEPARTMENT" property="collectionDepartment"
			jdbcType="VARCHAR" />
		<result column="TRANSPORTATION_REMARK" property="transportationRemark"
			jdbcType="VARCHAR" typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="IS_PASS_OWN_DEPARTMENT" property="isPassOwnDepartment"
			jdbcType="CHAR" />
		<result column="PAPER_NUM" property="paperNum" jdbcType="NUMERIC" />
		<result column="WOOD_NUM" property="woodNum" jdbcType="NUMERIC" />
		<result column="FIBRE_NUM" property="fibreNum" jdbcType="NUMERIC" />
		<result column="SALVER_NUM" property="salverNum" jdbcType="NUMERIC" />
		<result column="MEMBRANE_NUM" property="membraneNum" jdbcType="NUMERIC" />
		<result column="OTHER_PACKAGE" property="otherPackage"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_CONTACT_ID" property="deliverCustContactId"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CONTACT_ID" property="receiverCustContactId"
			jdbcType="VARCHAR" />
		<result column="PENDING_TYPE" property="pendingType" jdbcType="VARCHAR" />
		<result column="LICENSE_PLATE_NUM" property="licensePlateNum"
			jdbcType="VARCHAR" />
		<result column="ORDER_VEHICLE_NUM" property="orderVehicleNum"
			jdbcType="VARCHAR" />
		<result column="CREATE_USER_NAME" property="createUserName"
			jdbcType="VARCHAR" />
		<result column="CREATE_USER_DEPT_NAME" property="createUserDeptName"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_ORG_NAME" property="receiveOrgName"
			jdbcType="VARCHAR" />
		<result column="CUSTOMER_PICKUP_ORG_NAME" property="customerPickupOrgName"
			jdbcType="VARCHAR" />
		<result column="LOAD_ORG_NAME" property="loadOrgName" jdbcType="VARCHAR" />
		<result column="LAST_LOAD_ORG_NAME" property="lastLoadOrgName"
			jdbcType="VARCHAR" />
		<result column="TRANSFER_START_ORG_CODE" property="transferStartOrgCode"
			jdbcType="VARCHAR" />
		<result column="TRANSFER_START_ORG_NAME" property="transferStartOrgName"
			jdbcType="VARCHAR" />
		<result column="KILOMETER" property="kilometer" jdbcType="DECIMAL" />
		<result column="IS_INIT" property="isInit" jdbcType="CHAR" />
		<result column="IS_ECONOMY_GOODS" property="isEconomyGoods"
			jdbcType="CHAR" />
		<result column="ECONOMY_GOODS_TYPE" property="economyGoodsType"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_BIG_CUSTOMER" property="deliveryBigCustomer"
			jdbcType="CHAR" />
		<result column="RECEIVE_BIG_CUSTOMER" property="receiveBigCustomer"
			jdbcType="CHAR" />
		<result column="WAYBILL_TYPE" property="waybillType" jdbcType="VARCHAR" />
		<result column="IS_EXPRESS" property="isExpress" jdbcType="CHAR" />
		<result column="FREE_PICKUP_GOODS" property="freePickupGoods" jdbcType="CHAR" />
	</resultMap>
 	<!-- 用于查询的字段：主要是在金额的字段上除以100 -->
	<sql id="Base_Column_List_Select_vts">
		ID, WAYBILL_NO, ORDER_NO, ORDER_CHANNEL,ORDER_PAID_METHOD,
		DELIVERY_CUSTOMER_ID,
		DELIVERY_CUSTOMER_CODE,
		DELIVERY_CUSTOMER_NAME,
		DELIVERY_CUSTOMER_MOBILEPHONE, DELIVERY_CUSTOMER_PHONE,
		DELIVERY_CUSTOMER_CONTACT,
		DELIVERY_CUSTOMER_NATION_CODE,
		DELIVERY_CUSTOMER_PROV_CODE,
		DELIVERY_CUSTOMER_CITY_CODE,
		DELIVERY_CUSTOMER_DIST_CODE, DELIVERY_CUSTOMER_ADDRESS,
		RECEIVE_CUSTOMER_ID,
		RECEIVE_CUSTOMER_CODE,
		RECEIVE_CUSTOMER_NAME,
		RECEIVE_CUSTOMER_MOBILEPHONE, RECEIVE_CUSTOMER_PHONE,
		RECEIVE_CUSTOMER_CONTACT,
		RECEIVE_CUSTOMER_NATION_CODE,
		RECEIVE_CUSTOMER_PROV_CODE, RECEIVE_CUSTOMER_CITY_CODE,
		RECEIVE_CUSTOMER_DIST_CODE, RECEIVE_CUSTOMER_ADDRESS,
		RECEIVE_ORG_CODE, PRODUCT_ID,
		PRODUCT_CODE, RECEIVE_METHOD,
		CUSTOMER_PICKUP_ORG_CODE, LOAD_METHOD,
		TARGET_ORG_CODE,
		PICKUP_TO_DOOR,
		DRIVER_CODE, PICKUP_CENTRALIZED, LOAD_LINE_CODE, LOAD_ORG_CODE,
		LAST_LOAD_ORG_CODE,
		PRE_DEPARTURE_TIME, PRE_CUSTOMER_PICKUP_TIME,
		CAR_DIRECT_DELIVERY, GOODS_NAME,
		GOODS_QTY_TOTAL,
		GOODS_WEIGHT_TOTAL,
		GOODS_VOLUME_TOTAL, GOODS_SIZE, GOODS_TYPE_CODE, PRECIOUS_GOODS,
		SPECIAL_SHAPED_GOODS, OUTER_NOTES, INNER_NOTES, GOODS_PACKAGE,
		INSURANCE_AMOUNT/100 as INSURANCE_AMOUNT,
		COD_AMOUNT/100 as COD_AMOUNT,
		COD_RATE, COD_FEE/100 as COD_FEE, REFUND_TYPE,
		RETURN_BILL_TYPE,
		SECRET_PREPAID, TO_PAY_AMOUNT/100 as TO_PAY_AMOUNT,
		PRE_PAY_AMOUNT/100
		as PRE_PAY_AMOUNT, DELIVERY_GOODS_FEE/100 as
		DELIVERY_GOODS_FEE,
		OTHER_FEE/100 as OTHER_FEE, PACKAGE_FEE/100 as
		PACKAGE_FEE,
		PROMOTIONS_FEE/100 as PROMOTIONS_FEE, BILLING_TYPE,
		TRANSPORT_FEE/100
		as TRANSPORT_FEE, VALUE_ADD_FEE/100 as VALUE_ADD_FEE, PAID_METHOD,
		ARRIVE_TYPE, ACTIVE, FORBIDDEN_LINE, FREIGHT_METHOD,
		FLIGHT_SHIFT,
		TOTAL_FEE/100 as TOTAL_FEE, PROMOTIONS_CODE, CREATE_TIME,
		MODIFY_TIME,
		BILL_TIME, CREATE_USER_CODE,
		MODIFY_USER_CODE, CREATE_ORG_CODE,
		MODIFY_ORG_CODE, REF_ID, REF_CODE, CURRENCY_CODE,
		IS_WHOLE_VEHICLE,
		WHOLE_VEHICLE_APPFEE/100 as WHOLE_VEHICLE_APPFEE,
		WHOLE_VEHICLE_ACTUALFEE/100 as WHOLE_VEHICLE_ACTUALFEE, ACCOUNT_NAME,
		ACCOUNT_CODE,
		ACCOUNT_BANK, BILL_WEIGHT, PICKUP_FEE/100 as PICKUP_FEE,
		SERVICE_FEE/100 as
		SERVICE_FEE, PRE_ARRIVE_TIME, TRANSPORT_TYPE,
		ADD_TIME, INSURANCE_RATE, INSURANCE_FEE/100 as
		INSURANCE_FEE,UNIT_PRICE/100 AS UNIT_PRICE,CONTACT_ADDRESS_ID,
		FLIGHT_NUMBER_TYPE,
		COLLECTION_DEPARTMENT,
		TRANSPORTATION_REMARK,IS_PASS_OWN_DEPARTMENT,
		PAPER_NUM,WOOD_NUM,FIBRE_NUM,SALVER_NUM,MEMBRANE_NUM,OTHER_PACKAGE,DELIVERY_CUSTOMER_CONTACT_ID,RECEIVE_CUSTOMER_CONTACT_ID,
		PENDING_TYPE,LICENSE_PLATE_NUM,ORDER_VEHICLE_NUM,
		CREATE_USER_NAME,CREATE_USER_DEPT_NAME
		,RECEIVE_ORG_NAME,CUSTOMER_PICKUP_ORG_NAME,LOAD_ORG_NAME,LAST_LOAD_ORG_NAME,
		TRANSFER_START_ORG_CODE,
		TRANSFER_START_ORG_NAME,KILOMETER,IS_INIT,IS_ECONOMY_GOODS,ECONOMY_GOODS_TYPE,DELIVERY_BIG_CUSTOMER,RECEIVE_BIG_CUSTOMER,IS_EXPRESS
	</sql>
 	<select id="vtsQueryWaybillRFcByWaybillNo"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.VtsWaybillFRcQueryByWaybillNoDto"
		resultType="java.lang.String">

		select /*模块：接送货-运单-通过运单号来查询未受理更改单*/
		WAYBILL_NO from pkp.t_srv_waybillrfc

		where
		(
		STATUS=#{preAudit,jdbcType=VARCHAR} or STATUS=
		#{preAccecpt,jdbcType=VARCHAR} ) and WAYBILL_NO =
		#{waybillNo,jdbcType=VARCHAR}

	</select>
	<!-- 根据运单号查询运单部分信息 -->
	<select id="vtsQueryPartWaybillByNo" resultMap="VtsBaseResultMap"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillEntity">
		SELECT /*模块：接送货-运单-根据运单号查询运单部分信息*/
		PAID_METHOD,TO_PAY_AMOUNT/100 as
		TO_PAY_AMOUNT,CUSTOMER_PICKUP_ORG_CODE,CURRENCY_CODE,
		product_code
		,is_whole_vehicle,
		receive_method,
		total_fee/100 total_fee,
		insurance_amount/100 insurance_amount,
		cod_amount/100
		cod_amount,goods_qty_total,pending_type,
		last_load_org_code,order_no,DELIVERY_CUSTOMER_MOBILEPHONE,receive_customer_contact,
		RECEIVE_CUSTOMER_MOBILEPHONE,delivery_customer_contact,RECEIVE_ORG_CODE,waybill_no,FREIGHT_METHOD,bill_time,IS_EXPRESS,DELIVERY_CUSTOMER_NAME,
		pre_pay_amount/100 pre_pay_amount,DELIVERY_CUSTOMER_PROV_CODE
		FROM
		PKP.T_SRV_WAYBILL
		<where>
			ACTIVE = #{active,jdbcType=CHAR}
			AND WAYBILL_NO =
			#{waybillNo,jdbcType=VARCHAR}
		</where>
	</select>
	<!-- 根据运单号查询第一次开单时运单基本信息(给结算提供的接口) DN201511140004 liding add -->
	<select id="vtsSelectFirstWaybillByWaybillNo" resultMap="VtsBaseResultMap"
		parameterType="com.deppon.foss.module.pickup.waybill.shared.dto.WaybillQueryArgsDto">

		select * from (
		select /*模块：接送货-运单查询-根据运单号和订单号查询运单基本信息*/
		<include refid="Base_Column_List_Select_vts" />
		from PKP.T_SRV_WAYBILL
		where 1 = 1
		<!-- 防止出现一个运单号对应多个运单号时报错的情况出现 -->

		<if test="waybillNo != null and  waybillNo != '' ">
			and WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
		</if>
		order
		by CREATE_TIME ASC
		) where ROWNUM = 1
	</select>
</mapper>