<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.stl.BillPaymentEntityDao" >
  <resultMap id="BaseResultMap" type="com.deppon.foss.module.settlement.common.api.shared.domain.BillPaymentEntity" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="PAYMENT_NO" property="paymentNo" jdbcType="VARCHAR" />
    <result column="CURRENCY_CODE" property="currencyCode" jdbcType="VARCHAR" />
    <result column="AMOUNT" property="amount" jdbcType="DECIMAL" />
    <result column="CUSTOMER_CODE" property="customerCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="WORKFLOW_NO" property="workflowNo" jdbcType="VARCHAR" />
    <result column="REMIT_STATUS" property="remitStatus" jdbcType="VARCHAR" />
    <result column="AUDIT_STATUS" property="auditStatus" jdbcType="VARCHAR" />
    <result column="SOURCE_BILL_NO" property="sourceBillNo" jdbcType="VARCHAR" />
    <result column="SOURCE_BILL_TYPE" property="sourceBillType" jdbcType="VARCHAR" />
    <result column="PAYMENT_ORG_CODE" property="paymentOrgCode" jdbcType="VARCHAR" />
    <result column="PAYMENT_ORG_NAME" property="paymentOrgName" jdbcType="VARCHAR" />
    <result column="PAYMENT_COMPANY_CODE" property="paymentCompanyCode" jdbcType="VARCHAR" />
    <result column="PAYMENT_COMPANY_NAME" property="paymentCompanyName" jdbcType="VARCHAR" />
    <result column="ACTIVE" property="active" jdbcType="CHAR" />
    <result column="IS_RED_BACK" property="isRedBack" jdbcType="CHAR" />
    <result column="CREATE_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
    <result column="CREATE_USER_NAME" property="createUserName" jdbcType="VARCHAR" />
    <result column="AUDIT_USER_CODE" property="auditUserCode" jdbcType="VARCHAR" />
    <result column="AUDIT_USER_NAME" property="auditUserName" jdbcType="VARCHAR" />
    <result column="MODIFY_USER_CODE" property="modifyUserCode" jdbcType="VARCHAR" />
    <result column="MODIFY_USER_NAME" property="modifyUserName" jdbcType="VARCHAR" />
    <result column="BUSINESS_DATE" property="businessDate" jdbcType="TIMESTAMP" />
    <result column="ACCOUNT_DATE" property="accountDate" jdbcType="TIMESTAMP" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="BILL_TYPE" property="billType" jdbcType="VARCHAR" />
    <result column="IS_INIT" property="isInit" jdbcType="CHAR" />
    <result column="PAYMENT_TYPE" property="paymentType" jdbcType="VARCHAR" />
    <result column="MOBILE_PHONE" property="mobilePhone" jdbcType="VARCHAR" />
    <result column="ACCOUNT_NO" property="accountNo" jdbcType="VARCHAR" />
    <result column="PAYEE_NAME" property="payeeName" jdbcType="VARCHAR" />
    <result column="ACCOUNT_TYPE" property="accountType" jdbcType="VARCHAR" />
    <result column="PROVINCE_CODE" property="provinceCode" jdbcType="VARCHAR" />
    <result column="CITY_CODE" property="cityCode" jdbcType="VARCHAR" />
    <result column="BANK_HQ_NAME" property="bankHqName" jdbcType="VARCHAR" />
    <result column="BANK_BRANCH_NAME" property="bankBranchName" jdbcType="VARCHAR" />
    <result column="BANK_BRANCH_CODE" property="bankBranchCode" jdbcType="VARCHAR" />
    <result column="AUDIT_OPINION" property="auditOpinion" jdbcType="VARCHAR" />
    <result column="DISABLE_OPINION" property="disableOpinion" jdbcType="VARCHAR" />
    <result column="APPLY_WORK_FLOW_NO" property="applyWorkFlowNo" jdbcType="VARCHAR" />
    <result column="NOTES" property="notes" jdbcType="VARCHAR" />
    <result column="VERSION_NO" property="versionNo" jdbcType="DECIMAL" />
    <!-- 后面增加字段 -->
    <result column="PROVINCE_NAME" property="provinceName" jdbcType="VARCHAR" />
    <result column="BANK_HQ_CODE" property="bankHqCode" jdbcType="VARCHAR" />
    <result column="CITY_NAME" property="cityName" jdbcType="VARCHAR" />
    <result column="CREATE_TYPE" property="createType" jdbcType="VARCHAR" />
    <result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
    <result column="WORKFLOW_TYPE" property="workFlowType" jdbcType="VARCHAR" />
    
    <result column="INVOICE_HEAD_CODE" property="invoiceHeadCode" jdbcType="VARCHAR" />
    <result column="INVOICE_HEAD_NAME" property="invoiceHeadName" jdbcType="VARCHAR" />
    <result column="PAYEE_CODE" property="payeeCode" jdbcType="VARCHAR" />
    <result column="COST_DEPT_CODE" property="costDeptCode" jdbcType="VARCHAR" />
    <result column="COST_TYPE" property="costType" jdbcType="VARCHAR" />
    <result column="VAT_INVOICE" property="vatInvoice" jdbcType="VARCHAR" />
    <result column="REIMBURSEMENT" property="reimbursement" jdbcType="VARCHAR" />
    <result column="AUTO_SEND_COUNT" property="autoSendCount" jdbcType="DECIMAL" />
  </resultMap>
  <resultMap id="BaseFcusMap" type="com.deppon.foss.module.settlement.common.api.shared.domain.BillPaymentEntity" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="PAYMENT_NO" property="paymentNo" jdbcType="VARCHAR" />
    <result column="CURRENCY_CODE" property="currencyCode" jdbcType="VARCHAR" />
    <result column="AMOUNT" property="amount" jdbcType="DECIMAL" />
    <result column="CUSTOMER_CODE" property="customerCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="WORKFLOW_NO" property="workflowNo" jdbcType="VARCHAR" />
    <result column="REMIT_STATUS" property="remitStatus" jdbcType="VARCHAR" />
    <result column="AUDIT_STATUS" property="auditStatus" jdbcType="VARCHAR" />
    <result column="SOURCE_BILL_NO" property="sourceBillNo" jdbcType="VARCHAR" />
    <result column="SOURCE_BILL_TYPE" property="sourceBillType" jdbcType="VARCHAR" />
    <result column="PAYMENT_ORG_CODE" property="paymentOrgCode" jdbcType="VARCHAR" />
    <result column="PAYMENT_ORG_NAME" property="paymentOrgName" jdbcType="VARCHAR" />
    <result column="PAYMENT_COMPANY_CODE" property="paymentCompanyCode" jdbcType="VARCHAR" />
    <result column="PAYMENT_COMPANY_NAME" property="paymentCompanyName" jdbcType="VARCHAR" />
    <result column="ACTIVE" property="active" jdbcType="CHAR" />
    <result column="IS_RED_BACK" property="isRedBack" jdbcType="CHAR" />
    <result column="CREATE_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
    <result column="CREATE_USER_NAME" property="createUserName" jdbcType="VARCHAR" />
    <result column="AUDIT_USER_CODE" property="auditUserCode" jdbcType="VARCHAR" />
    <result column="AUDIT_USER_NAME" property="auditUserName" jdbcType="VARCHAR" />
    <result column="MODIFY_USER_CODE" property="modifyUserCode" jdbcType="VARCHAR" />
    <result column="MODIFY_USER_NAME" property="modifyUserName" jdbcType="VARCHAR" />
    <result column="BUSINESS_DATE" property="businessDate" jdbcType="TIMESTAMP" />
    <result column="ACCOUNT_DATE" property="accountDate" jdbcType="TIMESTAMP" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="BILL_TYPE" property="billType" jdbcType="VARCHAR" />
    <result column="IS_INIT" property="isInit" jdbcType="CHAR" />
    <result column="PAYMENT_TYPE" property="paymentType" jdbcType="VARCHAR" />
    <result column="MOBILE_PHONE" property="mobilePhone" jdbcType="VARCHAR" />
    <result column="ACCOUNT_NO" property="accountNo" jdbcType="VARCHAR" />
    <result column="PAYEE_NAME" property="payeeName" jdbcType="VARCHAR" />
    <result column="ACCOUNT_TYPE" property="accountType" jdbcType="VARCHAR" />
    <result column="PROVINCE_CODE" property="provinceCode" jdbcType="VARCHAR" />
    <result column="CITY_CODE" property="cityCode" jdbcType="VARCHAR" />
    <result column="BANK_HQ_NAME" property="bankHqName" jdbcType="VARCHAR" />
    <result column="BANK_BRANCH_NAME" property="bankBranchName" jdbcType="VARCHAR" />
    <result column="BANK_BRANCH_CODE" property="bankBranchCode" jdbcType="VARCHAR" />
    <result column="AUDIT_OPINION" property="auditOpinion" jdbcType="VARCHAR" />
    <result column="DISABLE_OPINION" property="disableOpinion" jdbcType="VARCHAR" />
    <result column="APPLY_WORK_FLOW_NO" property="applyWorkFlowNo" jdbcType="VARCHAR" />
    <result column="NOTES" property="notes" jdbcType="VARCHAR" />
    <result column="VERSION_NO" property="versionNo" jdbcType="DECIMAL" />
    <!-- 后面增加字段 -->
    <result column="PROVINCE_NAME" property="provinceName" jdbcType="VARCHAR" />
    <result column="BANK_HQ_CODE" property="bankHqCode" jdbcType="VARCHAR" />
    <result column="CITY_NAME" property="cityName" jdbcType="VARCHAR" />
    <result column="CREATE_TYPE" property="createType" jdbcType="VARCHAR" />
    <result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
    <result column="WORKFLOW_TYPE" property="workFlowType" jdbcType="VARCHAR" />
    
    <result column="INVOICE_HEAD_CODE" property="invoiceHeadCode" jdbcType="VARCHAR" />
    <result column="INVOICE_HEAD_NAME" property="invoiceHeadName" jdbcType="VARCHAR" />
    <result column="PAYEE_CODE" property="payeeCode" jdbcType="VARCHAR" />
    <result column="COST_DEPT_CODE" property="costDeptCode" jdbcType="VARCHAR" />
    <result column="COST_TYPE" property="costType" jdbcType="VARCHAR" />
    <result column="VAT_INVOICE" property="vatInvoice" jdbcType="VARCHAR" />
    <result column="REIMBURSEMENT" property="reimbursement" jdbcType="VARCHAR" />
    <result column="AUTO_SEND_COUNT" property="autoSendCount" jdbcType="DECIMAL" />
    <result column="UNIFIED_CODE" property="paymentOrgUnifiedCode" jdbcType="VARCHAR"  />
  </resultMap>
  
  <sql id="Base_Column_List" >
    ID, PAYMENT_NO, CURRENCY_CODE, AMOUNT/100 AMOUNT, CUSTOMER_CODE, CUSTOMER_NAME, WORKFLOW_NO, 
    REMIT_STATUS, AUDIT_STATUS, SOURCE_BILL_NO, SOURCE_BILL_TYPE, PAYMENT_ORG_CODE, PAYMENT_ORG_NAME, 
    PAYMENT_COMPANY_CODE, PAYMENT_COMPANY_NAME, ACTIVE, IS_RED_BACK, CREATE_USER_CODE, 
    CREATE_USER_NAME, AUDIT_USER_CODE, AUDIT_USER_NAME, MODIFY_USER_CODE, MODIFY_USER_NAME, 
    BUSINESS_DATE, ACCOUNT_DATE, CREATE_TIME, MODIFY_TIME, 
    BILL_TYPE, IS_INIT, PAYMENT_TYPE, MOBILE_PHONE, ACCOUNT_NO, PAYEE_NAME, 
    ACCOUNT_TYPE, PROVINCE_CODE, CITY_CODE, BANK_HQ_NAME, BANK_BRANCH_NAME, 
    BANK_BRANCH_CODE, AUDIT_OPINION, DISABLE_OPINION, APPLY_WORK_FLOW_NO, NOTES, VERSION_NO,
    PROVINCE_NAME,BANK_HQ_CODE,CITY_NAME,CREATE_TYPE,BATCH_NO,WORKFLOW_TYPE,INVOICE_HEAD_CODE,INVOICE_HEAD_NAME,PAYEE_CODE,
    COST_DEPT_CODE,COST_TYPE,VAT_INVOICE,REIMBURSEMENT,AUTO_SEND_COUNT
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select /*结算-付款单-根据ID查询付款单*/
    <include refid="Base_Column_List" />
    from STL.T_STL_BILL_PAYMENT
    where ID = #{id,jdbcType=VARCHAR}
  </select>
 
 <!-- 根据付款单号查询付款单信息   -->
  <select id="selectBillPaymentByPaymentNos" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT /*结算-付款单-根据付款单号查询付款单信息*/
    <include refid="Base_Column_List" />
    from STL.T_STL_BILL_PAYMENT  
    WHERE  PAYMENT_NO IN
	<foreach collection="paymentNos"  index="index" item="item"  open="(" separator="," close=")">  
		#{item} 
	</foreach>
	<if test="active!=null and active!='' ">
		AND ACTIVE=#{active}
	</if>
  </select>
  
  <!-- 根据来源单据号和来源单据类型查询付款单信息   -->
  <select id="selectBillPaymentBySourceBillNos" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT /*结算-付款单-根据来源单据号和来源单据类型查询付款单信息*/
    <include refid="Base_Column_List" />
    from STL.T_STL_BILL_PAYMENT  
    WHERE SOURCE_BILL_NO IN
	<foreach collection="sourceBillNos"  index="index" item="item"  open="(" separator="," close=")">  
		 #{item} 
	</foreach>	
	<if test="active!=null and active!='' ">
		AND ACTIVE=#{active}
	</if>
	<if test="sourceBillType!=null and sourceBillType!='' ">
		AND SOURCE_BILL_TYPE=#{sourceBillType}
	</if>
  </select>
  
  <!-- 查询各种付款单  -->
  <select id="queryBillPaymentByCondition" resultMap="BaseResultMap" parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillPaymentConditionDto" >
    SELECT /*结算-付款单-根据付款单号、来源单号查询付款单*/
    <include refid="Base_Column_List" />
    FROM STL.T_STL_BILL_PAYMENT WHERE
    <!-- 付款单号和来源单号，有一项是必填项   -->
    <choose>
    	<when test="paymentNo!=null and paymentNo!=''">
    	 	PAYMENT_NO=#{paymentNo}
    	</when>
    	<when test="sourceBillNo!=null and sourceBillNo!=''">
    		SOURCE_BILL_NO=#{sourceBillNo}
    	</when>
    	<otherwise>
    		1=0
    	</otherwise>
    </choose>
     AND ACTIVE=#{active} 
     AND IS_RED_BACK = #{isRedBack}
	<if test="billTypes!=null ">
		AND BILL_TYPE IN
		<foreach collection="billTypes"  index="index" item="item"  open="(" separator="," close=")">  
			#{item} 
		</foreach>
	</if>
	<if test="sourceBillType!=null and sourceBillType!='' ">
		AND SOURCE_BILL_TYPE=#{sourceBillType}
	</if>
	<if test="partailLineAgentCode!=null and partailLineAgentCode!='' "><!-- 偏线外发代理编码 -->
		AND CUSTOMER_CODE=#{partailLineAgentCode}
	</if>
  </select>
  
  <select id="selectPaymentRemitStatusByPaymentNos" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT /*结算-付款单-根据付款单号查询付款单*/ ID,PAYMENT_NO,REMIT_STATUS,SOURCE_BILL_NO,BILL_TYPE FROM STL.T_STL_BILL_PAYMENT 
     WHERE  PAYMENT_NO IN
	<foreach collection="paymentNos"  index="index" item="item"  open="(" separator="," close=")">  
		#{item} 
	</foreach>
	<if test="active!=null and active!='' ">
		AND ACTIVE=#{active}
	</if>
  </select>
  
  <insert id="insert" parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillPaymentEntity" >
    insert into /*结算-付款单-新增付款单*/ STL.T_STL_BILL_PAYMENT (ID, PAYMENT_NO, CURRENCY_CODE, 
      AMOUNT, CUSTOMER_CODE, CUSTOMER_NAME, 
      WORKFLOW_NO, REMIT_STATUS, AUDIT_STATUS, 
      SOURCE_BILL_NO, SOURCE_BILL_TYPE, PAYMENT_ORG_CODE, 
      PAYMENT_ORG_NAME, PAYMENT_COMPANY_CODE, PAYMENT_COMPANY_NAME, 
      ACTIVE, IS_RED_BACK, CREATE_USER_CODE, 
      CREATE_USER_NAME, AUDIT_USER_CODE, AUDIT_USER_NAME, 
      MODIFY_USER_CODE, MODIFY_USER_NAME, BUSINESS_DATE, ACCOUNT_DATE, 
      CREATE_TIME, MODIFY_TIME, 
      BILL_TYPE, IS_INIT, PAYMENT_TYPE, 
      MOBILE_PHONE, ACCOUNT_NO, PAYEE_NAME, 
      ACCOUNT_TYPE, PROVINCE_CODE, CITY_CODE, 
      BANK_HQ_NAME, BANK_BRANCH_NAME, BANK_BRANCH_CODE, 
      AUDIT_OPINION, DISABLE_OPINION, APPLY_WORK_FLOW_NO, 
      NOTES, VERSION_NO,PROVINCE_NAME,BANK_HQ_CODE,CITY_NAME,
      CREATE_TYPE,BATCH_NO,WORKFLOW_TYPE,INVOICE_HEAD_CODE,INVOICE_HEAD_NAME,PAYEE_CODE,
      COST_DEPT_CODE,COST_TYPE,VAT_INVOICE,REIMBURSEMENT,TAXPAYER_NUMBER,AUTO_SEND_COUNT)
    values (#{id,jdbcType=VARCHAR}, #{paymentNo,jdbcType=VARCHAR}, #{currencyCode,jdbcType=VARCHAR}, 
      #{amount,jdbcType=DECIMAL}*100, #{customerCode,jdbcType=VARCHAR}, #{customerName,jdbcType=VARCHAR}, 
      #{workflowNo,jdbcType=VARCHAR}, #{remitStatus,jdbcType=VARCHAR}, #{auditStatus,jdbcType=VARCHAR}, 
      #{sourceBillNo,jdbcType=VARCHAR}, #{sourceBillType,jdbcType=VARCHAR}, #{paymentOrgCode,jdbcType=VARCHAR}, 
      #{paymentOrgName,jdbcType=VARCHAR}, #{paymentCompanyCode,jdbcType=VARCHAR}, #{paymentCompanyName,jdbcType=VARCHAR}, 
      #{active,jdbcType=CHAR}, #{isRedBack,jdbcType=CHAR}, #{createUserCode,jdbcType=VARCHAR}, 
      #{createUserName,jdbcType=VARCHAR}, #{auditUserCode,jdbcType=VARCHAR}, #{auditUserName,jdbcType=VARCHAR}, 
      #{modifyUserCode,jdbcType=VARCHAR}, #{modifyUserName,jdbcType=VARCHAR}, #{businessDate,jdbcType=TIMESTAMP}, #{accountDate,jdbcType=TIMESTAMP}, 
      #{createTime,jdbcType=TIMESTAMP}, #{modifyTime,jdbcType=TIMESTAMP}, 
      #{billType,jdbcType=VARCHAR}, #{isInit,jdbcType=CHAR}, #{paymentType,jdbcType=VARCHAR}, 
      #{mobilePhone,jdbcType=VARCHAR}, #{accountNo,jdbcType=VARCHAR}, #{payeeName,jdbcType=VARCHAR}, 
      #{accountType,jdbcType=VARCHAR}, #{provinceCode,jdbcType=VARCHAR}, #{cityCode,jdbcType=VARCHAR}, 
      #{bankHqName,jdbcType=VARCHAR}, #{bankBranchName,jdbcType=VARCHAR}, #{bankBranchCode,jdbcType=VARCHAR}, 
      #{auditOpinion,jdbcType=VARCHAR}, #{disableOpinion,jdbcType=VARCHAR}, #{applyWorkFlowNo,jdbcType=VARCHAR}, 
      #{notes,jdbcType=VARCHAR}, #{versionNo,jdbcType=DECIMAL},#{provinceName,jdbcType=VARCHAR}, 
      #{bankHqCode,jdbcType=VARCHAR}, #{cityName,jdbcType=VARCHAR}, #{createType,jdbcType=VARCHAR}, #{batchNo,jdbcType=VARCHAR}, 
      #{workFlowType,jdbcType=VARCHAR},#{invoiceHeadCode,jdbcType=VARCHAR},#{invoiceHeadName,jdbcType=VARCHAR},#{payeeCode,jdbcType=VARCHAR},
      #{costDeptCode,jdbcType=VARCHAR},#{costType,jdbcType=VARCHAR},#{vatInvoice,jdbcType=VARCHAR},#{reimbursement,jdbcType=VARCHAR},
      #{taxpayerNumber,jdbcType=VARCHAR},#{autoSendCount,jdbcType=DECIMAL})
  </insert>
  
  <update id="updateByPrimaryKey" parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillPaymentEntity" >
    update /*结算-付款单-根据ID更新付款单*/ STL.T_STL_BILL_PAYMENT
    set PAYMENT_NO = #{paymentNo,jdbcType=VARCHAR},
      CURRENCY_CODE = #{currencyCode,jdbcType=VARCHAR},
      AMOUNT = #{amount,jdbcType=DECIMAL}*100,
      CUSTOMER_CODE = #{customerCode,jdbcType=VARCHAR},
      CUSTOMER_NAME = #{customerName,jdbcType=VARCHAR},
      WORKFLOW_NO = #{workflowNo,jdbcType=VARCHAR},
      REMIT_STATUS = #{remitStatus,jdbcType=VARCHAR},
      AUDIT_STATUS = #{auditStatus,jdbcType=VARCHAR},
      SOURCE_BILL_NO = #{sourceBillNo,jdbcType=VARCHAR},
      SOURCE_BILL_TYPE = #{sourceBillType,jdbcType=VARCHAR},
      PAYMENT_ORG_CODE = #{paymentOrgCode,jdbcType=VARCHAR},
      PAYMENT_ORG_NAME = #{paymentOrgName,jdbcType=VARCHAR},
      PAYMENT_COMPANY_CODE = #{paymentCompanyCode,jdbcType=VARCHAR},
      PAYMENT_COMPANY_NAME = #{paymentCompanyName,jdbcType=VARCHAR},
      ACTIVE = #{active,jdbcType=CHAR},
      IS_RED_BACK = #{isRedBack,jdbcType=CHAR},
      CREATE_USER_CODE = #{createUserCode,jdbcType=VARCHAR},
      CREATE_USER_NAME = #{createUserName,jdbcType=VARCHAR},
      AUDIT_USER_CODE = #{auditUserCode,jdbcType=VARCHAR},
      AUDIT_USER_NAME = #{auditUserName,jdbcType=VARCHAR},
      MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
      MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
      BUSINESS_DATE = #{businessDate,jdbcType=TIMESTAMP},
      ACCOUNT_DATE = #{accountDate,jdbcType=TIMESTAMP},
      CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
      BILL_TYPE = #{billType,jdbcType=VARCHAR},
      IS_INIT = #{isInit,jdbcType=CHAR},
      PAYMENT_TYPE = #{paymentType,jdbcType=VARCHAR},
      MOBILE_PHONE = #{mobilePhone,jdbcType=VARCHAR},
      ACCOUNT_NO = #{accountNo,jdbcType=VARCHAR},
      PAYEE_NAME = #{payeeName,jdbcType=VARCHAR},
      ACCOUNT_TYPE = #{accountType,jdbcType=VARCHAR},
      PROVINCE_CODE = #{provinceCode,jdbcType=VARCHAR},
      CITY_CODE = #{cityCode,jdbcType=VARCHAR},
      BANK_HQ_NAME = #{bankHqName,jdbcType=VARCHAR},
      BANK_BRANCH_NAME = #{bankBranchName,jdbcType=VARCHAR},
      BANK_BRANCH_CODE = #{bankBranchCode,jdbcType=VARCHAR},
      AUDIT_OPINION = #{auditOpinion,jdbcType=VARCHAR},
      DISABLE_OPINION = #{disableOpinion,jdbcType=VARCHAR},
      APPLY_WORK_FLOW_NO = #{applyWorkFlowNo,jdbcType=VARCHAR},
      NOTES = #{notes,jdbcType=VARCHAR},
      VERSION_NO = #{versionNo,jdbcType=DECIMAL},
      PROVINCE_NAME = #{provinceName,jdbcType=VARCHAR},
      BANK_HQ_CODE = #{bankHqCode,jdbcType=VARCHAR},
      CITY_NAME = #{cityName,jdbcType=VARCHAR},
      CREATE_TYPE = #{createType,jdbcType=VARCHAR},
      BATCH_NO = #{batchNo,jdbcType=VARCHAR},
      INVOICE_HEAD_CODE = #{invoiceHeadCode,jdbcType=VARCHAR},
      INVOICE_HEAD_NAME = #{invoiceHeadName,jdbcType=VARCHAR},
      PAYEE_CODE = #{payeeCode,jdbcType=VARCHAR}
    WHERE ID = #{id,jdbcType=VARCHAR}
  </update>
  
  <!-- 红冲付款单 -->
  <update id="updateByWriteBack" parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.BillPaymentEntity" >
    UPDATE /*结算-付款单-红冲付款单*/ STL.T_STL_BILL_PAYMENT set 
      VERSION_NO=VERSION_NO+1,
      DISABLE_OPINION = #{disableOpinion,jdbcType=VARCHAR},
      ACTIVE = #{active,jdbcType=CHAR},
      MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
      MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR}
    WHERE ID = #{id,jdbcType=VARCHAR}
      and VERSION_NO = #{versionNo,jdbcType=DECIMAL}
  </update>
  
  <select id="selectPaymentByExternalBillNo" resultType="int"  parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillPaymentConditionDto">
  	SELECT /*结算-付款单-根据来源单号查询付款单*/ COUNT(PT.ID) FROM STL.T_STL_BILL_PAYMENT PT
  	WHERE PT.SOURCE_BILL_NO=#{externalBillNo}  
	AND PT.ACTIVE=#{active} AND PT.IS_RED_BACK = #{isRedBack}
	AND PT.SOURCE_BILL_TYPE=#{sourceBillType}
    <if test="partailLineAgentCode!=null and partailLineAgentCode!=''">
    	AND PT.CUSTOMER_CODE=#{partailLineAgentCode}
    </if>
  </select>
  
   <update id="updateBillPaymentByBatchAudit" parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillPaymentDto">
  	update /*结算-付款单-更新付款单审核状态*/ STL.T_STL_BILL_PAYMENT set VERSION_NO=VERSION_NO+1,
  	AUDIT_STATUS = #{auditStatus,jdbcType=VARCHAR},
  	AUDIT_OPINION = #{auditOpinion,jdbcType=VARCHAR},
  	AUDIT_USER_CODE = #{auditUserCode,jdbcType=VARCHAR},
    AUDIT_USER_NAME = #{auditUserName,jdbcType=VARCHAR},
    MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
    MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
    MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP}
    WHERE (ID,VERSION_NO) IN
    <foreach collection="billPayments"  index="index" item="item"  open="(" separator="," close=")">  
		      (#{item.id},#{item.versionNo})
	</foreach> 
	AND ACTIVE=#{active,jdbcType=CHAR}  AND AUDIT_STATUS = #{conAuditStatus,jdbcType=VARCHAR}
  </update>
  
  <!-- 更新付款工作流号 -->
   <update id="updateBillPaymentByBatchWorkflow" parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillPaymentDto">
  	update /*结算-付款单-更新付款工作流号*/ STL.T_STL_BILL_PAYMENT set VERSION_NO=VERSION_NO+1,
  	WORKFLOW_NO = #{workflowNo,jdbcType=VARCHAR},
    MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
    MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
    MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP}
    WHERE (ID,VERSION_NO) IN
    <foreach collection="billPayments"  index="index" item="item"  open="(" separator="," close=")">  
		      (#{item.id},#{item.versionNo})
	</foreach> 
	AND ACTIVE=#{active,jdbcType=CHAR}
  </update>
  
  <!-- 更新备用金工作流号 -->
  <update id="updateBillPaymentByBatchApplyWorkflow" parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillPaymentDto">
  	update /*结算-付款单-更新备用金工作流号*/ STL.T_STL_BILL_PAYMENT set VERSION_NO=VERSION_NO+1,
  	APPLY_WORK_FLOW_NO = #{applyWorkFlowNo,jdbcType=VARCHAR},
    MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
    MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
    MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP}
    WHERE (ID,VERSION_NO) IN
    <foreach collection="billPayments"  index="index" item="item"  open="(" separator="," close=")">  
		      (#{item.id},#{item.versionNo})
	</foreach> 
	AND ACTIVE=#{active,jdbcType=CHAR}
  </update>
  
  <!-- 根据付款单id查询付款单信息   -->
  <select id="selectBillPaymentByPaymentIds" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT /*结算-付款单-根据付款单id查询付款单信息*/
    <include refid="Base_Column_List" />
    from STL.T_STL_BILL_PAYMENT  
    WHERE  ID IN
	<foreach collection="ids"  index="index" item="item"  open="(" separator="," close=")">  
		#{item} 
	</foreach>
	<if test="active!=null and active!='' ">
		AND ACTIVE=#{active}
	</if>
  </select>
  
  <!-- 更新付款状态 -->
   <update id="batchReverseRemitStatusBillPayment" parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillPaymentDto">
  	update /*结算-付款单-更新付款状态*/ STL.T_STL_BILL_PAYMENT set VERSION_NO=VERSION_NO+1,
  	<!-- 更新作废意见，给生成工作流失败反写其原因用 -->
  	DISABLE_OPINION = #{disableOpinion,jdbcType=VARCHAR},
  	<!-- 更新银行账号信息等相关内容 -->
  	<if test=" mobilePhone!=null and mobilePhone!='' ">
  		MOBILE_PHONE = #{mobilePhone,jdbcType=VARCHAR},
  	</if>
  	<if test=" accountNo!=null and accountNo!='' ">
  		 ACCOUNT_NO = #{accountNo,jdbcType=VARCHAR},
  	</if>
  	<if test=" payeeName!=null and payeeName!='' ">
  		 PAYEE_NAME = #{payeeName,jdbcType=VARCHAR},
  	</if>
  	<if test=" payeeCode!=null and payeeCode!='' ">
  		 PAYEE_CODE = #{payeeCode,jdbcType=VARCHAR},
  	</if>
  	<if test=" accountType!=null and accountType!='' ">
  		ACCOUNT_TYPE = #{accountType,jdbcType=VARCHAR},
  	</if>
  	<if test=" provinceCode!=null and provinceCode!='' ">
  		PROVINCE_CODE = #{provinceCode,jdbcType=VARCHAR},
  	</if>
  	<if test=" provinceName!=null and provinceName!='' ">
  		PROVINCE_NAME = #{provinceName,jdbcType=VARCHAR},
  	</if>
  	<if test=" cityCode!=null and cityCode!='' ">
  		CITY_CODE = #{cityCode,jdbcType=VARCHAR},
  	</if>
  	<if test=" cityName!=null and cityName!='' ">
  		CITY_NAME = #{cityName,jdbcType=VARCHAR},
  	</if>
  	<if test=" bankHqCode!=null and bankHqCode!='' ">
  		BANK_HQ_CODE = #{bankHqCode,jdbcType=VARCHAR},
  	</if>
  	<if test=" bankHqName!=null and bankHqName!='' ">
  		BANK_HQ_NAME = #{bankHqName,jdbcType=VARCHAR},
  	</if>
  	<if test=" bankBranchName!=null and bankBranchName!='' ">
  		BANK_BRANCH_NAME = #{bankBranchName,jdbcType=VARCHAR},
  	</if>
  	<if test=" bankBranchCode!=null and bankBranchCode!='' ">
  		BANK_BRANCH_CODE = #{bankBranchCode,jdbcType=VARCHAR},
  	</if>
	 <if test=" invoiceHeadCode!=null and invoiceHeadCode!='' ">
  		INVOICE_HEAD_CODE = #{invoiceHeadCode,jdbcType=VARCHAR},
  	</if>
  	<if test=" invoiceHeadName!=null and invoiceHeadName!='' ">
  		INVOICE_HEAD_NAME = #{invoiceHeadName,jdbcType=VARCHAR},
  	</if>
  	REMIT_STATUS = #{remitStatus,jdbcType=VARCHAR},
    MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
    MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
    MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
    BATCH_NO = #{batchNo,jdbcType=VARCHAR}
    WHERE (ID,VERSION_NO) IN
    <foreach collection="billPayments"  index="index" item="item"  open="(" separator="," close=")">  
		      (#{item.id},#{item.versionNo})
	</foreach> 
	AND ACTIVE=#{active,jdbcType=CHAR}
  </update>
  
  <!-- 根据付款单号，更新付款状态 -->
   <update id="updateRemitStatusByPmtNos" parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillPmtAutoPayDto">
  	update /*结算-付款单-根据付款单号，更新付款状态*/ STL.T_STL_BILL_PAYMENT set VERSION_NO=VERSION_NO+1,
  	<!-- 更新作废意见，给生成工作流失败反写其原因用 -->
  	DISABLE_OPINION = #{disableOpinion,jdbcType=VARCHAR},
  	REMIT_STATUS = #{remitStatus,jdbcType=VARCHAR},
    MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
    MODIFY_USER_NAME = #{modifyUserName,jdbcType=VARCHAR},
    MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP}
    WHERE PAYMENT_NO IN
    <foreach collection="paymentNoList"  index="index" item="item"  open="(" separator="," close=")">  
		      #{item}
	</foreach> 
	AND ACTIVE=#{active,jdbcType=CHAR}
  </update>
  
   <!-- 根据汇款状态、付款类型，查询应付单   -->
  <select id="queryBillPaymentByPmtType" resultMap="BaseFcusMap" parameterType="java.util.Map" >
    SELECT /*结算-付款单-根据汇款状态、付款类型，查询应付单*/
    T.PAYMENT_NO PAYMENT_NO,
    ORG.UNIFIED_CODE UNIFIED_CODE,
    T.PAYMENT_ORG_CODE PAYMENT_ORG_CODE,
    ORG2.UNIFIED_CODE CUSTOMER_CODE,
    T.PAYMENT_TYPE PAYMENT_TYPE,
    T.AMOUNT AMOUNT,
    T.CREATE_TIME CREATE_TIME,
    SYSDATE ACCOUNT_DATE
    from STL.T_STL_BILL_PAYMENT  T
    LEFT JOIN BSE.T_BAS_ORG ORG
    ON ORG.CODE= T.Payment_Org_Code
    AND ORG.ACTIVE = 'Y'
    LEFT JOIN BSE.T_BAS_ORG ORG2
    ON ORG2.CODE = T.CUSTOMER_CODE
    AND ORG2.ACTIVE = 'Y'
    WHERE  T.PAYMENT_TYPE in 
    <foreach collection="paymentTypes"  index="index" item="item"  open="(" separator="," close=")">  
		 #{item} 
	</foreach>
    AND T.REMIT_STATUS = #{remitStatus}
    /* AND T.CREATE_TIME >= to_date('2016-06-16', 'yyyy-mm-dd') */
	AND T.ACTIVE = #{active}
  </select>
  
   <!-- 根据付款编号查询付款单   -->
  <select id="selectBillPaymentByPaymentByBatchNos" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT /*结算-付款单-根据付款编号查询付款单*/
    <include refid="Base_Column_List" />
    from STL.T_STL_BILL_PAYMENT  
    WHERE  BATCH_NO = #{payNos}
	<if test="active!=null and active!='' ">
		AND ACTIVE=#{active}
	</if>
  </select>
  
  <!-- 根据来源单号集合和部门编码集合，查询付款单信息  -->
   <select id="selectBySourceBillNOsAndOrgCodes" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT /*结算-付款单-根据来源单号集合和部门编码集合，查询付款单信息*/
    <include refid="Base_Column_List" />
    from STL.T_STL_BILL_PAYMENT  T
    WHERE SOURCE_BILL_NO IN
	<foreach collection="sourceBillNos"  index="index" item="item"  open="(" separator="," close=")">  
		 #{item} 
	</foreach>	
	<if test="active!=null and active!='' ">
		AND ACTIVE=#{active}
	</if>
	<if test="sourceBillType!=null and sourceBillType!='' ">
		AND SOURCE_BILL_TYPE=#{sourceBillType}
	</if>
	AND EXISTS
	(SELECT V.ORG_CODE FROM BSE.MV_BAS_USER_ORG_AUTH_VIEW V WHERE V.EMP_CODE = #{currentInfo.empCode,jdbcType=VARCHAR}
		AND V.ORG_CODE=T.PAYMENT_ORG_CODE
	)
	
  </select>
  
  <!-- 根据付款单号，查询付款单是否已经付款  -->
  <select id="selectPaymentRemitStatusByPaymentNO" resultType="java.lang.String" parameterType="java.util.Map" >
  	  SELECT /*结算-付款单-根据付款单号，查询付款单是否已经付款*/ REMIT_STATUS FROM  STL.T_STL_BILL_PAYMENT   WHERE PAYMENT_NO=#{paymentNo} 
  	  <if test="active!=null and active!='' ">
		AND ACTIVE=#{active}
	</if> 
  </select>
  
    <!-- 还原付款状态 -->
   <update id="updatePaymentBatchNoBack" parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillPaymentDto">
  	update /*结算-付款单-更新付款状态*/ STL.T_STL_BILL_PAYMENT set 
  		VERSION_NO=VERSION_NO-1,
  		REMIT_STATUS = #{remitStatus,jdbcType=VARCHAR}
    	WHERE ID IN
    	<foreach collection="billPayments"  index="index" item="item"  open="(" separator="," close=")">  
			      #{item.id}
		</foreach> 
		AND ACTIVE=#{active,jdbcType=CHAR}
   </update>
  
	<!-- 修改转报销工作流号 -->
	<update id="updatePaymentByBatchNo" parameterType="java.util.Map">
		UPDATE STL.T_STL_BILL_PAYMENT P
		   SET P.PAYMENT_TRANSFER = #{workflowNo,jdbcType=VARCHAR}, 
		       P.REIMBURSEMENT = 'Y'
		 WHERE P.BATCH_NO = #{batchNo,jdbcType=VARCHAR}
		   AND P.ACTIVE = 'Y'
	</update>
	<!-- 根据付款单号，更新付款状态 -->
   <update id="updateFcusPaymentByPmtNos" parameterType="com.deppon.foss.module.settlement.common.api.shared.dto.BillPmtAutoPayDto">
  	update /*结算-付款单-根据付款单号，更新付款状态*/ STL.T_STL_BILL_PAYMENT set VERSION_NO=VERSION_NO+1,
  	REMIT_STATUS = #{remitStatus,jdbcType=VARCHAR},
    MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
    AUTO_SEND_COUNT = AUTO_SEND_COUNT+1
    WHERE PAYMENT_NO IN
    <foreach collection="paymentNoList"  index="index" item="item"  open="(" separator="," close=")">  
		      #{item}
	</foreach> 
	AND ACTIVE=#{active,jdbcType=CHAR}
	<if test="paymentType !=null and paymentType!='' ">
		AND PAYMENT_TYPE =#{paymentType,jdbcType=VARCHAR}
	</if>
  </update>
</mapper>