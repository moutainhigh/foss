<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.stl.VtsWaybillAndActualDao" >
   	<!-- 插入运单表信息 -->
   	<insert id="insertWaybillMessage" parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillEntity">
		insert into PKP.T_SRV_WAYBILL (
		ID, 
		WAYBILL_NO, 
		ORDER_NO,
		ORDER_CHANNEL,
		ORDER_PAID_METHOD,
		DELIVERY_CUSTOMER_ID,
		DELIVERY_CUSTOMER_CODE,
		DELIVERY_CUSTOMER_NAME,
		DELIVERY_CUSTOMER_MOBILEPHONE,
		DELIVERY_CUSTOMER_PHONE,
		DELIVERY_CUSTOMER_CONTACT,
		DELIVERY_CUSTOMER_NATION_CODE,
		DELIVERY_CUSTOMER_PROV_CODE,
		DELIVERY_CUSTOMER_CITY_CODE,
		DELIVERY_CUSTOMER_DIST_CODE,
		DELIVERY_CUSTOMER_ADDRESS,
		RECEIVE_CUSTOMER_ID,
		RECEIVE_CUSTOMER_CODE,
		RECEIVE_CUSTOMER_NAME,
		RECEIVE_CUSTOMER_MOBILEPHONE,
		RECEIVE_CUSTOMER_PHONE,
		RECEIVE_CUSTOMER_CONTACT,
		RECEIVE_CUSTOMER_NATION_CODE,
		RECEIVE_CUSTOMER_PROV_CODE,
		RECEIVE_CUSTOMER_CITY_CODE,
		RECEIVE_CUSTOMER_DIST_CODE,
		RECEIVE_CUSTOMER_ADDRESS,
		RECEIVE_ORG_CODE,
		PRODUCT_ID, 
		PRODUCT_CODE,
		RECEIVE_METHOD,
		CUSTOMER_PICKUP_ORG_CODE,
		LOAD_METHOD,
		TARGET_ORG_CODE,
		PICKUP_TO_DOOR,
		DRIVER_CODE,
		PICKUP_CENTRALIZED, 
		LOAD_LINE_CODE,
		LOAD_ORG_CODE,
		LAST_LOAD_ORG_CODE,
		PRE_DEPARTURE_TIME,
		PRE_CUSTOMER_PICKUP_TIME,
		CAR_DIRECT_DELIVERY,
		GOODS_NAME,
		GOODS_QTY_TOTAL,
		GOODS_WEIGHT_TOTAL,
		GOODS_VOLUME_TOTAL,
		GOODS_SIZE,
		GOODS_TYPE_CODE, 
		PRECIOUS_GOODS,
		SPECIAL_SHAPED_GOODS,
		OUTER_NOTES,
		INNER_NOTES, 
		GOODS_PACKAGE,
		INSURANCE_AMOUNT, 
		COD_AMOUNT,
		COD_RATE,
		COD_FEE, 
		REFUND_TYPE,
		RETURN_BILL_TYPE,
		SECRET_PREPAID,
		TO_PAY_AMOUNT,
		PRE_PAY_AMOUNT,
		DELIVERY_GOODS_FEE, 
		OTHER_FEE,
		PACKAGE_FEE,
		PROMOTIONS_FEE,
		BILLING_TYPE, 
		TRANSPORT_FEE,
		VALUE_ADD_FEE,
		PAID_METHOD,
		ARRIVE_TYPE,
		ACTIVE, 
		FORBIDDEN_LINE, 
		FREIGHT_METHOD,
		FLIGHT_SHIFT,
		TOTAL_FEE,
		PROMOTIONS_CODE,
		CREATE_TIME, 
		MODIFY_TIME,
		BILL_TIME,
		CREATE_USER_CODE,
		MODIFY_USER_CODE, 
		CREATE_ORG_CODE,
		MODIFY_ORG_CODE,
		REF_ID, 
		REF_CODE,
		CURRENCY_CODE, 
		IS_WHOLE_VEHICLE,
		WHOLE_VEHICLE_APPFEE,
		WHOLE_VEHICLE_ACTUALFEE, 
		ACCOUNT_NAME,
		ACCOUNT_CODE,
		ACCOUNT_BANK,
		BILL_WEIGHT, 
		PICKUP_FEE,
		SERVICE_FEE,
		PRE_ARRIVE_TIME, 
		TRANSPORT_TYPE,
		ADD_TIME, 
		INSURANCE_RATE,
		INSURANCE_FEE, 
		UNIT_PRICE,
		CONTACT_ADDRESS_ID,
		FLIGHT_NUMBER_TYPE,
		COLLECTION_DEPARTMENT,
		TRANSPORTATION_REMARK,
		IS_PASS_OWN_DEPARTMENT,
		PAPER_NUM,
		WOOD_NUM,
		FIBRE_NUM,
		SALVER_NUM,
		MEMBRANE_NUM,
		OTHER_PACKAGE,
		DELIVERY_CUSTOMER_CONTACT_ID,
		RECEIVE_CUSTOMER_CONTACT_ID,
		PENDING_TYPE,
		LICENSE_PLATE_NUM,
		ORDER_VEHICLE_NUM,
		CREATE_USER_NAME,
		CREATE_USER_DEPT_NAME,
		RECEIVE_ORG_NAME,
		CUSTOMER_PICKUP_ORG_NAME,
		LOAD_ORG_NAME,
		LAST_LOAD_ORG_NAME,
		TRANSFER_START_ORG_CODE,
		TRANSFER_START_ORG_NAME,
		KILOMETER,
		IS_ECONOMY_GOODS,
		ECONOMY_GOODS_TYPE,
		DELIVERY_BIG_CUSTOMER,
		RECEIVE_BIG_CUSTOMER,
		IS_EXPRESS,
		FREE_PICKUP_GOODS
		)
		values (
		#{id,jdbcType=VARCHAR}, 
		#{waybillNo,jdbcType=VARCHAR},
		#{orderNo,jdbcType=VARCHAR},
		#{orderChannel,jdbcType=VARCHAR},
		#{orderPaidMethod,jdbcType=VARCHAR},
		#{deliveryCustomerId,jdbcType=VARCHAR},
		#{deliveryCustomerCode,jdbcType=VARCHAR},
		#{deliveryCustomerName,jdbcType=VARCHAR},
		#{deliveryCustomerMobilephone,jdbcType=VARCHAR},
		#{deliveryCustomerPhone,jdbcType=VARCHAR},
		#{deliveryCustomerContact,jdbcType=VARCHAR},
		#{deliveryCustomerNationCode,jdbcType=VARCHAR},
		#{deliveryCustomerProvCode,jdbcType=VARCHAR},
		#{deliveryCustomerCityCode,jdbcType=VARCHAR},
		#{deliveryCustomerDistCode,jdbcType=VARCHAR},
		#{deliveryCustomerAddress,jdbcType=VARCHAR},
		#{receiveCustomerId,jdbcType=VARCHAR},
		#{receiveCustomerCode,jdbcType=VARCHAR},
		#{receiveCustomerName,jdbcType=VARCHAR},
		#{receiveCustomerMobilephone,jdbcType=VARCHAR},
		#{receiveCustomerPhone,jdbcType=VARCHAR},
		#{receiveCustomerContact,jdbcType=VARCHAR},
		#{receiveCustomerNationCode,jdbcType=VARCHAR},
		#{receiveCustomerProvCode,jdbcType=VARCHAR},
		#{receiveCustomerCityCode,jdbcType=VARCHAR},
		#{receiveCustomerDistCode,jdbcType=VARCHAR},
		#{receiveCustomerAddress,jdbcType=VARCHAR},
		#{receiveOrgCode,jdbcType=VARCHAR}, 
		'C30005',
		#{productCode,jdbcType=VARCHAR},
		#{receiveMethod,jdbcType=VARCHAR},
		#{customerPickupOrgCode,jdbcType=VARCHAR},
		#{loadMethod,jdbcType=VARCHAR},
		#{targetOrgCode,jdbcType=VARCHAR},
		'N', 
		#{driverCode,jdbcType=VARCHAR},
		'N', 
		'N',
		'N',
		#{lastLoadOrgCode,jdbcType=VARCHAR},
		#{preDepartureTime,jdbcType=TIMESTAMP},
		#{preCustomerPickupTime,jdbcType=TIMESTAMP},
		'N', 
		#{goodsName,jdbcType=VARCHAR},
		#{goodsQtyTotal,jdbcType=DECIMAL},
		#{goodsWeightTotal,jdbcType=DECIMAL},
		#{goodsVolumeTotal,jdbcType=DECIMAL},
		#{goodsSize,jdbcType=VARCHAR,typeHandler=org.apache.ibatis.type.ClobTypeHandler},
		#{goodsTypeCode,jdbcType=VARCHAR}, 
		'N',
		'N',
		#{outerNotes,jdbcType=VARCHAR,typeHandler=org.apache.ibatis.type.ClobTypeHandler},
		#{innerNotes,jdbcType=VARCHAR,typeHandler=org.apache.ibatis.type.ClobTypeHandler},
		#{goodsPackage,jdbcType=VARCHAR},
		#{insuranceAmount,jdbcType=DECIMAL}*100,
		#{codAmount,jdbcType=DECIMAL}*100, 
		#{codRate,jdbcType=DECIMAL},
		#{codFee,jdbcType=DECIMAL}*100, 
		#{refundType,jdbcType=VARCHAR},
		#{returnBillType,jdbcType=VARCHAR},
		#{secretPrepaid,jdbcType=CHAR},
		#{toPayAmount,jdbcType=DECIMAL}*100,
		#{prePayAmount,jdbcType=DECIMAL}*100,
		0,/*送货费*/
		#{otherFee,jdbcType=DECIMAL}*100, 
		#{packageFee,jdbcType=DECIMAL}*100,
		#{promotionsFee,jdbcType=DECIMAL}*100,
		#{billingType,jdbcType=VARCHAR}, 
		#{transportFee,jdbcType=DECIMAL}*100,
		#{valueAddFee,jdbcType=DECIMAL}*100, 
		#{paidMethod,jdbcType=VARCHAR},
		#{arriveType,jdbcType=VARCHAR},
		#{active,jdbcType=CHAR},
		'N', 
		#{freightMethod,jdbcType=VARCHAR},
		#{flightShift,jdbcType=VARCHAR}, 
		#{totalFee,jdbcType=DECIMAL}*100,
		#{promotionsCode,jdbcType=VARCHAR},
		sysdate,/*创建时间*/
		<if test="isWaybillRfc != null and isWaybillRfc == 'true'.toString()">
			to_date('31\12\2999 00:00:00','dd\mm\yyyy hh24:mi:ss'),/*修改时间*/
		</if>
		<if test="isWaybillRfc != null and isWaybillRfc == 'false'.toString()">
			sysdate,
		</if>
		#{billTime,jdbcType=TIMESTAMP},
		#{createUserCode,jdbcType=VARCHAR},
		#{modifyUserCode,jdbcType=VARCHAR},
		#{createOrgCode,jdbcType=VARCHAR},
		#{modifyOrgCode,jdbcType=VARCHAR}, 
		#{refId,jdbcType=VARCHAR},
		#{refCode,jdbcType=VARCHAR},
		'RMB',
		#{isWholeVehicle,jdbcType=CHAR},
		#{wholeVehicleAppfee,jdbcType=DECIMAL}*100,
		#{wholeVehicleActualfee,jdbcType=DECIMAL}*100,
		#{accountName,jdbcType=VARCHAR},
		#{accountCode,jdbcType=VARCHAR},
		#{accountBank,jdbcType=VARCHAR}, 
		#{billWeight,jdbcType=DECIMAL},
		0*100,
		#{serviceFee,jdbcType=DECIMAL}*100,
		#{preArriveTime,jdbcType=TIMESTAMP},
		#{transportType,jdbcType=VARCHAR},
		#{addTime,jdbcType=TIMESTAMP},
		#{insuranceRate,jdbcType=DECIMAL},
		#{insuranceFee,jdbcType=DECIMAL}*100,
		#{unitPrice,jdbcType=DECIMAL}*100,
		#{contactAddressId,jdbcType=VARCHAR},
		#{flightNumberType,jdbcType=VARCHAR},
		#{collectionDepartment,jdbcType=VARCHAR},
		#{transportationRemark,jdbcType=VARCHAR,typeHandler=org.apache.ibatis.type.ClobTypeHandler},
		#{isPassOwnDepartment,jdbcType=CHAR},
		#{paperNum,jdbcType=NUMERIC},
		#{woodNum,jdbcType=NUMERIC},
		#{fibreNum,jdbcType=NUMERIC},
		#{salverNum,jdbcType=NUMERIC},
		#{membraneNum,jdbcType=NUMERIC},
		#{otherPackage,jdbcType=VARCHAR},
		#{deliverCustContactId,jdbcType=VARCHAR},
		#{receiverCustContactId,jdbcType=VARCHAR},
		#{pendingType,jdbcType=VARCHAR},
		#{licensePlateNum,jdbcType=VARCHAR},
		#{orderVehicleNum,jdbcType=VARCHAR},
		#{createUserName,jdbcType=VARCHAR},
		#{createUserDeptName,jdbcType=VARCHAR},
		#{receiveOrgName,jdbcType=VARCHAR},
		#{customerPickupOrgName,jdbcType=VARCHAR},
		#{loadOrgName,jdbcType=VARCHAR},
		#{lastLoadOrgName,jdbcType=VARCHAR},
		#{transferStartOrgCode,jdbcType=VARCHAR},
		#{transferStartOrgName,jdbcType=VARCHAR},
		#{kilometer,jdbcType=DECIMAL},
		#{isEconomyGoods,jdbcType=CHAR},
		#{economyGoodsType,jdbcType=VARCHAR},
		#{deliveryBigCustomer,jdbcType=CHAR},
		#{receiveBigCustomer,jdbcType=CHAR},
		'N',
		'N'
		)
   	</insert>
   	
   	<!-- 插入实际承运表数据 -->
   	<insert id="insertActualFreightMess" parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.ActualFreightEntity">
		begin
			  update /*更新实际承运表*/ pkp.T_SRV_ACTUAL_FREIGHT w 
              	set 
					<if test="goodsName != null or goodsName != ''">
						GOODS_NAME = #{goodsName,jdbcType=VARCHAR},
					</if>
					<if test="weight != null or weight != ''">
						WEIGHT = #{weight,jdbcType=DECIMAL}, 
					</if>
					<if test="volume != null or volume != ''">
						VOLUME = #{volume,jdbcType=DECIMAL}, 
					</if>
					<if test="goodsQty != null or goodsQty != ''">
						GOODS_QTY = #{goodsQty,jdbcType=DECIMAL},
					</if>
					<if test="goodsQty != null or goodsQty != ''">
						DIMENSION = #{goodsQty,jdbcType=VARCHAR},
					</if>
					<if test="insuranceValue != null or insuranceValue != ''">
						INSURANCE_VALUE = #{insuranceValue,jdbcType=DECIMAL},
					</if>
					<if test="packingFee != null or packingFee != ''">
						PACKING_FEE = #{packingFee,jdbcType=DECIMAL},
					</if>
					<if test="laborFee != null or laborFee != ''">
						LABOR_FEE = #{laborFee,jdbcType=DECIMAL},
					</if>
					<if test="codAmount != null or codAmount != ''">
						COD_AMOUNT = #{codAmount,jdbcType=DECIMAL},
					</if>
					<if test="valueaddFee != null or valueaddFee != ''">
						VALUEADD_FEE = #{valueaddFee,jdbcType=DECIMAL},
					</if>
					<if test="freight != null or freight != ''">
						FREIGHT = #{freight,jdbcType=DECIMAL},
					</if>
					<if test="settleStatus != null or settleStatus != ''">
						SETTLE_STATUS = #{settleStatus,jdbcType=CHAR},
					</if>
					<if test="settleTime != null or settleTime != ''">
						SETTLE_TIME = #{settleTime,jdbcType=TIMESTAMP},
					</if>
					<if test="notificationTime != null or notificationTime != ''">
						NOTIFICATION_TIME = #{notificationTime,jdbcType=TIMESTAMP},
					</if>
					<if test="actualDeliverType != null or actualDeliverType != ''">
						ACTUAL_DELIVER_TYPE = #{actualDeliverType,jdbcType=VARCHAR},
					</if>
					<if test="storageDay != null or storageDay != ''">
						STORAGE_DAY = #{storageDay,jdbcType=DECIMAL},
					</if>
					<if test="storageCharge != null or storageCharge != ''">
						STORAGE_CHARGE = #{storageCharge,jdbcType=DECIMAL},
					</if>
					<if test="overdueDay != null or overdueDay != ''">
						OVERDUE_DAY = #{overdueDay,jdbcType=DECIMAL}, 
					</if>
					<if test="arriveGoodsQty != null or arriveGoodsQty != ''">
						ARRIVE_GOODS_QTY = #{arriveGoodsQty,jdbcType=DECIMAL},
					</if>
					<if test="arriveTime != null or arriveTime != ''">
						ARRIVE_TIME = #{arriveTime,jdbcType=TIMESTAMP},
					</if>
					<if test="arrangeGoodsQty != null or arrangeGoodsQty != ''">
						ARRANGE_GOODS_QTY = #{arrangeGoodsQty,jdbcType=DECIMAL},
					</if>
					<if test="arriveNotoutGoodsQty != null or arriveNotoutGoodsQty != ''">
						ARRIVE_NOTOUT_GOODS_QTY = #{arriveNotoutGoodsQty,jdbcType=DECIMAL},
					</if>
					<if test="exceptionGoodsQty != null or exceptionGoodsQty != ''">
						EXCEPTION_GOODS_QTY = #{exceptionGoodsQty,jdbcType=DECIMAL},
					</if>
					<if test="deliverRegionCode != null or deliverRegionCode != ''">
						DELIVER_REGION_CODE = #{deliverRegionCode,jdbcType=VARCHAR},
					</if>
					<if test="generateGoodsQty != null or generateGoodsQty != ''">
						GENERATE_GOODS_QTY = #{generateGoodsQty,jdbcType=DECIMAL},
					</if>
					<if test="paymentType != null or paymentType != ''">
						PAYMENT_TYPE = #{paymentType,jdbcType=VARCHAR},
					</if>
					<if test="startStockOrgCode != null or startStockOrgCode != ''">
						START_STOCK_ORG_CODE = #{startStockOrgCode,jdbcType=VARCHAR},
					</if>
					<if test="endStockOrgCode != null or endStockOrgCode != ''">
						END_STOCK_ORG_CODE = #{endStockOrgCode,jdbcType=VARCHAR},
					</if>
					<if test="waybillId != null or waybillId != ''">
						WAYBILL_ID =  #{waybillId,jdbcType=VARCHAR},
					</if>
					<if test="status != null or status != ''">
						STATUS =  #{status,jdbcType=VARCHAR},
					</if>
					<if test="channelCustId != null or channelCustId != ''">
						channelCustId = #{channelCustId,jdbcType=VARCHAR},
					</if>
					<if test="goodsAreaCode != null or goodsAreaCode != ''">
						GOODS_AREA_CODE = #{goodsAreaCode,jdbcType=VARCHAR},
					</if>
					<if test="invoice != null or invoice != ''">
						INVOICE = #{invoice,jdbcType=VARCHAR},
					</if>
					<if test="startBillTime != null or startBillTime != ''">
						START_BILL_TIME = #{startBillTime,jdbcType=TIMESTAMP}, 
					</if>
					<if test="bigTicketGoods != null or bigTicketGoods != ''">
						BIG_TICKET_GOODS = #{bigTicketGoods,jdbcType=CHAR},
					</if>
					<if test="startCentralizedSettlement != null or startCentralizedSettlement != ''">
						START_CENTRALIZED_SETTLEMENT = #{startCentralizedSettlement,jdbcType=CHAR},
					</if>
					<if test="arriveCentralizedSettlement != null or arriveCentralizedSettlement != ''">
						ARRIVE_CENTRALIZED_SETTLEMENT = #{arriveCentralizedSettlement,jdbcType=CHAR},
					</if>
					<if test="startContractOrgCode != null or startContractOrgCode != ''">
						START_CONTRACT_ORG_CODE = #{startContractOrgCode,jdbcType=VARCHAR},
					</if>
					<if test="arriveContractOrgCode != null or arriveContractOrgCode != ''">
						ARRIVE_CONTRACT_ORG_CODE = #{arriveContractOrgCode,jdbcType=VARCHAR},
					</if>
					<if test="startReminderOrgCode != null or startReminderOrgCode != ''">
						START_REMINDER_ORG_CODE = #{startReminderOrgCode,jdbcType=VARCHAR},
					</if>
					<if test="arriveReminderOrgCode != null or arriveReminderOrgCode != ''">
						ARRIVE_REMINDER_ORG_CODE = #{arriveReminderOrgCode,jdbcType=VARCHAR},
					</if>
					<if test="receiveCustomerAddressNote != null or receiveCustomerAddressNote != ''">
						RECEIVE_CUSTOMER_ADDRESS_NOTE = #{receiveCustomerAddressNote,jdbcType=VARCHAR},
					</if>
					<if test="deliveryCustomerAddressNote != null or deliveryCustomerAddressNote != ''">
						DELIVERY_CUSTOMER_ADDRESS_NOTE = #{deliveryCustomerAddressNote,jdbcType=VARCHAR},
					</if>
					<if test="isExhibitCargo != null or isExhibitCargo != ''">
						IS_EXHIBIT_CARGO = #{isExhibitCargo,jdbcType=VARCHAR},
					</if>
					<if test="packageRemark != null or packageRemark != ''">
						PACKAGE_REMARK = #{packageRemark,jdbcType=VARCHAR},
					</if>
					<if test="businessZone != null or businessZone != ''">
						BUSINESS_ZONE = #{businessZone,jdbcType=CHAR},
					</if>
					<if test="residentialDistrict != null or residentialDistrict != ''">
						RESIDENTIAL_DISTRICT = #{residentialDistrict,jdbcType=CHAR},
					</if>
					<if test="internalDeliveryType != null or internalDeliveryType != ''">
						INTERNAL_DELIVERY_TYPE = #{internalDeliveryType,jdbcType=VARCHAR},
					</if>
					<if test="specialValueAddedServiceType != null or specialValueAddedServiceType != ''">
						SPECIAL_VALUE_ADDED_SERVICE = #{specialValueAddedServiceType,jdbcType=VARCHAR},
					</if>
					<if test="employeeNo != null or employeeNo != ''">
						EMPLOYEE_NO = #{employeeNo,jdbcType=VARCHAR},
					</if>
					<if test="waybillType != null or waybillType != ''">
						WAYBILL_TYPE = #{waybillType,jdbcType=VARCHAR},
					</if>
					<if test="isBatchCreateWaybill != null or isBatchCreateWaybill != ''">
						IS_BATCH_CREATE_WAYBILL = #{isBatchCreateWaybill,jdbcType=VARCHAR},
					</if>
					<if test="modifyTime != null or modifyTime != ''">
						MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
					</if>
					<if test="minTransportFee != null or minTransportFee != ''">
						MIN_TRANSPORT_FEE = #{minTransportFee,jdbcType=DECIMAL},
					</if>
					WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
              where w.waybill_no = #{waybillNo,jdbcType=VARCHAR};
			IF SQL%NOTFOUND THEN
				     insert /*插入实际承运表*/into PKP.T_SRV_ACTUAL_FREIGHT (
							ID, 
							WAYBILL_NO, 
							GOODS_NAME,
							WEIGHT, 
							VOLUME, 
							GOODS_QTY,
							DIMENSION, 
							INSURANCE_VALUE, 
							PACKING_FEE,
							DELIVER_FEE, 
							LABOR_FEE, 
							COD_AMOUNT,
							VALUEADD_FEE, 
							FREIGHT, 
							SETTLE_STATUS,
							SETTLE_TIME, 
							NOTIFICATION_RESULT, 
							NOTIFICATION_TIME,
							ACTUAL_DELIVER_TYPE, 
							STORAGE_DAY,
							STORAGE_CHARGE, 
							OVERDUE_DAY, 
							ARRIVE_GOODS_QTY,
							ARRIVE_TIME, 
							ARRANGE_GOODS_QTY, 
							ARRIVE_NOTOUT_GOODS_QTY,
							EXCEPTION_GOODS_QTY, 
							DELIVER_REGION_CODE,
							GENERATE_GOODS_QTY, 
							PAYMENT_TYPE, 
							START_STOCK_ORG_CODE,
							END_STOCK_ORG_CODE, 
							WAYBILL_ID,
							STATUS,
							channelCustId,
							GOODS_AREA_CODE,
							CREATE_TIME,
							INVOICE,
							START_BILL_TIME,
							BIG_TICKET_GOODS,
							START_CENTRALIZED_SETTLEMENT,
							ARRIVE_CENTRALIZED_SETTLEMENT,
							START_CONTRACT_ORG_CODE,
							ARRIVE_CONTRACT_ORG_CODE,
							START_REMINDER_ORG_CODE,
							ARRIVE_REMINDER_ORG_CODE,
							RECEIVE_CUSTOMER_ADDRESS_NOTE,
							DELIVERY_CUSTOMER_ADDRESS_NOTE,
							IS_EXHIBIT_CARGO,
							PACKAGE_REMARK,
							BUSINESS_ZONE,
							RESIDENTIAL_DISTRICT,
							INTERNAL_DELIVERY_TYPE,
							SPECIAL_VALUE_ADDED_SERVICE,
							EMPLOYEE_NO,
							WAYBILL_TYPE,
							IS_BATCH_CREATE_WAYBILL,
							MIN_TRANSPORT_FEE,
							MODIFY_TIME
							) 
							values (
							SYS_GUID(), 
							#{waybillNo,jdbcType=VARCHAR},
							#{goodsName,jdbcType=VARCHAR},
							#{weight,jdbcType=DECIMAL}, 
							#{volume,jdbcType=DECIMAL}, 
							#{goodsQty,jdbcType=DECIMAL},
							#{dimension,jdbcType=VARCHAR}, 
							#{insuranceValue,jdbcType=DECIMAL},
							#{packingFee,jdbcType=DECIMAL},
							0, 
							#{laborFee,jdbcType=DECIMAL}, 
							#{codAmount,jdbcType=DECIMAL},
							#{valueaddFee,jdbcType=DECIMAL}, 
							#{freight,jdbcType=DECIMAL},
							#{settleStatus,jdbcType=CHAR},
							#{settleTime,jdbcType=TIMESTAMP}, 
							'NONE_NOTICE',
							#{notificationTime,jdbcType=TIMESTAMP},
							#{actualDeliverType,jdbcType=VARCHAR},
							#{storageDay,jdbcType=DECIMAL},
							#{storageCharge,jdbcType=DECIMAL}, 
							#{overdueDay,jdbcType=DECIMAL}, 
							#{arriveGoodsQty,jdbcType=DECIMAL},
							#{arriveTime,jdbcType=TIMESTAMP}, 
							#{arrangeGoodsQty,jdbcType=DECIMAL},
							#{arriveNotoutGoodsQty,jdbcType=DECIMAL},
							#{exceptionGoodsQty,jdbcType=DECIMAL},
							#{deliverRegionCode,jdbcType=VARCHAR},
							#{generateGoodsQty,jdbcType=DECIMAL}, 
							#{paymentType,jdbcType=VARCHAR},
							#{startStockOrgCode,jdbcType=VARCHAR},
							#{endStockOrgCode,jdbcType=VARCHAR},
					        #{waybillId,jdbcType=VARCHAR},
					        #{status,jdbcType=VARCHAR},
					        #{channelCustId,jdbcType=VARCHAR},
					        #{goodsAreaCode,jdbcType=VARCHAR},
					        sysdate,
					        #{invoice,jdbcType=VARCHAR},
					        #{startBillTime,jdbcType=TIMESTAMP}, 
					        #{bigTicketGoods,jdbcType=CHAR},
					        #{startCentralizedSettlement,jdbcType=CHAR},
					        #{arriveCentralizedSettlement,jdbcType=CHAR},
					        #{startContractOrgCode,jdbcType=VARCHAR},
					        #{arriveContractOrgCode,jdbcType=VARCHAR},
					        #{startReminderOrgCode,jdbcType=VARCHAR},
					        #{arriveReminderOrgCode,jdbcType=VARCHAR},
					        #{receiveCustomerAddressNote,jdbcType=VARCHAR},
					        #{deliveryCustomerAddressNote,jdbcType=VARCHAR},
							#{isExhibitCargo,jdbcType=VARCHAR},
							#{packageRemark,jdbcType=VARCHAR},
							#{businessZone,jdbcType=CHAR},
							#{residentialDistrict,jdbcType=CHAR},
							#{internalDeliveryType,jdbcType=VARCHAR},
					        #{specialValueAddedServiceType,jdbcType=VARCHAR},
							#{employeeNo,jdbcType=VARCHAR},
							#{waybillType,jdbcType=VARCHAR},
							#{isBatchCreateWaybill,jdbcType=VARCHAR},
							#{minTransportFee,jdbcType=DECIMAL},
							sysdate
						);
			END IF;
		end;
	</insert>
	
	<!-- 插入运单更改表 -->
    <insert id="vtsInsertWaybillRfcMess"
		parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillRfcEntity">
		insert into PKP.T_SRV_WAYBILLRFC
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				ID,
			</if>
			<if test="waybillNo != null">
				WAYBILL_NO,
			</if>
			<if test="rfcSource != null">
				RFC_SOURCE,
			</if>
			<if test="rfcType != null">
				RFC_TYPE,
			</if>
			<if test="rfcReason != null">
				RFC_REASON,
			</if>
			<if test="draftOrgName != null">
				DRAFT_ORG_NAME,
			</if>
			<if test="draftOrgCode != null">
				DRAFT_ORG_CODE,
			</if>
			<if test="drafter != null">
				DRAFTER,
			</if>
			<if test="drafterCode != null">
				DRAFTER_CODE,
			</if>
			<if test="draftTime != null">
				DRAFT_TIME,
			</if>
			<if test="notes != null">
				NOTES,
			</if>
			<if test="status != null">
				STATUS,
			</if>
			<if test="operator != null">
				OPERATOR,
			</if>
			<if test="operatorCode != null">
				OPERATOR_CODE,
			</if>
			<if test="operateOrgName != null">
				OPERATE_ORG_NAME,
			</if>
			<if test="operateOrgCode != null">
				OPERATE_ORG_CODE,
			</if>
			<if test="operateTime != null">
				OPERATE_TIME,
			</if>
			<if test="oldVersionWaybillId != null">
				OLD_VERSION_WAYBILL_ID,
			</if>
			<if test="newVersionWaybillId != null">
				NEW_VERSION_WAYBILL_ID,
			</if>
				IS_FINANCE_CHANGE,
			<if test="changeItems != null">
				CHANGE_ITEMS,
			</if>
				RECEIVER_SMS,
				DELIVER_SMS,
				IS_CHANGE_DESTINATION,
				NEED_WRITE_OFF,
				WRITE_OFF_STATUS,
			<if test="writeOffNotes != null">
				WRITE_OFF_NOTES,
			</if>
			<if test="pdaNotice != null">
				PDA_NOTICE,
			</if>
			<if test="transportFee != null">
				TRANSPORT_FEE,
			</if>
			<if test="transportFeeRate != null">
				TRANSPORT_FEE_RATE,
			</if>
			<if test="isChangeWaybillNo != null">
				IS_CHANGE_WAYBILL_NO,
			</if>
				IS_LABOUR_HANDLE,
			<if test="writeOffEmpName != null">
				WRITE_OFF_EMP_NAME,
			</if>
			<if test="writeOffTime != null">
				WRITE_OFF_TIME,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=VARCHAR},
			</if>
			<if test="waybillNo != null">
				#{waybillNo,jdbcType=VARCHAR},
			</if>
			<if test="rfcSource != null">
				#{rfcSource,jdbcType=VARCHAR},
			</if>
			<if test="rfcType != null">
				#{rfcType,jdbcType=VARCHAR},
			</if>
			<if test="rfcReason != null">
				#{rfcReason,jdbcType=VARCHAR},
			</if>
			<if test="draftOrgName != null">
				#{draftOrgName,jdbcType=VARCHAR},
			</if>
			<if test="draftOrgCode != null">
				#{draftOrgCode,jdbcType=VARCHAR},
			</if>
			<if test="drafter != null">
				#{drafter,jdbcType=VARCHAR},
			</if>
			<if test="drafterCode != null">
				#{drafterCode,jdbcType=VARCHAR},
			</if>
				SYSDATE,
			<if test="notes != null">
				#{notes,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				#{status,jdbcType=VARCHAR},
			</if>
			<if test="operator != null">
				#{operator,jdbcType=VARCHAR},
			</if>
			<if test="operatorCode != null">
				#{operatorCode,jdbcType=VARCHAR},
			</if>
			<if test="operateOrgName != null">
				#{operateOrgName,jdbcType=VARCHAR},
			</if>
			<if test="operateOrgCode != null">
				#{operateOrgCode,jdbcType=VARCHAR},
			</if>
				SYSDATE,
			<if test="oldVersionWaybillId != null">
				#{oldVersionWaybillId,jdbcType=VARCHAR},
			</if>
			<if test="newVersionWaybillId != null">
				#{newVersionWaybillId,jdbcType=VARCHAR},
			</if>
			'Y',
			<if test="changeItems != null">
				#{changeItems,jdbcType=VARCHAR},
			</if>
			'N',
			'N',
			'N',
			'Y',
			'NO_WRITE_OFF',
			<if test="writeOffNotes != null">
				#{writeOffNotes,jdbcType=VARCHAR},
			</if>
			<if test="pdaNotice != null">
				#{pdaNotice,jdbcType=CHAR},
			</if>
			<if test="transportFee != null">
				#{transportFee,jdbcType=DECIMAL},
			</if>
			<if test="transportFeeRate != null">
				#{transportFeeRate,jdbcType=DECIMAL},
			</if>
			<if test="isChangeWaybillNo != null">
				#{isChangeWaybillNo,jdbcType=CHAR},
			</if>
			'N',
			<if test="writeOffEmpName != null">
				#{writeOffEmpName,jdbcType=VARCHAR},
			</if>
			<if test="writeOffTime != null">
				#{writeOffTime,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert> 
	
	<!-- 插入签收结果表 -->
	<insert id="vtsInsertWaybillSignResult" parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillSignResultEntity" >
    insert into PKP.T_SRV_WAYBILL_SIGN_RESULT
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null and id != ''" >
        ID,
      </if>
      <if test="waybillNo != null and waybillNo != ''" >
        WAYBILL_NO,
      </if>
      <if test="signSituation != null and signSituation != ''" >
        SIGN_SITUATION,
      </if>
      <if test="deliverymanName != null and deliverymanName != ''" >
        DELIVERYMAN_NAME,
      </if>
      <if test="signGoodsQty != null and signGoodsQty != ''" >
        SIGN_GOODS_QTY,
      </if>
      <if test="signNote != null and signNote != ''" >
        SIGN_NOTE,
      </if>
      <if test="signTime != null and signTime != ''" >
        SIGN_TIME,
      </if>
      <if test="createTime != null and createTime != ''" >
        CREATE_TIME,
      </if>
      <if test="modifyTime != null and modifyTime != ''" >
        MODIFY_TIME,
      </if>
      <if test="active != null and active != ''" >
        ACTIVE,
      </if>
      <if test="identifyType != null and identifyType != ''" >
        IDENTIFY_TYPE,
      </if>
      <if test="identifyCode != null and identifyCode != ''" >
        IDENTIFY_CODE,
      </if>
      <if test="isPdaSign != null and isPdaSign != ''" >
        IS_PDA_SIGN,
      </if>
      <if test="signStatus != null and signStatus != ''" >
        SIGN_STATUS,
      </if>
      <if test="agentCode != null and agentCode != ''" >
        AGENT_CODE,
      </if>
      <if test="isRfcing != null and isRfcing != ''" >
        IS_RFCING,
      </if>
      <if test="deliverDate != null and deliverDate != ''" >
        DELIVER_DATE,
      </if>
      <if test="arriveTime != null and arriveTime != ''" >
        ARRIVE_TIME,
      </if>
      <if test="receiveMethod != null and receiveMethod != ''" >
        RECEIVE_METHOD,
      </if>
      <if test="isInit != null and isInit != ''" >
        IS_INIT,
      </if>
      <if test="createOrgCode != null and createOrgCode != ''" >
        CREATE_ORG_CODE,
      </if>
      <if test="createOrgName != null and createOrgName != ''" >
        CREATE_ORG_NAME,
      </if>
      <if test="creator != null and creator != ''" >
        CREATOR,
      </if>
      <if test="creatorCode != null and creatorCode != ''" >
        CREATOR_CODE,
      </if>
      <if test="expressEmpCode != null and expressEmpCode != ''" >
        SEND_EXPRESS_EMP_CODE,
      </if>
      <if test="expressEmpName != null and expressEmpName != ''" >
        SEND_EXPRESS_EMP_NAME,
      </if>
      <if test="expressOrgCode != null and expressOrgCode != ''" >
        SEND_EXPRESS_ORG_CODE,
      </if>
      <if test="expressOrgName != null and expressOrgName != ''" >
        SEND_EXPRESS_ORG_NAME,
      </if>
      <if test="toPayAmount != null and toPayAmount != ''" >
        TO_PAY_AMOUNT,
      </if>
      <if test="codAmount != null and codAmount != ''" >
        COD_AMOUNT,
      </if>
      <if test="codPaymentType != null and codPaymentType != ''" >
        COD_PAYMENT_TYPE,
      </if>
      <if test="codBankTradeSerail != null and codBankTradeSerail != ''" >
        COD_BANK_TRADESERAIL,
      </if>
      <if test="totalAmount != null and totalAmount != ''" >
        TOTAL_AMOUNT,
      </if>
      <if test="totalPaymentType != null and totalPaymentType != ''" >
        TOTAL_PAYMENT_TYPE,
      </if>
      <if test="isPartner != null and isPartner != ''">
      	IS_PARTNER,
      </if>
      <if test="partnerName != null and partnerName != ''">
      	PARTNER_NAME,
      </if>
      <if test="partnerPhone != null and partnerPhone != ''">
      	PARTNER_PHONE,
      </if>
      
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null and id != ''" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="waybillNo != null and waybillNo != ''" >
        #{waybillNo,jdbcType=VARCHAR},
      </if>
      <if test="signSituation != null and signSituation != ''" >
        #{signSituation,jdbcType=VARCHAR},
      </if>
      <if test="deliverymanName != null and deliverymanName != ''" >
        #{deliverymanName,jdbcType=VARCHAR},
      </if>
      <if test="signGoodsQty != null and signGoodsQty != ''" >
        #{signGoodsQty,jdbcType=DECIMAL},
      </if>
      <if test="signNote != null and signNote != ''" >
        #{signNote,jdbcType=VARCHAR},
      </if>
      <if test="signTime != null and signTime != ''" >
        #{signTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createTime != null and createTime != ''" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyTime != null and modifyTime != ''" >
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="active != null and active != ''" >
        #{active,jdbcType=CHAR},
      </if>
      <if test="identifyType != null and identifyType != ''" >
        #{identifyType,jdbcType=VARCHAR},
      </if>
      <if test="identifyCode != null and identifyCode != ''" >
        #{identifyCode,jdbcType=VARCHAR},
      </if>
      <if test="isPdaSign != null and isPdaSign != ''" >
        #{isPdaSign,jdbcType=CHAR},
      </if>
      <if test="signStatus != null and signStatus != ''" >
        #{signStatus,jdbcType=VARCHAR},
      </if>
      <if test="agentCode != null and agentCode != ''" >
        #{agentCode,jdbcType=VARCHAR},
      </if>
       <if test="isRfcing != null and isRfcing != ''" >
        #{isRfcing,jdbcType=CHAR},
      </if>
      <if test="deliverDate != null and deliverDate != ''" >
        #{deliverDate,jdbcType=TIMESTAMP},
      </if>
      <if test="arriveTime != null and arriveTime != ''" >
        #{arriveTime,jdbcType=TIMESTAMP},
      </if>
      <if test="receiveMethod != null and receiveMethod != ''" >
        #{receiveMethod,jdbcType=VARCHAR},
      </if>
      <if test="isInit != null and isInit != ''" >
        #{isInit,jdbcType=VARCHAR},
      </if>
      <if test="createOrgCode != null and createOrgCode != ''" >
        #{createOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="createOrgName != null and createOrgName != ''" >
        #{createOrgName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null and creator != ''" >
        #{creator,jdbcType=VARCHAR},
      </if>
      <if test="creatorCode != null and creatorCode != ''" >
        #{creatorCode,jdbcType=VARCHAR},
      </if>
      
      
      <if test="expressEmpCode != null and expressEmpCode != ''" >
        #{expressEmpCode,jdbcType=VARCHAR},
      </if>
      <if test="expressEmpName != null and expressEmpName != ''" >
        #{expressEmpName,jdbcType=VARCHAR},
      </if>
      <if test="expressOrgCode != null and expressOrgCode != ''" >
        #{expressOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="expressOrgName != null and expressOrgName != ''" >
        #{expressOrgName,jdbcType=VARCHAR},
      </if>
      
      <if test="toPayAmount != null and toPayAmount != ''" >
        #{toPayAmount,jdbcType=DECIMAL},
      </if>
      <if test="codAmount != null and codAmount != ''" >
        #{codAmount,jdbcType=DECIMAL},
      </if>
      <if test="codPaymentType != null and codPaymentType != ''" >
        #{codPaymentType,jdbcType=VARCHAR},
      </if>
      <if test="codBankTradeSerail != null and codBankTradeSerail != ''" >
        #{codBankTradeSerail,jdbcType=VARCHAR},
      </if>
      <if test="totalAmount != null and totalAmount != ''" >
        #{totalAmount,jdbcType=DECIMAL},
      </if>
      <if test="totalPaymentType != null and totalPaymentType != ''" >
        #{totalPaymentType,jdbcType=VARCHAR},
      </if>
      
      <if test="isPartner != null and isPartner != ''">
      	#{isPartner,jdbcType=CHAR},
      </if>
      <if test="partnerName != null and partnerName != ''">
      	#{partnerName,jdbcType=VARCHAR},
      </if>
      <if test="partnerPhone != null and partnerPhone != ''">
		#{partnerPhone,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
	<!-- 根据运单号查询有效的运单数据 -->
	<select id="queryWaybillEntity" parameterType="java.util.Map" resultType="int">
		select/*vts-根据运单号查询有效的运单数据*/ count(1) 
			from pkp.t_srv_waybill w 
		where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
        and   w.active = #{active,jdbcType=VARCHAR}
	</select>
	
	<!-- 作废运单数据 -->
	<update id="cancelWaybillEntity" parameterType="java.util.Map">
       update /*作废运单数据*/ pkp.t_srv_waybill w 
              set w.active = 'N',
                  w.modify_time = sysdate
             where w.id = #{waybillId,jdbcType=VARCHAR}
        	 and   w.active = #{active,jdbcType=VARCHAR}
	</update>
	
	<!-- 新增财务签收表 -->
	<insert id="insertPod" parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillSignResultEntity"> 
	insert into STL.T_STL_POD (
        ID,
        WAYBILL_NO,
        POD_DATE,
        POD_TYPE,
        POD_USER_CODE,
        POD_USER_NAME,
        POD_ORG_CODE,
        POD_ORG_NAME,
        CREATE_TIME,
        IS_INIT
        )
    VALUES(
        SYS_GUID(), 
        #{waybillNo,jdbcType=VARCHAR},
        #{signTime,jdbcType=TIMESTAMP},
        'POD',
        #{creatorCode,jdbcType=VARCHAR},
        #{creator,jdbcType=VARCHAR},
        #{createOrgCode,jdbcType=VARCHAR},
        #{createOrgName,jdbcType=VARCHAR},
        SYSDATE,/*创建时间*/
        #{isInit,jdbcType=CHAR}
        )
	</insert>
	
	<!-- 根据运单号查询未审核、未受理的更改单 -->
	<select id="queryExsitWaybillRfc" parameterType="java.util.Map" resultType="int">
		select/*vts-根据运单号查询未审核、未受理的更改单*/ count(1) 
			from PKP.T_SRV_WAYBILLRFC w 
		where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
        and   w.status in ('PRE_AUDIT','PRE_ACCECPT')
	</select>
	
	<!-- 更新更改单 -->
	<update id="updateWayBillRfcMessage" parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillRfcEntity">
       UPDATE/*更新运单更改表*/ PKP.T_SRV_WAYBILLRFC
		     SET
				<if test="waybillNo != null or waybillNo!=''">
					WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR},
				</if>
				<if test="rfcSource != null or rfcSource!=''">
					RFC_SOURCE = #{rfcSource,jdbcType=VARCHAR},
				</if>
				<if test="rfcType != null or rfcType!=''">
					RFC_TYPE = #{rfcType,jdbcType=VARCHAR},
				</if>
				<if test="rfcReason != null or rfcReason!=''">
					RFC_REASON = #{rfcReason,jdbcType=VARCHAR},
				</if>
				<if test="draftOrgName != null or draftOrgName!=''">
					DRAFT_ORG_NAME =#{draftOrgName,jdbcType=VARCHAR},
				</if>
				<if test="draftOrgCode != null or draftOrgCode!=''">
					DRAFT_ORG_CODE =#{draftOrgCode,jdbcType=VARCHAR},
				</if>
				<if test="drafter != null or drafter!=''">
					DRAFTER =#{drafter,jdbcType=VARCHAR},
				</if>
				<if test="drafterCode != null or drafterCode!=''">
					DRAFTER_CODE =#{drafterCode,jdbcType=VARCHAR},
				</if>
				<if test="draftTime != null or draftTime!=''">
					DRAFT_TIME = SYSDATE,
				</if>
				<if test="notes != null or notes!=''">
					NOTES =#{notes,jdbcType=VARCHAR},
				</if>
				<if test="operator != null or operator!=''">
					OPERATOR =#{operator,jdbcType=VARCHAR},
				</if>
				<if test="operatorCode != null or operatorCode!=''">
					OPERATOR_CODE =#{operatorCode,jdbcType=VARCHAR},
				</if>
				<if test="operateOrgName != null or operateOrgName!=''">
					OPERATE_ORG_NAME =#{operateOrgName,jdbcType=VARCHAR},
				</if>
				<if test="operateOrgCode != null or operateOrgCode!=''">
					OPERATE_ORG_CODE =#{operateOrgCode,jdbcType=VARCHAR},
				</if>
				<if test="operateTime != null or operateTime!=''">
					OPERATE_TIME =SYSDATE,
				</if>
				<if test="oldVersionWaybillId != null or oldVersionWaybillId!=''">
					OLD_VERSION_WAYBILL_ID =#{oldVersionWaybillId,jdbcType=VARCHAR},
				</if>
				<if test="newVersionWaybillId != null or newVersionWaybillId!=''">
					NEW_VERSION_WAYBILL_ID =#{newVersionWaybillId,jdbcType=VARCHAR},
				</if>
				<!-- <if test="isFinanceChange != null or isFinanceChange!=''">
					IS_FINANCE_CHANGE =#{isFinanceChange,jdbcType=VARCHAR},
				</if> -->
				<if test="changeItems != null or changeItems!=''">
					CHANGE_ITEMS =#{changeItems,jdbcType=VARCHAR},
				</if>
				<!-- <if test="receiverSms != null or receiverSms!=''">
					RECEIVER_SMS =#{receiverSms,jdbcType=VARCHAR},
				</if> -->
				<!-- <if test="deliverSms != null or deliverSms!=''">
					DELIVER_SMS =#{deliverSms,jdbcType=VARCHAR},
				</if> -->
				<!-- <if test="isChangeDestination != null or isChangeDestination!=''">
					IS_CHANGE_DESTINATION =#{isChangeDestination,jdbcType=VARCHAR},
				</if> -->
				<!-- <if test="writeOffStatus != null or writeOffStatus!=''">
					WRITE_OFF_STATUS =#{writeOffStatus,jdbcType=VARCHAR},
				</if> -->
				<if test="writeOffNotes != null or writeOffNotes!=''">
					WRITE_OFF_NOTES =#{writeOffNotes,jdbcType=VARCHAR},
				</if>
				<if test="pdaNotice != null or pdaNotice!=''">
					PDA_NOTICE =#{pdaNotice,jdbcType=VARCHAR},
				</if>
				<if test="transportFee != null or transportFee!=''">
					TRANSPORT_FEE =#{transportFee,jdbcType=DECIMAL},
				</if>
				<if test="transportFeeRate != null or transportFeeRate!=''">
					TRANSPORT_FEE_RATE =#{transportFeeRate,jdbcType=DECIMAL},
				</if>
				<if test="isChangeWaybillNo != null or isChangeWaybillNo!=''">
					IS_CHANGE_WAYBILL_NO =#{isChangeWaybillNo,jdbcType=VARCHAR},
				</if>
				<!-- <if test="isLabourHandle != null or isLabourHandle!=''">
					IS_LABOUR_HANDLE =#{isLabourHandle,jdbcType=VARCHAR},
				</if> -->
				<if test="writeOffEmpName != null or writeOffEmpName!=''">
					WRITE_OFF_EMP_NAME =#{writeOffEmpName,jdbcType=VARCHAR},
				</if>
				<if test="writeOffTime != null or writeOffTime!=''">
					WRITE_OFF_TIME =#{writeOffTime,jdbcType=TIMESTAMP},
				</if>
				STATUS = #{status,jdbcType=VARCHAR}
		 WHERE  WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
		 AND    STATUS IN ('PRE_AUDIT','PRE_ACCECPT')
	</update>
	
	<!-- 根据运单号有效运单id -->
	<select id="queryActiveYWaybillNo" parameterType="java.util.Map" resultType="string">
		select/*vts-根据运单号有效运单id*/ id 
			from PKP.T_SRV_WAYBILL w 
		where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
        and   w.active = #{active,jdbcType=VARCHAR} 
	</select>
	
	<!-- 根据运单号最后一条无效运单id -->
	<select id="queryLastActiveNWaybillNo" parameterType="java.util.Map" resultType="string">
		select/*vts-根据运单号最后一条无效运单id*/ id
          from (select *
                  from PKP.T_SRV_WAYBILL r
                 where r.waybill_no = #{waybillNo,jdbcType=VARCHAR}
                   and r.active = #{active,jdbcType=VARCHAR}
                 order by r.create_time desc)
         where rownum = 1
	</select>
	
	<!-- 修改运单状态 -->
	<update id="updateWaybillState"  parameterType="java.util.Map">
		update /*修改运单状态*/ pkp.t_Srv_Waybill w set 
			<if test="_parameter.containsKey('modifyTime')">
				w.MODIFY_TIME = SYSDATE,
			</if>
			<if test="_parameter.containsKey('createTime')">
				w.create_time =  SYSDATE,
				w.MODIFY_TIME =  to_date('31\12\2999 00:00:00','dd\mm\yyyy hh24:mi:ss'),/*修改时间*/
			</if> 
			w.active = #{active,jdbcType=VARCHAR}
		where w.id = #{id,jdbcType=VARCHAR}
	</update>
	
	<!-- 根据运单号查询应付单count -->
	<select id="queryApcOrRfPayable" parameterType="java.util.Map" resultType="int">
		select/*vts-根据运单号查询应付单count*/ count(1) 
			from stl.t_stl_bill_payable w 
		where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
        and   w.active = #{active,jdbcType=VARCHAR}
        and   w.bill_type = #{billType,jdbcType=VARCHAR}
	</select>
	
	<!-- 更新代收货款应付单签收日期 -->
	<update id="updateApcPayable"  parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillSignResultEntity">
		update /*更新应付单签收日期*/ stl.t_stl_bill_payable w 
              set w.SIGN_DATE = #{signTime,jdbcType=TIMESTAMP},
                  w.modify_time = sysdate
             where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
             and   w.bill_type = 'APC'
        	 and   w.active = 'Y'
	</update>
	
	<!-- 更新装卸费应付单签收日期 -->
	<update id="updateSfPayable"  parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillSignResultEntity">
		update /*更新应付单签收日期*/ stl.t_stl_bill_payable w 
              set w.SIGN_DATE = #{signTime,jdbcType=TIMESTAMP},
                  w.modify_time = sysdate
             where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
             and   w.bill_type = 'SF'
        	 and   w.active = 'Y'
	</update>
	
	<!-- 根据运单号查询现金收款单count -->
	<select id="queryCashColl" parameterType="java.util.Map" resultType="int">
		select/*vts-根据运单号查询现金收款单count*/ count(1) 
			from stl.t_stl_bill_cash_collection w 
		where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
        and   w.active = #{active,jdbcType=VARCHAR}
	</select>
	
	<!-- 更新现金收款单确定收入日期-->
	<update id="updateCashColl"  parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillSignResultEntity">
		update /*更新现金收款单确定收入日期--签收日期*/ stl.t_stl_bill_cash_collection w 
              set w.CONREVEN_DATE = #{signTime,jdbcType=TIMESTAMP},
                  w.modify_time = sysdate
             where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
        	 and   w.active = 'Y'
	</update>
	
	<!-- 根据运单号查询应收单count -->
	<select id="queryCrDrOrReceivable" parameterType="java.util.Map" resultType="int">
		select/*vts-根据运单号查询应收单count*/ count(1) 
			from stl.t_stl_bill_receivable w 
		where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
        and   w.active = #{active,jdbcType=VARCHAR}
        and   w.bill_type = #{billType,jdbcType=VARCHAR}
	</select>
	
	<!-- 更新代收货款应收单签收日期 -->
	<update id="updateCrReceivable"  parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillSignResultEntity">
		update /*更新应收单签收日期*/ stl.t_stl_bill_receivable w 
              set w.CONREVEN_DATE = #{signTime,jdbcType=TIMESTAMP},
                  w.modify_time = sysdate
             where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
             and   w.bill_type = 'CR'
        	 and   w.active = 'Y'
	</update>
	
	<!-- 更新始发提成应收单签收日期 -->
	<update id="updateOrReceivable"  parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillSignResultEntity">
		update /*更新应收单签收日期*/ stl.t_stl_bill_receivable w 
              set w.CONREVEN_DATE = #{signTime,jdbcType=TIMESTAMP},
                  w.modify_time = sysdate
             where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
             and   w.bill_type = 'OR'
        	 and   w.active = 'Y'
	</update>
	
	<!-- 更新到达应收单签收日期 -->
	<update id="updateDrReceivable"  parameterType="com.deppon.foss.module.settlement.common.api.shared.domain.WaybillSignResultEntity">
		update /*更新应收单签收日期*/ stl.t_stl_bill_receivable w 
              set w.CONREVEN_DATE = #{signTime,jdbcType=TIMESTAMP},
                  w.modify_time = sysdate
             where w.waybill_no = #{waybillNo,jdbcType=VARCHAR}
             and   w.bill_type = 'DR'
        	 and   w.active = 'Y'
	</update>
	
</mapper>