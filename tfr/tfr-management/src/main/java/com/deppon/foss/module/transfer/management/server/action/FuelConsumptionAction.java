/**
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 *  initial comments.
 */
/*******************************************************************************
 * Copyright 2013 TFR TEAM
 *  
 *  Licensed under the DEPPON License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *  
 *     http://www.deppon.com/licenses/LICENSE-2.0
 *  
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *  Contributors:
 *  038300-foss-pengzhen - initial API and implementation
 * 
 *  PROJECT NAME  : tfr-management
 *  
 *  FILE PATH     : src/main/java/com/deppon/foss/module/transfer/management/server/action/FuelConsumptionAction.java
 *  
 *  FILE NAME          :FuelConsumptionAction.java
 * 
 *  AUTHOR  : FOSS中转系统开发组
 *  
 *  TIME              : 
 *  
 *  HOME PAGE    :  http://www.deppon.com
 * 
 *  COPYRIGHT    : Copyright (c) 2013  Deppon All Rights Reserved.
 ******************************************************************************/
package com.deppon.foss.module.transfer.management.server.action;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.io.UnsupportedEncodingException;
import java.math.BigDecimal;
import java.net.URLEncoder;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.apache.commons.lang.StringUtils;
import org.apache.log4j.LogManager;
import org.apache.log4j.Logger;
import org.apache.poi.hssf.usermodel.HSSFCell;
import org.apache.poi.hssf.usermodel.HSSFDateUtil;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.struts2.ServletActionContext;
import org.jfree.util.Log;

import com.deppon.foss.framework.exception.BusinessException;
import com.deppon.foss.framework.server.components.export.excel.ExportInfo;
import com.deppon.foss.framework.server.components.export.excel.ExportResource;
import com.deppon.foss.framework.server.components.export.excel.ExportSetting;
import com.deppon.foss.framework.server.components.export.excel.ExporterExecutor;
import com.deppon.foss.framework.server.components.export.excel.IExportListener;
import com.deppon.foss.framework.server.components.export.excel.IResourceListener;
import com.deppon.foss.framework.server.components.ftp.FTPClient;
import com.deppon.foss.framework.server.components.ftp.FTPConfig;
import com.deppon.foss.framework.server.web.action.AbstractAction;
import com.deppon.foss.framework.server.web.result.json.annotation.JSON;
import com.deppon.foss.module.base.baseinfo.api.server.service.IrecordImportExcelFileInfoService;
import com.deppon.foss.module.base.baseinfo.api.shared.domain.DownloadInfoEntity;
import com.deppon.foss.module.base.dict.api.server.service.IDataDictionaryService;
import com.deppon.foss.module.base.dict.api.shared.define.DictionaryConstants;
import com.deppon.foss.module.base.dict.api.shared.domain.DataDictionaryEntity;
import com.deppon.foss.module.base.dict.api.shared.domain.DataDictionaryValueEntity;
import com.deppon.foss.module.frameworkimpl.server.context.FossUserContext;
import com.deppon.foss.module.transfer.management.api.server.service.IFuelConsumptionService;
import com.deppon.foss.module.transfer.management.api.shared.define.FuelConsonptionConstants;
import com.deppon.foss.module.transfer.management.api.shared.domain.FuelDetailEntity;
import com.deppon.foss.module.transfer.management.api.shared.domain.FuelRoadTollEntity;
import com.deppon.foss.module.transfer.management.api.shared.domain.FuelVehicleEntity;
import com.deppon.foss.module.transfer.management.api.shared.dto.FuelConsonptionForExportDto;
import com.deppon.foss.module.transfer.management.api.shared.dto.FuelConsumptionDto;
import com.deppon.foss.module.transfer.management.api.shared.dto.FuelConsumptionTotalDto;
import com.deppon.foss.module.transfer.management.api.shared.dto.FuelStandardExcelDto;
import com.deppon.foss.module.transfer.management.api.shared.util.XlsImpUtil;
import com.deppon.foss.module.transfer.management.api.shared.vo.FuelConsumptionVo;
import com.deppon.foss.module.transfer.management.api.shared.vo.FuelStandardVo;
import com.deppon.foss.util.CollectionUtils;
import com.deppon.foss.util.DateUtils;

/**
 * 车辆油耗相关操作
 * @author foss-liuxue(for IBM)
 * @date 2012-12-20 下午3:01:09
 */
public class FuelConsumptionAction extends AbstractAction {

	/**
	 * 序列化
	 */
	private static final long serialVersionUID = -2404721953931056144L;

	/**
	 * 日志
	 */
	private static final Logger LOGGER = LogManager.getLogger(FuelConsumptionAction.class);

	/**
	 * 油耗信息Service
	 */
	private IFuelConsumptionService fuelConsumptionService;
	
	/**
	 * 查询油耗信息VO
	 */
	private FuelConsumptionVo fuelConsumptionVo;
	
	/**
	 * 油耗标准VO
	 */
	
	private FuelStandardVo fuelStandardVo = new FuelStandardVo();
	
	/**
	 * 导出输出流
	 */
	private InputStream inputStream;
	
	/**
	 * excel名称
	 */
	private String excelName;
	
	/**
	 * 导入文件
	 */
	private File uploadFile;

	/**
	 * 导出Excel 文件流
	 */
	//transient InputStream excelStream;
	/**
	 * 导出Excel 文件名
	 */
	//private String fileName;
	/**
	 * 导入文件名
	 */
	private String uploadFileFileName;
	
	/**
	 * 是否同步导出
	 */
	private boolean syncExport;

	/**
	 * FTP客户端
	 */
	private FTPClient ftpClient;
	
	/**
	 * 下载ftp配置
	 */
	private FTPConfig downloadFtpConfig;

	
	/**
	 * 文件下载服务
	 */
	private IrecordImportExcelFileInfoService recordImportExcelFileInfoService;

	/**
	 * 数据字典Service
	 */
	private IDataDictionaryService dataDictionaryService;
	
	
	/**
	 * @param dataDictionaryService the dataDictionaryService to set
	 */
	public void setDataDictionaryService(
			IDataDictionaryService dataDictionaryService) {
		this.dataDictionaryService = dataDictionaryService;
	}

	/**
	 * @param ftpClient the ftpClient to set
	 */
	public void setFtpClient(FTPClient ftpClient) {
		this.ftpClient = ftpClient;
	}

	/**
	 * @param recordImportExcelFileInfoService the recordImportExcelFileInfoService to set
	 */
	public void setRecordImportExcelFileInfoService(
			IrecordImportExcelFileInfoService recordImportExcelFileInfoService) {
		this.recordImportExcelFileInfoService = recordImportExcelFileInfoService;
	}

	/**
	 * @param downloadFtpConfig the downloadFtpConfig to set
	 */
	public void setDownloadFtpConfig(FTPConfig downloadFtpConfig) {
		this.downloadFtpConfig = downloadFtpConfig;
	}

	/**
	 * @return the syncExport
	 */
	public boolean isSyncExport() {
		return syncExport;
	}

	/**
	 * @param syncExport the syncExport to set
	 */
	public void setSyncExport(boolean syncExport) {
		this.syncExport = syncExport;
	}

	/**
	 * @return the uploadFile
	 */
	public File getUploadFile() {
		return uploadFile;
	}

	/**
	 * @param uploadFile the uploadFile to set
	 */
	public void setUploadFile(File uploadFile) {
		this.uploadFile = uploadFile;
	}

	/**
	 * @return the uploadFileFileName
	 */
	public String getUploadFileFileName() {
		return uploadFileFileName;
	}

	/**
	 * 获取 excel名称.
	 *
	 * @return the excel名称
	 */
	public String getExcelName() {
		return excelName;
	}

	/**
	 * 设置 excel名称.
	 *
	 * @param excelName the new excel名称
	 */
	public void setExcelName(String excelName) {
		this.excelName = excelName;
	}

	/**
	 * 设置 导出输出流.
	 *
	 * @param inputStream the new 导出输出流
	 */
	public void setInputStream(InputStream inputStream) {
		this.inputStream = inputStream;
	}

	/**
	 * 获取 导出输出流.
	 *
	 * @return the 导出输出流
	 */
	public InputStream getInputStream() {
		return inputStream;
	}
	/**
	 * @param uploadFileFileName the uploadFileFileName to set
	 */
	public void setUploadFileFileName(String uploadFileFileName) {
		this.uploadFileFileName = uploadFileFileName;
	}
	
	/**
	 * @return the fuelStandardVo
	 */
	public FuelStandardVo getFuelStandardVo() {
		return fuelStandardVo;
	}

	/**
	 * @param fuelStandardVo the fuelStandardVo to set
	 */
	public void setFuelStandardVo(FuelStandardVo fuelStandardVo) {
		this.fuelStandardVo = fuelStandardVo;
	}

	/**
	 * 获取 查询油耗信息VO.
	 *
	 * @return the 查询油耗信息VO
	 */
	public FuelConsumptionVo getFuelConsumptionVo() {
		return fuelConsumptionVo;
	}

	/**
	 * 设置 查询油耗信息VO.
	 *
	 * @param fuelConsumptionVo the new 查询油耗信息VO
	 */
	public void setFuelConsumptionVo(FuelConsumptionVo fuelConsumptionVo) {
		this.fuelConsumptionVo = fuelConsumptionVo;
	}

	/**
	 * 设置 油耗信息Service.
	 *
	 * @param fuelConsumptionService the new 油耗信息Service
	 */
	public void setFuelConsumptionService(
			IFuelConsumptionService fuelConsumptionService) {
		this.fuelConsumptionService = fuelConsumptionService;
	}
	/**
	 * 根据车牌号获取车辆信息
	 * @author foss-liuxue(for IBM)
	 * @date 2012-12-21 下午4:18:53
	 */
	@JSON
	public String queryVehicleInfo(){
		try{
			//根据车牌号获取车辆信息
			FuelVehicleEntity fuelVehicleEntity = fuelConsumptionService.queryVehicleInfo(fuelConsumptionVo.getFuelConsumptionDto());
			//存入vo
			fuelConsumptionVo.setFuelVehicleEntity(fuelVehicleEntity);
			return returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	/**
	 * 新增或修改油耗信息
	 * @author foss-liuxue(for IBM)
	 * @date 2012-12-24 下午9:09:14
	 */
	@JSON
	public String saveOrUpdateFuelConsumption(){
		try{
			//新增或修改油耗信息
			fuelConsumptionService.saveOrUpdateFuelConsumption(fuelConsumptionVo.getFuelVehicleEntity(),fuelConsumptionVo.getFuelDepartureList());
			return returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	/**
	 * @author niuly
	 * @date 2013-11-23上午11:24:09
	 * @function 更新信息
	 * @return
	 */
	@JSON
	public String updateFuelConsumption() {
		try{
			//新增或修改油耗信息
			fuelConsumptionService.updateFuelConsumption(fuelConsumptionVo.getFuelVehicleEntity(),fuelConsumptionVo.getFuelConsumptionDto(),fuelConsumptionVo.getFuelDetailList(),fuelConsumptionVo.getFuelRoadTollList());
			return returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	
	/**
	 * 根据查询条件查询发车信息
	 * @author foss-liuxue(for IBM)
	 * @date 2012-12-25 下午8:02:32
	 */
	@JSON
	public String queryFuelConsumption(){
		try{
			FuelConsumptionDto fuelConsumptionDto = fuelConsumptionVo.getFuelConsumptionDto();
			//FuelVehicleEntity vehicleEntity = fuelConsumptionVo.getFuelVehicleEntity();
			//查询油耗信息
			List<FuelConsumptionDto> fuelConsumptionDtoList = fuelConsumptionService.queryFuelConsumption(fuelConsumptionDto, start, limit);
			//获取总记录条数
			this.setTotalCount(fuelConsumptionService.getCount(fuelConsumptionDto));
			
			FuelConsumptionTotalDto totalDto = null;
			if(fuelConsumptionService.getCount(fuelConsumptionDto) > 0) {
				//查询总计数据
				totalDto = fuelConsumptionService.queryTotalInfo(fuelConsumptionDto);
			}
			//存入vo
			fuelConsumptionVo.setFuelConsumptionDtoList(fuelConsumptionDtoList);
			fuelConsumptionVo.setTotalDto(totalDto);
			
			return  returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	
	/**
	 * 删除油耗信息
	 * @author foss-liuxue(for IBM)
	 * @date 2012-12-25 下午8:19:59
	 */
	@JSON
	public String deleteFuelConsumption(){
		try{
			//删除油耗信息
			fuelConsumptionService.deleteFuelConsumption(fuelConsumptionVo.getFuelConsumptionDto());
			return  returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	
	/**
	 * 点击编辑/查看时load油耗信息
	 * @author foss-liuxue(for IBM)
	 * @date 2012-12-27 下午6:15:59
	 */
	@JSON
	public String loadFuelConsumption(){
		try{
			//load油耗信息
			//FuelConsumptionEntity fuelConsumptionEntity = fuelConsumptionService.loadFuelConsumption(fuelConsumptionVo.getFuelConsumptionDto());
			//查询加油信息
			List<FuelDetailEntity> fuelDetailList = new ArrayList<FuelDetailEntity>();
			fuelDetailList = fuelConsumptionService.queryFuelDetailById(fuelConsumptionVo.getFuelConsumptionDto().getId());
			//查询路桥信息
			List<FuelRoadTollEntity> fuelRoadTollList = new ArrayList<FuelRoadTollEntity>();
			fuelRoadTollList = fuelConsumptionService.queryFuelRoadTollById(fuelConsumptionVo.getFuelConsumptionDto().getId());
			//存入vo
			fuelConsumptionVo.setFuelDetailList(fuelDetailList);
			fuelConsumptionVo.setFuelRoadTollList(fuelRoadTollList);
			return  returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	
	/**
	 * @author niuly
	 * @date 2013-11-21下午1:48:07
	 * @function 根据发车记录ID查询对应的加油信息
	 * @return
	 */
	@JSON
	public String queryFuelDetailById() {
		try{
			List<FuelDetailEntity> fuelDetailList = fuelConsumptionService.queryFuelDetailById(fuelConsumptionVo.getFuelConsumptionDto().getId());
			fuelConsumptionVo.setFuelDetailList(fuelDetailList);
			return  returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	
	/**
	 * @author niuly
	 * @date 2013-11-21下午3:25:37
	 * @function 根据发车记录ID查询对应的路桥费信息
	 * @return
	 */
	@JSON
	public String queryFuelRoadTollById() {
		try{
			List<FuelRoadTollEntity> fuelRoadTollList = fuelConsumptionService.queryFuelRoadTollById(fuelConsumptionVo.getFuelConsumptionDto().getId());
			fuelConsumptionVo.setFuelRoadTollList(fuelRoadTollList);
			return  returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	
	/**
	 * @author niuly
	 * @date 2013-11-27上午9:20:54
	 * @function 根据配载车次号查询配载信息
	 * @return
	 */
	@JSON
	public String queryAssembleInfo() {
		try {
			FuelConsumptionDto fuelConsumptionDto = fuelConsumptionService.queryAssemblyList(fuelConsumptionVo.getFuelConsumptionDto().getAssemblyNo());
			fuelConsumptionVo.setFuelConsumptionDto(fuelConsumptionDto);
			return returnSuccess();
		} catch(BusinessException e) {
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	
	/**
	 * 导出车辆油耗信息
	 * 
	 * @author 099995-foss-wujiangtao
	 * @date 2012-12-27 下午3:42:15
	 * @return
	 */
	/*public String queryFuelConsumptionToExport(){
		try{
			FuelConsumptionDto dto = fuelConsumptionVo.getFuelConsumptionDto();
			//长途油耗
			if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_LONG_DISTANCE.equals(dto.getDepartureTypeCode()
					)){
				//如果为长途油耗，则名字为长途油耗
				excelName = URLEncoder.encode(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_LONG, "UTF-8");
			}else{
				//如果为短途油耗，则名字为短途油耗
				excelName = URLEncoder.encode(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_SHORT, "UTF-8");
			}
			//导出excel
			inputStream = fuelConsumptionService.exportExcel(dto);
			return  returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e.getMessage(),e);
			return returnError(e);
		}catch(UnsupportedEncodingException  e1){
			//打印异常日志
			LOGGER.error(e1.getMessage(),e1);
			return returnError(e1.getMessage());
		}
	}*/
	/**
	 * @author niuly
	 * @date 2013-11-15下午7:45:21
	 * @function 导入油耗标准信息
	 * @return
	 */
	public String importFuelStandardInfo(){

		// 文件
		Workbook book = null;
		// 输入流
		FileInputStream inputStream = null;
		// 抓取文件类型
		try {
			// 文件名不为空
			// 判空
			if (StringUtils.isNotBlank(uploadFileFileName)) {
				// 判空
				if (uploadFileFileName.endsWith(FuelConsonptionConstants.EXCEL_FILE_TAIL_XLS_DOWN)
						|| uploadFileFileName.endsWith(FuelConsonptionConstants.EXCEL_FILE_TAIL_XLS_UP)
						|| uploadFileFileName.endsWith(FuelConsonptionConstants.EXCEL_FILE_TAIL_XLSX_DOWN)
						|| uploadFileFileName.endsWith(FuelConsonptionConstants.EXCEL_FILE_TAIL_XLSX_UP)) {
					// 验证通过
				} else {
					throw new BusinessException("只支持.xls或.xlsx格式的文件,请选择正确的文件导入", "只支持.xls或.xlsx格式的文件,请选择正确的文件导入");
				}
			}
			// 判空
			if (uploadFile != null) {
				inputStream = new FileInputStream(uploadFile);
				try {
					book = XlsImpUtil.create(inputStream);
				} catch (Exception ex) {
					LOGGER.error("非2003格式文件，转2007格式");
					throw new BusinessException("非2003格式文件，转2007格式，或文件加密", "非2003格式文件，转2007格式，或文件加密");
				}
			} else {
				throw new BusinessException("请选择导入文件", "请选择导入文件");
			}
			// 解析导入的数据文件
			// 判空
			if (book != null) {
				// 默认获取获取工作表1
				Sheet sheet = book.getSheetAt(FuelConsonptionConstants.EXCEL_DEFAULT_SHEET_ONE);

				// 读取Excel的所用数据,考虑到数据量不大，暂时不适用集中缓存
				List<FuelStandardExcelDto> excelDtos = new ArrayList<FuelStandardExcelDto>();
				
				// 将Excel表格每行数据读入列表
				makeExcelDtos(excelDtos, sheet);
				// 判空
				if (CollectionUtils.isNotEmpty(excelDtos)) {
					// 执行批量插入
					int totalCount = fuelConsumptionService.batchImportFuleList(excelDtos);
					// 传回成功导入条数
					fuelStandardVo.setImportTotalCount(totalCount);
				} else {
					throw new BusinessException("导入数据为空", "导入数据为空");
				}	
			}

			// 成功
			return super.returnSuccess();
			// 异常
		} catch (BusinessException e) {
			// 日志
			LOGGER.error(e);
			// 异常信息
			return super.returnError(e);
			// 异常
		} catch (FileNotFoundException e) {
			// 日志
			LOGGER.error("数据文件不存在", e);
			// 异常信息
			return returnError("数据文件不存在");
			// 异常信息
		} catch (Exception e) {
			// 日志
			LOGGER.error("数据异常", e);
			// 异常信息
			return returnError("数据异常:请确认导入数据格式是否正确！", e);

		} finally {
			// 回收文件数据
			// 判空
			if (book != null) {
				book = null;
			}
			// 关闭流文件
			// 判空
			if (inputStream != null) {
				try {
					inputStream.close();
				} catch (IOException e) {
					LOGGER.error(e);
					return returnError("文件关闭失败");
				}
			}
		}
	
	}
	
	/**
	 * @author niuly
	 * @date 2013-11-15下午6:21:24
	 * @function 读取excel内容至列表
	 * @param excelDtos
	 * @param sheet
	 */
	private void makeExcelDtos(List<FuelStandardExcelDto> excelDtos, Sheet sheet) {
		// 判空
		if (sheet != null && excelDtos != null) {
			// 获取物理行数
			int rowCount = sheet.getPhysicalNumberOfRows();
			// 根据行数循环
			Row row = null;
			// 最大列数
			int colCnt = FuelConsonptionConstants.EXCEL_COLUMN_MAX_SIZE;
			
			// EXCEL行记录
			FuelStandardExcelDto excelDto = null;
			
			//用户信息
			String userCode = "";
			String userName = "";
			if(FossUserContext.getCurrentInfo() != null) {
				userCode = FossUserContext.getCurrentInfo().getEmpCode();
				userName = FossUserContext.getCurrentInfo().getEmpName();
			}
			String user = new StringBuffer(userCode).append(",").append(new StringBuffer(userName)).toString();
			
			// 根据行数循环
			for (int rowNum = 1; rowNum < rowCount; rowNum++) {
				// 获取每行数据
				excelDto = new FuelStandardExcelDto();
				// 设置行号
				excelDto.setRowNum(rowNum);
				// 取得一行的数据
				row = sheet.getRow(rowNum);
				
				//判断单元格值是否满足要求
				//TO-DO
				
				// 如果本行第一列或第二列或第三列有任意一列值为空，则不取本行的数据，继续往下取值
				// 判空
				if (row == null 
						|| (row.getCell(FuelConsonptionConstants.EXCEL_COLUMN_FIRST) == null
								|| StringUtils.isBlank(obtainStringVal(row.getCell(FuelConsonptionConstants.EXCEL_COLUMN_FIRST))))
						|| (row.getCell(FuelConsonptionConstants.EXCEL_COLUMN_SECOND) == null
								|| StringUtils.isBlank(obtainStringVal(row.getCell(FuelConsonptionConstants.EXCEL_COLUMN_SECOND))))
						|| ((row.getCell(FuelConsonptionConstants.EXCEL_COLUMN_THREE) == null
								|| StringUtils.isBlank(obtainStringVal(row.getCell(FuelConsonptionConstants.EXCEL_COLUMN_THREE)))))) {
					continue;
				} else {
					
					// 循环取列值
					for (int colNum = 0; colNum < colCnt; colNum++) {
						// 由于读取EXCEL效率低下，故先取所有的值，再到内存中校验，提升性能（前提是数据量不大）
						try {
							obtainCellValue(row, colNum, excelDto,user);
						} catch (ParseException e) {
							Log.error("获取单元格数据失败");
							e.printStackTrace();
						}
					}
				}
				excelDtos.add(excelDto);
			}
		}
	}
	
	/**
	 * 
	 * 单元格取值
	 * 
	 * @author 096598-foss-zhongyubing
	 * 
	 * @date 2012-11-5 上午9:22:47
	 * 
	 */
	private String obtainStringVal(Cell cell) {
		// 列值
		String cellVal = "";
		// 单元格类型
		switch (cell.getCellType()) {
		case HSSFCell.CELL_TYPE_NUMERIC: // 数值型
			// 判空
			if (HSSFDateUtil.isCellDateFormatted(cell)) {
				// 如果是date类型则 ，获取该cell的date值
				cellVal = com.deppon.foss.util.DateUtils.convert(HSSFDateUtil.getJavaDate(cell.getNumericCellValue()),
						com.deppon.foss.util.DateUtils.DATE_FORMAT);
			} else {// 纯数字
				cellVal = String.valueOf(cell.getNumericCellValue());
			}
			break;
		// 此行表示单元格的内容为string类型
		case HSSFCell.CELL_TYPE_STRING: // 字符串型
			cellVal = cell.getRichStringCellValue().toString();
			break;
		case HSSFCell.CELL_TYPE_FORMULA:// 公式型
			try {
				// 读公式计算值
				cellVal = String.valueOf(cell.getNumericCellValue());
			} catch (Exception e) {
				cellVal = String.valueOf(cell.getStringCellValue());
			}
			// 判空
			if (FuelConsonptionConstants.NAN.equals(cellVal)) {// 如果获取的数据值为非法值,则转换为获取字符串
				cellVal = cell.getRichStringCellValue().toString();
			}
			break;
		case HSSFCell.CELL_TYPE_BOOLEAN:// 布尔
			cellVal = " " + cell.getBooleanCellValue();
			break;
		// 此行表示该单元格值为空
		case HSSFCell.CELL_TYPE_BLANK: // 空值
		case HSSFCell.CELL_TYPE_ERROR: // 故障
			cellVal = "";
			break;
		default:
			cellVal = cell.getRichStringCellValue().toString();
		}
		return cellVal.trim();
	}
	
	/**
	 * @author niuly
	 * @date 2013-11-28下午2:59:08
	 * @function  获取单元格的值
	 * @param row
	 * @param colNum
	 * @param excelDto
	 * @param createUser
	 * @throws ParseException
	 */
	private void obtainCellValue(Row row, int colNum, FuelStandardExcelDto excelDto,String createUser) throws ParseException {
		// 判空
		if (row != null) {
			Cell cell = row.getCell(colNum);
			// 判空
			if (cell != null) {
				// 取单元格值
				String cellVal = obtainStringVal(cell);
				// 值不为空，则辨别字段值类型
				// 判空
				if (StringUtils.isNotBlank(cellVal)) {
					//设置创建人
					excelDto.setCreateUser(createUser);
					// 根据列号设置列值
					switch (colNum) {
					case 0:// 导入时间
						SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM");
						Date date = sdf.parse(cellVal);
						excelDto.setFuelTime(date);
						return;
					case 1:// 车牌号
						excelDto.setVehicleNo(cellVal);
						return;
					case 2:// 油耗标准
						BigDecimal fuelStandard=new BigDecimal(cellVal); 
						//设置小数位数，第一个变量是小数位数，第二个变量是取舍方法(四舍五入) 
						fuelStandard = fuelStandard.setScale(2, BigDecimal.ROUND_HALF_UP);
						excelDto.setFuelStandard(fuelStandard);
						return;
					default:
						return;
					}
				}

			}
		}
	}
	
	/**
	 * @author niuly
	 * @date 2013-11-28下午3:05:32
	 * @function 查询油耗标准List
	 * @return String
	 */
	@JSON
	public String queryFuelStandard() {
		try{
			FuelStandardExcelDto fuelStandardExcelDto = fuelStandardVo.getFuelStandardExcelDto();
			//查询油耗信息
			List<FuelStandardExcelDto> fuelStandardExcelDtoList = fuelConsumptionService.queryFuelStandard(fuelStandardExcelDto, start, limit);
			//获取总记录条数
			this.setTotalCount(fuelConsumptionService.getFuelStandardCount(fuelStandardExcelDto));
			
			//存入vo
			fuelStandardVo.setFuelStandardDtoList(fuelStandardExcelDtoList);
			
			return  returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	
	/**
	 * @author niuly
	 * @date 2013-11-28下午5:29:20
	 * @function 删除油耗标准
	 * @return
	 */
	@JSON
	public String deleteFuelStandard() {
		try{
			//删除油耗标准
			fuelConsumptionService.deleteFuelStandard(fuelStandardVo.getFuelStandardExcelDto().getId());
			return  returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e);
			return returnError(e);
		}
	}
	/**
	 * @author niuly
	 * @date 2013-11-28下午5:39:38
	 * @function 新增或更新油耗信息
	 * @return
	 */
	@JSON
	public String saveOrUpdateFuelStandard() {
		FuelStandardExcelDto dto = fuelStandardVo.getFuelStandardExcelDto();
		String userCode = "";
		String userName = "";
		if(FossUserContext.getCurrentInfo() != null) {
			userCode = FossUserContext.getCurrentInfo().getEmpCode();
			userName = FossUserContext.getCurrentInfo().getEmpName();
		}
		String user = new StringBuffer(userCode).append(",").append(new StringBuffer(userName)).toString();
		dto.setCreateUser(user);
		String id = dto.getId();
		try {
			//新增
			if(StringUtils.isEmpty(id)) {
				//判断是否已经存在
				long count = fuelConsumptionService.queryFuelStandardCount(fuelStandardVo.getFuelStandardExcelDto());
				if(count > 0) {
					throw new BusinessException("已存在该车的油耗标准，不允许重复添加！","");
				}
				List<FuelStandardExcelDto> dtoList = new ArrayList<FuelStandardExcelDto>();
				
				dtoList.add(dto);
				//删除油耗标准
				fuelConsumptionService.batchImportFuleList(dtoList);
				return  returnSuccess();
			} else {//更新
				//更新油耗标准
				fuelConsumptionService.updateFuelStandard(fuelStandardVo.getFuelStandardExcelDto());
				return  returnSuccess();
			}
		}catch(BusinessException e) {
			//打印异常日志
			LOGGER.error(e);
			System.out.println("errro==" + returnError(e));
			return returnError(e);
		}
	}
	/**
	 * @author niuly
	 * @date 2013-12-5下午2:17:34
	 * @function 所在部门是否为车队
	 * @return
	 */
	@JSON
	public String hasTransDepartment() {
		try {
			//获取总记录条数
			String hasTransDepartment = fuelConsumptionService.isTransDepartment();
			fuelConsumptionVo.setTransDepartment(hasTransDepartment);
			return returnSuccess();
		} catch (BusinessException e) {
			// 记录错误
			LOGGER.error(e.getMessage(), e);
			return returnError(e);
		}
	}
	/**
	 * @author niuly
	 * @date 2013-12-5下午2:17:01
	 * @function 查询油耗标准值
	 * @return
	 */
	@JSON
	public String queryFuelStandardValue() {
		try {
			FuelConsumptionDto fuelConsumptionDto = fuelConsumptionVo.getFuelConsumptionDto();
			//获取总记录条数
			BigDecimal standard = fuelConsumptionService.queryFuelStandardValue(fuelConsumptionDto);
			fuelConsumptionVo.setFuelStandardValue(standard);
			return returnSuccess();
		} catch (BusinessException e) {
			// 记录错误
			LOGGER.error(e.getMessage(), e);
			return returnError(e);
		}
	}
	
	/**
	 * @author niuly
	 * @date 2013-11-29上午10:31:18
	 * @function 查询导出数据的总条数，区分同步或异步导出
	 * @return
	 */
	@JSON
	public String exportSynchronized() {
		try {
			FuelConsumptionDto fuelConsumptionDto = fuelConsumptionVo.getFuelConsumptionDto();
			//获取总记录条数
			long count = fuelConsumptionService.getCount(fuelConsumptionDto);
			//数据小于最大条数时，设置为同步导出
			this.syncExport = (count < FuelConsonptionConstants.EXPORT_EXCEL_MAX_COUNTS);
			
			return returnSuccess();
		} catch (BusinessException e) {
			// 记录错误
			LOGGER.error(e.getMessage(), e);
			return returnError(e);
		}
	}
	
	/**
	 * @author niuly
	 * @date 2013-11-29下午2:51:41
	 * @function 同步导出数据
	 * @return
	 */
	public String exportExcelSync() {
		try{
			FuelConsumptionDto dto = fuelConsumptionVo.getFuelConsumptionDto();
			//是否为车队
		    String transDepartment = fuelConsumptionService.isTransDepartment();
		    dto.setTransDepartment(transDepartment);
			excelName = this.getExportExcelName(dto);
			//导出excel
			List<FuelConsonptionForExportDto> exportList = fuelConsumptionService.queryFuelConsumptionForExport(dto,0,FuelConsonptionConstants.EXPORT_EXCEL_MAX_COUNTS);
			ExportResource resource = new ExportResource();
			resource.setHeads(this.getExcelHeader());
			resource.setRowList(this.getExportDataList(exportList));

			ExportSetting settings = new ExportSetting();
			settings.setSheetName(getSheetName(dto));
			//settings.setDataType(this.getDataType());

			// 创建导出工具类
			ExporterExecutor objExporterExecutor = new ExporterExecutor();
			// 导出成文件
			inputStream = objExporterExecutor.exportSync(resource, settings);
			return  returnSuccess();
		}catch(BusinessException e){
			//打印异常日志
			LOGGER.error(e.getMessage(),e);
			return returnError(e);
		}
	}

	/**
	 * @author niuly
	 * @date 2013-11-29下午3:04:36
	 * @function 异步导出
	 * @return
	 */
	public String exportExcelAsyn() {

		try {
			// 校验数据
			final FuelConsumptionDto dto = fuelConsumptionVo.getFuelConsumptionDto();
			//是否为车队
		    String transDepartment = fuelConsumptionService.isTransDepartment();
		    dto.setTransDepartment(transDepartment);
		    
			// 创建导出类
			ExportResource resource = new ExportResource();
			ExporterExecutor executor = new ExporterExecutor();
			final ExportSetting settings = new ExportSetting();

			// 设置表头
			resource.setHeads(this.getExcelHeader());

			// 导出设置
			//长途油耗
			if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_LONG_DISTANCE.equals(dto.getDepartureTypeCode())){
				//如果为长途油耗，则名字为长途油耗
				this.excelName =this.encodeFileName("长途油耗");
			}else if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_LOGISTICS_VEHICLE.equals(dto.getDepartureTypeCode())){
				//后勤车油耗
				this.excelName = this.encodeFileName("后勤车油耗");
			}else if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_EXPRESS.equals(dto.getDepartureTypeCode())){
				//快递车油耗
				this.excelName = this.encodeFileName("快递车油耗");
			}else {
				//如果为短途油耗，则名字为短途油耗
				this.excelName = this.encodeFileName("短途油耗");
			}
			excelName = this.getExportExcelName(dto);
			settings.setFileName(excelName);
			settings.setSize(FuelConsonptionConstants.EXPORT_EXCEL_MAX_COUNTS);
			settings.setFileDesc(String.format("%s导出", settings.getFileName()));

			String userTempCode = "";
			String deptTempCode = "";
			if(FossUserContext.getCurrentInfo() != null) {
				userTempCode = FossUserContext.getCurrentInfo().getEmpCode();
				deptTempCode = FossUserContext.getCurrentInfo().getCurrentDeptCode();
			}
			final String userCode = userTempCode;
			final String deptCode = deptTempCode;
			
			// 导出后结果处理
			IExportListener exportListener = new IExportListener() {
				@Override
				public void doExported(ExportInfo info) {
					DownloadInfoEntity entity = new DownloadInfoEntity();

					String encodedUsername = downloadFtpConfig.getUserName();
					String encodedPassword = downloadFtpConfig.getPassword();

					//对用户名密码加密
					try {
						encodedUsername = URLEncoder.encode(encodedUsername,"UTF-8");
						encodedPassword = URLEncoder.encode(encodedPassword,"UTF-8");
					} catch (UnsupportedEncodingException e) {
						e.printStackTrace();
						LOG.error(e.getMessage(), e);
					}
					
					entity.setEmpCode(userCode);
					entity.setOrgCode(deptCode);
					entity.setFileName(settings.getFileDesc());
					entity.setFileLoadPath(String.format(
							"ftp://%s:%s@%s/%s/%s", encodedUsername,
							encodedPassword, downloadFtpConfig.getHost(),
							downloadFtpConfig.getPath(),
							info.getRemoteFileName()));
					//保存
					recordImportExcelFileInfoService.saveImportExcelFileInfo(entity);
				}
			};

			// 导出数据来源：包括总分页数和每页数据
			IResourceListener resourceListener = new IResourceListener() {

				@Override
				public int getDataPage() {

					// 查询总条数
					long  count = fuelConsumptionService.getCount(dto);
					int size = Long.valueOf(count).intValue();

					// 返回总导出页数
					return (size + FuelConsonptionConstants.EXPORT_EXCEL_MAX_COUNTS - 1)
							/ FuelConsonptionConstants.EXPORT_EXCEL_MAX_COUNTS;
				}

				@Override
				public List<List<String>> getDataList(int page) {

					// 查询当前页数据
					List<FuelConsonptionForExportDto> exportList = fuelConsumptionService.queryFuelConsumptionForExport(
									dto,
									page * FuelConsonptionConstants.EXPORT_EXCEL_MAX_COUNTS,
									FuelConsonptionConstants.EXPORT_EXCEL_MAX_COUNTS);

					// 数据转换成导出格式的数据
					List<List<String>> dataList = getExportDataList(exportList);

					return dataList;
				}

			};

			// 异步导出
			executor.exportAsync(resource, settings, ftpClient, exportListener,
					resourceListener);

			// 正常返回
			return returnSuccess();

		} catch (BusinessException e) {
			// 记录错误
			LOGGER.error(e.getMessage(), e);
			return returnError(e);
		}catch (UnsupportedEncodingException e) {
			return returnError(new BusinessException("转换字符串编码时出错!"));
		}
	}
	
	/**
	 * 
	 * @author niuly
	 * @date 2013-11-30上午9:41:49
	 * @function 获取导出excel表头
	 * @return
	 */
	private String[] getExcelHeader() {
		return new String[] { 
					"事业部", "所属大区", "车队","小组", "车牌号", "车辆品牌","出车性质","车型",
					"配载车次号", "发车日期", "出发站", "目的站", "线路", "发车模式", "载重","体积",
					  "出发公里数", "到达公里数","行驶公里数", "司机1", "司机2","油耗标准","百公里油耗",
					"加油升数", "平均加油单价","燃油费总计","路桥费总计","备注"
				};
	}
	
	private String getSheetName(FuelConsumptionDto dto) {
		String name = "油耗";
		//长途油耗
		if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_LONG_DISTANCE.equals(dto.getDepartureTypeCode())){
			//如果为长途油耗，则名字为长途油耗
			name = "长途油耗";
		}else if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_LOGISTICS_VEHICLE.equals(dto.getDepartureTypeCode())){
			//后勤车油耗
			name = "后勤车油耗";
		}else if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_EXPRESS.equals(dto.getDepartureTypeCode())){
			//快递车油耗
			name = "快递车油耗";
		}else {
			//如果为短途油耗，则名字为短途油耗
			name = "短途油耗";
		}
		
		return name;	
	}
	
	private String getExportExcelName(FuelConsumptionDto dto) {
		String name = "油耗";
		try{
			//长途油耗
			if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_LONG_DISTANCE.equals(dto.getDepartureTypeCode())){
				//如果为长途油耗，则名字为长途油耗
				//name = URLEncoder.encode(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_LONG, "UTF-8");
				name = encodeFileName(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_LONG);
			}else if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_LOGISTICS_VEHICLE.equals(dto.getDepartureTypeCode())){
				//后勤车油耗
//				name = URLEncoder.encode(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_LOGISTICS, "UTF-8");
				name = encodeFileName(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_LOGISTICS);
			}else if(FuelConsonptionConstants.DEPARTURE_TYPE_FOR_EXPRESS.equals(dto.getDepartureTypeCode())){
				//快递车油耗
				//name = URLEncoder.encode(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_EXPRESS, "UTF-8");
				name = encodeFileName(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_EXPRESS);
			}else {
				//如果为短途油耗，则名字为短途油耗
				//name = URLEncoder.encode(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_SHORT, "UTF-8");
				name = encodeFileName(FuelConsonptionConstants.FUEL_CONSUMPTION_EXCEL_NAME_FOR_SHORT);
			}
		}catch(UnsupportedEncodingException e) {
			Log.info(e.getMessage());
			e.printStackTrace();
			return returnError(new BusinessException("转换字符串编码时出错!"));
		}
		return name;
	}
	/**
	 * @author niuly
	 * @date 2013-9-24下午1:44:25
	 * @function 编码转换
	 * @param fileName
	 * @return String
	 * @throws UnsupportedEncodingException
	 */
	public String encodeFileName(String fileName)
			throws UnsupportedEncodingException {
		String returnStr;
		String agent = (String) ServletActionContext.getRequest().getHeader("USER-AGENT");
		if (agent != null && agent.indexOf("MSIE") == -1) {
			returnStr = new String(fileName.getBytes("UTF-8"), "iso-8859-1");
		} else {
			returnStr = URLEncoder.encode(fileName, "UTF-8");
		}
		return returnStr;
	}
	/**
	 * 获取导出数据
	 * 
	 * @param exportList
	 * @return
	 */
	private List<List<String>> getExportDataList(
			List<FuelConsonptionForExportDto> exportList) {

		List<List<String>> dataList = new ArrayList<List<String>>();
		List<String> data = null;

		for (FuelConsonptionForExportDto dto : exportList) {
			data = new ArrayList<String>();

			data.add(dto.getDivisionOrgName());
			data.add(dto.getRegionOrgName());
			data.add(dto.getTransDepartmentName());
			data.add(dto.getGroupOrgName());
			data.add(dto.getVehicleNo());
			data.add(dto.getVehicleBrand());
			//data.add(dto.getDepartureTypeCode());
			data.add(termsName(DictionaryConstants.ARRIVE_TYPE,dto.getDepartureTypeCode()));
			data.add(dto.getVehicleType());

			data.add(dto.getAssemblyNo());
			data.add(dto.getDepartureDate() == null ? "" : DateUtils.convert(
					dto.getDepartureDate(), DateUtils.DATE_FORMAT));
			data.add(dto.getDeptRegionName());
			data.add(dto.getArrvRegionName());
			data.add(dto.getLineName());
			//data.add(dto.getDepartureMode());
			data.add(termsName(DictionaryConstants.DEPARTURE_MODEL,dto.getDepartureMode()));
			data.add(dto.getActualLoad() == null ? "0" : dto.getActualLoad().toString());
			data.add(dto.getVolume() == null ? "0" : dto.getVolume().toString());
			data.add(dto.getStartKm() == null ? "0" : dto.getStartKm().toString());
			data.add(dto.getArriveKm() == null ? "0" : dto.getArriveKm().toString());
			data.add(dto.getRunKm() == null ? "0" : dto.getRunKm().toString());
			data.add(dto.getDriver1Name());
			data.add(dto.getDriver2Name());
			data.add(dto.getFuelStandard() == null ? "0" : dto.getFuelStandard().toString());
			data.add(dto.getHdKmFuel() == null ? "0" : dto.getHdKmFuel().toString());
			data.add(dto.getFuelQtyTotal() == null ? "0" : dto.getFuelQtyTotal().toString());
			data.add(dto.getAveragePrice() == null ? "0" : dto.getAveragePrice().toString());
			data.add(dto.getFuelFeeTotal() == null ? "0" : dto.getFuelFeeTotal().toString());
			data.add(dto.getRoadTollTotal() == null ? "0" : dto.getRoadTollTotal().toString());
			data.add(dto.getRemark());
			
			dataList.add(data);
		}

		return dataList;
	}
	
	/**
	 * 数据字典中根据code查询name
	 * @author foss-liuxue(for IBM)
	 * @date 2013-3-28 上午10:25:47
	 */
	private String termsName(String termsCode, String valueCode){
		//用于返回的值
		String valueName = "";
		//如果termsCode不为空
		if(StringUtils.isNotBlank(termsCode)){
			//根据termsCode查询数据字典表
			DataDictionaryEntity dataDictionaryEntity = dataDictionaryService.queryDataDictionaryByTermsCode(termsCode);
			//如果查询到了
			if(dataDictionaryEntity != null){
				//获取当前数据字典所有的子集
				List<DataDictionaryValueEntity> dataDictionaryValueEntities = dataDictionaryEntity.getDataDictionaryValueEntityList();
				//遍历集合，根据valueCode找到valueName
				for(DataDictionaryValueEntity dataDictionaryValueEntity : dataDictionaryValueEntities){
					if(StringUtils.equals(valueCode, dataDictionaryValueEntity.getValueCode())){
						//给valueName赋值
						valueName = dataDictionaryValueEntity.getValueName();
					}
				}
			}else{
				//如果entity为null,则valueName=valueCode
				valueName = valueCode;
			}
		}
		return valueName;
	}
	
}