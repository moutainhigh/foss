<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
	"-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="foss.scheduling.InviteVehicle" >
	<resultMap type="com.deppon.foss.module.transfer.scheduling.api.shared.dto.InviteVehicleDto" id="InviteVehicleResultMap">
    	<id  property="id" column="INVITE_VEHICLE_ID"/>
		<result property="status" column="STATUS"/>
		<result property="inviteNo" column="INVITE_NO"/>
		<result property="applyTime" column="APPLY_TIME"/>
		<result property="usePurpose" column="USE_PURPOSE"/>
		<result property="useType" column="USE_TYPE"/>
		<result property="orderVehicleModel" column="ORDER_VEHICLE_MODEL"/>
		<result property="predictUseTime" column="PREDICT_USE_TIME"/>
		<result property="useAddress" column="USE_ADDRESS"/>
		<result property="clientName" column="CLIENT_NAME"/>
		<result property="clientContactPhone" column="CLIENT_CONTACT_PHONE"/>
		<result property="goodsPackege" column="GOODS_PACKEGE"/>
		<result property="goodsQty" column="GOODS_QTY"/>
		<result property="weight" column="WEIGHT"/>
		<result property="volume" column="VOLUME"/>
		<result property="requirment" column="REQUIRMENT"/>
		<result property="dispatchTransDept" column="DISPATCH_TRANS_DEPT"/>
		<result property="applyOrgName" column="APPLY_ORG_NAME"/>
		<result property="applyOrgCode" column="APPLY_ORG_CODE"/>
		<result property="applyEmpName" column="APPLY_EMP_NAME"/>
		<result property="applyEmpCode" column="APPLY_EMP_CODE"/>
		<result property="telephoneNo" column="TELEPHONE_NO"/>
		<result property="mobilephoneNo" column="MOBILEPHONE_NO"/>
		<result property="vehicleNo" column="VEHICLENO"/>
		<result property="inviteCost" column="INVITECOST"/>
		<result property="auditTime" column="AUDITTIME"/>
		<result property="vehicleLengthName" column="VEHICLELENGTHNAME"/>
		<result property="isFinishBill" column="IS_FINISH_BILL"/>
		<result property="isPassByArrivedDept" column="IS_PASSBY_ARRIVED_DEPT"/>
		<result property="arrivedDeptCode" column="ARRIVED_DEPT_CODE"/>
		<result property="isReturn" column="IS_RETURN"/>
		<result property="arrivalTime" column="ARRIVAL_TIME"/>
		<result property="returnCost" column="RETURN_COST"/>
		<result property="isContractVehicle" column="IS_CONTRACT_VEHICLE"/>
		<result property="contractLineCode" column="CONTRACT_LINE_CODE"/>
		<result property="dispatchTransDeptName" column="DISPATCHTRANSDEPTNAME"/>
		<result property="arrivedDeptName" column="ARRIVEDDEPTNAME"/>
		<result property="useStatus" column="USE_STATUS"/>
		<result property="goodsName" column="GOODS_NAME"/>
		<result property="loadGoodsTime" column="LOAD_GOODS_TIME"/>
		<result property="contractLine" column="CONTRACTLINE"/>
		<result property="acceptEmpName" column="ACCEPT_EMP_NAME"/>
		<result property="topFleetCode" column="TOP_FLEET_CODE"/>
		<result property="predictArriveTime" column="PERDICT_ARRIVE_TIME"/>
		<result property="arrivedAddress" column="ARRIVED_ADDRESS"/>
		<result property="isScaneSeeGoods" column="IS_SCANE_SEE_GOODS"/>
		<result property="isGoodsOver" column="IS_GOODS_OVER"/>
		<result property="provinceCode" column="PROVINCE_CODE"/>
		<result property="cityCode" column="CITY_CODE"/>
		<result property="areaCode" column="AREA_CODE"/>
		<result property="inquiryNo" column="INQUIRY_NO"/>
        <result property="applyFees" column="APPLY_FEES"/>
	    <result property="bearFeesDeptName" column="BEAR_FEES_DEPT_NAME"/>
	    <result property="businessType" column="BUSINESS_TYPE"/>
	</resultMap>

	<sql id="InviteVehicleall_column">
        INVITEVEHICLE.INVITE_VEHICLE_ID,
		INVITEVEHICLE.STATUS,
		INVITEVEHICLE.INVITE_NO,
		INVITEVEHICLE.APPLY_TIME,
		INVITEVEHICLE.USE_PURPOSE,
		INVITEVEHICLE.USE_TYPE,
		INVITEVEHICLE.ORDER_VEHICLE_MODEL,
		INVITEVEHICLE.PREDICT_USE_TIME,
		INVITEVEHICLE.USE_ADDRESS,
		INVITEVEHICLE.CLIENT_NAME,
		INVITEVEHICLE.CLIENT_CONTACT_PHONE,
		INVITEVEHICLE.GOODS_PACKEGE,
		INVITEVEHICLE.GOODS_QTY,
		INVITEVEHICLE.WEIGHT,
		INVITEVEHICLE.VOLUME,
		INVITEVEHICLE.REQUIRMENT,
		INVITEVEHICLE.DISPATCH_TRANS_DEPT,
		INVITEVEHICLE.APPLY_ORG_NAME,
		INVITEVEHICLE.APPLY_ORG_CODE,
		INVITEVEHICLE.APPLY_EMP_NAME,
		INVITEVEHICLE.APPLY_EMP_CODE,
		INVITEVEHICLE.TELEPHONE_NO,
		INVITEVEHICLE.MOBILEPHONE_NO,
		INVITEVEHICLE.IS_FINISH_BILL,
		INVITEVEHICLE.IS_PASSBY_ARRIVED_DEPT,
		INVITEVEHICLE.ARRIVED_DEPT_CODE,
		INVITEVEHICLE.IS_RETURN,
		INVITEVEHICLE.RETURN_COST / 100 AS RETURN_COST,
		INVITEVEHICLE.IS_CONTRACT_VEHICLE,
		INVITEVEHICLE.CONTRACT_LINE_CODE,
		INVITEVEHICLE.USE_STATUS,
		INVITEVEHICLE.GOODS_NAME,
		INVITEVEHICLE.LOAD_GOODS_TIME,
		INVITEVEHICLE.IS_SCANE_SEE_GOODS,
		INVITEVEHICLE.IS_GOODS_OVER,
		INVITEVEHICLE.APPLY_FEES,
		INVITEVEHICLE.BUSINESS_TYPE,
		INVITEVEHICLE.BEAR_FEES_DEPT_NAME,
		PASSINVITEAPPLY.PASS_TIME AS AUDITTIME,
	    PASSINVITEAPPLY.VEHICLE_NO AS VEHICLENO,
	    PASSINVITEAPPLY.INVITE_COST / 100 AS INVITECOST,
	    VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_NAME AS VEHICLELENGTHNAME,
	    BAS_ORG1.NAME AS DISPATCHTRANSDEPTNAME, 
	    BAS_ORG2.NAME AS ARRIVEDDEPTNAME,
	    BAS_LINE.LINE_NAME AS CONTRACTLINE
	</sql>
	
	<sql id="INVITEVEHICLE_USE_STATUS">
		INVITEVEHICLE.INVITE_VEHICLE_ID,
		INVITEVEHICLE.STATUS,
		INVITEVEHICLE.INVITE_NO,
		INVITEVEHICLE.APPLY_TIME,
		INVITEVEHICLE.USE_PURPOSE,
		INVITEVEHICLE.USE_TYPE,
		INVITEVEHICLE.ORDER_VEHICLE_MODEL,
		INVITEVEHICLE.PREDICT_USE_TIME,
		INVITEVEHICLE.USE_ADDRESS,
		INVITEVEHICLE.CLIENT_NAME,
		INVITEVEHICLE.CLIENT_CONTACT_PHONE,
		INVITEVEHICLE.GOODS_PACKEGE,
		INVITEVEHICLE.GOODS_QTY,
		INVITEVEHICLE.WEIGHT,
		INVITEVEHICLE.VOLUME,
		INVITEVEHICLE.REQUIRMENT,
		INVITEVEHICLE.DISPATCH_TRANS_DEPT,
		INVITEVEHICLE.APPLY_ORG_NAME,
		INVITEVEHICLE.APPLY_ORG_CODE,
		INVITEVEHICLE.APPLY_EMP_NAME,
		INVITEVEHICLE.APPLY_EMP_CODE,
		INVITEVEHICLE.TELEPHONE_NO,
		INVITEVEHICLE.MOBILEPHONE_NO,
		INVITEVEHICLE.IS_FINISH_BILL,
		INVITEVEHICLE.IS_PASSBY_ARRIVED_DEPT,
		INVITEVEHICLE.ARRIVED_DEPT_CODE,
		INVITEVEHICLE.IS_RETURN,
		INVITEVEHICLE.RETURN_COST / 100 AS RETURN_COST,
		INVITEVEHICLE.IS_CONTRACT_VEHICLE,
		INVITEVEHICLE.CONTRACT_LINE_CODE,
		INVITEAPPLY.USE_STATUS,
		INVITEAPPLY.ACCEPT_EMP_NAME
	</sql>
	
	<!-- 新增  -->
	<insert id="addInviteVehicle" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.InviteVehicleEntity">
		INSERT INTO TFR.T_OPT_INVITE_VEHICLE(
						INVITE_VEHICLE_ID, STATUS, INVITE_NO, 
						APPLY_TIME, USE_PURPOSE, USE_TYPE, 
						ORDER_VEHICLE_MODEL, PREDICT_USE_TIME, USE_ADDRESS, 
						CLIENT_NAME, CLIENT_CONTACT_PHONE, GOODS_PACKEGE, 
						GOODS_QTY, WEIGHT, VOLUME, 
						REQUIRMENT, DISPATCH_TRANS_DEPT, APPLY_ORG_NAME, 
						APPLY_ORG_CODE, APPLY_EMP_NAME, APPLY_EMP_CODE, 
						TELEPHONE_NO, MOBILEPHONE_NO, IS_FINISH_BILL, 
						IS_PASSBY_ARRIVED_DEPT, ARRIVED_DEPT_CODE,
						IS_RETURN, RETURN_COST ,
						IS_CONTRACT_VEHICLE, CONTRACT_LINE_CODE,USE_STATUS,
						GOODS_NAME, LOAD_GOODS_TIME,TOP_FLEET_CODE,ARRIVED_ADDRESS,
						IS_SCANE_SEE_GOODS,IS_GOODS_OVER,
						PROVINCE_CODE,CITY_CODE,AREA_CODE,INQUIRY_NO,APPLY_FEES,BEAR_FEES_DEPT_NAME,BEAR_FEES_DEPT_CODE,BUSINESS_TYPE
						)
		VALUES(
						#{id jdbcType=VARCHAR}, #{status jdbcType=VARCHAR}, #{inviteNo jdbcType=VARCHAR}, 
						#{applyTime,jdbcType=TIMESTAMP}, #{usePurpose jdbcType=VARCHAR}, #{useType jdbcType=VARCHAR}, 
						#{orderVehicleModel jdbcType=VARCHAR}, #{predictUseTime}, #{useAddress jdbcType=VARCHAR}, 
						#{clientName jdbcType=VARCHAR}, #{clientContactPhone jdbcType=VARCHAR}, #{goodsPackege jdbcType=VARCHAR}, 
						#{goodsQty jdbcType=NUMERIC}, #{weight jdbcType=NUMERIC}, #{volume jdbcType=NUMERIC}, 
						#{requirment jdbcType=VARCHAR}, #{dispatchTransDept jdbcType=VARCHAR}, #{applyOrgName jdbcType=VARCHAR}, 
						#{applyOrgCode jdbcType=VARCHAR}, #{applyEmpName jdbcType=VARCHAR}, #{applyEmpCode jdbcType=VARCHAR}, 
						#{telephoneNo jdbcType=VARCHAR}, #{mobilephoneNo jdbcType=VARCHAR}, #{isFinishBill jdbcType=VARCHAR},
						#{isPassByArrivedDept jdbcType=VARCHAR}, #{arrivedDeptCode jdbcType=VARCHAR},
						#{isReturn jdbcType=VARCHAR}, #{returnCost jdbcType=NUMERIC} * 100,
						#{isContractVehicle jdbcType=VARCHAR}, #{contractLineCode jdbcType=VARCHAR}, #{useStatus jdbcType=VARCHAR},
						#{goodsName jdbcType=VARCHAR},#{loadGoodsTime jdbcType=TIMESTAMP},#{topFleetCode jdbcType=TIMESTAMP},
						#{arrivedAddress jdbcType=VARCHAR},#{isScaneSeeGoods jdbcType=CHAR},#{isGoodsOver jdbcType=CHAR},
						#{provinceCode jdbcType=VARCHAR},#{cityCode jdbcType=VARCHAR},#{areaCode jdbcType=VARCHAR},#{inquiryNo jdbcType=VARCHAR},
			            #{applyFees jdbcType=NUMERIC},#{bearFeesDeptName jdbcType=VARCHAR},#{bearFeesDeptCode jdbcType=VARCHAR},#{businessType jdbcType=VARCHAR}
			   )
	</insert>
	
	<!-- 修改  -->
	<update id="updateInviteVehicle"	parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.InviteVehicleEntity">
		UPDATE TFR.T_OPT_INVITE_VEHICLE INVITEVEHICLE
				SET
					INVITEVEHICLE.STATUS = #{status jdbcType=VARCHAR}, 
					INVITEVEHICLE.INVITE_NO = #{inviteNo jdbcType=VARCHAR}, 
					INVITEVEHICLE.APPLY_TIME = #{applyTime}, 
					INVITEVEHICLE.USE_PURPOSE = #{usePurpose jdbcType=VARCHAR}, 
					INVITEVEHICLE.USE_TYPE = #{useType jdbcType=VARCHAR}, 
					INVITEVEHICLE.ORDER_VEHICLE_MODEL = #{orderVehicleModel jdbcType=VARCHAR}, 
					INVITEVEHICLE.PREDICT_USE_TIME = #{predictUseTime}, 
					INVITEVEHICLE.USE_ADDRESS = #{useAddress jdbcType=VARCHAR},
					INVITEVEHICLE.ARRIVED_ADDRESS = #{arrivedAddress jdbcType=VARCHAR}, 
					INVITEVEHICLE.PROVINCE_CODE = #{provinceCode jdbcType=VARCHAR}, 
					INVITEVEHICLE.CITY_CODE = #{cityCode jdbcType=VARCHAR}, 
					INVITEVEHICLE.AREA_CODE = #{areaCode jdbcType=VARCHAR}, 
					INVITEVEHICLE.CLIENT_NAME = #{clientName jdbcType=VARCHAR}, 
					INVITEVEHICLE.CLIENT_CONTACT_PHONE = #{clientContactPhone jdbcType=VARCHAR}, 
					INVITEVEHICLE.GOODS_PACKEGE = #{goodsPackege jdbcType=VARCHAR}, 
					INVITEVEHICLE.GOODS_QTY = #{goodsQty jdbcType=NUMERIC}, 
					INVITEVEHICLE.WEIGHT = #{weight jdbcType=NUMERIC}, 
					INVITEVEHICLE.VOLUME = #{volume jdbcType=NUMERIC}, 
					INVITEVEHICLE.IS_SCANE_SEE_GOODS = #{isScaneSeeGoods jdbcType=CHAR},
					INVITEVEHICLE.IS_GOODS_OVER = #{isGoodsOver jdbcType=CHAR},
					INVITEVEHICLE.REQUIRMENT = #{requirment jdbcType=VARCHAR}, 
					INVITEVEHICLE.DISPATCH_TRANS_DEPT = #{dispatchTransDept jdbcType=VARCHAR}, 
					INVITEVEHICLE.APPLY_ORG_NAME = #{applyOrgName jdbcType=VARCHAR}, 
					INVITEVEHICLE.APPLY_ORG_CODE = #{applyOrgCode jdbcType=VARCHAR}, 
					INVITEVEHICLE.APPLY_EMP_NAME = #{applyEmpName jdbcType=VARCHAR}, 
					INVITEVEHICLE.APPLY_EMP_CODE = #{applyEmpCode jdbcType=VARCHAR}, 
					INVITEVEHICLE.TELEPHONE_NO = #{telephoneNo jdbcType=VARCHAR}, 
					<if test="isFinishBill != null and isFinishBill != ''">
						INVITEVEHICLE.IS_FINISH_BILL = #{isFinishBill jdbcType=VARCHAR},
					</if>
					INVITEVEHICLE.IS_PASSBY_ARRIVED_DEPT = #{isPassByArrivedDept jdbcType=VARCHAR},
					INVITEVEHICLE.ARRIVED_DEPT_CODE = #{arrivedDeptCode jdbcType=VARCHAR},
					INVITEVEHICLE.MOBILEPHONE_NO = #{mobilephoneNo jdbcType=VARCHAR},
					INVITEVEHICLE.IS_RETURN = #{isReturn jdbcType=VARCHAR},
					<if test="arrivalTime != null and arrivalTime != ''">
					INVITEVEHICLE.ARRIVAL_TIME = #{arrivalTime jdbcType=TIMESTAMP},
					</if>
					INVITEVEHICLE.RETURN_COST = #{returnCost jdbcType=VARCHAR} * 100, 
					INVITEVEHICLE.IS_CONTRACT_VEHICLE = #{isContractVehicle jdbcType=VARCHAR},
					<if test="useStatus != null and useStatus != ''">
						INVITEVEHICLE.USE_STATUS = #{useStatus jdbcType=VARCHAR},
					</if>
					<if test="goodsName != null and goodsName != ''">
						INVITEVEHICLE.GOODS_NAME = #{goodsName jdbcType=VARCHAR},
					</if>
					<if test="loadGoodsTime != null">
						INVITEVEHICLE.LOAD_GOODS_TIME = #{loadGoodsTime jdbcType=TIMESTAMP},
					</if>
					INVITEVEHICLE.CONTRACT_LINE_CODE = #{contractLineCode jdbcType=VARCHAR}
					<if test="topFleetCode != null">
						,INVITEVEHICLE.TOP_FLEET_CODE = #{topFleetCode jdbcType=VARCHAR}					
					</if>
		WHERE INVITEVEHICLE.INVITE_VEHICLE_ID = #{id} 
					<if test="inquiryNo != null">
						AND INVITEVEHICLE.INQUIRY_NO = #{inquiryNo jdbcType=VARCHAR}					
					</if>
	</update>
	
	<!-- 修改约车状态  -->
	<update id="updateInviteVehicleApplyStatus"	parameterType="map">
		UPDATE TFR.T_OPT_INVITE_VEHICLE INVITEVEHICLE
				SET
					INVITEVEHICLE.STATUS = #{status jdbcType=VARCHAR}					
		WHERE INVITEVEHICLE.INVITE_NO IN 
		<foreach collection="inviteNoList" close=")" open="(" item="inviteNo" separator=",">
			#{inviteNo}
		</foreach>
	</update>
	
	<!-- 更新 约车总价  -->
	<update id="updateInviteVehicleForTotalInviteCost"	parameterType="map">
		UPDATE TFR.T_OPT_INVITE_VEHICLE INVITEVEHICLE
				SET
					INVITEVEHICLE.TOTAL_INVITE_COST = #{totalInviteCost}*100					
		WHERE INVITEVEHICLE.INVITE_NO = #{inviteNo}
	</update>
	<!-- 更新开单完成状态  -->
	<update id="updateInviteVehicleForFinishBill"	parameterType="map">
		UPDATE TFR.T_OPT_INVITE_VEHICLE INVITEVEHICLE
				SET
					INVITEVEHICLE.IS_FINISH_BILL = #{isFinishBill jdbcType=VARCHAR}					
		WHERE INVITEVEHICLE.INVITE_NO = #{inviteNo}
	</update>
	
	<!-- 更新外请约车使用状态 -->
	<update id="updateUseStatus" parameterType="map">
		UPDATE TFR.T_OPT_PASS_INVITE_APPLY INVITEVEHICLE
				SET
					INVITEVEHICLE.USE_STATUS = #{status jdbcType=VARCHAR}					
		WHERE INVITEVEHICLE.INVITE_NO = #{inviteNo}
		AND INVITEVEHICLE.VEHICLE_NO = #{vehicleNo}
	</update>
	
	<sql id="select_Where">
		<where>
			<if test="status != null and status !=''">
				AND INVITEVEHICLE.STATUS  = #{status}   
			</if>
			<if test="inviteNo != null and inviteNo !=''">
				AND INVITEVEHICLE.INVITE_NO  =  #{inviteNo}   
			</if>
			<if test="applyTime != null and applyTime !=''">
				AND INVITEVEHICLE.APPLY_TIME = #{applyTime}    
			</if>
			<if test="usePurpose != null and usePurpose !=''">
				AND INVITEVEHICLE.USE_PURPOSE  =  #{usePurpose}   
			</if>
			<if test="useType != null and useType !=''">
				AND INVITEVEHICLE.USE_TYPE =  #{useType}   
			</if>
			<if test="orderVehicleModel != null and orderVehicleModel !=''">
				AND INVITEVEHICLE.ORDER_VEHICLE_MODEL =  #{orderVehicleModel}   
			</if>
			<if test="predictUseTime != null and predictUseTime !=''">
				AND INVITEVEHICLE.PREDICT_USE_TIME = #{predictUseTime}    
			</if>
			<if test="useAddress != null and useAddress !=''">
				AND INVITEVEHICLE.USE_ADDRESS  =  #{useAddress}   
			</if>
			<if test="clientName != null and clientName !=''">
				AND INVITEVEHICLE.CLIENT_NAME  = #{clientName}   
			</if>
			<if test="clientContactPhone != null and clientContactPhone !=''">
				AND INVITEVEHICLE.CLIENT_CONTACT_PHONE = #{clientContactPhone}   
			</if>
			<if test="requirment != null and requirment !=''">
				AND INVITEVEHICLE.REQUIRMENT = #{requirment}   
			</if>
			<if test="dispatchTransDept != null and dispatchTransDept !=''">
				AND INVITEVEHICLE.DISPATCH_TRANS_DEPT = #{dispatchTransDept}   
			</if>
			<if test="applyOrgName != null and applyOrgName !=''">
				AND INVITEVEHICLE.APPLY_ORG_NAME = #{applyOrgName}   
			</if>
			<if test="applyOrgCode != null and applyOrgCode !=''">
				AND INVITEVEHICLE.APPLY_ORG_CODE = #{applyOrgCode}   
			</if>
			<if test="applyEmpName != null and applyEmpName !=''">
				AND INVITEVEHICLE.APPLY_EMP_NAME = #{applyEmpName}   
			</if>
			<if test="applyEmpCode != null and applyEmpCode !=''">
				AND INVITEVEHICLE.APPLY_EMP_CODE = #{applyEmpCode}   
			</if>
			<if test="beginInviteCostStr != null and beginInviteCostStr != ''">
				<![CDATA[ 
					AND PASSINVITEAPPLY.INVITE_COST >= #{beginInviteCostStr} * 100
				]]>
			</if>
			<if test="endInviteCostStr != null and endInviteCostStr != ''">
				<![CDATA[ 
					AND PASSINVITEAPPLY.INVITE_COST  <= #{endInviteCostStr} * 100
				]]>
			</if>
			<if test="vehicleLengthName != null and  vehicleLengthName != ''">
				AND VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_NAME LIKE '%'||#{vehicleLengthName}||'%'
			</if>
			<if test="beginAuditTime != null and  endAuditTime != null">
				AND PASSINVITEAPPLY.PASS_TIME BETWEEN #{beginAuditTime}  AND #{endAuditTime}
			</if>
			<if test="beginAuditTime != null and  endAuditTime == null">
				<![CDATA[ 
					AND PASSINVITEAPPLY.PASS_TIME >= #{beginAuditTime}  
				]]>
			</if>
			<if test="beginAuditTime == null and  endAuditTime != null">
				<![CDATA[ 
					AND PASSINVITEAPPLY.PASS_TIME <= #{endAuditTime}  
				]]>
			</if>
			<if test="beginPredictUseTime != null and  endPredictUseTime != null">
				AND INVITEVEHICLE.PREDICT_USE_TIME BETWEEN #{beginPredictUseTime}  AND #{endPredictUseTime}
			</if>
			<if test="beginPredictUseTime != null and  endPredictUseTime == null">
				<![CDATA[ 
					AND INVITEVEHICLE.PREDICT_USE_TIME >= #{beginPredictUseTime}  
				]]>
			</if>
			<if test="beginPredictUseTime == null and  endPredictUseTime != null">
				<![CDATA[ 
					AND INVITEVEHICLE.PREDICT_USE_TIME <= #{endPredictUseTime}  
				]]>
			</if>
			
			<if test="inviteNoList != null">
				AND INVITEVEHICLE.INVITE_NO  IN
				<foreach collection="inviteNoList" close=")" open="(" index="index" item="item" separator=",">
					#{item}
				</foreach>
			</if>
			<if test="inviteVehicleStatusList != null">
				AND INVITEVEHICLE.STATUS IN
				<foreach collection="inviteVehicleStatusList" close=")" open="(" index="index" item="item" separator=",">
					#{item}
				</foreach>
			</if>
			<if test="isReturn != null and isReturn != ''">
				<![CDATA[ 
					AND INVITEVEHICLE.IS_RETURN = #{isReturn}
				]]>
			</if>
			<if test="beginReturnCostStr != null and beginReturnCostStr != ''">
				<![CDATA[ 
					AND INVITEVEHICLE.RETURN_COST >= #{beginReturnCostStr} * 100
				]]>
			</if>
			<if test="endReturnCostStr != null and endReturnCostStr != ''">
				<![CDATA[ 
					AND INVITEVEHICLE.RETURN_COST  <= #{endReturnCostStr} * 100
				]]>
			</if>
			<if test="isContractVehicle != null and  isContractVehicle != ''">
				AND INVITEVEHICLE.IS_CONTRACT_VEHICLE =  #{isContractVehicle} 
			</if>
			<if test="contractLineCode != null and  contractLineCode != ''">
				AND INVITEVEHICLE.CONTRACT_LINE_CODE =  #{contractLineCode} 
			</if>
			<if test="vehicleNo != null and vehicleNo !=''">
				AND PASSINVITEAPPLY.VEHICLE_NO = #{vehicleNo}   
			</if>
			<if test="useStatus != null and useStatus !=''">
				AND INVITEVEHICLE.USE_STATUS = #{useStatus}   
			</if>
			<if test="contractLine != null and contractLine !=''">
				AND BAS_LINE.LINE_NAME LIKE '%'||#{vehicleLengthName}
			</if>
		</where>
	</sql>
	
	<sql id="queryInviteVehicleList_Sql">
		FROM TFR.T_OPT_INVITE_VEHICLE INVITEVEHICLE 
			LEFT JOIN TFR.T_OPT_PASS_INVITE_APPLY PASSINVITEAPPLY  
				ON INVITEVEHICLE.INVITE_NO = PASSINVITEAPPLY.INVITE_NO AND INVITEVEHICLE.STATUS NOT IN('REJECT', 'RETURN')
			LEFT JOIN BSE.T_BAS_VEHICLE_TYPE_LENGTH VEHICLE_TYPE_LENGTH ON 
			          VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_CODE = INVITEVEHICLE.ORDER_VEHICLE_MODEL AND VEHICLE_TYPE_LENGTH.ACTIVE ='Y' /**AND VEHICLE_TYPE_LENGTH.VEHICLE_SORT = 'ownership_leased'*/
			LEFT JOIN BSE.T_BAS_ORG BAS_ORG1 ON BAS_ORG1.CODE = INVITEVEHICLE.DISPATCH_TRANS_DEPT AND BAS_ORG1.ACTIVE ='Y'
      		LEFT JOIN BSE.T_BAS_ORG BAS_ORG2 ON BAS_ORG2.CODE = INVITEVEHICLE.ARRIVED_DEPT_CODE AND BAS_ORG2.ACTIVE ='Y'
      		LEFT JOIN BSE.T_BAS_LEASED_TRUCK BAS_LEASED_TRUCK ON PASSINVITEAPPLY.VEHICLE_NO = BAS_LEASED_TRUCK.VEHICLE_NO AND  BAS_LEASED_TRUCK.ACTIVE = 'Y' AND BAS_LEASED_TRUCK.STATUS = 'Y'
      		LEFT JOIN BSE.T_BAS_LINE BAS_LINE ON BAS_LINE.SIMPLE_CODE = BAS_LEASED_TRUCK.BARGAIN_ROUTE AND BAS_LINE.ACTIVE = 'Y' AND INVITEVEHICLE.IS_CONTRACT_VEHICLE = 'Y'
	</sql>
	
	<!-- 查询集合  -->
	<select id="queryInviteVehicleList"	resultMap="InviteVehicleResultMap"  parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.InviteVehicleDto">
		SELECT
				  inv.INVITE_NO							AS INVITE_NO,
				  max(inv.INVITE_VEHICLE_ID)			AS INVITE_VEHICLE_ID,
				  max(inv.STATUS)						AS STATUS,
				  max(inv.APPLY_TIME)					AS APPLY_TIME,
				  max(inv.USE_PURPOSE)					AS USE_PURPOSE,
				  max(inv.USE_TYPE)						AS USE_TYPE,
				  max(inv.ORDER_VEHICLE_MODEL)			AS ORDER_VEHICLE_MODEL,
				  max(inv.PREDICT_USE_TIME)				AS PREDICT_USE_TIME,
				  max(inv.USE_ADDRESS)					AS USE_ADDRESS,
				  max(inv.CLIENT_NAME)					AS CLIENT_NAME,
				  max(inv.CLIENT_CONTACT_PHONE)			AS CLIENT_CONTACT_PHONE,
				  max(inv.GOODS_PACKEGE)				AS GOODS_PACKEGE,
				  max(inv.GOODS_QTY)					AS GOODS_QTY,
				  max(inv.WEIGHT)						AS WEIGHT,
				  max(inv.VOLUME)						AS VOLUME,
				  max(inv.REQUIRMENT)					AS REQUIRMENT,
				  max(inv.DISPATCH_TRANS_DEPT)			AS DISPATCH_TRANS_DEPT,
				  max(inv.APPLY_ORG_NAME)				AS APPLY_ORG_NAME,
				  max(inv.APPLY_ORG_CODE)				AS APPLY_ORG_CODE,
				  max(inv.APPLY_EMP_NAME)				AS APPLY_EMP_NAME,
				  max(inv.APPLY_EMP_CODE)				AS APPLY_EMP_CODE,
				  max(inv.TELEPHONE_NO)					AS TELEPHONE_NO,
				  max(inv.MOBILEPHONE_NO)				AS MOBILEPHONE_NO,
				  max(inv.IS_FINISH_BILL)				AS IS_FINISH_BILL,
				  max(inv.IS_PASSBY_ARRIVED_DEPT)		AS IS_PASSBY_ARRIVED_DEPT,
				  max(inv.ARRIVED_DEPT_CODE)			AS ARRIVED_DEPT_CODE,
				  max(inv.IS_RETURN)					AS IS_RETURN,
				  max(inv.ARRIVAL_TIME)					AS ARRIVAL_TIME,
				  max(inv.RETURN_COST)					AS RETURN_COST,
				  max(inv.IS_CONTRACT_VEHICLE)			AS IS_CONTRACT_VEHICLE,
				  max(inv.CONTRACT_LINE_CODE)			AS CONTRACT_LINE_CODE,
				  wm_concat(inv.USE_STATUS)				AS USE_STATUS,
				  max(inv.GOODS_NAME)					AS GOODS_NAME,
				  max(inv.LOAD_GOODS_TIME)				AS LOAD_GOODS_TIME,
				  sum(inv.INVITECOST)					AS INVITECOST,
				  wm_concat(inv.VEHICLENO)				AS VEHICLENO,
				  max(inv.AUDITTIME)					AS AUDITTIME,
				  max(inv.VEHICLELENGTHNAME)			AS VEHICLELENGTHNAME,
				  max(inv.DISPATCHTRANSDEPTNAME)		AS DISPATCHTRANSDEPTNAME,
				  max(inv.ARRIVEDDEPTNAME)				AS ARRIVEDDEPTNAME,
				  max(inv.CONTRACTLINE)					AS CONTRACTLINE,
				  max(inv.TOP_FLEET_CODE)				AS TOP_FLEET_CODE,
				  max(inv.INQUIRY_NO)				    AS INQUIRY_NO
		FROM (
				SELECT 
					/** 中转:查询外请约车信息 **/ 
					INVITEVEHICLE.INVITE_VEHICLE_ID,
					INVITEVEHICLE.STATUS,
					INVITEVEHICLE.INVITE_NO,
					INVITEVEHICLE.APPLY_TIME,
					INVITEVEHICLE.USE_PURPOSE,
					INVITEVEHICLE.USE_TYPE,
					INVITEVEHICLE.ORDER_VEHICLE_MODEL,
					INVITEVEHICLE.PREDICT_USE_TIME,
					INVITEVEHICLE.USE_ADDRESS,
					INVITEVEHICLE.CLIENT_NAME,
					INVITEVEHICLE.CLIENT_CONTACT_PHONE,
					INVITEVEHICLE.GOODS_PACKEGE,
					INVITEVEHICLE.GOODS_QTY,
					INVITEVEHICLE.WEIGHT,
					INVITEVEHICLE.VOLUME,
					INVITEVEHICLE.REQUIRMENT,
					INVITEVEHICLE.DISPATCH_TRANS_DEPT,
					INVITEVEHICLE.APPLY_ORG_NAME,
					INVITEVEHICLE.APPLY_ORG_CODE,
					INVITEVEHICLE.APPLY_EMP_NAME,
					INVITEVEHICLE.APPLY_EMP_CODE,
					INVITEVEHICLE.TELEPHONE_NO,
					INVITEVEHICLE.MOBILEPHONE_NO,
					INVITEVEHICLE.IS_FINISH_BILL,
					INVITEVEHICLE.IS_PASSBY_ARRIVED_DEPT,
					INVITEVEHICLE.ARRIVED_DEPT_CODE,
					INVITEVEHICLE.IS_RETURN,
					INVITEVEHICLE.ARRIVAL_TIME,
					INVITEVEHICLE.RETURN_COST / 100 AS RETURN_COST,
					INVITEVEHICLE.IS_CONTRACT_VEHICLE,
					INVITEVEHICLE.CONTRACT_LINE_CODE,
					PASSINVITEAPPLY.USE_STATUS,
					INVITEVEHICLE.GOODS_NAME,
					INVITEVEHICLE.LOAD_GOODS_TIME,
					PASSINVITEAPPLY.PASS_TIME AS AUDITTIME,
					PASSINVITEAPPLY.VEHICLE_NO AS VEHICLENO,
					PASSINVITEAPPLY.INVITE_COST / 100 AS INVITECOST,
					VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_NAME AS VEHICLELENGTHNAME,
					BAS_ORG1.NAME AS DISPATCHTRANSDEPTNAME, 
					BAS_ORG2.NAME AS ARRIVEDDEPTNAME,
					BAS_LINE.LINE_NAME AS CONTRACTLINE,
					INVITEVEHICLE.TOP_FLEET_CODE,
					INVITEVEHICLE.INQUIRY_NO AS INQUIRY_NO
				FROM TFR.T_OPT_INVITE_VEHICLE INVITEVEHICLE 
					LEFT JOIN TFR.T_OPT_PASS_INVITE_APPLY PASSINVITEAPPLY  
						ON INVITEVEHICLE.INVITE_NO = PASSINVITEAPPLY	.INVITE_NO AND INVITEVEHICLE.STATUS NOT IN('REJECT', 'RETURN') /**只有非拒绝与退回状态才关联查询通过状态的表*/
					LEFT JOIN BSE.T_BAS_VEHICLE_TYPE_LENGTH VEHICLE_TYPE_LENGTH ON 
							  VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_CODE = INVITEVEHICLE.ORDER_VEHICLE_MODEL AND VEHICLE_TYPE_LENGTH.ACTIVE ='Y'
					LEFT JOIN BSE.T_BAS_ORG BAS_ORG1 ON BAS_ORG1.CODE = INVITEVEHICLE.DISPATCH_TRANS_DEPT AND BAS_ORG1.ACTIVE ='Y'
					LEFT JOIN BSE.T_BAS_ORG BAS_ORG2 ON BAS_ORG2.CODE = INVITEVEHICLE.ARRIVED_DEPT_CODE AND BAS_ORG2.ACTIVE ='Y'
					LEFT JOIN BSE.T_BAS_LEASED_TRUCK BAS_LEASED_TRUCK ON PASSINVITEAPPLY.VEHICLE_NO = BAS_LEASED_TRUCK.VEHICLE_NO AND  BAS_LEASED_TRUCK.ACTIVE = 'Y' AND BAS_LEASED_TRUCK.STATUS = 'Y'
					LEFT JOIN BSE.T_BAS_LINE BAS_LINE ON BAS_LINE.SIMPLE_CODE = BAS_LEASED_TRUCK.BARGAIN_ROUTE AND BAS_LINE.ACTIVE = 'Y' AND INVITEVEHICLE.IS_CONTRACT_VEHICLE = 'Y' /**只有合同车才关联查询合同线路表*/
				where (INVITEVEHICLE.APPLY_ORG_CODE = #{currentDeptCode} OR INVITEVEHICLE.APPLY_ORG_CODE = #{currentTransferCenterCode} OR INVITEVEHICLE.DISPATCH_TRANS_DEPT = #{currentDeptCode} OR INVITEVEHICLE.TOP_FLEET_CODE = #{topFleetCode})
					<if test="status != null and status !=''">
						AND INVITEVEHICLE.STATUS  = #{status}   
					</if>
					<if test="inviteNo != null and inviteNo !=''">
						AND INVITEVEHICLE.INVITE_NO  =  #{inviteNo}   
					</if>
					<!-- 按照询价编号查询 -->
					<if test="inquiryNo != null and inquiryNo !=''">
						AND INVITEVEHICLE.INQUIRY_NO  =  #{inquiryNo}   
					</if>
					<if test="applyTime != null and applyTime !=''">
						AND INVITEVEHICLE.APPLY_TIME = #{applyTime}    
					</if>
					<if test="usePurpose != null and usePurpose !=''">
						AND INVITEVEHICLE.USE_PURPOSE  =  #{usePurpose}   
					</if>
					<if test="useType != null and useType !=''">
						AND INVITEVEHICLE.USE_TYPE =  #{useType}   
					</if>
					<if test="orderVehicleModel != null and orderVehicleModel !=''">
						AND INVITEVEHICLE.ORDER_VEHICLE_MODEL =  #{orderVehicleModel}   
					</if>
					<if test="predictUseTime != null and predictUseTime !=''">
						AND INVITEVEHICLE.PREDICT_USE_TIME = #{predictUseTime}    
					</if>
					<if test="useAddress != null and useAddress !=''">
						AND INVITEVEHICLE.USE_ADDRESS  =  #{useAddress}   
					</if>
					<if test="clientName != null and clientName !=''">
						AND INVITEVEHICLE.CLIENT_NAME  = #{clientName}   
					</if>
					<if test="clientContactPhone != null and clientContactPhone !=''">
						AND INVITEVEHICLE.CLIENT_CONTACT_PHONE = #{clientContactPhone}   
					</if>
					<if test="requirment != null and requirment !=''">
						AND INVITEVEHICLE.REQUIRMENT = #{requirment}   
					</if>
					<if test="dispatchTransDept != null and dispatchTransDept !=''">
						AND INVITEVEHICLE.DISPATCH_TRANS_DEPT = #{dispatchTransDept}   
					</if>
					<if test="applyOrgName != null and applyOrgName !=''">
						AND INVITEVEHICLE.APPLY_ORG_NAME = #{applyOrgName}   
					</if>
					<if test="applyOrgCode != null and applyOrgCode !=''">
						AND INVITEVEHICLE.APPLY_ORG_CODE = #{applyOrgCode}   
					</if>
					<if test="applyEmpName != null and applyEmpName !=''">
						AND INVITEVEHICLE.APPLY_EMP_NAME = #{applyEmpName}   
					</if>
					<if test="applyEmpCode != null and applyEmpCode !=''">
						AND INVITEVEHICLE.APPLY_EMP_CODE = #{applyEmpCode}   
					</if>
					<if test="beginInviteCostStr != null and beginInviteCostStr != ''">
						<![CDATA[ 
							AND INVITEVEHICLE.TOTAL_INVITE_COST >= #{beginInviteCostStr} * 100
						]]>
					</if>
					<if test="endInviteCostStr != null and endInviteCostStr != ''">
						<![CDATA[ 
							AND INVITEVEHICLE.TOTAL_INVITE_COST  <= #{endInviteCostStr} * 100
						]]>
					</if>
					<if test="vehicleLengthName != null and  vehicleLengthName != ''">
						AND VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_NAME LIKE '%'||#{vehicleLengthName}||'%'
					</if>
					<if test="beginAuditTime != null and  endAuditTime != null">
						AND PASSINVITEAPPLY.PASS_TIME BETWEEN #{beginAuditTime}  AND #{endAuditTime}
					</if>
					<if test="beginAuditTime != null and  endAuditTime == null">
						<![CDATA[ 
							AND PASSINVITEAPPLY.PASS_TIME >= #{beginAuditTime}  
						]]>
					</if>
					<if test="beginAuditTime == null and  endAuditTime != null">
						<![CDATA[ 
							AND PASSINVITEAPPLY.PASS_TIME <= #{endAuditTime}  
						]]>
					</if>
					<if test="beginPredictUseTime != null and  endPredictUseTime != null">
						AND INVITEVEHICLE.PREDICT_USE_TIME BETWEEN #{beginPredictUseTime}  AND #{endPredictUseTime}
					</if>
					<if test="beginPredictUseTime != null and  endPredictUseTime == null">
						<![CDATA[ 
							AND INVITEVEHICLE.PREDICT_USE_TIME >= #{beginPredictUseTime}  
						]]>
					</if>
					<if test="beginPredictUseTime == null and  endPredictUseTime != null">
						<![CDATA[ 
							AND INVITEVEHICLE.PREDICT_USE_TIME <= #{endPredictUseTime}  
						]]>
					</if>
					
					<if test="inviteNoList != null">
						AND INVITEVEHICLE.INVITE_NO  IN
						<foreach collection="inviteNoList" close=")" open="(" index="index" item="item" separator=",">
							#{item}
						</foreach>
					</if>
					<if test="inviteVehicleStatusList != null">
						AND INVITEVEHICLE.STATUS IN
						<foreach collection="inviteVehicleStatusList" close=")" open="(" index="index" item="item" separator=",">
							#{item}
						</foreach>
					</if>
					<if test="isReturn != null and isReturn != ''">
						<![CDATA[ 
							AND INVITEVEHICLE.IS_RETURN = #{isReturn}
						]]>
					</if>
					<if test="beginReturnCostStr != null and beginReturnCostStr != ''">
						<![CDATA[ 
							AND INVITEVEHICLE.RETURN_COST >= #{beginReturnCostStr} * 100
						]]>
					</if>
					<if test="endReturnCostStr != null and endReturnCostStr != ''">
						<![CDATA[ 
							AND INVITEVEHICLE.RETURN_COST  <= #{endReturnCostStr} * 100
						]]>
					</if>
					<if test="isContractVehicle != null and  isContractVehicle != ''">
						AND INVITEVEHICLE.IS_CONTRACT_VEHICLE =  #{isContractVehicle} 
					</if>
					<if test="contractLineCode != null and  contractLineCode != ''">
						AND INVITEVEHICLE.CONTRACT_LINE_CODE =  #{contractLineCode} 
					</if>
					<if test="vehicleNo != null and vehicleNo !=''">
						AND PASSINVITEAPPLY.VEHICLE_NO = #{vehicleNo}   
					</if>
					<if test="useStatus != null and useStatus !=''">
						AND PASSINVITEAPPLY.USE_STATUS = #{useStatus}   
					</if>
					<if test="contractLine != null and contractLine !=''">
						AND BAS_LINE.LINE_NAME LIKE '%'||#{vehicleLengthName}
					</if>
				ORDER BY 
						INVITEVEHICLE.PREDICT_USE_TIME - INVITEVEHICLE.APPLY_TIME, 
						INVITEVEHICLE.PREDICT_USE_TIME - sysdate
			) inv
		GROUP BY inv.INVITE_NO  
	</select>
	<select id="queryAuditInviteVehicleList" resultMap="InviteVehicleResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.InviteVehicleDto">
		SELECT
		      inv.INVITE_NO							AS INVITE_NO,
		      max(inv.INVITE_VEHICLE_ID)			AS INVITE_VEHICLE_ID,
			  max(inv.STATUS)						AS STATUS,
		      max(inv.APPLY_TIME)					AS APPLY_TIME,
		      max(inv.USE_PURPOSE)					AS USE_PURPOSE,
		      max(inv.USE_TYPE)						AS USE_TYPE,
		      max(inv.ORDER_VEHICLE_MODEL)			AS ORDER_VEHICLE_MODEL,
		      max(inv.PREDICT_USE_TIME)				AS PREDICT_USE_TIME,
		      max(inv.USE_ADDRESS)					AS USE_ADDRESS,
		      max(inv.CLIENT_NAME)					AS CLIENT_NAME,
		      max(inv.CLIENT_CONTACT_PHONE)			AS CLIENT_CONTACT_PHONE,
		      max(inv.GOODS_PACKEGE)				AS GOODS_PACKEGE,
		      max(inv.GOODS_QTY)					AS GOODS_QTY,
		      max(inv.WEIGHT)						AS WEIGHT,
		      max(inv.VOLUME)						AS VOLUME,
		      max(inv.REQUIRMENT)					AS REQUIRMENT,
		      max(inv.DISPATCH_TRANS_DEPT)			AS DISPATCH_TRANS_DEPT,
		      max(inv.APPLY_ORG_NAME)				AS APPLY_ORG_NAME,
		      max(inv.APPLY_ORG_CODE)				AS APPLY_ORG_CODE,
		      max(inv.APPLY_EMP_NAME)				AS APPLY_EMP_NAME,
		      max(inv.APPLY_EMP_CODE)				AS APPLY_EMP_CODE,
		      max(inv.TELEPHONE_NO)					AS TELEPHONE_NO,
		      max(inv.MOBILEPHONE_NO)				AS MOBILEPHONE_NO,
		      max(inv.ARRIVED_ADDRESS)              AS ARRIVED_ADDRESS,
		      max(inv.PROVINCE_CODE)              	AS PROVINCE_CODE,
		      max(inv.CITY_CODE)              		AS CITY_CODE,
		      max(inv.AREA_CODE)              		AS AREA_CODE,
		      max(inv.IS_FINISH_BILL)				AS IS_FINISH_BILL,
		      max(inv.IS_PASSBY_ARRIVED_DEPT)		AS IS_PASSBY_ARRIVED_DEPT,
		      max(inv.ARRIVED_DEPT_CODE)			AS ARRIVED_DEPT_CODE,
		      max(inv.IS_RETURN)					AS IS_RETURN,
		      max(inv.RETURN_COST)					AS RETURN_COST,
		      max(inv.IS_CONTRACT_VEHICLE)			AS IS_CONTRACT_VEHICLE,
		      max(inv.CONTRACT_LINE_CODE)			AS CONTRACT_LINE_CODE,
		      wm_concat(inv.USE_STATUS)				AS USE_STATUS,
		      max(inv.GOODS_NAME)					AS GOODS_NAME,
		      max(inv.LOAD_GOODS_TIME)				AS LOAD_GOODS_TIME,
		      max(inv.IS_SCANE_SEE_GOODS)			AS IS_SCANE_SEE_GOODS,
		      max(inv.IS_GOODS_OVER)			    AS IS_GOODS_OVER,
		      max(inv.Apply_Fees)			        AS Apply_Fees,
		      max(inv.BUSINESS_TYPE)			    AS BUSINESS_TYPE,
		      max(inv.Bear_Fees_Dept_Name)			AS Bear_Fees_Dept_Name,
		      sum(inv.INVITECOST)					AS INVITECOST,
		      wm_concat(inv.VEHICLENO)				AS VEHICLENO,
		      max(inv.AUDITTIME)					AS AUDITTIME,
		      max(inv.PERDICT_ARRIVE_TIME)			AS PERDICT_ARRIVE_TIME,
		      max(inv.VEHICLELENGTHNAME)			AS VEHICLELENGTHNAME,
		      max(inv.DISPATCHTRANSDEPTNAME)		AS DISPATCHTRANSDEPTNAME,
		      max(inv.ARRIVEDDEPTNAME)				AS ARRIVEDDEPTNAME,
		      max(inv.CONTRACTLINE)					AS CONTRACTLINE
		FROM (
			SELECT 
				/** 中转:查询外请车约车受理页面所显示的约车列表信息**/ 
				INVITEVEHICLE.INVITE_VEHICLE_ID,
				INVITEVEHICLE.STATUS,
				INVITEVEHICLE.INVITE_NO,
				INVITEVEHICLE.APPLY_TIME,
				INVITEVEHICLE.USE_PURPOSE,
				INVITEVEHICLE.USE_TYPE,
				INVITEVEHICLE.ORDER_VEHICLE_MODEL,
				INVITEVEHICLE.PREDICT_USE_TIME,
				INVITEVEHICLE.USE_ADDRESS,
				INVITEVEHICLE.CLIENT_NAME,
				INVITEVEHICLE.CLIENT_CONTACT_PHONE,
				INVITEVEHICLE.GOODS_PACKEGE,
				INVITEVEHICLE.GOODS_QTY,
				INVITEVEHICLE.WEIGHT,
				INVITEVEHICLE.VOLUME,
				INVITEVEHICLE.REQUIRMENT,
				INVITEVEHICLE.DISPATCH_TRANS_DEPT,
				INVITEVEHICLE.APPLY_ORG_NAME,
				INVITEVEHICLE.APPLY_ORG_CODE,
				INVITEVEHICLE.APPLY_EMP_NAME,
				INVITEVEHICLE.APPLY_EMP_CODE,
				INVITEVEHICLE.TELEPHONE_NO,
				INVITEVEHICLE.MOBILEPHONE_NO,
				INVITEVEHICLE.ARRIVED_ADDRESS,
				INVITEVEHICLE.PROVINCE_CODE,
				INVITEVEHICLE.CITY_CODE,
				INVITEVEHICLE.AREA_CODE,
				INVITEVEHICLE.IS_FINISH_BILL,
				INVITEVEHICLE.IS_PASSBY_ARRIVED_DEPT,
				INVITEVEHICLE.ARRIVED_DEPT_CODE,
				INVITEVEHICLE.IS_RETURN,
				INVITEVEHICLE.RETURN_COST / 100 AS RETURN_COST,
				INVITEVEHICLE.IS_CONTRACT_VEHICLE,
				INVITEVEHICLE.CONTRACT_LINE_CODE,
				PASSINVITEAPPLY.USE_STATUS,
				INVITEVEHICLE.GOODS_NAME,
				INVITEVEHICLE.LOAD_GOODS_TIME,
				INVITEVEHICLE.IS_SCANE_SEE_GOODS,
				INVITEVEHICLE.IS_GOODS_OVER,
				INVITEVEHICLE.Apply_Fees,
				INVITEVEHICLE.BUSINESS_TYPE,
                INVITEVEHICLE.Bear_Fees_Dept_Name,
			    PASSINVITEAPPLY.INVITE_COST / 100 AS INVITECOST,
			    PASSINVITEAPPLY.VEHICLE_NO AS VEHICLENO,
				PASSINVITEAPPLY.PASS_TIME AS AUDITTIME,
			    PASSINVITEAPPLY.PERDICT_ARRIVE_TIME,
			    VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_NAME AS VEHICLELENGTHNAME,
			    BAS_ORG1.NAME AS DISPATCHTRANSDEPTNAME, 
			    BAS_ORG2.NAME AS ARRIVEDDEPTNAME,
			    BAS_LINE.LINE_NAME AS CONTRACTLINE	 
			FROM TFR.T_OPT_INVITE_VEHICLE INVITEVEHICLE 
				LEFT JOIN TFR.T_OPT_PASS_INVITE_APPLY PASSINVITEAPPLY  
					ON INVITEVEHICLE.INVITE_NO = PASSINVITEAPPLY.INVITE_NO AND INVITEVEHICLE.STATUS NOT IN('REJECT', 'RETURN')
				LEFT JOIN BSE.T_BAS_VEHICLE_TYPE_LENGTH VEHICLE_TYPE_LENGTH ON 
				          VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_CODE = INVITEVEHICLE.ORDER_VEHICLE_MODEL AND VEHICLE_TYPE_LENGTH.ACTIVE ='Y' 
				LEFT JOIN BSE.T_BAS_ORG BAS_ORG1 ON BAS_ORG1.CODE = INVITEVEHICLE.DISPATCH_TRANS_DEPT AND BAS_ORG1.ACTIVE ='Y'
	      		LEFT JOIN BSE.T_BAS_ORG BAS_ORG2 ON BAS_ORG2.CODE = INVITEVEHICLE.ARRIVED_DEPT_CODE AND BAS_ORG2.ACTIVE ='Y'
	      		LEFT JOIN BSE.T_BAS_LEASED_TRUCK BAS_LEASED_TRUCK ON PASSINVITEAPPLY.VEHICLE_NO = BAS_LEASED_TRUCK.VEHICLE_NO AND  BAS_LEASED_TRUCK.ACTIVE = 'Y' AND BAS_LEASED_TRUCK.STATUS = 'Y'
	      		LEFT JOIN BSE.T_BAS_LINE BAS_LINE ON BAS_LINE.SIMPLE_CODE = BAS_LEASED_TRUCK.BARGAIN_ROUTE AND BAS_LINE.ACTIVE = 'Y' AND INVITEVEHICLE.IS_CONTRACT_VEHICLE = 'Y'
			<where>
				<if test="inviteNoList != null">
					AND INVITEVEHICLE.INVITE_NO  IN
					<foreach collection="inviteNoList" close=")" open="(" index="index" item="item" separator=",">
						#{item}
					</foreach>
				</if>
			</where>
			ORDER BY 
					INVITEVEHICLE.PREDICT_USE_TIME - INVITEVEHICLE.APPLY_TIME, 
					INVITEVEHICLE.PREDICT_USE_TIME - sysdate
		) inv
	GROUP BY inv.INVITE_NO
	</select>
	<!-- getCount  -->
	<select id="queryCount"  resultType="Long" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.InviteVehicleDto">
		SELECT 
			COUNT(1)
		FROM
			(
				SELECT
						  inv.INVITE_NO
				FROM (
						SELECT 
							INVITEVEHICLE.INVITE_NO
						FROM TFR.T_OPT_INVITE_VEHICLE INVITEVEHICLE 
							LEFT JOIN TFR.T_OPT_PASS_INVITE_APPLY PASSINVITEAPPLY  
								ON INVITEVEHICLE.INVITE_NO = PASSINVITEAPPLY	.INVITE_NO AND INVITEVEHICLE.STATUS NOT IN('REJECT', 'RETURN') /**只有非拒绝与退回状态才关联查询通过状态的表*/
							LEFT JOIN BSE.T_BAS_VEHICLE_TYPE_LENGTH VEHICLE_TYPE_LENGTH ON 
									  VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_CODE = INVITEVEHICLE.ORDER_VEHICLE_MODEL AND VEHICLE_TYPE_LENGTH.ACTIVE ='Y'
							LEFT JOIN BSE.T_BAS_ORG BAS_ORG1 ON BAS_ORG1.CODE = INVITEVEHICLE.DISPATCH_TRANS_DEPT AND BAS_ORG1.ACTIVE ='Y'
							LEFT JOIN BSE.T_BAS_ORG BAS_ORG2 ON BAS_ORG2.CODE = INVITEVEHICLE.ARRIVED_DEPT_CODE AND BAS_ORG2.ACTIVE ='Y'
							LEFT JOIN BSE.T_BAS_LEASED_TRUCK BAS_LEASED_TRUCK ON PASSINVITEAPPLY.VEHICLE_NO = BAS_LEASED_TRUCK.VEHICLE_NO AND  BAS_LEASED_TRUCK.ACTIVE = 'Y' AND BAS_LEASED_TRUCK.STATUS = 'Y'
							LEFT JOIN BSE.T_BAS_LINE BAS_LINE ON BAS_LINE.SIMPLE_CODE = BAS_LEASED_TRUCK.BARGAIN_ROUTE AND BAS_LINE.ACTIVE = 'Y' AND INVITEVEHICLE.IS_CONTRACT_VEHICLE = 'Y' /**只有合同车才关联查询合同线路表*/
						where (INVITEVEHICLE.APPLY_ORG_CODE = #{currentDeptCode} OR INVITEVEHICLE.APPLY_ORG_CODE = #{currentTransferCenterCode} OR INVITEVEHICLE.DISPATCH_TRANS_DEPT = #{currentDeptCode} OR INVITEVEHICLE.TOP_FLEET_CODE = #{topFleetCode})
							<if test="status != null and status !=''">
								AND INVITEVEHICLE.STATUS  = #{status}   
							</if>
							<if test="inviteNo != null and inviteNo !=''">
								AND INVITEVEHICLE.INVITE_NO  =  #{inviteNo}   
							</if>
							<if test="applyTime != null and applyTime !=''">
								AND INVITEVEHICLE.APPLY_TIME = #{applyTime}    
							</if>
							<if test="usePurpose != null and usePurpose !=''">
								AND INVITEVEHICLE.USE_PURPOSE  =  #{usePurpose}   
							</if>
							<if test="useType != null and useType !=''">
								AND INVITEVEHICLE.USE_TYPE =  #{useType}   
							</if>
							<if test="orderVehicleModel != null and orderVehicleModel !=''">
								AND INVITEVEHICLE.ORDER_VEHICLE_MODEL =  #{orderVehicleModel}   
							</if>
							<if test="predictUseTime != null and predictUseTime !=''">
								AND INVITEVEHICLE.PREDICT_USE_TIME = #{predictUseTime}    
							</if>
							<if test="useAddress != null and useAddress !=''">
								AND INVITEVEHICLE.USE_ADDRESS  =  #{useAddress}   
							</if>
							<if test="clientName != null and clientName !=''">
								AND INVITEVEHICLE.CLIENT_NAME  = #{clientName}   
							</if>
							<if test="clientContactPhone != null and clientContactPhone !=''">
								AND INVITEVEHICLE.CLIENT_CONTACT_PHONE = #{clientContactPhone}   
							</if>
							<if test="requirment != null and requirment !=''">
								AND INVITEVEHICLE.REQUIRMENT = #{requirment}   
							</if>
							<if test="dispatchTransDept != null and dispatchTransDept !=''">
								AND INVITEVEHICLE.DISPATCH_TRANS_DEPT = #{dispatchTransDept}   
							</if>
							<if test="applyOrgName != null and applyOrgName !=''">
								AND INVITEVEHICLE.APPLY_ORG_NAME = #{applyOrgName}   
							</if>
							<if test="applyOrgCode != null and applyOrgCode !=''">
								AND INVITEVEHICLE.APPLY_ORG_CODE = #{applyOrgCode}   
							</if>
							<if test="applyEmpName != null and applyEmpName !=''">
								AND INVITEVEHICLE.APPLY_EMP_NAME = #{applyEmpName}   
							</if>
							<if test="applyEmpCode != null and applyEmpCode !=''">
								AND INVITEVEHICLE.APPLY_EMP_CODE = #{applyEmpCode}   
							</if>
							<if test="beginInviteCostStr != null and beginInviteCostStr != ''">
								<![CDATA[ 
									AND INVITEVEHICLE.TOTAL_INVITE_COST >= #{beginInviteCostStr} * 100
								]]>
							</if>
							<if test="endInviteCostStr != null and endInviteCostStr != ''">
								<![CDATA[ 
									AND INVITEVEHICLE.TOTAL_INVITE_COST  <= #{endInviteCostStr} * 100
								]]>
							</if>
							<if test="vehicleLengthName != null and  vehicleLengthName != ''">
								AND VEHICLE_TYPE_LENGTH.VEHICLE_LENGTH_NAME LIKE '%'||#{vehicleLengthName}||'%'
							</if>
							<if test="beginAuditTime != null and  endAuditTime != null">
								AND PASSINVITEAPPLY.PASS_TIME BETWEEN #{beginAuditTime}  AND #{endAuditTime}
							</if>
							<if test="beginAuditTime != null and  endAuditTime == null">
								<![CDATA[ 
									AND PASSINVITEAPPLY.PASS_TIME >= #{beginAuditTime}  
								]]>
							</if>
							<if test="beginAuditTime == null and  endAuditTime != null">
								<![CDATA[ 
									AND PASSINVITEAPPLY.PASS_TIME <= #{endAuditTime}  
								]]>
							</if>
							<if test="beginPredictUseTime != null and  endPredictUseTime != null">
								AND INVITEVEHICLE.PREDICT_USE_TIME BETWEEN #{beginPredictUseTime}  AND #{endPredictUseTime}
							</if>
							<if test="beginPredictUseTime != null and  endPredictUseTime == null">
								<![CDATA[ 
									AND INVITEVEHICLE.PREDICT_USE_TIME >= #{beginPredictUseTime}  
								]]>
							</if>
							<if test="beginPredictUseTime == null and  endPredictUseTime != null">
								<![CDATA[ 
									AND PASSINVITEAPPLY.PERDICT_ARRIVE_TIME <= #{endPredictUseTime}  
								]]>
							</if>
							
							<if test="inviteNoList != null">
								AND INVITEVEHICLE.INVITE_NO  IN
								<foreach collection="inviteNoList" close=")" open="(" index="index" item="item" separator=",">
									#{item}
								</foreach>
							</if>
							<if test="inviteVehicleStatusList != null">
								AND INVITEVEHICLE.STATUS IN
								<foreach collection="inviteVehicleStatusList" close=")" open="(" index="index" item="item" separator=",">
									#{item}
								</foreach>
							</if>
							<if test="isReturn != null and isReturn != ''">
								<![CDATA[ 
									AND INVITEVEHICLE.IS_RETURN = #{isReturn}
								]]>
							</if>
							<if test="beginReturnCostStr != null and beginReturnCostStr != ''">
								<![CDATA[ 
									AND INVITEVEHICLE.RETURN_COST >= #{beginReturnCostStr} * 100
								]]>
							</if>
							<if test="endReturnCostStr != null and endReturnCostStr != ''">
								<![CDATA[ 
									AND INVITEVEHICLE.RETURN_COST  <= #{endReturnCostStr} * 100
								]]>
							</if>
							<if test="isContractVehicle != null and  isContractVehicle != ''">
								AND INVITEVEHICLE.IS_CONTRACT_VEHICLE =  #{isContractVehicle} 
							</if>
							<if test="contractLineCode != null and  contractLineCode != ''">
								AND INVITEVEHICLE.CONTRACT_LINE_CODE =  #{contractLineCode} 
							</if>
							<if test="vehicleNo != null and vehicleNo !=''">
								AND PASSINVITEAPPLY.VEHICLE_NO = #{vehicleNo}   
							</if>
							<if test="useStatus != null and useStatus !=''">
								AND INVITEVEHICLE.USE_STATUS = #{useStatus}   
							</if>
							<if test="contractLine != null and contractLine !=''">
								AND BAS_LINE.LINE_NAME LIKE '%'||#{vehicleLengthName}
							</if>
						ORDER BY 
								INVITEVEHICLE.PREDICT_USE_TIME - INVITEVEHICLE.APPLY_TIME, 
								INVITEVEHICLE.PREDICT_USE_TIME - sysdate
					) inv
				GROUP BY inv.INVITE_NO  
			)
	</select>
	
	<!-- 根据车牌号查询外请车使用信息 -->
	<select id="queryInviteUseStatus" parameterType="String" resultMap="InviteVehicleResultMap">
		SELECT
			<include refid="INVITEVEHICLE_USE_STATUS"/> 
			 FROM TFR.T_OPT_INVITE_VEHICLE INVITEVEHICLE ,TFR.T_OPT_PASS_INVITE_APPLY INVITEAPPLY
			 WHERE INVITEVEHICLE.INVITE_NO = INVITEAPPLY.INVITE_NO
			 AND INVITEAPPLY.VEHICLE_NO=#{vehicleNo}
			 AND TO_CHAR(INVITEVEHICLE.PREDICT_USE_TIME,'YYYY-MM-DD') = TO_CHAR(SYSDATE,'YYYY-MM-DD')
        	 ORDER BY INVITEVEHICLE.PREDICT_USE_TIME DESC 
	</select>
	
	<!-- 查询集合 -->
	<select id="queryInviteVehicleListByNeedPassRecord" resultMap="InviteVehicleResultMap"  parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.InviteVehicleDto">
		SELECT 
			<include refid="InviteVehicleall_column"/>
			<include refid="queryInviteVehicleList_Sql"/>
	      where INVITEVEHICLE.TOP_FLEET_CODE = #{topFleetCode}
			<if test="inviteVehicleStatusList != null">
				AND INVITEVEHICLE.STATUS IN
				<foreach collection="inviteVehicleStatusList" close=")" open="(" index="index" item="item" separator=",">
					#{item}
				</foreach>
			</if>
			<if test="inviteNoList !=null and inviteNoList !=''">
				AND INVITEVEHICLE.INVITE_NO IN 
				<foreach collection="inviteNoList" close=")" open="(" index="index" item="item" separator=",">
					#{item}
				</foreach>
			</if>
			<!--
		    AND ((INVITEVEHICLE.USE_PURPOSE = 'WHOLECAR_ORDER'
	        	AND INVITEVEHICLE.PREDICT_USE_TIME >= #{predictUseTime}) 
	            OR (INVITEVEHICLE.USE_PURPOSE = 'INVITE_ORDER'))
	        -->
		ORDER BY 
		INVITEVEHICLE.PREDICT_USE_TIME - INVITEVEHICLE.APPLY_TIME, 
		INVITEVEHICLE.PREDICT_USE_TIME - sysdate   
	</select>
	<select id="queryCheckVehicleArriveRuleList" resultType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.InviteVehicleDto" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.InviteVehicleDto">
		select a.STATUS as status
		     , a.USE_STATUS as useStatus
		     , b.VEHICLE_NO as vehicleNo
		     , a.INVITE_NO as inviteNo
		     , a.APPLY_ORG_NAME as applyOrgName
		     , a.APPLY_ORG_CODE as applyOrgCode
		    from tfr.T_OPT_INVITE_VEHICLE a
		        ,tfr.T_OPT_PASS_INVITE_APPLY b
		    where a.INVITE_NO = b.INVITE_NO(+)
		      and a.INVITE_NO != #{inviteNo}
		      and b.VEHICLE_NO = #{vehicleNo}
		      and a.STATUS = #{status}
		      and b.USE_STATUS = #{useStatus}
	</select>
	<select id="queryInviteVehicleByNo" resultMap="InviteVehicleResultMap"  parameterType="string">
		select a.STATUS as status
		     , b.USE_STATUS as useStatus
		     , b.VEHICLE_NO as vehicleNo
		     , a.INVITE_NO as inviteNo
		     , a.INVITE_VEHICLE_ID as id
	      from TFR.T_OPT_INVITE_VEHICLE a
	          ,TFR.T_OPT_PASS_INVITE_APPLY b
	      where a.INVITE_NO = b.INVITE_NO(+)
	        and a.INVITE_NO = #{inviteNo}
	</select>
	<!-- 用外请车查询配载车次号(配载单号) -->
	<select id="queryVehicleassemblebillByInviteNo" resultType="string"  parameterType="string">
		SELECT
			VEHICLEASSEMBLEBILL.vehicleassemble_no AS vehicleassembleNo 
		FROM 
			tfr.T_OPT_VEHICLEASSEMBLEBILL VEHICLEASSEMBLEBILL
		WHERE 
			VEHICLEASSEMBLEBILL.invite_no = #{inviteNo}
		AND VEHICLEASSEMBLEBILL.state <![CDATA[<>]]> 90 <!-- 90 表示作废状态 -->
	</select>
	<select id="queryInviteVehicleInfo" resultType="string"  parameterType="string">
		SELECT
  			PIA.VEHICLE_NO
		FROM
  			TFR.T_OPT_INVITE_VEHICLE IV
			LEFT JOIN TFR.T_OPT_PASS_INVITE_APPLY PIA　ON  PIA.INVITE_NO = IV.INVITE_NO
		WHERE
	    IV.INVITE_NO = #{inviteNo,jdbcType=VARCHAR}
	</select>
</mapper>