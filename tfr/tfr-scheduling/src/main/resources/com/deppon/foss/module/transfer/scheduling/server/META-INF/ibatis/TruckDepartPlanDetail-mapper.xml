<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="Foss.scheduling.TruckDepartPlanDetail" >
  <resultMap id="TruckDepartPlanDetailDtoResultMap" type="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >    
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="TRUCK_DEPART_PLAN_ID" property="truckDepartPlanId" jdbcType="VARCHAR" />
    <result column="PLAN_TYPE" property="planType" jdbcType="VARCHAR" />
    <result column="VEHICLE_NO" property="vehicleNo" jdbcType="VARCHAR" />
    <result column="LINE_NO" property="lineNo" jdbcType="VARCHAR" />
    <result column="DEPART_DATE" property="departDate" jdbcType="TIMESTAMP" />
    <result column="PLAN_DEPART_TIME" property="planDepartTime" jdbcType="TIMESTAMP" />
    <result column="FREQUENCY_NO" property="frequencyNo" jdbcType="VARCHAR" />
    <result column="ORIG_ORG_CODE" property="origOrgCode" jdbcType="VARCHAR" />
    <result column="DEST_ORG_CODE" property="destOrgCode" jdbcType="VARCHAR" />
    <result column="PLATFORM_DISTRIBUTE_ID" property="platformDistributeId" jdbcType="VARCHAR" />
    <result column="IS_ON_SCHEDULING" property="isOnScheduling" jdbcType="CHAR" />
    <result column="FREQUENCY_TYPE" property="frequencyType" jdbcType="VARCHAR" />
    <result column="TRUCK_MODEL" property="truckModel" jdbcType="VARCHAR" />
    <result column="TRUCK_MODEL_VALUE" property="truckModelValue" jdbcType="VARCHAR" />
    <result column="TRUCK_TYPE" property="truckType" jdbcType="VARCHAR" />
    <result column="TRUCK_ARRIVE_TIME" property="truckArriveTime" jdbcType="TIMESTAMP" />
    <result column="CONTAINER_NO" property="containerNo" jdbcType="VARCHAR" />
    <result column="MAX_LOAD_WEIGHT" property="maxLoadWeight" jdbcType="DECIMAL" />
    <result column="ACTUAL_MAX_LOAD_WEIGHT" property="actualMaxLoadWeight" jdbcType="DECIMAL" />
    <result column="TRUCK_VOLUME" property="truckVolume" jdbcType="DECIMAL" />
    <result column="PLAN_LOAD_WEIGHT" property="planLoadWeight" jdbcType="DECIMAL" />
    <result column="PLAN_LOAD_VOLUME" property="planLoadVolume" jdbcType="DECIMAL" />
    <result column="TRUCK_INFO_NOTES" property="truckInfoNotes" jdbcType="VARCHAR" />
    <result column="DRIVER_CODE1" property="driverCode1" jdbcType="VARCHAR" />
    <result column="DRIVER_NAME1" property="driverName1" jdbcType="VARCHAR" />
    <result column="DRIVER_PHONE1" property="driverPhone1" jdbcType="VARCHAR" />
    <result column="DRIVER_CODE2" property="driverCode2" jdbcType="VARCHAR" />
    <result column="DRIVER_NAME2" property="driverName2" jdbcType="VARCHAR" />
    <result column="DRIVER_PHONE2" property="driverPhone2" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="CREATE_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
    <result column="CREATE_USER_NAME" property="createUserName" jdbcType="VARCHAR" />
    <result column="CREATE_ORG_CODE" property="createOrgCode" jdbcType="VARCHAR" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="UPDATE_USER_CODE" property="updateUserCode" jdbcType="VARCHAR" />
    <result column="UPDATE_USER_NAME" property="updateUserName" jdbcType="VARCHAR" />
    <result column="UPDATE_ORG_CODE" property="updateOrgCode" jdbcType="VARCHAR" />
    <result column="LINE_NAME" property="lineName" jdbcType="VARCHAR" />
    <result column="PLAN_ARRIVE_TIME" property="planArriveTime" jdbcType="TIMESTAMP" />
    <result column="PLATFORM_TIME_START" property="platformTimeStart" jdbcType="TIMESTAMP" />
    <result column="PLATFORM_TIME_END" property="platformTimeEnd" jdbcType="TIMESTAMP" />
    <result column="PLAN_STATUS" property="planStatus" jdbcType="VARCHAR" />
    <result column="LONG_CAR_GROUP" property="longCarGroup" jdbcType="VARCHAR" />
    <result column="PLATFORM_NO" property="platformNo" jdbcType="VARCHAR" />
    <result column="INIT_FLAG" property="initFlag" jdbcType="VARCHAR" />
    <result column="HAS_LEFT" property="hasLeft" jdbcType="VARCHAR" />
    <result column="SCHEDULE_TASK_ID" property="scheduleTaskId" jdbcType="VARCHAR" />
    <result column="trailer_VehicleNo" property="trailerVehicleNo" jdbcType="VARCHAR"/>
  </resultMap>
 
  <!--计划及计划明细两张表-->
  <sql id="TruckDepartPlanDetail_Column_List" >    
    detail.ID, detail.TRUCK_DEPART_PLAN_ID, detail.PLAN_TYPE, detail.VEHICLE_NO, detail.LINE_NO, detail.DEPART_DATE, detail.PLAN_DEPART_TIME, 
    detail.FREQUENCY_NO, detail.ORIG_ORG_CODE, detail.DEST_ORG_CODE, detail.PLATFORM_DISTRIBUTE_ID, detail.IS_ON_SCHEDULING, 
    detail.FREQUENCY_TYPE, detail.TRUCK_MODEL, detail.TRUCK_TYPE, detail.TRUCK_ARRIVE_TIME, detail.CONTAINER_NO, detail.MAX_LOAD_WEIGHT, 
    detail.ACTUAL_MAX_LOAD_WEIGHT, detail.TRUCK_VOLUME, detail.PLAN_LOAD_WEIGHT, detail.PLAN_LOAD_VOLUME, detail.TRUCK_INFO_NOTES, 
    detail.DRIVER_CODE1, detail.DRIVER_NAME1, detail.DRIVER_PHONE1, detail.DRIVER_CODE2, detail.DRIVER_NAME2, detail.DRIVER_PHONE2, 
    detail.STATUS, detail.CREATE_TIME, detail.CREATE_USER_CODE, detail.CREATE_USER_NAME, detail.CREATE_ORG_CODE, detail.UPDATE_TIME, 
    detail.UPDATE_USER_CODE, detail.UPDATE_USER_NAME, detail.UPDATE_ORG_CODE, detail.LINE_NAME, detail.PLAN_ARRIVE_TIME,detail.PLAN_STATUS,
    detail.PLATFORM_TIME_START,detail.PLATFORM_TIME_END,detail.LONG_CAR_GROUP,detail.INIT_FLAG,plt.PLATFORM_NO
  </sql>
  
  <!--计划明细两张表-->
  <sql id="TruckDepartPlanDetail_Column_Only_List" >    
    detail.ID, detail.TRUCK_DEPART_PLAN_ID, detail.PLAN_TYPE, detail.VEHICLE_NO, detail.LINE_NO, detail.DEPART_DATE, detail.PLAN_DEPART_TIME, 
    detail.FREQUENCY_NO, detail.ORIG_ORG_CODE, detail.DEST_ORG_CODE, detail.PLATFORM_DISTRIBUTE_ID, detail.IS_ON_SCHEDULING, 
    detail.FREQUENCY_TYPE, detail.TRUCK_MODEL, detail.TRUCK_TYPE, detail.TRUCK_ARRIVE_TIME, detail.CONTAINER_NO, detail.MAX_LOAD_WEIGHT, 
    detail.ACTUAL_MAX_LOAD_WEIGHT, detail.TRUCK_VOLUME, detail.PLAN_LOAD_WEIGHT, detail.PLAN_LOAD_VOLUME, detail.TRUCK_INFO_NOTES, 
    detail.DRIVER_CODE1, detail.DRIVER_NAME1, detail.DRIVER_PHONE1, detail.DRIVER_CODE2, detail.DRIVER_NAME2, detail.DRIVER_PHONE2, 
    detail.STATUS, detail.CREATE_TIME, detail.CREATE_USER_CODE, detail.CREATE_USER_NAME, detail.CREATE_ORG_CODE, detail.UPDATE_TIME, 
    detail.UPDATE_USER_CODE, detail.UPDATE_USER_NAME, detail.UPDATE_ORG_CODE, detail.LINE_NAME, detail.PLAN_ARRIVE_TIME,detail.PLAN_STATUS,
    detail.PLATFORM_TIME_START,detail.PLATFORM_TIME_END,detail.LONG_CAR_GROUP,detail.INIT_FLAG,detail.HAS_LEFT,detail.trailer_VehicleNo
  </sql>
  
  <!--计划明细和车型-->
  <sql id="TruckDepartPlanDetail_Column_vehicle_List" >    
    detail.ID, detail.TRUCK_DEPART_PLAN_ID, detail.PLAN_TYPE, detail.VEHICLE_NO, detail.LINE_NO, detail.DEPART_DATE, detail.PLAN_DEPART_TIME, 
    detail.FREQUENCY_NO, detail.ORIG_ORG_CODE, detail.DEST_ORG_CODE, detail.PLATFORM_DISTRIBUTE_ID, detail.IS_ON_SCHEDULING, 
    detail.FREQUENCY_TYPE, detail.TRUCK_MODEL, detail.TRUCK_TYPE, detail.TRUCK_ARRIVE_TIME, detail.CONTAINER_NO, detail.MAX_LOAD_WEIGHT, 
    detail.ACTUAL_MAX_LOAD_WEIGHT, detail.TRUCK_VOLUME, detail.PLAN_LOAD_WEIGHT, detail.PLAN_LOAD_VOLUME, detail.TRUCK_INFO_NOTES, 
    detail.DRIVER_CODE1, detail.DRIVER_NAME1, detail.DRIVER_PHONE1, detail.DRIVER_CODE2, detail.DRIVER_NAME2, detail.DRIVER_PHONE2, 
    detail.STATUS, detail.CREATE_TIME, detail.CREATE_USER_CODE, detail.CREATE_USER_NAME, detail.CREATE_ORG_CODE, detail.UPDATE_TIME, 
    detail.UPDATE_USER_CODE, detail.UPDATE_USER_NAME, detail.UPDATE_ORG_CODE, detail.LINE_NAME, detail.PLAN_ARRIVE_TIME,detail.PLAN_STATUS,
    detail.PLATFORM_TIME_START,detail.PLATFORM_TIME_END,detail.LONG_CAR_GROUP,detail.INIT_FLAG,detail.HAS_LEFT,
    vtl.vehicle_length_name as TRUCK_MODEL_VALUE,detail.SCHEDULE_TASK_ID,detail.trailer_VehicleNo
  </sql>
  
  <!--计划明细和车型和月台号-->
  <sql id="TruckDepartPlanDetail_Column_Vehicle_Platform_List" >    
    detail.ID, detail.TRUCK_DEPART_PLAN_ID, detail.PLAN_TYPE, detail.VEHICLE_NO, detail.LINE_NO, detail.DEPART_DATE, detail.PLAN_DEPART_TIME, 
    detail.FREQUENCY_NO, detail.ORIG_ORG_CODE, detail.DEST_ORG_CODE, detail.PLATFORM_DISTRIBUTE_ID, detail.IS_ON_SCHEDULING, 
    detail.FREQUENCY_TYPE, detail.TRUCK_MODEL, detail.TRUCK_TYPE, detail.TRUCK_ARRIVE_TIME, detail.CONTAINER_NO, detail.MAX_LOAD_WEIGHT, 
    detail.ACTUAL_MAX_LOAD_WEIGHT, detail.TRUCK_VOLUME, detail.PLAN_LOAD_WEIGHT, detail.PLAN_LOAD_VOLUME, detail.TRUCK_INFO_NOTES, 
    detail.DRIVER_CODE1, detail.DRIVER_NAME1, detail.DRIVER_PHONE1, detail.DRIVER_CODE2, detail.DRIVER_NAME2, detail.DRIVER_PHONE2, 
    detail.STATUS, detail.CREATE_TIME, detail.CREATE_USER_CODE, detail.CREATE_USER_NAME, detail.CREATE_ORG_CODE, detail.UPDATE_TIME, 
    detail.UPDATE_USER_CODE, detail.UPDATE_USER_NAME, detail.UPDATE_ORG_CODE, detail.LINE_NAME, detail.PLAN_ARRIVE_TIME,detail.PLAN_STATUS,
    detail.PLATFORM_TIME_START,detail.PLATFORM_TIME_END,detail.LONG_CAR_GROUP,detail.INIT_FLAG,detail.HAS_LEFT,
    vtl.vehicle_length_name as TRUCK_MODEL_VALUE,detail.SCHEDULE_TASK_ID,detail.PLATFORM_NO,detail.trailer_VehicleNo
  </sql>
  
  <!-- 根据ID列表删除明细 -->
  <update id="deleteTruckDepartPlanDetail" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >    
    update  TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL detail
    set detail.STATUS =#{status,jdbcType=VARCHAR}   
    where detail.INIT_FLAG =#{initFlag,jdbcType=VARCHAR} /**非导入状态N**/
    	and detail.HAS_LEFT = #{hasLeft,jdbcType=VARCHAR}/**未出发状态N**/
         and detail.ID in
        <foreach collection="list" item="item" open="(" close=")" separator=",">
     	    #{item,jdbcType=VARCHAR}
        </foreach>    
  </update>
  
  <!-- 新增单条计划明细 -->
  <insert id="addTruckDepartPlanDetail" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >    
    insert into TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL (ID, TRUCK_DEPART_PLAN_ID, PLAN_TYPE, 
      VEHICLE_NO, LINE_NO, DEPART_DATE, 
      PLAN_DEPART_TIME, FREQUENCY_NO, ORIG_ORG_CODE, 
      DEST_ORG_CODE, PLATFORM_DISTRIBUTE_ID, IS_ON_SCHEDULING, 
      FREQUENCY_TYPE, TRUCK_MODEL, TRUCK_TYPE, 
      TRUCK_ARRIVE_TIME, CONTAINER_NO, MAX_LOAD_WEIGHT, 
      ACTUAL_MAX_LOAD_WEIGHT, TRUCK_VOLUME, PLAN_LOAD_WEIGHT, 
      PLAN_LOAD_VOLUME, TRUCK_INFO_NOTES, DRIVER_CODE1, 
      DRIVER_NAME1, DRIVER_PHONE1, DRIVER_CODE2, 
      DRIVER_NAME2, DRIVER_PHONE2, STATUS, 
      CREATE_TIME, CREATE_USER_CODE, CREATE_USER_NAME, 
      CREATE_ORG_CODE, UPDATE_TIME, UPDATE_USER_CODE, 
      UPDATE_USER_NAME, UPDATE_ORG_CODE, LINE_NAME, 
      PLAN_ARRIVE_TIME,PLAN_STATUS,PLATFORM_TIME_START,
      PLATFORM_TIME_END,LONG_CAR_GROUP,INIT_FLAG,HAS_LEFT,
      PLATFORM_NO,trailer_VehicleNo)
    values (#{id,jdbcType=VARCHAR}, #{truckDepartPlanId,jdbcType=VARCHAR}, #{planType,jdbcType=VARCHAR}, 
      #{vehicleNo,jdbcType=VARCHAR}, #{lineNo,jdbcType=VARCHAR}, #{departDate,jdbcType=TIMESTAMP}, 
      #{planDepartTime,jdbcType=TIMESTAMP}, #{frequencyNo,jdbcType=VARCHAR}, #{origOrgCode,jdbcType=VARCHAR}, 
      #{destOrgCode,jdbcType=VARCHAR}, #{platformDistributeId,jdbcType=VARCHAR}, #{isOnScheduling,jdbcType=CHAR}, 
      #{frequencyType,jdbcType=VARCHAR}, #{truckModel,jdbcType=VARCHAR}, #{truckType,jdbcType=VARCHAR}, 
      #{truckArriveTime,jdbcType=TIMESTAMP}, #{containerNo,jdbcType=VARCHAR}, #{maxLoadWeight,jdbcType=DECIMAL}, 
      #{actualMaxLoadWeight,jdbcType=DECIMAL}, #{truckVolume,jdbcType=DECIMAL}, #{planLoadWeight,jdbcType=DECIMAL}, 
      #{planLoadVolume,jdbcType=DECIMAL}, #{truckInfoNotes,jdbcType=VARCHAR}, #{driverCode1,jdbcType=VARCHAR}, 
      #{driverName1,jdbcType=VARCHAR}, #{driverPhone1,jdbcType=VARCHAR}, #{driverCode2,jdbcType=VARCHAR}, 
      #{driverName2,jdbcType=VARCHAR}, #{driverPhone2,jdbcType=VARCHAR}, #{status,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=TIMESTAMP}, #{createUserCode,jdbcType=VARCHAR}, #{createUserName,jdbcType=VARCHAR}, 
      #{createOrgCode,jdbcType=VARCHAR}, #{updateTime,jdbcType=TIMESTAMP}, #{updateUserCode,jdbcType=VARCHAR}, 
      #{updateUserName,jdbcType=VARCHAR}, #{updateOrgCode,jdbcType=VARCHAR}, #{lineName,jdbcType=VARCHAR}, 
      #{planArriveTime,jdbcType=TIMESTAMP},#{planStatus,jdbcType=VARCHAR},#{platformTimeStart,jdbcType=TIMESTAMP},
      #{platformTimeEnd,jdbcType=TIMESTAMP}, #{longCarGroup,jdbcType=VARCHAR}, #{initFlag,jdbcType=VARCHAR},
      #{hasLeft,jdbcType=VARCHAR},#{platformNo,jdbcType=VARCHAR},#{trailerVehicleNo,jdbcType=VARCHAR})
  </insert>
  
  
    <!--批量新增计划明细-->
  <insert id="batchAddTruckDepartPlanDetail" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDto" >
  	BEGIN 
		<foreach collection="list" item="item"  separator=";">
		    insert into TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL (ID, TRUCK_DEPART_PLAN_ID, PLAN_TYPE, 
		      VEHICLE_NO, LINE_NO, DEPART_DATE, 
		      PLAN_DEPART_TIME, FREQUENCY_NO, ORIG_ORG_CODE, 
		      DEST_ORG_CODE, PLATFORM_DISTRIBUTE_ID, IS_ON_SCHEDULING, 
		      FREQUENCY_TYPE, TRUCK_MODEL, TRUCK_TYPE, 
		      TRUCK_ARRIVE_TIME, CONTAINER_NO, MAX_LOAD_WEIGHT, 
		      ACTUAL_MAX_LOAD_WEIGHT, TRUCK_VOLUME, PLAN_LOAD_WEIGHT, 
		      PLAN_LOAD_VOLUME, TRUCK_INFO_NOTES, DRIVER_CODE1, 
		      DRIVER_NAME1, DRIVER_PHONE1, DRIVER_CODE2, 
		      DRIVER_NAME2, DRIVER_PHONE2, STATUS, 
		      CREATE_TIME, CREATE_USER_CODE, CREATE_USER_NAME, 
		      CREATE_ORG_CODE, UPDATE_TIME, UPDATE_USER_CODE, 
		      UPDATE_USER_NAME, UPDATE_ORG_CODE, LINE_NAME, 
		      PLAN_ARRIVE_TIME,PLAN_STATUS,PLATFORM_TIME_START
		      ,PLATFORM_TIME_END,LONG_CAR_GROUP,INIT_FLAG,HAS_LEFT,SCHEDULE_TASK_ID)
		    values (#{item.id,jdbcType=VARCHAR}, #{item.truckDepartPlanId,jdbcType=VARCHAR}, #{item.planType,jdbcType=VARCHAR}, 
		      #{item.vehicleNo,jdbcType=VARCHAR}, #{item.lineNo,jdbcType=VARCHAR}, #{item.departDate,jdbcType=TIMESTAMP}, 
		      #{item.planDepartTime,jdbcType=TIMESTAMP}, #{item.frequencyNo,jdbcType=VARCHAR}, #{item.origOrgCode,jdbcType=VARCHAR}, 
		      #{item.destOrgCode,jdbcType=VARCHAR}, #{item.platformDistributeId,jdbcType=VARCHAR}, #{item.isOnScheduling,jdbcType=CHAR}, 
		      #{item.frequencyType,jdbcType=VARCHAR}, #{item.truckModel,jdbcType=VARCHAR}, #{item.truckType,jdbcType=VARCHAR}, 
		      #{item.truckArriveTime,jdbcType=TIMESTAMP}, #{item.containerNo,jdbcType=VARCHAR}, #{item.maxLoadWeight,jdbcType=DECIMAL}, 
		      #{item.actualMaxLoadWeight,jdbcType=DECIMAL}, #{item.truckVolume,jdbcType=DECIMAL}, #{item.planLoadWeight,jdbcType=DECIMAL}, 
		      #{item.planLoadVolume,jdbcType=DECIMAL}, #{item.truckInfoNotes,jdbcType=VARCHAR}, #{item.driverCode1,jdbcType=VARCHAR}, 
		      #{item.driverName1,jdbcType=VARCHAR}, #{item.driverPhone1,jdbcType=VARCHAR}, #{item.driverCode2,jdbcType=VARCHAR}, 
		      #{item.driverName2,jdbcType=VARCHAR}, #{item.driverPhone2,jdbcType=VARCHAR}, #{item.status,jdbcType=VARCHAR}, 
		      #{item.createTime,jdbcType=TIMESTAMP}, #{item.createUserCode,jdbcType=VARCHAR}, #{item.createUserName,jdbcType=VARCHAR}, 
		      #{item.createOrgCode,jdbcType=VARCHAR}, #{item.updateTime,jdbcType=TIMESTAMP}, #{item.updateUserCode,jdbcType=VARCHAR}, 
		      #{item.updateUserName,jdbcType=VARCHAR}, #{item.updateOrgCode,jdbcType=VARCHAR}, #{item.lineName,jdbcType=VARCHAR}, 
		      #{item.planArriveTime,jdbcType=TIMESTAMP},#{item.planStatus,jdbcType=VARCHAR},#{item.platformTimeStart,jdbcType=TIMESTAMP},
     		 #{item.platformTimeEnd,jdbcType=TIMESTAMP}, #{item.longCarGroup,jdbcType=VARCHAR}, #{item.initFlag,jdbcType=VARCHAR},
     		 #{item.hasLeft,jdbcType=VARCHAR}, #{item.scheduleTaskId,jdbcType=VARCHAR})
	    </foreach>
		;END;    
  </insert>
  
    <!--批量新增计划明细单条-->
  <insert id="batchAddTruckDepartPlanDetailOne" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >  
		    insert into TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL (ID, TRUCK_DEPART_PLAN_ID, PLAN_TYPE, 
		      VEHICLE_NO, LINE_NO, DEPART_DATE, 
		      PLAN_DEPART_TIME, FREQUENCY_NO, ORIG_ORG_CODE, 
		      DEST_ORG_CODE, PLATFORM_DISTRIBUTE_ID, IS_ON_SCHEDULING, 
		      FREQUENCY_TYPE, TRUCK_MODEL, TRUCK_TYPE, 
		      TRUCK_ARRIVE_TIME, CONTAINER_NO, MAX_LOAD_WEIGHT, 
		      ACTUAL_MAX_LOAD_WEIGHT, TRUCK_VOLUME, PLAN_LOAD_WEIGHT, 
		      PLAN_LOAD_VOLUME, TRUCK_INFO_NOTES, DRIVER_CODE1, 
		      DRIVER_NAME1, DRIVER_PHONE1, DRIVER_CODE2, 
		      DRIVER_NAME2, DRIVER_PHONE2, STATUS, 
		      CREATE_TIME, CREATE_USER_CODE, CREATE_USER_NAME, 
		      CREATE_ORG_CODE, UPDATE_TIME, UPDATE_USER_CODE, 
		      UPDATE_USER_NAME, UPDATE_ORG_CODE, LINE_NAME, 
		      PLAN_ARRIVE_TIME,PLAN_STATUS,PLATFORM_TIME_START
		      ,PLATFORM_TIME_END,LONG_CAR_GROUP,INIT_FLAG,HAS_LEFT,SCHEDULE_TASK_ID)
		    values (#{id,jdbcType=VARCHAR}, #{truckDepartPlanId,jdbcType=VARCHAR}, #{planType,jdbcType=VARCHAR}, 
		      #{vehicleNo,jdbcType=VARCHAR}, #{lineNo,jdbcType=VARCHAR}, #{departDate,jdbcType=TIMESTAMP}, 
		      #{planDepartTime,jdbcType=TIMESTAMP}, #{frequencyNo,jdbcType=VARCHAR}, #{origOrgCode,jdbcType=VARCHAR}, 
		      #{destOrgCode,jdbcType=VARCHAR}, #{platformDistributeId,jdbcType=VARCHAR}, #{isOnScheduling,jdbcType=CHAR}, 
		      #{frequencyType,jdbcType=VARCHAR}, #{truckModel,jdbcType=VARCHAR}, #{truckType,jdbcType=VARCHAR}, 
		      #{truckArriveTime,jdbcType=TIMESTAMP}, #{containerNo,jdbcType=VARCHAR}, #{maxLoadWeight,jdbcType=DECIMAL}, 
		      #{actualMaxLoadWeight,jdbcType=DECIMAL}, #{truckVolume,jdbcType=DECIMAL}, #{planLoadWeight,jdbcType=DECIMAL}, 
		      #{planLoadVolume,jdbcType=DECIMAL}, #{truckInfoNotes,jdbcType=VARCHAR}, #{driverCode1,jdbcType=VARCHAR}, 
		      #{driverName1,jdbcType=VARCHAR}, #{driverPhone1,jdbcType=VARCHAR}, #{driverCode2,jdbcType=VARCHAR}, 
		      #{driverName2,jdbcType=VARCHAR}, #{driverPhone2,jdbcType=VARCHAR}, #{status,jdbcType=VARCHAR}, 
		      #{createTime,jdbcType=TIMESTAMP}, #{createUserCode,jdbcType=VARCHAR}, #{createUserName,jdbcType=VARCHAR}, 
		      #{createOrgCode,jdbcType=VARCHAR}, #{updateTime,jdbcType=TIMESTAMP}, #{updateUserCode,jdbcType=VARCHAR}, 
		      #{updateUserName,jdbcType=VARCHAR}, #{updateOrgCode,jdbcType=VARCHAR}, #{lineName,jdbcType=VARCHAR}, 
		      #{planArriveTime,jdbcType=TIMESTAMP},#{planStatus,jdbcType=VARCHAR},#{platformTimeStart,jdbcType=TIMESTAMP},
     		 #{platformTimeEnd,jdbcType=TIMESTAMP}, #{longCarGroup,jdbcType=VARCHAR}, #{initFlag,jdbcType=VARCHAR},
     		 #{hasLeft,jdbcType=VARCHAR}, #{scheduleTaskId,jdbcType=VARCHAR})	      
  </insert>
  
  <insert id="insertSelective" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckDepartPlanDetailEntity" >   
    insert into TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="truckDepartPlanId != null" >
        TRUCK_DEPART_PLAN_ID,
      </if>
      <if test="planType != null" >
        PLAN_TYPE,
      </if>
      <if test="vehicleNo != null" >
        VEHICLE_NO,
      </if>
      <if test="lineNo != null" >
        LINE_NO,
      </if>
      <if test="departDate != null" >
        DEPART_DATE,
      </if>
      <if test="planDepartTime != null" >
        PLAN_DEPART_TIME,
      </if>
      <if test="frequencyNo != null" >
        FREQUENCY_NO,
      </if>
      <if test="origOrgCode != null" >
        ORIG_ORG_CODE,
      </if>
      <if test="destOrgCode != null" >
        DEST_ORG_CODE,
      </if>
      <if test="platformDistributeId != null" >
        PLATFORM_DISTRIBUTE_ID,
      </if>
      <if test="isOnScheduling != null" >
        IS_ON_SCHEDULING,
      </if>
      <if test="frequencyType != null" >
        FREQUENCY_TYPE,
      </if>
      <if test="truckModel != null" >
        TRUCK_MODEL,
      </if>
      <if test="truckType != null" >
        TRUCK_TYPE,
      </if>
      <if test="truckArriveTime != null" >
        TRUCK_ARRIVE_TIME,
      </if>
      <if test="containerNo != null" >
        CONTAINER_NO,
      </if>
      <if test="maxLoadWeight != null" >
        MAX_LOAD_WEIGHT,
      </if>
      <if test="actualMaxLoadWeight != null" >
        ACTUAL_MAX_LOAD_WEIGHT,
      </if>
      <if test="truckVolume != null" >
        TRUCK_VOLUME,
      </if>
      <if test="planLoadWeight != null" >
        PLAN_LOAD_WEIGHT,
      </if>
      <if test="planLoadVolume != null" >
        PLAN_LOAD_VOLUME,
      </if>
      <if test="truckInfoNotes != null" >
        TRUCK_INFO_NOTES,
      </if>
      <if test="driverCode1 != null" >
        DRIVER_CODE1,
      </if>
      <if test="driverName1 != null" >
        DRIVER_NAME1,
      </if>
      <if test="driverPhone1 != null" >
        DRIVER_PHONE1,
      </if>
      <if test="driverCode2 != null" >
        DRIVER_CODE2,
      </if>
      <if test="driverName2 != null" >
        DRIVER_NAME2,
      </if>
      <if test="driverPhone2 != null" >
        DRIVER_PHONE2,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="createTime != null" >
        CREATE_TIME,
      </if>
      <if test="createUserCode != null" >
        CREATE_USER_CODE,
      </if>
      <if test="createUserName != null" >
        CREATE_USER_NAME,
      </if>
      <if test="createOrgCode != null" >
        CREATE_ORG_CODE,
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME,
      </if>
      <if test="updateUserCode != null" >
        UPDATE_USER_CODE,
      </if>
      <if test="updateUserName != null" >
        UPDATE_USER_NAME,
      </if>
      <if test="updateOrgCode != null" >
        UPDATE_ORG_CODE,
      </if>
      <if test="lineName != null" >
        LINE_NAME,
      </if>
      <if test="planArriveTime != null" >
        PLAN_ARRIVE_TIME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="truckDepartPlanId != null" >
        #{truckDepartPlanId,jdbcType=VARCHAR},
      </if>
      <if test="planType != null" >
        #{planType,jdbcType=VARCHAR},
      </if>
      <if test="vehicleNo != null" >
        #{vehicleNo,jdbcType=VARCHAR},
      </if>
      <if test="lineNo != null" >
        #{lineNo,jdbcType=VARCHAR},
      </if>
      <if test="departDate != null" >
        #{departDate,jdbcType=TIMESTAMP},
      </if>
      <if test="planDepartTime != null" >
        #{planDepartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="frequencyNo != null" >
        #{frequencyNo,jdbcType=VARCHAR},
      </if>
      <if test="origOrgCode != null" >
        #{origOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="destOrgCode != null" >
        #{destOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="platformDistributeId != null" >
        #{platformDistributeId,jdbcType=VARCHAR},
      </if>
      <if test="isOnScheduling != null" >
        #{isOnScheduling,jdbcType=CHAR},
      </if>
      <if test="frequencyType != null" >
        #{frequencyType,jdbcType=VARCHAR},
      </if>
      <if test="truckModel != null" >
        #{truckModel,jdbcType=VARCHAR},
      </if>
      <if test="truckType != null" >
        #{truckType,jdbcType=VARCHAR},
      </if>
      <if test="truckArriveTime != null" >
        #{truckArriveTime,jdbcType=TIMESTAMP},
      </if>
      <if test="containerNo != null" >
        #{containerNo,jdbcType=VARCHAR},
      </if>
      <if test="maxLoadWeight != null" >
        #{maxLoadWeight,jdbcType=DECIMAL},
      </if>
      <if test="actualMaxLoadWeight != null" >
        #{actualMaxLoadWeight,jdbcType=DECIMAL},
      </if>
      <if test="truckVolume != null" >
        #{truckVolume,jdbcType=DECIMAL},
      </if>
      <if test="planLoadWeight != null" >
        #{planLoadWeight,jdbcType=DECIMAL},
      </if>
      <if test="planLoadVolume != null" >
        #{planLoadVolume,jdbcType=DECIMAL},
      </if>
      <if test="truckInfoNotes != null" >
        #{truckInfoNotes,jdbcType=VARCHAR},
      </if>
      <if test="driverCode1 != null" >
        #{driverCode1,jdbcType=VARCHAR},
      </if>
      <if test="driverName1 != null" >
        #{driverName1,jdbcType=VARCHAR},
      </if>
      <if test="driverPhone1 != null" >
        #{driverPhone1,jdbcType=VARCHAR},
      </if>
      <if test="driverCode2 != null" >
        #{driverCode2,jdbcType=VARCHAR},
      </if>
      <if test="driverName2 != null" >
        #{driverName2,jdbcType=VARCHAR},
      </if>
      <if test="driverPhone2 != null" >
        #{driverPhone2,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUserCode != null" >
        #{createUserCode,jdbcType=VARCHAR},
      </if>
      <if test="createUserName != null" >
        #{createUserName,jdbcType=VARCHAR},
      </if>
      <if test="createOrgCode != null" >
        #{createOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUserCode != null" >
        #{updateUserCode,jdbcType=VARCHAR},
      </if>
      <if test="updateUserName != null" >
        #{updateUserName,jdbcType=VARCHAR},
      </if>
      <if test="updateOrgCode != null" >
        #{updateOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="lineName != null" >
        #{lineName,jdbcType=VARCHAR},
      </if>
      <if test="planArriveTime != null" >
        #{planArriveTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  
  <!--根据ID主键查询发车计划明细及车辆信息-->
  <select id="queryTruckDepartPlanDetailById" resultMap="TruckDepartPlanDetailDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >
    select 
    <include refid="TruckDepartPlanDetail_Column_vehicle_List" />
    from TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL detail ,
    	 BSE.T_BAS_VEHICLE_TYPE_LENGTH vtl
    where detail.truck_model=vtl.vehicle_length_code(+)
         and detail.STATUS=vtl.active(+)
    	 and detail.STATUS =#{status,jdbcType=VARCHAR}
    	 and detail.ID=#{id,jdbcType=VARCHAR}
  </select>
  
  <!--查询明细列表-->
  <select id="queryTruckDepartPlanDetail" resultMap="TruckDepartPlanDetailDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >
    select 
    <include refid="TruckDepartPlanDetail_Column_Vehicle_Platform_List" />
    from TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL detail 
    ,TFR.T_OPT_PLATFORM_DISTRIBUTE plt,
    bse.t_bas_vehicle_type_length vtl
    where detail.PLATFORM_DISTRIBUTE_ID =plt.platform_distribute_id(+) 
	and   detail.truck_model=vtl.vehicle_length_code(+)
	and detail.STATUS=vtl.active(+) 
    and detail.STATUS =#{status,jdbcType=VARCHAR}
    and detail.truck_depart_plan_id=#{truckDepartPlanId,jdbcType=VARCHAR}
    order by detail.FREQUENCY_NO 
  </select>
  
  <!--根据 车牌号、出发部门、到达部门查询最近未出发的发车计划-->
  <select id="queryLatestTruckDepartPlanDetail" resultMap="TruckDepartPlanDetailDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >
    select 
    <include refid="TruckDepartPlanDetail_Column_Only_List" />
    from tfr.t_opt_truck_depart_plan_detail detail
	where detail.ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR}
	   and detail.DEST_ORG_CODE = #{destOrgCode,jdbcType=VARCHAR}
	   <if test="departDate != null and departDate!=''" >
	      and detail.DEPART_DATE =#{departDate,jdbcType=TIMESTAMP}
	   </if>
	   and detail.VEHICLE_NO =  #{vehicleNo,jdbcType=VARCHAR}
	   and detail.STATUS = #{status,jdbcType=VARCHAR}
	   and (
		   (detail.PLAN_STATUS=#{planStatusRelease,jdbcType=VARCHAR} AND detail.Plan_Type=#{planTypeLong,jdbcType=VARCHAR}) 
		  OR (detail.PLAN_STATUS=#{planStatusNew,jdbcType=VARCHAR} AND detail.Plan_Type=#{planTypeShort,jdbcType=VARCHAR})
	   )
	   and detail.HAS_LEFT=#{hasLeft,jdbcType=VARCHAR}
	   and detail.FREQUENCY_TYPE in
	     <foreach collection="list" item="item" open="(" close=")" separator=",">
     		#{item,jdbcType=VARCHAR}
        </foreach>
	 order  by detail.plan_type asc,detail.plan_depart_time asc 
  </select>
  <!--根据 货柜编号、出发部门、到达部门查询最近未出发的发车计划-->
  <select id="queryLatestTruckDepartPlanDetailByContarnerNo" resultMap="TruckDepartPlanDetailDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >
    select 
    <include refid="TruckDepartPlanDetail_Column_Only_List" />
    from tfr.t_opt_truck_depart_plan_detail detail
	where detail.ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR}
	   and detail.DEST_ORG_CODE = #{destOrgCode,jdbcType=VARCHAR}
	   <if test="departDate != null and departDate!=''" >
	      and detail.DEPART_DATE =#{departDate,jdbcType=DATE}
	   </if>
	   and detail.CONTAINER_NO =  #{containerNo,jdbcType=VARCHAR}
	   and detail.STATUS = #{status,jdbcType=VARCHAR}
	   and detail.PLAN_STATUS=#{planStatusRelease,jdbcType=VARCHAR} 
	   and detail.Plan_Type=#{planTypeLong,jdbcType=VARCHAR}
	   and detail.HAS_LEFT=#{hasLeft,jdbcType=VARCHAR}
	   and detail.FREQUENCY_TYPE in
	     <foreach collection="list" item="item" open="(" close=")" separator=",">
     		#{item,jdbcType=VARCHAR}
        </foreach>
	 order  by detail.plan_type asc,detail.plan_depart_time asc 
  </select>
  
  <!--根据 挂牌号、出发部门、到达部门查询最近未出发的发车计划-->
  <select id="queryDepartPlanDetailByTrailerVehicleNo" resultMap="TruckDepartPlanDetailDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >
    select 
    <include refid="TruckDepartPlanDetail_Column_Only_List" />
    from tfr.t_opt_truck_depart_plan_detail detail
	where detail.ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR}
	   and detail.DEST_ORG_CODE = #{destOrgCode,jdbcType=VARCHAR}
	   <if test="departDate != null and departDate!=''" >
	      and detail.DEPART_DATE =#{departDate,jdbcType=DATE}
	   </if>
	   and detail.trailer_VehicleNo =  #{vehicleNo,jdbcType=VARCHAR}
	   and detail.STATUS = #{status,jdbcType=VARCHAR}
	   and detail.PLAN_STATUS=#{planStatusRelease,jdbcType=VARCHAR} 
	   and detail.Plan_Type=#{planTypeLong,jdbcType=VARCHAR}
	   and detail.HAS_LEFT=#{hasLeft,jdbcType=VARCHAR}
	   and detail.FREQUENCY_TYPE in
	     <foreach collection="list" item="item" open="(" close=")" separator=",">
     		#{item,jdbcType=VARCHAR}
        </foreach>
	 order  by detail.plan_type asc,detail.plan_depart_time asc 
  </select>
  <!--根据 出发部门、到达部门、日期查询发车计划明细-->
  <select id="queryPlanDetailCount" resultType="Long" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >
    select 
    count(detail.id)
    from tfr.t_opt_truck_depart_plan_detail detail
	where detail.ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR}
	   and detail.DEST_ORG_CODE = #{destOrgCode,jdbcType=VARCHAR}	   
	   and detail.DEPART_DATE = #{departDate,jdbcType=TIMESTAMP}	   
	   and detail.STATUS = #{status,jdbcType=VARCHAR}
	   and (
		   (detail.PLAN_STATUS=#{planStatusRelease,jdbcType=VARCHAR} AND detail.Plan_Type=#{planTypeLong,jdbcType=VARCHAR}) 
		OR (detail.PLAN_STATUS=#{planStatusNew,jdbcType=VARCHAR} AND detail.Plan_Type=#{planTypeShort,jdbcType=VARCHAR})
	   )
	   and detail.HAS_LEFT=#{hasLeft,jdbcType=VARCHAR}	   
	   and detail.FREQUENCY_TYPE in
	     <foreach collection="list" item="item" open="(" close=")" separator=",">
     		#{item,jdbcType=VARCHAR}
        </foreach>
  </select>
  
  
  <!--查询明细总数-->
  <select id="queryTotalCount" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" resultType="Long" >
    select count(id) 
    from TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL detail   
    where  detail.STATUS =#{status,jdbcType=VARCHAR}
    and detail.truck_depart_plan_id=#{truckDepartPlanId,jdbcType=VARCHAR}  
  </select>
  
  <!-- 更新明细信息 -->
  <update id="updateTruckDepartPlanDetail" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto">
    update TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL
    set
      VEHICLE_NO = #{vehicleNo,jdbcType=VARCHAR},
      LINE_NO = #{lineNo,jdbcType=VARCHAR},
      PLAN_DEPART_TIME = #{planDepartTime,jdbcType=TIMESTAMP},
      FREQUENCY_NO = #{frequencyNo,jdbcType=VARCHAR},
      PLATFORM_DISTRIBUTE_ID = #{platformDistributeId,jdbcType=VARCHAR},
      IS_ON_SCHEDULING = #{isOnScheduling,jdbcType=CHAR},
      FREQUENCY_TYPE = #{frequencyType,jdbcType=VARCHAR},
      TRUCK_MODEL = #{truckModel,jdbcType=VARCHAR},
      TRUCK_TYPE = #{truckType,jdbcType=VARCHAR},
      TRUCK_ARRIVE_TIME = #{truckArriveTime,jdbcType=TIMESTAMP},
      CONTAINER_NO = #{containerNo,jdbcType=VARCHAR},
      MAX_LOAD_WEIGHT = #{maxLoadWeight,jdbcType=DECIMAL},
      ACTUAL_MAX_LOAD_WEIGHT = #{actualMaxLoadWeight,jdbcType=DECIMAL},
      TRUCK_VOLUME = #{truckVolume,jdbcType=DECIMAL},
      PLAN_LOAD_WEIGHT = #{planLoadWeight,jdbcType=DECIMAL},
      PLAN_LOAD_VOLUME = #{planLoadVolume,jdbcType=DECIMAL},
      TRUCK_INFO_NOTES = #{truckInfoNotes,jdbcType=VARCHAR},
      DRIVER_CODE1 = #{driverCode1,jdbcType=VARCHAR},
      DRIVER_NAME1 = #{driverName1,jdbcType=VARCHAR},
      DRIVER_PHONE1 = #{driverPhone1,jdbcType=VARCHAR},
      DRIVER_CODE2 = #{driverCode2,jdbcType=VARCHAR},
      DRIVER_NAME2 = #{driverName2,jdbcType=VARCHAR},
      DRIVER_PHONE2 = #{driverPhone2,jdbcType=VARCHAR},      
      UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
      UPDATE_USER_CODE = #{updateUserCode,jdbcType=VARCHAR},
      UPDATE_USER_NAME = #{updateUserName,jdbcType=VARCHAR},
      UPDATE_ORG_CODE = #{updateOrgCode,jdbcType=VARCHAR},
      LINE_NAME = #{lineName,jdbcType=VARCHAR},
      PLAN_ARRIVE_TIME = #{planArriveTime,jdbcType=TIMESTAMP},     
      PLATFORM_TIME_START = #{platformTimeStart,jdbcType=TIMESTAMP},
      PLATFORM_TIME_END = #{platformTimeEnd,jdbcType=TIMESTAMP},
      LONG_CAR_GROUP   =   #{longCarGroup,jdbcType=VARCHAR},
      PLATFORM_NO = #{platformNo,jdbcType=VARCHAR},
      TRAILER_VEHICLENO=#{trailerVehicleNo  ,jdbcType=VARCHAR}
      where  ID = #{id,jdbcType=VARCHAR}
  </update>
  
  <!-- 下发发车计划-->
  <update id="releaseTruckDepartPlanDetail" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto">
    update TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL detail
    set    
      detail.PLAN_STATUS=#{planStatus,jdbcType=VARCHAR},
	  detail.UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
      detail.UPDATE_USER_CODE = #{updateUserCode,jdbcType=VARCHAR},
      detail.UPDATE_USER_NAME = #{updateUserName,jdbcType=VARCHAR},
      detail.UPDATE_ORG_CODE = #{updateOrgCode,jdbcType=VARCHAR}
      where  detail.ID in
        <foreach collection="list" item="item" open="(" close=")" separator=",">
     		#{item,jdbcType=VARCHAR}
        </foreach>      
  </update>
  
  <!--根据 车牌号、时间发车计划-->
  <select id="queryPlanDetailByVehicleNoAndDate" resultMap="TruckDepartPlanDetailDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.CarInfoDto" >
    select 
    <include refid="TruckDepartPlanDetail_Column_Only_List" />
    from TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL detail
	where detail.VEHICLE_NO =  #{vehicleNo,jdbcType=VARCHAR}
	   and detail.STATUS = #{status,jdbcType=VARCHAR}
  </select>
  
  <!--根据 出发部门、到达部门、日期、线路、班次查询，用于排除当天线路班次唯一-->
  <select id="queryCurrentDayLineFrequencyOnly"  resultMap="TruckDepartPlanDetailDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >
    select 
    <include refid="TruckDepartPlanDetail_Column_Only_List" />
    from TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL detail
		where detail.orig_org_code=#{origOrgCode,jdbcType=VARCHAR}
		and detail.dest_org_code= #{destOrgCode,jdbcType=VARCHAR}
		and detail.depart_date=#{departDate,jdbcType=TIMESTAMP}
		and detail.line_no=#{lineNo,jdbcType=VARCHAR}
		and detail.frequency_no=#{frequencyNo,jdbcType=VARCHAR}
		and detail.plan_type=#{planType,jdbcType=VARCHAR}
		and detail.status=#{status,jdbcType=VARCHAR}
  </select>
  
   <!-- 更换车辆归属类型-->
  <update id="changePlanDetailTruckType" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto">
    update TFR.T_OPT_TRUCK_DEPART_PLAN_DETAIL detail
    set    
      detail.TRUCK_TYPE = #{truckType,jdbcType=VARCHAR},
	  detail.DRIVER_CODE1 = #{driverCode1,jdbcType=TIMESTAMP},
      detail.DRIVER_NAME1 = #{driverName1,jdbcType=VARCHAR},
      detail.DRIVER_PHONE1 = #{driverPhone1,jdbcType=VARCHAR},
	  detail.DRIVER_CODE2 = #{driverCode2,jdbcType=TIMESTAMP},
      detail.DRIVER_NAME2 = #{driverName2,jdbcType=VARCHAR},
      detail.DRIVER_PHONE2 = #{driverPhone2,jdbcType=VARCHAR},
      detail.VEHICLE_NO = #{vehicleNo,jdbcType=VARCHAR},
      detail.TRUCK_VOLUME  = #{truckVolume ,jdbcType=VARCHAR},
      detail.PLAN_LOAD_VOLUME = #{planLoadVolume,jdbcType=VARCHAR},      
      detail.PLAN_LOAD_WEIGHT = #{planLoadWeight,jdbcType=VARCHAR},
      detail.ACTUAL_MAX_LOAD_WEIGHT = #{actualMaxLoadWeight,jdbcType=VARCHAR},
      detail.MAX_LOAD_WEIGHT = #{maxLoadWeight,jdbcType=VARCHAR},
      detail.CONTAINER_NO   = #{containerNo ,jdbcType=VARCHAR},      
      detail.TRUCK_MODEL = #{truckModel,jdbcType=VARCHAR}
      where  detail.ID = #{id,jdbcType=VARCHAR}
  </update>
  
  <!--根据计划ID查询明细-->
   <select id="queryTruckDepartPlanDetailBylimitForExport"  resultMap="TruckDepartPlanDetailDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >
	   select 
	   	   org2.name orig_org_code,
	       org3.name dest_org_code,
	       t.depart_date,
	       line.line_name line_no,
	       t.plan_depart_time,
	       t.frequency_no,
	       decode(t.is_on_scheduling, 'Y', '是', 'N', '否') is_on_scheduling,
	       decode(t.frequency_type,
	              'ADD',
	              '加发',
	              'NORMAL',
	              '正常',
	              'SUSPEND',
	              '停发') frequency_type,
	       t.driver_name1,
	       t.driver_phone1,
	       t.driver_name2,
	       t.driver_phone2,
	       t.vehicle_no,
	       vehicle_type.vehicle_length_name truck_model,
	       decode(t.truck_type, 'OWN', '自有', 'N', '外请') truck_type,      
	       plat.platform_code platform_no,
	       t.container_no,
	       t.TRAILER_VEHICLENO,
	       org.name long_car_group,
	       t.create_user_name,
	       t.create_time,
	       t.has_left,
	       decode(t.plan_status, 'NEW', '新建', 'RELEASE', '下发') plan_status
	  from tfr.t_opt_truck_depart_plan_detail t,
	       tfr.t_opt_truck_depart_plan        pn,
	       bse.t_bas_line                     line,
	       bse.t_bas_vehicle_type_length      vehicle_type， bse.t_bas_platform plat,
	       bse.t_bas_org                      org,
           bse.t_bas_org                      org2,
    	   bse.t_bas_org                      org3
	 where t.line_no = line.virtual_code(+)
	   and t.status = line.active(+)
	   and t.truck_depart_plan_id = pn.id(+)
	   and t.status = pn.status(+)
	   and t.truck_model = vehicle_type.vehicle_length_code(+)
	   and t.status = vehicle_type.active(+)
	   and t.truck_depart_plan_id = #{truckDepartPlanId,jdbcType=VARCHAR}
	   and t.platform_no = plat.virtual_code(+)
	   and t.status = plat.active(+)
	   and t.long_car_group = org.code(+)
	   and t.status = org.active(+)
	   and t.orig_org_code = org2.code(+)
	   and t.status = org2.active(+)   
	   and t.dest_org_code = org3.code(+)
	   and t.status = org3.active(+)
	   and t.status = #{status,jdbcType=VARCHAR}
  </select>
  
  <!--根据 车牌号、出发部门、到达部门查询最近未出发的发车计划分为长途和短途-->
  <select id="queryLongOrShortDepartPlanInfoDetail" resultMap="TruckDepartPlanDetailDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckDepartPlanDetailDto" >
    select 
    <include refid="TruckDepartPlanDetail_Column_Only_List" />
    from (select * 
    from tfr.t_opt_truck_depart_plan_detail detail
	where detail.ORIG_ORG_CODE = #{origOrgCode,jdbcType=VARCHAR}
	   and detail.DEST_ORG_CODE = #{destOrgCode,jdbcType=VARCHAR}
	   <if test="departDate != null and departDate!=''" >
	      and detail.DEPART_DATE =#{departDate,jdbcType=TIMESTAMP}
	   </if>
	   and detail.VEHICLE_NO =  #{vehicleNo,jdbcType=VARCHAR}
	   and detail.STATUS = #{status,jdbcType=VARCHAR}
  	   and detail.Plan_Type=#{planTypeLong,jdbcType=VARCHAR}
   	   and detail.PLAN_STATUS=#{planStatusRelease,jdbcType=VARCHAR}
	   and detail.HAS_LEFT=#{hasLeft,jdbcType=VARCHAR}
	   and detail.FREQUENCY_TYPE in
	     <foreach collection="list" item="item" open="(" close=")" separator=",">
     		#{item,jdbcType=VARCHAR}
        </foreach>
		order by detail.plan_type asc,detail.plan_depart_time asc) detail
		where rownum=1
  </select>
</mapper>