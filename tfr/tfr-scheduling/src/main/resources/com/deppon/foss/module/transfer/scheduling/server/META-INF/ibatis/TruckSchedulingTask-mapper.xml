<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="Foss.scheduling.truckSchedulingTask" >
	<!--结果映射-->
  <resultMap id="TruckSchedulingTaskResultMap" type="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckSchedulingTaskEntity" >  
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="T_OPT_TRUCK_SCHEDULING_ID" property="schedulingId" jdbcType="VARCHAR" />
    <result column="VEHICLE_NO" property="vehicleNo" jdbcType="VARCHAR" />
    <result column="TRUCK_MODEL" property="truckModel" jdbcType="VARCHAR" />
    <result column="LINE_NO" property="lineNo" jdbcType="VARCHAR" />
    <result column="FREQUENCY_NO" property="frequencyNo" jdbcType="VARCHAR" />
    <result column="CAR_OWNER" property="carOwner" jdbcType="VARCHAR" />
    <result column="ZONE_CODE" property="zoneCode" jdbcType="VARCHAR" />
    <result column="DEPART_TIME" property="departTime" jdbcType="TIMESTAMP" />
    <result column="TASK_STATUS" property="taskStatus" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="CREATE_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
    <result column="CREATE_USER_NAME" property="createUserName" jdbcType="VARCHAR" />
    <result column="CREATE_ORG_CODE" property="createOrgCode" jdbcType="VARCHAR" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="UPDATE_USER_CODE" property="updateUserCode" jdbcType="VARCHAR" />
    <result column="UPDATE_USER_NAME" property="updateUserName" jdbcType="VARCHAR" />
    <result column="UPDATE_ORG_CODE" property="updateOrgCode" jdbcType="VARCHAR" />
    <result column="TASK_NO" property="taskNo" jdbcType="VARCHAR" />
    <result column="Regional_Name" property="pkpAreaNames" jdbcType="VARCHAR"/>    
  </resultMap>
  
  <!--联表结果映射-->
  <resultMap id="SchedulingAndTaskResultMap" type="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >   
		<result column="DRIVER_CODE" property="driverCode" jdbcType="VARCHAR" />
		<result column="DRIVER_NAME" property="driverName" jdbcType="VARCHAR" />
	    <result column="SCHEDULING_DATE" property="schedulingDate" jdbcType="TIMESTAMP" />
		<result column="PLAN_TYPE" property="planType" jdbcType="VARCHAR" />
	    <result column="VEHICLE_NO" property="vehicleNo" jdbcType="VARCHAR" />
	    <result column="TRUCK_MODEL" property="truckModel" jdbcType="VARCHAR" />
		<result column="CAR_OWNER" property="carOwner" jdbcType="VARCHAR" />
	    <result column="LINE_NO" property="lineNo" jdbcType="VARCHAR" />
		<result column="DRIVER_PHONE" property="driverPhone" jdbcType="VARCHAR" />
	    <result column="DEPART_TIME" property="departTime" jdbcType="TIMESTAMP" />
	    <result column="FREQUENCY_NO" property="frequencyNo" jdbcType="VARCHAR" />
		<result column="DRIVER_ORG_CODE" property="driverOrgCode" jdbcType="VARCHAR" />
		<result column="DRIVER_ORG_NAME" property="driverOrgName" jdbcType="VARCHAR" />
		<result column="ZONE_CODE" property="zoneCode" jdbcType="VARCHAR" />
		<result column="DELIVERY_AREA_CODE" property="deliveryAreaCode" jdbcType="VARCHAR" />
		<result column="SCHEDULE_ID" property="scheduleId" jdbcType="VARCHAR" />
		<result column="SCHEDULE_TASK_ID" property="scheduleTaskId" jdbcType="VARCHAR" />
		<result column="TRUCK_FLAG" property="truckFlag" jdbcType="VARCHAR" />
		<result column="Regional_Name" property="pkpRegionalName" jdbcType="VARCHAR"/>
		<result column="DELIVERY_REGIONAL_NAME" property="deliveryRegionalName" jdbcType="VARCHAR"/>
		<result column="IS_BRING_EXPRESS" property="isBringExpress" jdbcType="VARCHAR"/>
		<result column="EXPECTED_BRING_VOLUME" property="expectedBringVolume" jdbcType="DECIMAL"/>
		<result column="SELF_VOLUME" property="selfVolume" jdbcType="DECIMAL"/>
		<result column="DEAD_LOAD" property="deadLoad" jdbcType="DECIMAL"/>
		<!--新增字段-->
		<result column="DISPATCH_VEHICLE_TASK" property="dispatchVehicleTask" jdbcType="VARCHAR"/>
		<result column="EXPECTED_DISPATCH_VEHICLE_TIME" property="expectedDispatchVehicleTime" jdbcType="VARCHAR"/>
		<result column="IS_THE_TWO_TRIP_TIME" property="isTheTwoTripTime" jdbcType="VARCHAR"/>
		<result column="TAKE_GOODS_DEPARTMENT" property="takeGoodsDepartment" jdbcType="VARCHAR"/>
		<result column="TRANSFER_GOODS_DEPARTMENT" property="transferGoodsDepartment" jdbcType="VARCHAR"/>
		<result column="takeGoodsDepartmentName" property="takeGoodsDepartmentName" jdbcType="VARCHAR"/>
		<result column="transferGoodsDepartmentName" property="transferGoodsDepartmentName" jdbcType="VARCHAR"/>
  </resultMap>
  
  <!--导出EXCEL Map-->
  <resultMap id="ScheduleExcelDtoResultMap" type="com.deppon.foss.module.transfer.scheduling.api.shared.dto.ScheduleExcelDto" >  
		<result column="SCHEDULING_TYPE" property="schedulingType" jdbcType="VARCHAR" />
		<result column="DRIVER_ORG_CODE" property="driverOrgCode" jdbcType="VARCHAR" />
  		<result column="DRIVER_CODE" property="driverCode" jdbcType="VARCHAR" />
  		<result column="SCHEDULING_DATE" property="schedulingDate" jdbcType="TIMESTAMP" />
		<result column="YEAR_MONTH" property="yearMonth" jdbcType="VARCHAR" />
		<result column="PLAN_TYPE" property="planType" jdbcType="VARCHAR" />
		<result column="DRIVER_PHONE" property="driverPhone" jdbcType="VARCHAR" />	
	    <result column="VEHICLE_NO" property="vehicleNo" jdbcType="VARCHAR" />
	    <result column="TRUCK_MODEL" property="truckModel" jdbcType="VARCHAR" />
		<result column="CAR_OWNER" property="carOwner" jdbcType="VARCHAR" />
		<result column="ZONE_CODE" property="zoneCode" jdbcType="VARCHAR" />
	    <result column="LINE_NO" property="lineNo" jdbcType="VARCHAR" />
	    <result column="FREQUENCY_NO" property="frequencyNo" jdbcType="VARCHAR" />
	    <result column="TASK_NO" property="taskNo" jdbcType="VARCHAR" />	    
	    <result column="SCHEDULE_ID" property="schedulingId" jdbcType="VARCHAR" />	    
	    <result column="SCHEDULE_TASK_ID" property="scheduleTaskId" jdbcType="VARCHAR" />	    
  </resultMap>
  <resultMap id="SchedulingZoneResultMap" type="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckSchedulingZoneEntity">
  		<result column="id" property="id" jdbcType="VARCHAR" />
  		<result column="truckSchedulingTaskId" property="truckSchedulingTaskId" jdbcType="VARCHAR" />
  		<result column="vehicleNo" property="vehicleNo" jdbcType="VARCHAR" />
  		<result column="zoneCode" property="zoneCode" jdbcType="VARCHAR" />
  		<result column="zoneName" property="zoneName" jdbcType="VARCHAR" />
  		<result column="schedulTime" property="schedulTime" jdbcType="TIMESTAMP" />
  		<result column="driverName" property="driverName" jdbcType="VARCHAR" />
  		<result column="driverCode" property="driverCode" jdbcType="VARCHAR" />
  		<result column="vehicleTeamCode" property="vehicleTeamCode" jdbcType="VARCHAR" />
  		<result column="vehicleTeamName" property="vehicleTeamName" jdbcType="VARCHAR" />
  		<result column="createUserName" property="createUserName" jdbcType="VARCHAR" />
  		<result column="createUserCode" property="createUserCode" jdbcType="VARCHAR" />
  		<result column="createTime" property="createTime" jdbcType="TIMESTAMP" />
  		<result column="regionCode" property="regionCode" jdbcType="VARCHAR" />
  </resultMap>
  <!--查询字段-->
  <sql id="Task_Column_List" >
    ID, T_OPT_TRUCK_SCHEDULING_ID, VEHICLE_NO, TRUCK_MODEL, LINE_NO, FREQUENCY_NO, DEPART_TIME, 
    TASK_STATUS, CREATE_TIME, CREATE_USER_CODE, CREATE_USER_NAME, CREATE_ORG_CODE, UPDATE_TIME, 
    UPDATE_USER_CODE, UPDATE_USER_NAME, UPDATE_ORG_CODE,ZONE_CODE,CAR_OWNER,TRUCK_FLAG,Regional_Name
  </sql>  

  
  <!--查询总条数-->
  <select id="queryCount" resultType="Long" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >
	 select 
	 	   count(S.ID) cnt
		   from tfr.T_OPT_TRUCK_SCHEDULING      S,
		   tfr.T_OPT_TRUCK_SCHEDULING_TASK ST,
		   BSE.T_BAS_OWNDRIVER         DR,
		   BSE.T_BAS_ORG               ORG 
		  <where>
				   S.ID = ST.T_OPT_TRUCK_SCHEDULING_ID(+)
				   and S.DRIVER_CODE = DR.EMP_CODE(+)
				   and S.SCHEDULING_DEPART_CODE= ORG.CODE(+)
				   and S.SCHEDULING_STATUS = ST.TASK_STATUS(+)
				   and S.SCHEDULING_STATUS =DR.active(+)
				   and S.SCHEDULING_STATUS=ORG.active(+)
				   and S.SCHEDULING_STATUS=#{schedulingStatus} /**有效状态**/
				 <if test="schedulingtype!=null and schedulingtype!=''"> 
					 and S.SCHEDULING_TYPE=#{schedulingtype}/**排班类型**/
				</if>			
				<if test="schedulingDepartCode!=null and schedulingDepartCode!=''"> 
					and S.SCHEDULING_DEPART_CODE=#{schedulingDepartCode}
				</if>
				<if test="vehicleNo!=null and vehicleNo!=''"> 
					and ST.VEHICLE_NO=#{vehicleNo}
				</if>
				<if test="driverCode!=null and driverCode!=''"> 
					and S.DRIVER_CODE=#{driverCode}
				</if>
				<if test="list != null">
					and S.PLAN_TYPE 
					<foreach  collection="list" item="item"  separator="," open="in (" close=")">
								 #{item,jdbcType=VARCHAR}
					</foreach>	
				</if>
				<if test="departmentCodes != null">
						and S.SCHEDULING_DEPART_CODE 
						<foreach  collection="departmentCodes" item="item"  separator="," open="in (" close=")">
									 #{item,jdbcType=VARCHAR}
						</foreach>	
					</if>
				<if test="planType!=null and planType!=''"> 
					and S.PLAN_TYPE =#{planType}
				</if>				   		
				<if test="scheduleDateFrom!=null and scheduleDateFrom!=''">    		
					<![CDATA[ and S.SCHEDULING_DATE >= #{scheduleDateFrom,jdbcType=TIMESTAMP}]]>  
				</if>
				<if test="scheduleDateTo!=null and scheduleDateTo!=''"> 
					<![CDATA[ and S.SCHEDULING_DATE <= #{scheduleDateTo,jdbcType=TIMESTAMP}]]>  
				</if>
				<if test="scheduleId != null and scheduleId !='' "> 
					and ST.T_OPT_TRUCK_SCHEDULING_ID =#{scheduleId}
				</if>
				 <if test="ymd!=null and ymd!=''"> 
					<![CDATA[ and S.SCHEDULING_DATE >=to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
					<![CDATA[ and S.SCHEDULING_DATE <to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>  
				 </if>    		 	
		 </where>				
	    
  </select>
  
  <!--联合查询T_OPT_TRUCK_SCHEDULING_TASK,T_OPT_TRUCK_SCHEDULING,用于短途排班的简单查询和查询某司机的任务时使用-->
  <select id="querySchedulingAndTask" resultMap="SchedulingAndTaskResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >   
	  select   S.DRIVER_CODE,
			   S.SCHEDULING_DATE,
			   S.PLAN_TYPE,
			   ST.VEHICLE_NO, /**车牌号**/
			   ST.TRUCK_MODEL, /**车型**/
			   ST.CAR_OWNER, /**车辆所属车队**/
			   ST.LINE_NO, /**线路**/       
			   ST.DEPART_TIME, /**发车时间**/
			   ST.FREQUENCY_NO, /**班次**/
			   ST.ZONE_CODE,
			   ST.DELIVERY_AREA_CODE,
			   ST.ID SCHEDULE_TASK_ID,
			   ST.Regional_Name,
			   ST.EXPECTED_DISPATCH_VEHICLE_TIME,
			   ST.IS_THE_TWO_TRIP_TIME,
			   ST.DISPATCH_VEHICLE_TASK,
			   ST.TAKE_GOODS_DEPARTMENT,
			   ST.TRANSFER_GOODS_DEPARTMENT,
			   ST.DELIVERY_REGIONAL_NAME,
			   ST.IS_BRING_EXPRESS,
			   ST.EXPECTED_BRING_VOLUME,
			   S.ID SCHEDULE_ID,
			   TO_CHAR(S.SCHEDULING_DATE, 'YYYY-MM-DD') ymd,
			   DR.EMP_NAME DRIVER_NAME,
			   DR.EMP_PHONE DRIVER_PHONE, /**司机电话**/
			   ORG.NAME DRIVER_ORG_NAME,
			   S.driver_org_code DRIVER_ORG_CODE
			  from tfr.T_OPT_TRUCK_SCHEDULING      S,
			   tfr.T_OPT_TRUCK_SCHEDULING_TASK ST,
			   BSE.T_BAS_OWNDRIVER         DR,
			   BSE.T_BAS_ORG               ORG 
			  <where>
					   S.ID = ST.T_OPT_TRUCK_SCHEDULING_ID
					   and S.DRIVER_CODE = DR.EMP_CODE(+)
					   and S.DRIVER_ORG_CODE= ORG.CODE(+)
					   and S.SCHEDULING_STATUS = ST.TASK_STATUS(+)
					   and S.SCHEDULING_STATUS =DR.active(+)
				  	   and S.SCHEDULING_STATUS=ORG.active(+)
					   and S.SCHEDULING_STATUS=#{schedulingStatus,jdbcType=VARCHAR} /**有效状态**/
					 <if test="schedulingtype!=null and schedulingtype!=''"> 
						 and S.SCHEDULING_TYPE=#{schedulingtype}/**排班类型**/
					</if>			
					<if test="schedulingDepartCode!=null and schedulingDepartCode!=''"> 
						and S.SCHEDULING_DEPART_CODE=#{schedulingDepartCode}
					</if>
					<if test="vehicleNo!=null and vehicleNo!=''"> 
						and ST.VEHICLE_NO=#{vehicleNo}
					</if>
					<if test="driverCode!=null and driverCode!=''"> 
						and S.DRIVER_CODE=#{driverCode}
					</if>				   		
					<if test="planType!=null and planType!=''"> 
						and S.PLAN_TYPE =#{planType}
					</if>
					<if test="scheduleDateFrom!=null and scheduleDateFrom!=''">    		
						<![CDATA[ and S.SCHEDULING_DATE >= #{scheduleDateFrom,jdbcType=TIMESTAMP}]]>  
					</if>
					<if test="scheduleDateTo!=null and scheduleDateTo!=''"> 
						<![CDATA[ and S.SCHEDULING_DATE <= #{scheduleDateTo,jdbcType=TIMESTAMP}]]>  
					</if>
					<if test="scheduleId != null and scheduleId !='' "> 
						and ST.T_OPT_TRUCK_SCHEDULING_ID =#{scheduleId,jdbcType=VARCHAR}
					</if> 
					 <if test="ymd!=null and ymd!=''"> 
						<![CDATA[ and S.SCHEDULING_DATE >=to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
						<![CDATA[ and S.SCHEDULING_DATE <to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>  
					 </if>   		 	
			 </where>				
   		 	 order by  S.SCHEDULING_DATE,ST.LINE_NO,ST.DEPART_TIME
  </select>
  
  <!--联合查询T_OPT_TRUCK_SCHEDULING_TASK,T_OPT_TRUCK_SCHEDULING,用于短途排班的简单查询和查询某司机的任务时使用-->
  <select id="querySchedulingAndTaskByWork" resultMap="SchedulingAndTaskResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >   
		   select  S.DRIVER_CODE,
			   S.SCHEDULING_DATE,
			   S.PLAN_TYPE,
			   ST.VEHICLE_NO, /**车牌号**/
			   ST.TRUCK_MODEL, /**车型**/
			   ST.CAR_OWNER, /**车辆所属车队**/
			   ST.LINE_NO, /**线路**/       
			   ST.DEPART_TIME, /**发车时间**/
			   ST.FREQUENCY_NO, /**班次**/
			   ST.ZONE_CODE,
			   ST.DELIVERY_AREA_CODE,
			   ST.DELIVERY_REGIONAL_NAME,
			   ST.EXPECTED_BRING_VOLUME,
			   ST.ID SCHEDULE_TASK_ID,
			   ST.TRUCK_FLAG,
			   ST.Regional_Name,
			   ST.EXPECTED_DISPATCH_VEHICLE_TIME,
			   ST.IS_THE_TWO_TRIP_TIME,
			   ST.DISPATCH_VEHICLE_TASK,
			   ST.TAKE_GOODS_DEPARTMENT,
			   ST.TRANSFER_GOODS_DEPARTMENT,
			   S.ID SCHEDULE_ID,
			   TO_CHAR(S.SCHEDULING_DATE, 'YYYY-MM-DD') ymd,
			   DR.EMP_NAME DRIVER_NAME,
			   DR.EMP_PHONE DRIVER_PHONE, /**司机电话**/
			   ORG.NAME DRIVER_ORG_NAME,
			   S.DRIVER_ORG_CODE DRIVER_ORG_CODE
			   from tfr.T_OPT_TRUCK_SCHEDULING      S,
			   tfr.T_OPT_TRUCK_SCHEDULING_TASK ST,
			   BSE.T_BAS_OWNDRIVER         DR,
			   BSE.T_BAS_ORG               ORG 
			  <where>
					   S.ID = ST.T_OPT_TRUCK_SCHEDULING_ID(+)
					   and S.DRIVER_CODE = DR.EMP_CODE(+)
					   and S.DRIVER_ORG_CODE= ORG.CODE(+)
					   and S.SCHEDULING_STATUS = ST.TASK_STATUS(+)
					   and S.SCHEDULING_STATUS =DR.active(+)
				       and S.SCHEDULING_STATUS=ORG.active(+)
					   and S.SCHEDULING_STATUS=#{schedulingStatus} /**有效状态**/
					 <if test="schedulingtype!=null and schedulingtype!=''"> 
						 and S.SCHEDULING_TYPE=#{schedulingtype}/**排班类型**/
					</if>			
					<if test="schedulingDepartCode!=null and schedulingDepartCode!=''"> 
						and S.SCHEDULING_DEPART_CODE=#{schedulingDepartCode}
					</if>
					<if test="vehicleNo!=null and vehicleNo!=''"> 
						and ST.VEHICLE_NO=#{vehicleNo}
					</if>
					<if test="driverCode!=null and driverCode!=''"> 
						and S.DRIVER_CODE=#{driverCode}
					</if>
					<if test="list != null">
						and S.PLAN_TYPE 
						<foreach  collection="list" item="item"  separator="," open="in (" close=")">
									 #{item,jdbcType=VARCHAR}
						</foreach>	
					</if>
					<if test="departmentCodes != null">
						and S.SCHEDULING_DEPART_CODE 
						<foreach  collection="departmentCodes" item="item"  separator="," open="in (" close=")">
									 #{item,jdbcType=VARCHAR}
						</foreach>	
					</if>
					<if test="planType!=null and planType!=''"> 
						and S.PLAN_TYPE =#{planType}
					</if>				   		
					<if test="scheduleDateFrom!=null and scheduleDateFrom!=''">    		
						<![CDATA[ and S.SCHEDULING_DATE >= #{scheduleDateFrom,jdbcType=TIMESTAMP}]]>  
					</if>
					<if test="scheduleDateTo!=null and scheduleDateTo!=''"> 
						<![CDATA[ and S.SCHEDULING_DATE <= #{scheduleDateTo,jdbcType=TIMESTAMP}]]>  
					</if>
					<if test="scheduleId != null and scheduleId !='' "> 
						and ST.T_OPT_TRUCK_SCHEDULING_ID =#{scheduleId}
					</if>
					 <if test="ymd!=null and ymd!=''"> 
						<![CDATA[ and S.SCHEDULING_DATE >=to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
						<![CDATA[ and S.SCHEDULING_DATE <to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>  
					 </if>    		 	
			 </where>				
   		 	 order by  S.SCHEDULING_DATE DESC,S.DRIVER_CODE,ST.LINE_NO,ST.DEPART_TIME
  </select>
  
  
  
  <!--新增-->
  <insert id="insertTruckSchedulingTask" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckSchedulingTaskEntity" >
    insert into TFR.T_OPT_TRUCK_SCHEDULING_TASK (
		<include refid="Task_Column_List" />,DELIVERY_AREA_CODE,DELIVERY_REGIONAL_NAME,IS_BRING_EXPRESS,EXPECTED_BRING_VOLUME,DISPATCH_VEHICLE_TASK,
		EXPECTED_DISPATCH_VEHICLE_TIME,IS_THE_TWO_TRIP_TIME,TAKE_GOODS_DEPARTMENT,TRANSFER_GOODS_DEPARTMENT
	)
    values (#{id,jdbcType=VARCHAR}, #{schedulingId,jdbcType=VARCHAR}, #{vehicleNo,jdbcType=VARCHAR}, 
      #{truckModel,jdbcType=VARCHAR}, #{lineNo,jdbcType=VARCHAR}, #{frequencyNo,jdbcType=VARCHAR}, 
      #{departTime,jdbcType=TIMESTAMP}, #{taskStatus,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, 
      #{createUserCode,jdbcType=VARCHAR}, #{createUserName,jdbcType=VARCHAR}, #{createOrgCode,jdbcType=VARCHAR}, 
      #{updateTime,jdbcType=TIMESTAMP}, #{updateUserCode,jdbcType=VARCHAR}, #{updateUserName,jdbcType=VARCHAR}, 
      #{updateOrgCode,jdbcType=VARCHAR},#{zoneCode,jdbcType=VARCHAR},#{carOwner,jdbcType=VARCHAR},#{truckFlag,jdbcType=VARCHAR},
      #{pkpAreaNames,jdbcType=VARCHAR},#{deliveryAreaCode,jdbcType=VARCHAR},#{deliveryRegionalNames,jdbcType=VARCHAR},
      #{isBringExpress,jdbcType=VARCHAR},#{expectedBringVolume,jdbcType=DECIMAL},#{dispatchVehicleTask,jdbcType=VARCHAR},
      #{expectedDispatchVehicleTime,jdbcType=VARCHAR},#{isTheTwoTripTime,jdbcType=VARCHAR},#{takeGoodsDepartment,jdbcType=VARCHAR},#{transferGoodsDepartment,jdbcType=VARCHAR})
  </insert>
  
  <!--批量新增-->
  <insert id="batchInsertTruckSchedulingTask" parameterType="java.util.List" >
  	    BEGIN 
		<foreach  collection="list" item="item"  separator=";">
		    insert into TFR.T_OPT_TRUCK_SCHEDULING_TASK (
		   	 <include refid="Task_Column_List" />
		    )
		    values (#{item.id,jdbcType=VARCHAR}, #{item.schedulingId,jdbcType=VARCHAR}, #{item.vehicleNo,jdbcType=VARCHAR}, 
		      #{item.truckModel,jdbcType=VARCHAR}, #{item.lineNo,jdbcType=VARCHAR}, #{item.frequencyNo,jdbcType=VARCHAR}, 
		      #{item.departTime,jdbcType=TIMESTAMP}, #{item.taskStatus,jdbcType=VARCHAR}, #{item.createTime,jdbcType=TIMESTAMP}, 
		      #{item.createUserCode,jdbcType=VARCHAR}, #{item.createUserName,jdbcType=VARCHAR}, #{item.createOrgCode,jdbcType=VARCHAR}, 
		      #{item.updateTime,jdbcType=TIMESTAMP}, #{item.updateUserCode,jdbcType=VARCHAR}, #{item.updateUserName,jdbcType=VARCHAR}, 
		      #{item.updateOrgCode,jdbcType=VARCHAR},#{item.zoneCode,jdbcType=VARCHAR},#{item.carOwner,jdbcType=VARCHAR}
		      ,#{item.truckFlag,jdbcType=VARCHAR},#{item.pkpAreaNames,jdbcType=VARCHAR})
	    </foreach>
		;END;    
  </insert>
  
  <!--批量新增单条插入-->
  <insert id="batchInsertTruckSchedulingTaskOne" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckSchedulingTaskEntity" >
  	  insert into TFR.T_OPT_TRUCK_SCHEDULING_TASK (
		   	 <include refid="Task_Column_List" />
		    )
		    values (#{id,jdbcType=VARCHAR}, #{schedulingId,jdbcType=VARCHAR}, #{vehicleNo,jdbcType=VARCHAR}, 
		      #{truckModel,jdbcType=VARCHAR}, #{lineNo,jdbcType=VARCHAR}, #{frequencyNo,jdbcType=VARCHAR}, 
		      #{departTime,jdbcType=TIMESTAMP}, #{taskStatus,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, 
		      #{createUserCode,jdbcType=VARCHAR}, #{createUserName,jdbcType=VARCHAR}, #{createOrgCode,jdbcType=VARCHAR}, 
		      #{updateTime,jdbcType=TIMESTAMP}, #{updateUserCode,jdbcType=VARCHAR}, #{updateUserName,jdbcType=VARCHAR}, 
		      #{updateOrgCode,jdbcType=VARCHAR},#{zoneCode,jdbcType=VARCHAR},#{carOwner,jdbcType=VARCHAR}
		      ,#{truckFlag,jdbcType=VARCHAR}, #{pkpAreaNames,jdbcType=VARCHAR})	      
  </insert>
  
  <!--批量插入-->
 <insert id="batchImportTruckSchedulingTask" parameterType="java.util.List" >
		BEGIN 
		<foreach  collection="list" item="item"  separator=";">
					  insert into TFR.T_OPT_TRUCK_SCHEDULING_TASK
				    <trim prefix="(" suffix=")" suffixOverrides="," >
				      <if test="item.id != null" >
				        ID,
				      </if>
				      <if test="item.pkpAreaNames !=null">
				      	Regional_Name,
				      </if>
				       <if test='item.schedulingId!=null'>
				        T_OPT_TRUCK_SCHEDULING_ID,	
				       </if>			      
				      <if test="item.vehicleNo != null" >
				        VEHICLE_NO,
				      </if>
				      <if test="item.truckModel != null" >
				        TRUCK_MODEL,
				      </if>
				      <if test="item.lineCode != null" >
				        LINE_NO,
				      </if>
				      <if test="item.frequencyNo != null" >
				        FREQUENCY_NO,
				      </if>
				      <if test="item.departTime != null" >
				        DEPART_TIME,
				      </if>
				      <if test="item.taskStatus != null" >
				        TASK_STATUS,
				      </if>
				      <if test="item.createTime != null" >
				        CREATE_TIME,
				      </if>
				      <if test="item.createUserCode != null" >
				        CREATE_USER_CODE,
				      </if>
				      <if test="item.createUserName != null" >
				        CREATE_USER_NAME,
				      </if>
				      <if test="item.createOrgCode != null" >
				        CREATE_ORG_CODE,
				      </if>
				      <if test="item.updateTime != null" >
				        UPDATE_TIME,
				      </if>
				      <if test="item.updateUserCode != null" >
				        UPDATE_USER_CODE,
				      </if>
				      <if test="item.updateUserName != null" >
				        UPDATE_USER_NAME,
				      </if>
				      <if test="item.updateOrgCode != null" >
				        UPDATE_ORG_CODE,
				      </if>
				      <if test="item.carOwner != null" >
				        CAR_OWNER,
				      </if>
				      <if test="item.zoneCode != null" >
				        ZONE_CODE,
				      </if>
				      <if test="item.truckFlag != null" >
				        TRUCK_FLAG
				      </if>
				      
				    </trim>
				     <trim prefix="values (" suffix=")" suffixOverrides="," >
				      <if test="item.id != null" >
				        #{item.id,jdbcType=VARCHAR},
				      </if>
				      <if test="item.pkpAreaNames!=null">
				      	#{item.pkpAreaNames,jdbcType=VARCHAR},
				      </if>
			        <if test='item.schedulingId!=null'>
			        	#{item.schedulingId,jdbcType=VARCHAR},
			        </if>
				      <if test="item.vehicleNo != null" >
				        #{item.vehicleNo,jdbcType=VARCHAR},
				      </if>
				      <if test="item.truckModel != null" >
				        #{item.truckModel,jdbcType=VARCHAR},
				      </if>
				      <if test="item.lineCode != null" >
				        #{item.lineCode,jdbcType=VARCHAR},
				      </if>
				      <if test="item.frequencyNo != null" >
				        #{item.frequencyNo,jdbcType=VARCHAR},
				      </if>
				      <if test="item.departTime != null" >
				        #{item.departTime,jdbcType=TIMESTAMP},
				      </if>
				      <if test="item.taskStatus != null" >
				        #{item.taskStatus,jdbcType=VARCHAR},
				      </if>
				      <if test="item.createTime != null" >
				        #{item.createTime,jdbcType=TIMESTAMP},
				      </if>
				      <if test="item.createUserCode != null" >
				        #{item.createUserCode,jdbcType=VARCHAR},
				      </if>
				      <if test="item.createUserName != null" >
				        #{item.createUserName,jdbcType=VARCHAR},
				      </if>
				      <if test="item.createOrgCode != null" >
				        #{item.createOrgCode,jdbcType=VARCHAR},
				      </if>
				      <if test="item.updateTime != null" >
				        #{item.updateTime,jdbcType=TIMESTAMP},
				      </if>
				      <if test="item.updateUserCode != null" >
				        #{item.updateUserCode,jdbcType=VARCHAR},
				      </if>
				      <if test="item.updateUserName != null" >
				        #{item.updateUserName,jdbcType=VARCHAR},
				      </if>
				      <if test="item.updateOrgCode != null" >
				        #{item.updateOrgCode,jdbcType=VARCHAR},
				      </if>
				      <if test="item.carOwner != null" >
				        #{item.carOwner,jdbcType=VARCHAR},
				      </if>
				      <if test="item.zoneCode != null" >
				        #{item.zoneCode,jdbcType=VARCHAR},
				      </if>
				      <if test="item.truckFlag != null" >
				        #{item.truckFlag,jdbcType=VARCHAR}
				      </if>
				      
			    </trim>
	    </foreach>
		;END;    
  </insert>
  
  <!--批量单条插入-->
 <insert id="batchImportTruckSchedulingTaskOne" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.TruckSchedulingTaskDto" >
				insert into TFR.T_OPT_TRUCK_SCHEDULING_TASK
				    <trim prefix="(" suffix=")" suffixOverrides="," >
				      <if test="id != null" >
				        ID,
				      </if>
				       <if test='schedulingId!=null'>
				        T_OPT_TRUCK_SCHEDULING_ID,	
				       </if>
				       <if test="pkpAreaNames !=null">
				      	Regional_Name,
				      </if>			      
				      <if test="vehicleNo != null" >
				        VEHICLE_NO,
				      </if>
				      <if test="truckModel != null" >
				        TRUCK_MODEL,
				      </if>
				      <if test="lineCode != null" >
				        LINE_NO,
				      </if>
				      <if test="frequencyNo != null" >
				        FREQUENCY_NO,
				      </if>
				      <if test="departTime != null" >
				        DEPART_TIME,
				      </if>
				      <if test="taskStatus != null" >
				        TASK_STATUS,
				      </if>
				      <if test="createTime != null" >
				        CREATE_TIME,
				      </if>
				      <if test="createUserCode != null" >
				        CREATE_USER_CODE,
				      </if>
				      <if test="createUserName != null" >
				        CREATE_USER_NAME,
				      </if>
				      <if test="createOrgCode != null" >
				        CREATE_ORG_CODE,
				      </if>
				      <if test="updateTime != null" >
				        UPDATE_TIME,
				      </if>
				      <if test="updateUserCode != null" >
				        UPDATE_USER_CODE,
				      </if>
				      <if test="updateUserName != null" >
				        UPDATE_USER_NAME,
				      </if>
				      <if test="updateOrgCode != null" >
				        UPDATE_ORG_CODE,
				      </if>
				      <if test="carOwner != null" >
				        CAR_OWNER,
				      </if>
				      <if test="zoneCode != null" >
				        ZONE_CODE,
				      </if>
				      <if test="truckFlag != null" >
				        TRUCK_FLAG
				      </if>
				      
				    </trim>
				    <trim prefix="values (" suffix=")" suffixOverrides="," >
				      <if test="id != null" >
				        #{id,jdbcType=VARCHAR},
				      </if>
			        <if test='schedulingId!=null'>
			        	#{schedulingId,jdbcType=VARCHAR},
			        </if>
			        <if test="pkpAreaNames!=null">
				      	#{pkpAreaNames,jdbcType=VARCHAR},
				      </if>
				      <if test="vehicleNo != null" >
				        #{vehicleNo,jdbcType=VARCHAR},
				      </if>
				      <if test="truckModel != null" >
				        #{truckModel,jdbcType=VARCHAR},
				      </if>
				      <if test="lineCode != null" >
				        #{lineCode,jdbcType=VARCHAR},
				      </if>
				      <if test="frequencyNo != null" >
				        #{frequencyNo,jdbcType=VARCHAR},
				      </if>
				      <if test="departTime != null" >
				        #{departTime,jdbcType=TIMESTAMP},
				      </if>
				      <if test="taskStatus != null" >
				        #{taskStatus,jdbcType=VARCHAR},
				      </if>
				      <if test="createTime != null" >
				        #{createTime,jdbcType=TIMESTAMP},
				      </if>
				      <if test="createUserCode != null" >
				        #{createUserCode,jdbcType=VARCHAR},
				      </if>
				      <if test="createUserName != null" >
				        #{createUserName,jdbcType=VARCHAR},
				      </if>
				      <if test="createOrgCode != null" >
				        #{createOrgCode,jdbcType=VARCHAR},
				      </if>
				      <if test="updateTime != null" >
				        #{updateTime,jdbcType=TIMESTAMP},
				      </if>
				      <if test="updateUserCode != null" >
				        #{updateUserCode,jdbcType=VARCHAR},
				      </if>
				      <if test="updateUserName != null" >
				        #{updateUserName,jdbcType=VARCHAR},
				      </if>
				      <if test="updateOrgCode != null" >
				        #{updateOrgCode,jdbcType=VARCHAR},
				      </if>
				      <if test="carOwner != null" >
				        #{carOwner,jdbcType=VARCHAR},
				      </if>
				      <if test="zoneCode != null" >
				        #{zoneCode,jdbcType=VARCHAR},
				      </if>
				      <if test="truckFlag != null" >
				        #{truckFlag,jdbcType=VARCHAR}
				      </if>
				      
			    </trim>	        
  </insert>
  
   <!--更新排班任务-->
  <update id="updateTruckSchedulingTask" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckSchedulingTaskEntity" >
    update TFR.T_OPT_TRUCK_SCHEDULING_TASK
    <set> 
      ID = #{id,jdbcType=VARCHAR},
      <if test="schedulingId != null and schedulingId != ''">
      	T_OPT_TRUCK_SCHEDULING_ID = #{schedulingId,jdbcType=VARCHAR},      	
      </if>
      VEHICLE_NO = #{vehicleNo,jdbcType=VARCHAR},
      TRUCK_MODEL = #{truckModel,jdbcType=VARCHAR},
      LINE_NO = #{lineNo,jdbcType=VARCHAR},
      FREQUENCY_NO = #{frequencyNo,jdbcType=VARCHAR},
      <!--<if test="pkpAreaNames!=null and pkpAreaNames!=''">-->
       	 Regional_Name=#{pkpAreaNames,jdbcType=VARCHAR},
      <!--</if>-->
      <!--<if test="deliveryRegionalNames!=null and deliveryRegionalNames!=''">-->
       	 DELIVERY_REGIONAL_NAME=#{deliveryRegionalNames,jdbcType=VARCHAR},
      <!--</if>-->
      <if test="isBringExpress!=null and isBringExpress!=''">
       	 IS_BRING_EXPRESS=#{isBringExpress,jdbcType=VARCHAR},
      </if> 
      <!--<if test="expectedBringVolume!=null and expectedBringVolume!=''">-->
       	 EXPECTED_BRING_VOLUME=#{expectedBringVolume,jdbcType=DECIMAL},
      <!--</if>--> 
      <if test="departTime != null and departTime != ''">
      	 DEPART_TIME = #{departTime,jdbcType=TIMESTAMP},
      </if>
      <if test="taskStatus != null and taskStatus != ''">     
     	 TASK_STATUS = #{taskStatus,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null and createTime != ''">     
      	CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUserCode != null and createUserCode != ''"> 
     	 CREATE_USER_CODE = #{createUserCode,jdbcType=VARCHAR},
       </if>
       <if test="createUserName != null and createUserName != ''">   
      	CREATE_USER_NAME = #{createUserName,jdbcType=VARCHAR},
       </if>
       <if test="createOrgCode != null and createOrgCode != ''">   
     	 CREATE_ORG_CODE = #{createOrgCode,jdbcType=VARCHAR},
       </if>
       <if test="updateTime != null and updateTime != ''">   
     	 UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
       </if>
       <if test="updateUserCode != null and updateUserCode != ''">   
    	  UPDATE_USER_CODE = #{updateUserCode,jdbcType=VARCHAR},
       </if>
       <if test="updateUserName != null and updateUserName != ''">   
    	  UPDATE_USER_NAME = #{updateUserName,jdbcType=VARCHAR},
       </if>
       <if test="updateOrgCode != null and updateOrgCode != ''">   
    	  UPDATE_ORG_CODE = #{updateOrgCode,jdbcType=VARCHAR},
       </if>
       <if test="zoneCode != null and zoneCode != ''">   
     	 ZONE_CODE=#{zoneCode,jdbcType=VARCHAR},
       </if>
       <if test="deliveryAreaCode != null and deliveryAreaCode != ''">   
     	 DELIVERY_AREA_CODE=#{deliveryAreaCode,jdbcType=VARCHAR},
       </if>
       <if test="carOwner != null and carOwner != ''">   
     	 CAR_OWNER=#{carOwner,jdbcType=VARCHAR},
       </if>       
       <if test="truckFlag != null and truckFlag != ''">   
     	 TRUCK_FLAG=#{truckFlag,jdbcType=VARCHAR},
       </if>
      <if test="dispatchVehicleTask != null and dispatchVehicleTask != ''">   
     	 DISPATCH_VEHICLE_TASK=#{dispatchVehicleTask,jdbcType=VARCHAR},
       </if>
       <if test="expectedDispatchVehicleTime != null and expectedDispatchVehicleTime != ''">   
     	 EXPECTED_DISPATCH_VEHICLE_TIME=#{expectedDispatchVehicleTime,jdbcType=VARCHAR},
       </if>
        <!-- <if test="isTheTwoTripTime != null and isTheTwoTripTime != ''">-->    
     	 IS_THE_TWO_TRIP_TIME=#{isTheTwoTripTime,jdbcType=VARCHAR},
       <!--</if>-->
         <!--<if test="takeGoodsDepartment != null and takeGoodsDepartment != ''">  -->  
     	 TAKE_GOODS_DEPARTMENT=#{takeGoodsDepartment,jdbcType=VARCHAR},
      <!--</if>-->
        <!--<if test="transferGoodsDepartment != null and transferGoodsDepartment != ''">-->   
     	 TRANSFER_GOODS_DEPARTMENT=#{transferGoodsDepartment,jdbcType=VARCHAR}
       <!--</if>-->
     </set>                
     where ID=#{id,jdbcType=VARCHAR}       
  </update>
  
  <!--删除对应计划的任务列表-->
   <delete id="deleteTasksByScheduleId" parameterType="java.lang.String">
    delete from TFR.T_OPT_TRUCK_SCHEDULING_TASK T
    where T.T_OPT_TRUCK_SCHEDULING_ID = #{schedulingId,jdbcType=VARCHAR}
  </delete>

  <!--删除对应计划的任务列表-->
   <delete id="delteTask" parameterType="java.lang.String">
    delete from TFR.T_OPT_TRUCK_SCHEDULING_TASK T
    where T.ID = #{scheduleTaskId,jdbcType=VARCHAR}
  </delete>
  
  <!--删除非工作状态的相应的计划的任务列表-->
   <delete id="deleteTasksForUnworkType" parameterType="java.util.List">
   	   BEGIN 
		<foreach  collection="list" item="item"  separator=";">
	     delete from  TFR.T_OPT_TRUCK_SCHEDULING_TASK T where exists	     
			  (
			  select 
				  T2.ID ID
			   from tfr.T_OPT_TRUCK_SCHEDULING T2
			   where T2.SCHEDULING_DEPART_CODE = #{item.schedulingDepartCode,jdbcType=VARCHAR}
				and T2.DRIVER_CODE = #{item.driverCode,jdbcType=VARCHAR}
				and T2.SCHEDULING_STATUS = #{item.schedulingStatus,jdbcType=VARCHAR}
				and T2.SCHEDULING_TYPE = #{item.schedulingtype,jdbcType=VARCHAR}	
				and T2.ID = T.T_OPT_TRUCK_SCHEDULING_ID				 				
				<![CDATA[ and T2.SCHEDULING_DATE >=to_date(#{item.ymd,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
				<![CDATA[ and T2.SCHEDULING_DATE <to_date(#{item.ymd,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>  
			  )     
      </foreach>
		;END;    
  </delete>
  
  <!--删除非工作状态的相应的计划的任务列表单条-->
   <delete id="deleteTasksForUnworkTypeOne" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto">   	  
	     delete from  TFR.T_OPT_TRUCK_SCHEDULING_TASK T where exists	     
			  (
			  select 
				  T2.ID ID
			   from tfr.T_OPT_TRUCK_SCHEDULING T2
			   where T2.SCHEDULING_DEPART_CODE = #{schedulingDepartCode,jdbcType=VARCHAR}
				and T2.DRIVER_CODE = #{driverCode,jdbcType=VARCHAR}
				and T2.SCHEDULING_STATUS = #{schedulingStatus,jdbcType=VARCHAR}
				and T2.SCHEDULING_TYPE = #{schedulingtype,jdbcType=VARCHAR}	
				and T2.ID = T.T_OPT_TRUCK_SCHEDULING_ID				 				
				<![CDATA[ and T2.SCHEDULING_DATE >=to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
				<![CDATA[ and T2.SCHEDULING_DATE <to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>  
			  )       
  </delete>
  
  
   <!--导出排班数据-->
  <select id="querySchedulingForExport" resultMap="ScheduleExcelDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >
  select 
        S.SCHEDULING_TYPE,
        S.DRIVER_ORG_CODE ,
        S.DRIVER_CODE,   
        S.SCHEDULING_DATE, 
        S.YEAR_MONTH,           
        S.PLAN_TYPE   ,        
        S.DRIVER_PHONE ,        
        ST.VEHICLE_NO,
        ST.CAR_OWNER,
        ST.ZONE_CODE ,                    
        ST.TRUCK_MODEL,                    
        ST.LINE_NO,                        
        ST.FREQUENCY_NO ,                  
        ST.DEPART_TIME,
        ST.TASK_NO,
        ST.Regional_Name
        from tfr.T_OPT_TRUCK_SCHEDULING S
        left join   tfr.T_OPT_TRUCK_SCHEDULING_TASK ST on  S.ID=ST.T_OPT_TRUCK_SCHEDULING_ID and S.SCHEDULING_STATUS=ST.TASK_STATUS
        where
        S.SCHEDULING_DEPART_CODE= #{schedulingDepartCode,jdbcType=VARCHAR}
        and S.SCHEDULING_STATUS=#{schedulingStatus,jdbcType=VARCHAR}	
        and S.YEAR_MONTH= #{yearMonth,jdbcType=VARCHAR}
        and S.Scheduling_Type= #{schedulingtype,jdbcType=VARCHAR}
        <if test="list != null">
        	and S.PLAN_TYPE in
	     	<foreach  collection="list" item="item"  separator="," open=" (" close=")">
						 #{item,jdbcType=VARCHAR}
			</foreach>	
		</if>         
        order by  S.DRIVER_ORG_CODE ,S.DRIVER_CODE,S.SCHEDULING_DATE, S.PLAN_TYPE 
  </select>
  
  <!--查询短途排班，车队小组、当天、线路、班次是否已经存在本班次的排班-->
   <select id="queryHasLineNoFrequencyNoCurrentDay" resultMap="ScheduleExcelDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >
	 select 
		   S.DRIVER_ORG_CODE,
		   ST.LINE_NO,
		   ST.FREQUENCY_NO,
		   S.Id SCHEDULE_ID,
		   ST.ID SCHEDULE_TASK_ID,
		   ST.VEHICLE_NO
		  from tfr.T_OPT_TRUCK_SCHEDULING S
		  left join tfr.T_OPT_TRUCK_SCHEDULING_TASK ST
			on S.ID = ST.T_OPT_TRUCK_SCHEDULING_ID
		   and S.SCHEDULING_STATUS = ST.TASK_STATUS
		   and S.SCHEDULING_STATUS = #{schedulingStatus,jdbcType=VARCHAR}
		 where S.Scheduling_Type = #{schedulingtype,jdbcType=VARCHAR}
		 <if test="ymd!=null and ymd !=''">
			 <![CDATA[ and S.SCHEDULING_DATE >=to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
			 <![CDATA[ and S.SCHEDULING_DATE <to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>  
			 and    S.SCHEDULING_DEPART_CODE =#{schedulingDepartCode,jdbcType=VARCHAR} 
			 and ST.LINE_NO=#{lineNo,jdbcType=VARCHAR}
			 and ST.FREQUENCY_NO=#{frequencyNo,jdbcType=VARCHAR}
		 </if>
		 <if test="scheduleTaskId!=null and scheduleTaskId !=''">
			 and ST.ID=#{scheduleTaskId,jdbcType=VARCHAR}
		 </if>	
			 		    
  </select>
  
   <!--查询接送货排班，车队小组、当天、司机是否已经安排过-->
   <select id="queryPKPDuliVehicleCurrentDay" resultMap="ScheduleExcelDtoResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >
	 select 
		   S.DRIVER_ORG_CODE,
		   ST.LINE_NO,
		   ST.FREQUENCY_NO,
		   S.Id SCHEDULE_ID,
		   ST.ID SCHEDULE_TASK_ID
		  from tfr.T_OPT_TRUCK_SCHEDULING S
		  left join tfr.T_OPT_TRUCK_SCHEDULING_TASK ST
			on S.ID = ST.T_OPT_TRUCK_SCHEDULING_ID
		   and S.SCHEDULING_STATUS = ST.TASK_STATUS
		   and S.SCHEDULING_STATUS = #{schedulingStatus,jdbcType=VARCHAR}
		 where S.Scheduling_Type = #{schedulingtype,jdbcType=VARCHAR}
		 <if test="ymd!=null and ymd !=''">
			 <![CDATA[ and S.SCHEDULING_DATE >=to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
			 <![CDATA[ and S.SCHEDULING_DATE <to_date(#{ymd,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>  
			 and S.SCHEDULING_DEPART_CODE =#{schedulingDepartCode,jdbcType=VARCHAR} 
			 and S.DRIVER_CODE=#{driverCode,jdbcType=VARCHAR}
			 and ST.VEHICLE_NO=#{vehicleNo,jdbcType=VARCHAR}
			 and ST.ZONE_CODE=#{zoneCode,jdbcType=VARCHAR}	
		 </if>
		 <if test="scheduleTaskId!=null and scheduleTaskId !=''">
			and ST.ID=#{scheduleTaskId,jdbcType=VARCHAR}
		 </if>	
			 		    
  </select>
  
  <!--根据ID列表删除计划任务列表-->
   <delete id="deleteTasksByScheduleTaskIds" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto">
    <if test="list!=null">
    	delete from TFR.T_OPT_TRUCK_SCHEDULING_TASK T
		where T.ID in
    	<foreach  collection="list" item="item"  separator="," open="  (" close=")">
		   #{item,jdbcType=VARCHAR}
	    </foreach>
    
    </if>
  </delete>
  
   <!--根据计划ID查询任务表中是否存在计划对应的任务数据-->
  <select id="queryTruckSchedulingTaskByScheduleId" resultType="Long" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckSchedulingEntity" >
  	select   
    	count(t.id)
    from TFR.T_OPT_TRUCK_SCHEDULING_TASK   t 
    where t.t_opt_truck_scheduling_id=#{id,jdbcType=VARCHAR}
  </select>
  
  <!--联合查询T_OPT_TRUCK_SCHEDULING_TASK,T_OPT_TRUCK_SCHEDULING,用于短途排班的简单查询和查询某司机的任务时使用-->
  <select id="queryFrequencyNosByline" resultMap="SchedulingAndTaskResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >   
	  select   S.DRIVER_CODE,
			   S.SCHEDULING_DATE,
			   S.PLAN_TYPE,
			   ST.VEHICLE_NO, /**车牌号**/
			   ST.TRUCK_MODEL, /**车型**/
			   ST.CAR_OWNER, /**车辆所属车队**/
			   ST.LINE_NO, /**线路**/       
			   ST.DEPART_TIME, /**发车时间**/
			   ST.FREQUENCY_NO, /**班次**/
			   ST.ZONE_CODE,
			   ST.ID SCHEDULE_TASK_ID,
			   ST.Regional_Name,
			   S.ID SCHEDULE_ID,
			   TO_CHAR(S.SCHEDULING_DATE, 'YYYY-MM-DD') ymd,
			   DR.EMP_NAME DRIVER_NAME,
			   DR.EMP_PHONE DRIVER_PHONE, /**司机电话**/
			   ORG.NAME DRIVER_ORG_NAME,
			   S.driver_org_code DRIVER_ORG_CODE
			  from tfr.T_OPT_TRUCK_SCHEDULING      S,
			   tfr.T_OPT_TRUCK_SCHEDULING_TASK ST,
			   BSE.T_BAS_OWNDRIVER         DR,
			   BSE.T_BAS_ORG               ORG 
			  where
			   S.ID = ST.T_OPT_TRUCK_SCHEDULING_ID
			   and S.DRIVER_CODE = DR.EMP_CODE(+)
			   and S.DRIVER_ORG_CODE= ORG.CODE(+)
			   and S.SCHEDULING_STATUS = ST.TASK_STATUS(+)
			   and S.SCHEDULING_STATUS =DR.active(+)
			   and S.SCHEDULING_STATUS=ORG.active(+)
			   and S.SCHEDULING_STATUS=#{schedulingStatus} /**有效状态**/			
			   and S.SCHEDULING_TYPE=#{schedulingtype}/**短途排班类型**/		
			   and S.PLAN_TYPE =#{planType}					
			   <![CDATA[ and S.SCHEDULING_DATE = #{schedulingDate,jdbcType=TIMESTAMP}]]> 
			   and ST.LINE_NO in 
				<foreach  collection="list" item="item"  separator="," open="(" close=")">
					#{item,jdbcType=VARCHAR}
				</foreach>							
  </select>
  
  
  <!--根据任务ID 查询排班任务信息 -->
  <select id="queryTruckSchedulingTaskById" resultMap="SchedulingAndTaskResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckSchedulingTaskEntity" >   
	  select   S.DRIVER_CODE,
			   S.SCHEDULING_DATE,
			   S.PLAN_TYPE,
			   ST.VEHICLE_NO, /**车牌号**/
			   ST.TRUCK_MODEL, /**车型**/
			   ST.CAR_OWNER, /**车辆所属车队**/
			   ST.LINE_NO, /**线路**/       
			   ST.DEPART_TIME, /**发车时间**/
			   ST.FREQUENCY_NO, /**班次**/
			   ST.ZONE_CODE,
			   ST.DELIVERY_AREA_CODE,
			   ST.ID SCHEDULE_TASK_ID,
			   ST.Regional_Name,
			   ST.DELIVERY_REGIONAL_NAME,
			   ST.IS_BRING_EXPRESS,
			   ST.EXPECTED_BRING_VOLUME,
			   S.ID SCHEDULE_ID,
			   TO_CHAR(S.SCHEDULING_DATE, 'YYYY-MM-DD') ymd,
			   DR.EMP_NAME DRIVER_NAME,
			   DR.EMP_PHONE DRIVER_PHONE, /**司机电话**/
			   ORG.NAME DRIVER_ORG_NAME,
			   S.driver_org_code DRIVER_ORG_CODE
			  from tfr.T_OPT_TRUCK_SCHEDULING      S,
			   tfr.T_OPT_TRUCK_SCHEDULING_TASK ST,
			   BSE.T_BAS_OWNDRIVER         DR,
			   BSE.T_BAS_ORG               ORG 
			  where
			   S.ID = ST.T_OPT_TRUCK_SCHEDULING_ID
			   and S.DRIVER_CODE = DR.EMP_CODE(+)
			   and S.DRIVER_ORG_CODE= ORG.CODE(+)
			   and S.SCHEDULING_STATUS = ST.TASK_STATUS(+)
			   and S.SCHEDULING_STATUS =DR.active(+)
			   and S.SCHEDULING_STATUS=ORG.active(+)
			   and ST.id=#{id} 
  </select>
  
  <!--根据计划查询排班任务-->
  <select id="queryLineInfoAndVehicleNo" resultMap="SchedulingAndTaskResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckSchedulingEntity" >   
	 select   
	 	 S.DRIVER_CODE,
         S.SCHEDULING_DATE,
         S.PLAN_TYPE,
         ST.VEHICLE_NO, /**车牌号**/
         ST.LINE_NO, /**线路**/
         ST.ZONE_CODE   
        from tfr.T_OPT_TRUCK_SCHEDULING      S,
             tfr.T_OPT_TRUCK_SCHEDULING_TASK ST
        where
         S.ID = ST.T_OPT_TRUCK_SCHEDULING_ID      
         and S.SCHEDULING_STATUS = ST.TASK_STATUS(+)
         and S.SCHEDULING_STATUS=#{schedulingStatus,jdbcType=VARCHAR}
         and S.DRIVER_CODE=#{driverCode,jdbcType=VARCHAR}
         and S.YEAR_MONTH=#{yearMonth,jdbcType=VARCHAR}
         and S.SCHEDULING_DEPART_CODE=#{schedulingDepartCode,jdbcType=VARCHAR}
         and S.SCHEDULING_TYPE=#{schedulingType,jdbcType=VARCHAR}
         and S.PLAN_TYPE=#{planType,jdbcType=VARCHAR}  
         order by S.SCHEDULING_DATE asc       	  
  </select>
  
  <!--通过车牌号及约车受理时间，读取短途排版表中的司机，如果获取多个司机-->
  <select id="queryTaskByVehicleNoAndDate" resultMap="SchedulingAndTaskResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >
	 select 
	 	s.driver_code,
	 	d.emp_name driver_name,
	 	s.driver_phone,
	 	s.driver_org_code
	    from tfr.t_opt_truck_scheduling s
	    join bse.t_bas_owndriver d 
	     on s.driver_code=d.emp_code and d.active=s.scheduling_status
		 where s.scheduling_date=to_date(#{ymd,jdbcType=VARCHAR},'YYYY-MM-DD')
		 and  s.scheduling_status=#{schedulingStatus} 
		 and exists (
		     select 1 from tfr.t_opt_truck_scheduling_task t where
		      t.t_opt_truck_scheduling_id=s.id and t.vehicle_no=#{vehicleNo} and t.task_status=#{schedulingStatus} 
		 )
  </select>   

  <!--根据排班id, 排班任务id, 车牌号, 线路号, 班次号查询排班任务. -->
  <select id="validateTruckSchedulingTask" resultMap="TruckSchedulingTaskResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto" >
	 select 
	 	<include refid="Task_Column_List" />
		from tfr.t_opt_truck_scheduling_task
	  where vehicle_no = #{vehicleNo}
	   and line_no = #{lineNo}
	   and frequency_no = #{frequencyNo}
	   and t_opt_truck_scheduling_Id = #{scheduleId}
	   <if test="scheduleTaskId!=null and scheduleTaskId!=''"> 
	   <![CDATA[ and id <> #{scheduleTaskId}]]>
	   </if>
  </select>   
  
  <!--跟据排班任务id删除定人定区接货区域-->
  <delete id="deleteTaskspkpAreabyId" parameterType="java.lang.String" >
  	 delete from tfr.t_Opt_Truck_Scheduling_Pkparea sp
  	  where sp.truck_scheduling_task_id=#{scheduleTaskId,jdbcType=VARCHAR}
  </delete>
  
  <!--跟据排班任务id删除定人定区接货区域-->
  <delete id="deleteTaskspkpArea" parameterType="HashMap" >
  	 delete from tfr.t_Opt_Truck_Scheduling_Pkparea sp
  	  where sp.truck_scheduling_task_id=#{scheduleTaskId,jdbcType=VARCHAR}
  	   and sp.region_type=#{regionType,jdbcType=VARCHAR}
  </delete>
  
  <!--新增非工作日定人定区接货小区-->
  <insert id="addTaskspkpArea" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.domain.TruckSchedulingZoneEntity">
  	insert into tfr.t_Opt_Truck_Scheduling_Pkparea 
		(
		id ,
		truck_scheduling_task_id ,
		area_name ,
		area_code ,
		create_user_name ,
		create_user_code ,
		create_time,
		region_Type 
		)
		values(
		#{id,jdbcType=VARCHAR},
		#{truckSchedulingTaskId,jdbcType=VARCHAR},
		#{zoneName,jdbcType=VARCHAR},
		#{zoneCode,jdbcType=VARCHAR},
		#{createUserName,jdbcType=VARCHAR},
		#{createUserCode,jdbcType=VARCHAR},
		#{createTime,jdbcType=TIMESTAMP},
		#{regionType,jdbcType=TIMESTAMP}
		)
  </insert>
  <!--通过车牌号查询最近的非工作日排班-->
  <select id="queryPkpAreaInfoByVehicleNo" resultMap="SchedulingZoneResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto">
  	select 
  		sp.id id,
		sp.truck_scheduling_task_id truckSchedulingTaskId,
		sp.area_name zoneName,
		sp.area_code zoneCode,
		sp.create_user_name createUserName,
		sp.create_user_code createUserCode,
		sp.create_time createTime,
		sp.region_Type  regionType 
  	 from tfr.t_opt_truck_scheduling_pkparea sp 
		where sp.truck_scheduling_task_id in (
			select id from (
				select  st.id from tfr.t_Opt_Truck_Scheduling_Pkparea sp
				inner join tfr.t_Opt_Truck_Scheduling_Task st on st.id=sp.truck_scheduling_task_id and st.task_status='Y'
				
				where st.vehicle_no=#{vehicleNo,jdbcType=VARCHAR} order by st.update_time desc
				 ) where  rownum =1
		) 

  </select>
  <!--查询节假日排班信息-->
  <select id="querySchedulingZoneInfo" resultMap="SchedulingZoneResultMap" parameterType="HashMap">
  	select
  		st.id					truckSchedulingTaskId, 
  		st.vehicle_no  			vehicleNo,
  		ts.driver_code 			driverCode,
  		ow.emp_name				driverName, 
  		ts.scheduling_date 		schedulTime,
  		ts.driver_org_code 		vehicleTeamCode,
  		og.name					vehicleTeamName,
  		sp.area_code 			regionCode
		from tfr.t_opt_truck_scheduling ts 
		inner join tfr.t_opt_truck_scheduling_task st on ts.id=st.t_opt_truck_scheduling_id 
		inner join tfr.t_Opt_Truck_Scheduling_Pkparea sp on sp.truck_scheduling_task_id=st.id
		inner join bse.t_bas_owndriver ow on ow.emp_code=ts.driver_code and ow.active='Y'
		inner join bse.t_bas_org og on og.code=ts.driver_org_code and og.active='Y'
		where st.task_status='Y'
		and ts.scheduling_status='Y' and ts.scheduling_type='PKP'
		<![CDATA[ and ts.SCHEDULING_DATE >=to_date(#{queryTime,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
		<![CDATA[ and ts.SCHEDULING_DATE <to_date(#{queryTime,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]> 
		<if test="zoneCode!=null and zoneCode!=''">
			and sp.area_code=#{zoneCode,jdbcType=VARCHAR}
		</if>
		<if test="vehilceNo!=null and vehilceNo!=''">
			and st.vehicle_no=#{vehilceNo,jdbcType=VARCHAR}
		</if>
  </select>
 	<!-- 通过车牌号查询司机 -->
 	<select id="queryDriverByVehicle" resultMap="SchedulingZoneResultMap" parameterType="HashMap">
 		select 
  		st.vehicle_no  			vehicleNo,
  		ts.driver_code 			driverCode,
  		ow.emp_name				driverName, 
  		ts.scheduling_date 		schedulTime,
  		ts.driver_org_code 		vehicleTeamCode,
  		og.name					vehicleTeamName
		from tfr.t_opt_truck_scheduling ts 
		inner join tfr.t_opt_truck_scheduling_task st on ts.id=st.t_opt_truck_scheduling_id 
		inner join bse.t_bas_owndriver ow on ow.emp_code=ts.driver_code and ow.active='Y'
		inner join bse.t_bas_org og on og.code=ts.driver_org_code and og.active='Y'
		where st.task_status='Y'
		and ts.scheduling_status='Y' and ts.scheduling_type='PKP'
		<![CDATA[ and ts.SCHEDULING_DATE >=to_date(#{queryTime,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
		<![CDATA[ and ts.SCHEDULING_DATE <to_date(#{queryTime,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]> 
		<if test="vehilceNo!=null and vehilceNo!=''">
			and st.vehicle_no=#{vehilceNo,jdbcType=VARCHAR}
		</if>
 	</select>
 	<!-- 通过车牌号查询是否带快递货， 带快递货方数，班次 -->
 	<select id='queryTruckByVehicle' resultMap="SchedulingAndTaskResultMap" parameterType="HashMap">
 		select st.frequency_no,
 			   st.is_bring_express,
 			   st.expected_bring_volume 
       	from tfr.t_opt_truck_scheduling ts,
             tfr.t_opt_truck_scheduling_task st
        where ts.id=st.t_opt_truck_scheduling_id
          and ts.scheduling_status='Y'
          and st.task_status = 'Y'
		  and ts.scheduling_type='PKP'
          <![CDATA[ and ts.SCHEDULING_DATE >=to_date(#{queryTime,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
		  <![CDATA[ and ts.SCHEDULING_DATE <to_date(#{queryTime,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>
         <if test="vehilceNo!=null and vehilceNo!=''">
		 	and st.vehicle_no=#{vehilceNo,jdbcType=VARCHAR}
		 </if>
 	</select>
 	
 		<!-- 根据车牌号和送货时间查询车辆净空，车辆载重, 带快递货方数，班次，车型,出车任务，预计出车时间，带货部门code，转货部门code,预计二次出车时间,带货部门名称，转货部门名称-->
 		<!-- @date:2015-07-27,@author:gongjp-->
 	<select id='queryTruckByVehicleAndDiliverGoodsTime' resultMap="SchedulingAndTaskResultMap" parameterType="HashMap">
 		      select st.frequency_no,
 		       st.expected_bring_volume ,
 		       st.is_bring_express,
 			   st.DISPATCH_VEHICLE_TASK,
 			   st.EXPECTED_DISPATCH_VEHICLE_TIME,
 			   st.IS_THE_TWO_TRIP_TIME,
 			   st.TAKE_GOODS_DEPARTMENT,
 			    (select distinct b.name  from  BSE.T_BAS_ORG  b where b.code=st.take_goods_department and b.active='Y' and rownum=1) takeGoodsDepartmentName,
 			   st.TRANSFER_GOODS_DEPARTMENT,
 			   (select distinct b.name from  BSE.T_BAS_ORG  b where b.code=st.TRANSFER_GOODS_DEPARTMENT  and b.active='Y' and rownum=1)  transferGoodsDepartmentName 
       	from tfr.t_opt_truck_scheduling ts,
             tfr.t_opt_truck_scheduling_task st
        where ts.id=st.t_opt_truck_scheduling_id
          and ts.scheduling_status='Y'
          and st.task_status = 'Y'
		  and ts.scheduling_type='PKP'
          <![CDATA[ and ts.SCHEDULING_DATE >=to_date(#{diliverGoodsTime,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
		  <![CDATA[ and ts.SCHEDULING_DATE <to_date(#{diliverGoodsTime,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>
         <if test="vehilceNo!=null and vehilceNo!=''">
		 	and st.vehicle_no=#{vehilceNo,jdbcType=VARCHAR}
		 </if>
 	</select>
 		
 		
 	<!-- 通过车牌号查询车辆信息 -->
 	<select id='queryTaskByZoneCodeAndDate' resultMap="SchedulingAndTaskResultMap" parameterType="HashMap">
 		select st.vehicle_no 
		from tfr.t_opt_truck_scheduling ts,
     		tfr.t_opt_truck_scheduling_task st,
     		TFR.T_OPT_TRUCK_SCHEDULING_PKPAREA p
		where ts.id=st.t_opt_truck_scheduling_id
      		and st.id = p.truck_scheduling_task_id
      		and ts.scheduling_status='Y'
      		and st.task_status = 'Y'
      		and ts.scheduling_type='PKP'
      		<![CDATA[ and ts.SCHEDULING_DATE >=to_date(#{Ymd,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
		  	<![CDATA[ and ts.SCHEDULING_DATE <to_date(#{Ymd,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>
      		and p.area_code=#{zoneCode,jdbcType=VARCHAR}
 	</select>
 	
 	
 	<!--通过车牌号和时间查询接送货小区code，接送货类型，接送货区域名称 -->
 	<!--@author:gongjp,@Date 2015-07-31-->
 	<select id='queryReceivingAreaByVehicleAndDate' resultMap="SchedulingZoneResultMap" parameterType="HashMap">
 		select p.AREA_CODE zoneCode,
 			   p.AREA_NAME zoneName,
 			   p.REGION_TYPE regionType		 
		from tfr.t_opt_truck_scheduling ts,
     		tfr.t_opt_truck_scheduling_task st,
     		TFR.T_OPT_TRUCK_SCHEDULING_PKPAREA p
		where ts.id=st.t_opt_truck_scheduling_id
      		and st.id = p.truck_scheduling_task_id
      		and ts.scheduling_status='Y'
      		and st.task_status = 'Y'
      		and ts.scheduling_type='PKP'
      		<![CDATA[ and ts.SCHEDULING_DATE >=to_date(#{Ymd,jdbcType=VARCHAR},'yyyy-mm-dd')]]>  
		  	<![CDATA[ and ts.SCHEDULING_DATE <to_date(#{Ymd,jdbcType=VARCHAR},'yyyy-mm-dd')+1]]>
      	<if test="vehicleNo!=null and vehicleNo!=''">
		 	and st.vehicle_no=#{vehicleNo,jdbcType=VARCHAR}
		 </if>
 	</select>

 	<!-- 查询排班任务  -->
 	<select id="queryTruckSchedulingTask" resultMap="TruckSchedulingTaskResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto">
 		select 
 		<include refid="Task_Column_List" />
 		 from tfr.t_Opt_Truck_Scheduling_Task t 
 		 where t.t_opt_truck_scheduling_id = #{scheduleId}
 	</select>
 	
 	<select id="queryTruckSchedulingPkpAreaInfo" resultMap="SchedulingZoneResultMap" parameterType="com.deppon.foss.module.transfer.scheduling.api.shared.dto.SimpleTruckScheduleDto">
 		select 
			tsp.id id,
			tsp.truck_scheduling_task_id truckSchedulingTaskId,
			tsp.area_name zoneName,
			tsp.area_code zoneCode,
			tsp.create_user_name createUserName,
			tsp.create_user_code createUserCode,
			tsp.create_time  createTime
			from tfr.t_Opt_Truck_Scheduling_Pkparea tsp
			where tsp.truck_scheduling_task_id=#{scheduleTaskId,jdbcType=VARCHAR}
			
 	</select>
 	
 	<!--根据部门code查询部门名称-->
 	 	<select id="queryOrgInfoByCode" resultType="String" parameterType="java.lang.String">
 
          SELECT b.name FROM BSE.T_BAS_ORG  b where b.code=#{code,jdbcType=VARCHAR} and active='Y'
			
 	</select>
</mapper>