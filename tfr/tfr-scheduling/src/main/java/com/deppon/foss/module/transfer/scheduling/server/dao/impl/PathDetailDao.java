/**
 *  initial comments.
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 *  
 */
/*******************************************************************************
 * Copyright 2013 TFR TEAM
 *  
 *  Licensed under the DEPPON License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *  
 *     http://www.deppon.com/licenses/LICENSE-2.0
 *  
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *  
 *  PROJECT NAME  : tfr-scheduling
 *  
 *  PACKAGE NAME  : 
 * 
 *  DESCRIPTION   : 调度、发车计划、排班、月台、车辆管理等
 *  
 *  FILE PATH     :src/main/java/com/deppon/foss/module/transfer/scheduling/server/dao/impl/PathDetailDao.java
 * 
 *  FILE NAME     :PathDetailDao.java
 *  
 *  AUTHOR        : FOSS中转开发组
 *  
 *  TIME          : 
 *  
 *  HOME PAGE     :  http://www.deppon.com
 *  
 *  COPYRIGHT     : Copyright (c) 2013  Deppon All Rights Reserved.
 * 
 *  VERSION       :0.1
 * 
 *  LAST MODIFY TIME:
 ******************************************************************************/
package com.deppon.foss.module.transfer.scheduling.server.dao.impl;

import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.cxf.common.util.StringUtils;
import org.springframework.util.CollectionUtils;

import com.deppon.foss.framework.server.components.dataaccess.ibatis.iBatis3DaoImpl;
import com.deppon.foss.module.transfer.common.api.shared.exception.TfrBusinessException;
import com.deppon.foss.module.transfer.scheduling.api.define.TransportPathConstants;
import com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao;
import com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity;
import com.deppon.foss.util.UUIDUtils;


/**
 * 路径明细dao实现
 * @author huyue
 * @date 2012-10-11 下午9:13:22
 */
public class PathDetailDao extends iBatis3DaoImpl implements IPathDetailDao{

	private static final String NAMESPACE = "Foss.pathDetail.";
	
	/**
	 * 查询路径明细LIST
	 * @author huyue
	 * @date 2012-10-18 下午6:41:24
	 */
	@SuppressWarnings("unchecked")
	public List<PathDetailEntity> queryPathDetailList(PathDetailEntity pathDetailEntity) {
		
		return getSqlSession().selectList(NAMESPACE + "pathDetailQuery", pathDetailEntity);
		
	}
	
	/**
	 * 查询路径明细LIST 如果状态为空则默认查询状态不等于再离开的条目
	 * @author huyue
	 * @date 2013-1-17 上午9:53:38
	 */
	@SuppressWarnings("unchecked")
	public List<PathDetailEntity> pathDetailNotReleave(PathDetailEntity pathDetailEntity) {
		
		return getSqlSession().selectList(NAMESPACE + "pathDetailNotReleave", pathDetailEntity);
		
	}
	
	@SuppressWarnings("unchecked")
	//@Override
	public List<PathDetailEntity> pathDetailNotReleave4OnlyOne(PathDetailEntity pathDetailEntity) {
		
		return getSqlSession().selectList(NAMESPACE + "pathDetailNotReleave4OnlyOne", pathDetailEntity);
		
	}
	
	
	/** 
	 * 查询路径明细
	 * @author huyue
	 * @date 2012-10-25 下午5:25:34
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryPathDetail(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	public PathDetailEntity queryPathDetail(PathDetailEntity pathDetailEntity){
		
		return (PathDetailEntity) getSqlSession().selectOne(NAMESPACE + "pathDetailQuery", pathDetailEntity);
		
	}
	
	/**
	 * 用于多货修改路径 找到ARRIVE_OR_LEAVE字段不为空的LIST倒序排列
	 * @author huyue
	 * @date 2012-11-12 下午8:14:40
	 */
	@SuppressWarnings("unchecked")
	public List<PathDetailEntity> queryWrong(PathDetailEntity pathDetailEntity){
		
		String statement = NAMESPACE + "pathWrong";
		return getSqlSession().selectList(statement, pathDetailEntity);
		
	}

	/**
	 * 新增路径明细信息 自动筛选有值字段
	 * @author huyue
	 * @date 2012-10-18 下午6:41:43
	 */
	public int addPathDetailSelect(PathDetailEntity pathDetailEntity) {
		String statement = NAMESPACE + "insertSelective";
		deletePathDetailEntity(pathDetailEntity);
		return getSqlSession().insert(statement, pathDetailEntity);
	}
	
	/**
	 * 新增路径明细信息
	 * @author huyue
	 * @date 2012-10-18 下午6:42:00
	 */
	public int addPathDetail(PathDetailEntity pathDetailEntity) {
		String statement = NAMESPACE + "insert";
		deletePathDetailEntity(pathDetailEntity);
		return getSqlSession().insert(statement, pathDetailEntity);
	}
	
	/**
	 * 批量新增路径明细信息
	 * 
	 * @author huyue
	 * @date 2012-10-18 下午6:42:09
	 */
	public int addListPathDetail(List<PathDetailEntity> pathDetailList) {

		// modify by liangfuxiang 2013-4-7下午7:01:11 begin 为解决大数据量宕机问题，修改为批量提交（每次最多提交100笔记录)
		// return getSqlSession().insert(NAMESPACE + "insertList", pathDetailList);
		return this.dealPathDetailList(pathDetailList, "insertList");
		// modify by liangfuxiang 2013-4-7下午7:02:28 end
	}
	
	
	/**
	 * 批量新增路径明细信息
	 * @author 140222 songjie
	 * @date 2015-10-27上午8:51:01
	 * @param pathDetailList
	 * @param insertPathType
	 * @return
	 */
	@Override
	public int addListPathDetail(List<PathDetailEntity> pathDetailList,
			String insertPathType) {
		if(org.apache.commons.lang3.StringUtils.isBlank(insertPathType)){
			insertPathType = "insertList";
		}
		// modify by liangfuxiang 2013-4-7下午7:01:11 begin 为解决大数据量宕机问题，修改为批量提交（每次最多提交100笔记录)
		// return getSqlSession().insert(NAMESPACE + "insertList", pathDetailList);
		return this.dealPathDetailList(pathDetailList, insertPathType);
		// modify by liangfuxiang 2013-4-7下午7:02:28 end
	}

	/**
	 * 
	 * @Title: PathDetailList
	 * @Description: 解决大数据量宕机问题，修改为批量提交（每次最多提交100笔记录)
	 * @param pathDetailList
	 * @param dealType
	 * @return 设定文件
	 * @return int 返回类型
	 * @see PathDetailList
	 * @author: liangfuxiang liangfux@cn.ibm.com
	 * @version: 2013-4-7 下午7:14:14
	 * @throws
	 */
	private int dealPathDetailList(List<PathDetailEntity> pathDetailList, String dealType) {

		if (!CollectionUtils.isEmpty(pathDetailList)) {
//			Integer count = pathDetailList.size();
//			int n = count / 100;
			// 数量小于100，直接提交
//			if (n < 1) {
//				return getSqlSession().insert(NAMESPACE + dealType, pathDetailList);
//			}
//			else {
//
//				int returnCount = 0;
//				int mod = count % 100;
//				// 先保存余数（用100取余）
//				if (mod > 0) {
//					returnCount = getSqlSession().insert(NAMESPACE + dealType, new ArrayList<PathDetailEntity>(pathDetailList.subList(n * 100, n * 100 + mod)));
//				}
//
//				// 保存100整数倍数据集
//				for (int i = 0; i < n; i++) {
//					List<PathDetailEntity> newPathDetailList = new ArrayList<PathDetailEntity>(pathDetailList.subList(i * 100, (i + 1) * 100));
//					returnCount += getSqlSession().insert(NAMESPACE + dealType, newPathDetailList);
//				}
//
//				return returnCount;
//			}
			String addFlag = null;
			if(dealType.equalsIgnoreCase("noDeleteInsert")){
				addFlag = "noDeleteToInsert";
				dealType = "insertList";
			}
			
			String statement = NAMESPACE + dealType;
			int j =0;
			if(pathDetailList!=null){
				for(int i=0;i<pathDetailList.size();i++ ){
					PathDetailEntity e = pathDetailList.get(i);
					
					// modify by liangfuxiang 2013-7-9上午11:33:40 begin BUG-43356 处理卸车差异报告时异常报错----为防止重复异常，现插入前，先做删除操作。
					if(dealType.equalsIgnoreCase("insertList")){
						if(org.apache.commons.lang3.StringUtils.isNotBlank(addFlag) && "noDeleteToInsert".equals(addFlag)){
							//执行类型 不需要先删除后插入(该判断只为开单创建走货路径调用)
						}else{
							deletePathDetailEntity(e);
						}
						
					}
					// modify by liangfuxiang 2013-7-9上午11:34:16 end BUG-43356 ;
					
					// modify by liangfuxiang 2013-6-25下午3:34:28 begin BUG-33307
					// 防止id为空
					if (StringUtils.isEmpty(e.getPathDetailId())) {
						e.setPathDetailId(UUIDUtils.getUUID());
					}
					// modify by liangfuxiang 2013-6-25下午3:35:49 end BUG-33307;
					
					j=j+getSqlSession().insert(statement, e);
				}
			}
			return j;
		}
		return 0;
	}
	
	/** 
	* @Title: deletePathDetailEntity 
	* @Description: 为防止重复异常，现插入前，先做删除操作。
	* @param e  设定文件 
	* @return void    返回类型 
	* @see deletePathDetailEntity
	* @author: liangfuxiang liangfux@cn.ibm.com  
	* @version: 2013-7-9 上午11:36:12   
	* @throws 
	*/ 
	private void deletePathDetailEntity(PathDetailEntity e) {
		PathDetailEntity tempPathDetailEntity=new PathDetailEntity();
		tempPathDetailEntity.setWaybillNo(e.getWaybillNo());
		tempPathDetailEntity.setGoodsNo(e.getGoodsNo());
		tempPathDetailEntity.setRouteNo(e.getRouteNo());
		String statement = NAMESPACE + "deletePathDetailEntity";
		getSqlSession().delete(statement, tempPathDetailEntity);
	}

	/**
	 * 根据PKID更新路径明细信息 自动筛选有值字段
	 * @author huyue
	 * @date 2012-10-18 下午6:42:17
	 */
	public int updatePathDetailSelect(PathDetailEntity pathDetailEntity) {
		String statement = NAMESPACE + "updateByPrimaryKeySelective";
		return getSqlSession().insert(statement, pathDetailEntity);
	}
	
	/**
	 * 根据PKID更新路径明细信息
	 * @author huyue
	 * @date 2012-10-18 下午6:42:26
	 */
	public int updatePathDetail(PathDetailEntity pathDetailEntity) {
		String statement = NAMESPACE + "updateByPrimaryKey";
		return getSqlSession().insert(statement, pathDetailEntity);
	}
	
	/**
	 * 批量更新路径明细信息
	 * @author huyue
	 * @date 2012-10-18 下午6:42:46
	 */
	public int updateListPathDetail(List<PathDetailEntity> pathDetailList) {
		// modify by liangfuxiang 2013-4-7下午7:01:11 begin 为解决大数据量宕机问题，修改为批量提交（每次最多提交100笔记录)
		// return getSqlSession().insert(NAMESPACE + "updateList", pathDetailList);
		return this.dealPathDetailList(pathDetailList, "updateList");
		// modify by liangfuxiang 2013-4-7下午7:02:28 end
	}

	/**
	 * 批量删除路径明细信息
	 * @author huyue
	 * @date 2012-10-26 上午9:17:36
	 */
	public int deleteListPathDetail(List<PathDetailEntity> pathDetailList){

		String statement = NAMESPACE + "deleteList";
		int j =0;
		if(pathDetailList!=null){
			for(int i=0;i<pathDetailList.size();i++ ){
				PathDetailEntity e = pathDetailList.get(i);
				
				if(StringUtils.isEmpty(e.getWaybillNo())){
					logger.error("PathDetailDao[deleteListPathDetail()]:"+TransportPathConstants.WAYBILL_NO_DELETE_IS_NULL);
					throw new TfrBusinessException(TransportPathConstants.WAYBILL_NO_DELETE_IS_NULL_GLOB);
				}
				
				j=j+ getSqlSession().delete(statement, e);
			}
			
		}
		return j;
	}
	
	/**
	 * 根据运单号查询所有运单内货件号.如果已包装则查询包装后件号
	 * @author huyue
	 * @date 2012-10-26 上午10:07:14
	 */
	@SuppressWarnings("unchecked")
	public List<String> listQueryGoodsNo(String waybillNo){
		String statement = NAMESPACE + "listQueryGoodsNo";
		return getSqlSession().selectList(statement, waybillNo);
	}
	
	/**
	 * 查询运单中货件号,以剩余线路段数排序 by notLeave
	 * @author huyue
	 * @param waybillNo 运单号
	 * @date 2012-11-19 下午5:11:20
	 */
	@SuppressWarnings("unchecked")
	public List<String> listFastGoodsNo(PathDetailEntity pathDetailEntity){
		String statement = NAMESPACE + "listFastGoodsNo";
		return getSqlSession().selectList(statement, pathDetailEntity);
	}

	/**
	 * 查询运单中货件号,以剩余线路段数排序 by releave
	 * @author huyue
	 * @param waybillNo 运单号
	 * @date 2012-11-19 下午5:11:20
	 */
	@SuppressWarnings("unchecked")
	public List<String> listFastGoodsNoByReleave(PathDetailEntity pathDetailEntity){
		String statement = NAMESPACE + "listFastGoodsNoByReleave";
		return getSqlSession().selectList(statement, pathDetailEntity);
	}
	
	/**
	 * 根据运单号,路段标号等字段查询路段编号大于该段段号的走货路径明细条目
	 * @author huyue
	 * @date 2012-10-26 上午10:40:42
	 */
	@SuppressWarnings("unchecked")
	public List<PathDetailEntity> listQueryNextStep(PathDetailEntity pathDetailEntity) {
		return getSqlSession().selectList(NAMESPACE + "listQueryNextStep", pathDetailEntity);
	}
	
	/**
	 * 查询外场到达时间最晚一条
	 * @author huyue
	 * @date 2012-11-23 下午5:02:38
	 */
	public Date queryMaxArriveTime(String objectiveOrgCode){
		return (Date) getSqlSession().selectOne(NAMESPACE + "maxArriveTime", objectiveOrgCode);
	}
	
	/**
	 * 查询外场出发时间最晚一条
	 * @author huyue
	 * @date 2012-11-23 下午5:19:49
	 */
	public Date queryMaxStartTime(String origOrgCode){
		return (Date) getSqlSession().selectOne(NAMESPACE + "maxStartTime", origOrgCode);
	}
	
	/**
	 * 查询外场到达的部门LIST
	 * @author huyue
	 * @date 2012-12-18 下午12:30:37
	 */
	@SuppressWarnings("unchecked")
	public List<String> queryArriveRelevantOrgCode(Map<String, Object> map){
		return getSqlSession().selectList(NAMESPACE + "queryArriveRelevantOrgCode", map);
	}
	
	/**
	 * 查询外场到达货量
	 * @author huyue
	 * @date 2012-11-23 下午5:33:24
	 */
	@SuppressWarnings("unchecked")
	public List<PathDetailEntity> queryArrive(Map<String, Object> map){
		return getSqlSession().selectList(NAMESPACE + "queryArrive", map);
	}
	
	/**
	 * 查询外场出发的部门LIST
	 * @author huyue
	 * @date 2012-12-18 下午12:30:37
	 */
	@SuppressWarnings("unchecked")
	public List<String> departRelevantOrgCode(Map<String, Object> map){
		return getSqlSession().selectList(NAMESPACE + "queryDepartRelevantOrgCode", map);
	}
	
	/**
	 * 查询外场出发开单货量
	 * @author huyue
	 * @date 2012-11-23 下午5:39:42
	 */
	@SuppressWarnings("unchecked")
	public List<PathDetailEntity> queryStartBilling(Map<String, Object> map){
		return getSqlSession().selectList(NAMESPACE + "queryStartBilling", map);
	}
	
	/**
	 * 查询外场出发非开单货量
	 * @author huyue
	 * @date 2012-11-23 下午5:40:09
	 */
	@SuppressWarnings("unchecked")
	public List<PathDetailEntity> queryStartNotBilling(Map<String, Object> map){
		return getSqlSession().selectList(NAMESPACE + "queryStartNotBilling", map);
	}
	
	/**
	 * 查询非开单或到达目的营业部的明细list group by 启始部门,到达部门,启始时间,到达时间,下一到达部门
	 * @author huyue
	 * @date 2012-12-24 下午5:40:48
	 */
	@SuppressWarnings("unchecked")
	public List<PathDetailEntity> generalQuery(PathDetailEntity pathDetailEntity){
		return getSqlSession().selectList(NAMESPACE + "generalQuery", pathDetailEntity);
	}
	
	/**
	 * 查询开单或到达目的地的明细list group by 启始部门,到达部门,启始时间,到达时间,下一到达部门
	 * @author huyue
	 * @date 2012-12-24 下午5:48:51
	 */
	@SuppressWarnings("unchecked")
	public List<PathDetailEntity> generalQueryNot(PathDetailEntity pathDetailEntity){
		return getSqlSession().selectList(NAMESPACE + "generalQueryNot", pathDetailEntity);
	}
	
	/**
	 * 根据条件获取匹配的运单号
	 * @author huyue
	 * @date 2012-12-24 下午5:45:25
	 */
	@SuppressWarnings("unchecked")
	public List<String> generalGoodsNoList(PathDetailEntity pathDetailEntity){
		return getSqlSession().selectList(NAMESPACE + "generalGoodsNoList", pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#pathDetailNotReleaveFromMigration(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */

	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> pathDetailNotReleaveFromMigration(PathDetailEntity pathDetailEntity) {
		return getSqlSession().selectList(NAMESPACE + "pathDetailNotReleaveFromMigration", pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryPathDetailFromMigration(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> queryPathDetailFromMigration(PathDetailEntity pathDetailEntity) {
		return getSqlSession().selectList(NAMESPACE + "queryPathDetailFromMigration", pathDetailEntity);
	}
	
	/**
	 * 查询简单路径明细LIST,重新生成走货路径界面使用
	 * @author peng.z
	 * @date 2013-05-29 下午5:49:53
	 */
	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> querySimplePathDetailList(PathDetailEntity pathDetailEntity) {
		return getSqlSession().selectList(NAMESPACE + "pathDetailSimpleQuery", pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#listFastGoodsNoFromMigration(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */

	@SuppressWarnings("unchecked")
	@Override
	public List<String> listFastGoodsNoFromMigration(PathDetailEntity pathDetail) {
		String statement = NAMESPACE + "listFastGoodsNoFromMigration";
		return getSqlSession().selectList(statement, pathDetail);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#listFastGoodsNoByReleaveFromMigration(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */

	@SuppressWarnings("unchecked")
	@Override
	public List<String> listFastGoodsNoByReleaveFromMigration(PathDetailEntity pathDetail) {
		String statement = NAMESPACE + "listFastGoodsNoByReleaveFromMigration";
		return getSqlSession().selectList(statement, pathDetail);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryPathDetailReleave(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> queryPathDetailReleave(PathDetailEntity pathDetailEntity) {
		return getSqlSession().selectList(NAMESPACE + "queryPathDetailReleave", pathDetailEntity);
	}


	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.ITransportationPathDao#queryMaxRouteNo(java.util.Map)
	 */
	@SuppressWarnings("unchecked")
	@Override
	public List<String> queryMaxRouteNo(Map<String, String> maxRouteNoMap) {
		return this.getSqlSession().selectList(NAMESPACE + "queryMaxRouteNo", maxRouteNoMap);
	}

	  
	    /* (non-Javadoc)   
	     * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#getNeedsOldPathDetailList(java.util.Map)   
	     */   
	    
	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> getNeedsOldPathDetailList(Map<String, String> needsOldMap) {
		return this.getSqlSession().selectList(NAMESPACE + "getNeedsOldPathDetailList", needsOldMap);
	}
	
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryMaxReleavePathDetailEntityList(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */

	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> queryMaxReleavePathDetailEntityList(PathDetailEntity pathDetailEntity) {
		return getSqlSession().selectList(NAMESPACE + "queryMaxReleavePathDetailEntityList", pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#updateBeforePathDetailList(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@Override
	public void updateBeforePathDetailList(PathDetailEntity maxReleavePathDetailEntity) {
		String statement = NAMESPACE + "updateBeforePathDetailList";
		this.getSqlSession().update(statement, maxReleavePathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#updatePathDetailMaxRouteNo(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@Override
	public void updatePathDetailMaxRouteNo(PathDetailEntity pathDetailEntity) {
		String statement = NAMESPACE + "updatePathDetailMaxRouteNo";
		this.getSqlSession().update(statement, pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#updateBeforePathDetailEntityForReleave(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */

	@Override
	public void updateBeforePathDetailEntityForReleave(PathDetailEntity pathDetailEntity) {
		String statement = NAMESPACE + "updateBeforePathDetailEntityForReleave";
		this.getSqlSession().update(statement, pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#updateBehindPathDetailForNotLeave(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@Override
	public void updateBehindPathDetailForNotLeave(PathDetailEntity notLeavePathDetailEntity) {
		String statement = NAMESPACE + "updateBehindPathDetailForNotLeave";
		this.getSqlSession().update(statement, notLeavePathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#deleteBehindPathDetailEntityWithOrigOrgCode(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity
	 * )
	 */
	@Override
	public void deleteBehindPathDetailEntityWithOrigOrgCode(PathDetailEntity pde) {
		String statement = NAMESPACE + "deleteBehindPathDetailEntityWithOrigOrgCode";
		this.getSqlSession().update(statement, pde);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#updateBeforePathDetailEntityWithOrigOrgCode(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity
	 * )
	 */
	@Override
	public void updateBeforePathDetailEntityWithOrigOrgCode(PathDetailEntity pde) {
		String statement = NAMESPACE + "updateBeforePathDetailEntityWithOrigOrgCode";
		this.getSqlSession().update(statement, pde);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryLastPathDetailEntity(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> queryLastPathDetailEntity(PathDetailEntity tempPathDetailEntity) {
		return getSqlSession().selectList(NAMESPACE + "queryLastPathDetailEntity", tempPathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryMaxRouteNoPathDetailEntityWithObjOrgCode(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity
	 * )
	 */
	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> queryMaxRouteNoPathDetailEntityWithObjOrgCode(PathDetailEntity pathDetailEntity) {
		return getSqlSession().selectList(NAMESPACE + "queryMaxRouteNoPathDetailEntityWithObjOrgCode", pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryGoodsNoList(java.lang.String)
	 */
	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> queryGoodsNoList(String waybillNo) {
		return getSqlSession().selectList(NAMESPACE + "queryGoodsNoList", waybillNo);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#changePathDetailDestOrgCode(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@Override
	public void changePathDetailDestOrgCode(PathDetailEntity pathDetailEntity) {
		this.getSqlSession().selectList(NAMESPACE + "changePathDetailDestOrgCode", pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#changePathDetailEntityNextOrgCode(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@Override
	public void changePathDetailEntityNextOrgCode(PathDetailEntity pathDetailEntity) {
		this.getSqlSession().selectList(NAMESPACE + "changePathDetailEntityNextOrgCode", pathDetailEntity);
	}

	
	/**
	* @description 根据出发部门修改查询的最大路由的前一段明细的nextOrgCode
	* @param pathDetailEntity
	* @version 1.0
	* @author 14022-foss-songjie
	* @update 2013年10月26日 上午10:18:42
	*/
	@Override
	public void changePathDetailPojoNextOrgCode(
			PathDetailEntity pathDetailEntity) {
		this.getSqlSession().selectList(NAMESPACE + "changePathDetailPojoNextOrgCode", pathDetailEntity);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryEqualsLastSecondPathDetailCount(java.util.Map)
	 */
	@Override
	public int queryEqualsLastSecondPathDetailCount(PathDetailEntity pathDetailEntity) {
		return (Integer) this.getSqlSession().selectOne(NAMESPACE + "queryEqualsLastSecondPathDetailCount", pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryBeforePathDetailList(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> queryBeforePathDetailList(PathDetailEntity pathDetailEntity) {
		return this.getSqlSession().selectList(NAMESPACE + "queryBeforePathDetailList", pathDetailEntity);
	}

	  
	/*
	 * (non-Javadoc)
	 * 
	 * @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#deletePathDetailList(com.deppon.foss.module.transfer.scheduling.api.shared.domain.PathDetailEntity)
	 */
	@Override
	public void deletePathDetailList(PathDetailEntity deletePathDetailEntity) {
		this.getSqlSession().delete(NAMESPACE + "deletePathDetailList", deletePathDetailEntity);
	}
	
	/**
	 * 根据运单号和流水号获取最新的交接单号
	 * @param pathDetailEntity
	 * @return
	 */
	@Override
	public String queryNewHandoverNoByWaybillNo(
			PathDetailEntity pathDetailEntity) {
		return (String) this.getSqlSession().selectOne(NAMESPACE + "queryNewHandoverNoByWaybillNo", pathDetailEntity);
	}
	/**
	* @description 根据运单号查询出运单第一次补码前的虚拟营业部(针对快递)
	* (non-Javadoc)
	* @see com.deppon.foss.module.transfer.scheduling.api.server.dao.IPathDetailDao#queryBeforeOrgCode(java.lang.String)
	* @author 218381-foss-lijie
	* @update 2015年3月18日 上午9:59:58
	* @version V1.0
	*/
	@SuppressWarnings("unchecked")
	@Override
	public String queryBeforeOrgCodeByWaybillNO(String waybillNo) {
		List<String> orgCodeList =  this.getSqlSession().selectList(NAMESPACE + "queryBeforeOrgCodeByWaybillNO", waybillNo);
		if(orgCodeList != null){
			return orgCodeList.get(0);
		}else{
			return null;
		}
	}
	
	/**
	 * @author nly
	 * @date 2015年5月9日 下午2:38:09
	 * @function 根据运单号或运单号流水号查询走货路径明细
	 * @param waybillNo
	 * @param serialNoList
	 * @return
	 */
	@SuppressWarnings("unchecked")
	@Override
	public List<PathDetailEntity> queryPathDetailByNos(String waybillNo,List<String> serialNoList) {
		Map<String,Object> map = new HashMap<String,Object>();
		map.put("waybillNo", waybillNo);
		map.put("serialNoList", serialNoList);
		
		return this.getSqlSession().selectList(NAMESPACE + "queryPathDetailByNos", map);
	}
	
}