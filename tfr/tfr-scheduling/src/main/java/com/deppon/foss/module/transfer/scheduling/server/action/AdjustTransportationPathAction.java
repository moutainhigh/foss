/*******************************************************************************
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * Copyright 2013 TFR TEAM
 *  
 *  
 *  Licensed under the DEPPON License, Version 2.0 (the "License");
 *  
 *  
 *  
 *  you may not use this file except in compliance with the License.
 *  
 *  
 *  
 *  You may obtain a copy of the License at
 *  
 *    
 *     http://www.deppon.com/licenses/LICENSE-2.0
 *  
 *  
 *  
 *  
 *  Unless required by applicable law or agreed to in writing, software
 *  
 *  
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  
 *  
 *  
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  
 *  
 *  See the License for the specific language governing permissions and
 * 
 *  
 *  limitations under the License.
 *  
 *  
 *  PROJECT NAME  : tfr-scheduling
 *  
 *  PACKAGE NAME  : 
 * 
 *  DESCRIPTION   : 调度、发车计划、排班、月台、车辆管理等
 *  
 *  FILE PATH     :src/main/java/com/deppon/foss/module/transfer/scheduling/server/action/AdjustTransportationPathAction.java
 * 
 *  FILE NAME     :AdjustTransportationPathAction.java
 *  
 *  AUTHOR        : FOSS中转开发组
 *  
 *  TIME          : 
 *  
 *  HOME PAGE     :  http://www.deppon.com
 *  
 *  COPYRIGHT     : Copyright (c) 2013  Deppon All Rights Reserved.
 * 
 *  VERSION       :0.1
 * 
 *  LAST MODIFY TIME:
 *  
 *  
 *   *  
 *  1.1	相关业务用例
 *  
 *  BUC_FOSS_5.10.20_020  制定长途发车计划
 *  
 *  
 * 	BUC_FOSS_5.10.20_060  制定班车发车计划
 * 	
 * 
 * 
 * 
 * 	1.2	用例描述
 * 
 * 	在制定发车计划的过程中,将会产生调整货物的走货路径的需要.
 * 
 * 进行合车或者单一线路调整.
 * 
 * 
 * 
 * 
 * 前置条件	
 * 
 * 
 * 	调度员需要对现有某几条货物线路进行合并,修改部分货物的走货路径.
 * 
 * 或
 * 
 * 	调度员需要对现有某一货物线路进行改变.修改部分货物的走货路径
 * 
 * 
 * 
 * 
 * 后置条件	
 * 
 * 
 * 生成新的走货路径
 * 
 * 给货量预测提供合车的结果参考
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 1.5.3	界面描述
 * 
 * 走货路径查询界面:
 * 
 * 进入查询界面后,
 * 
 * 根据登陆人员选则的中转场及相应库区编号,
 * 
 * 查询相应库区内的货物走货路径信息.
 * 
 * 
 * 选择相应的条目,
 * 
 * 进行走货路径的调整.
 * 
 * 可以根据路径(库区号),
 * 
 * 路径中的运单及运单中的流水号进行不同力度的选择.
 * 
 * 
 * 选择项都为同一路径时,
 * 
 * 进入调整走货路径界面.
 * 
 * 
 * 
 * 选择项包含多路径时,进入合车调整界面.
 * 
 * 
 * 
 * 调整走货路径界面:
 * 
 * 进入调整走货路径界面,
 * 
 * 输入人工指定的下一到达站,
 * 
 * 系统出现线路班车列表,根据列表进行路线选择.
 * 
 * 选择的班次的出发/到达时间将会被带到人工调整的出发/到达时间输入框之中.
 * 
 * 操作员可以对该出发时间进行修改.到达时间为系统自动计算的.
 * 
 * 如果还要继续指定下一到达站,
 * 
 * 点击添加按钮添加下一段线路的设置.
 * 
 * 直到指定的最后一个中转地.
 * 
 * 点击保存,存储调整后的走货路径.
 * 
 * 调整截止时间,一旦填写该时间,
 * 
 * 则代表从当前时间起到截止时间内,
 * 
 * 该调整持续生效,之后到达的该部分货物都会自动进行调整.
 * 
 * 默认该选项为空.代表只调整当前选中货物.
 * 
 * 
 * 
 * 
 * 
 * 合车调整界面:
 * 
 * 进入合车调整界面,
 * 
 * 被选择的线路会被列举在界面中,
 * 
 * 勾选合车后的目标线路.进行保存.
 * 
 * 调整截止时间,一旦填写该时间,
 * 
 * 则代表从当前时间起到截止时间内,
 * 
 * 该调整持续生效,之后到达的该部分货物都会自动进行调整.
 * 
 * 默认该选项为空.代表只调整当前选中货物.
 * 
 * 
 * 
 * 
 * 
 * 1.5.4	按钮描述
 * 
 * 
 * 查询: 
 * 
 * 根据输入的库区编号信息,查询相应条目.
 * 
 * 
 * 清空: 
 * 
 * 清空当前输入的库区编号信息.
 * 
 * 
 * 路径调整: 
 * 
 * 选择项都为同一路径时,
 * 
 * 进入调整走货路径界面.
 * 
 * 选择项包含多路径时,
 * 
 * 进入合车调整界面.
 * 
 * 
 * 添加:
 *  
 * 添加一条指定线路的选择模版
 * 
 * 
 * 保存: 
 * 
 * 将调整后的走货路径信息提交保存
 * 
 * 
 * 取消: 
 * 
 * 放弃调整该部分货物走货路径.
 * 
 * 
 * 
 * 
 * 1.6	操作步骤
 * 
 * 
 * 1.6.1  走货路径查询界面:
 * 
 * 
 * 1	操作员需要对待合车货物进行走货路径的调整.		
 * 
 * 
 * 2	操作员选择中转场,根据中转场的库区编号,
 * 
 * 搜索相应货物走货路径信息.
 * 
 * (同一中转场内库区可多选)	
 * 	
 * 一票货物中,
 * 
 * 只有实际存放在该货区的货物才会被罗列至搜索结果列表.
 * 
 * 被搜索出的货物有同样的存放地点(当前搜索库区)及同样的到达地点.
 * 
 * 
 * 3	操作员批量选择需要修改的货物信息.
 * 
 * 点击调整路径按钮进行走货路径修改.		
 * 
 * 已经生成超过一条走货路径的条目,
 * 
 * 允许再次操作.必须在货物最初所属库区进行勾选调整.
 * 
 * 出现在新线路的条目前不提供勾选框.
 * 
 * 
 * 4	系统弹出修改页面.		
 * 
 * 
 * 选择项都为同一路径时,
 * 
 * 进入调整走货路径界面.
 * 
 * 选择项包含多路径时,
 * 
 * 进入合车调整界面.
 * 
 * 
 * 
 * 
 * 调整走货路径界面:
 * 
 * 
 *1	进入调整走货路径界面,操作员输入人工指定的下一到达站.		
 *
 *出发地到指定到达地必须有线路存在.
 *
 *调整截止时间填写逻辑见SR-2
 *
 *
 *
 *2	系统根据当前地及下一到达站,
 *
 *出现线路班车列表		
 *
 *
 *
 *3	操作员根据列表进行路线选择.		
 *
 *
 *
 *4	系统将选择线路的出发到达时间带入人工调整出发/到达时间输入框.
 *
 *操作员可以调整出发时间.系统根据线路自动计算改动后的到达时间.		
 *
 *
 *5	还要继续指定下一到达站,
 *
 *操作员点击添加按钮,
 *
 *重复1-3步骤.		
 *
 *
 *
 *6	操作员保存修改后的走货路径.
 *
 *保存的路径存为新的条目,不删除已有路径.	
 *	
 *系统调用<<计算走货路径>>,
 *
 *根据运单,
 *
 *补全后序未设置的部分走货路径.
 *
 *出发地为最后定制化的外场,
 *
 *到达地为最终目的地.
 *
 *具体见SR-1
 *
 *
 *7	保存之后刷新新路径的文字描述，
 *
 *页面需手工关闭		
 * 
 * 
 * 1.6.3  合车调整界面:
 * 
 * 1	进入合车调整界面,
 * 
 * 系统将被选择的路径会列举在界面中.		
 * 
 * 调整截止时间填写逻辑见SR-2
 * 
 * 
 * 
 * 2	页面左侧为全部待合车的路径,
 * 
 * 操作员直接勾选某一合车路径.
 * 
 * 系统将勾选路径带至右侧区域作为指定的合车后路径.	
 * 	
 * 待合车路径的全部货物将会被合并至指定的合车路径中.
 * 
 * 
 * 4	操作员保存修改后的走货路径.
 * 
 * 保存的路径存为新的条目,不删除已有路径.		
 * 
 * 
 * 
 * 
 * 1.7	业务规则
 * 
 * SR-1	
 * 
 * 调整走货路径是由一个走货路径分为N个线路+一个子走货路径,
 * 
 * 通过查询后,再按顺序合成为一条整体的走货路径.
 * 
 * 假设A-C是原路径,那么调整后可能由A-B-C.
 * 
 * 则首先需要保证A-B是一条确定的线路,
 * 
 * 再由B-C生成一条子走货路径,从而确定一条A-C的整体新走货路经.
 * 
 * 
 * 
 * SR-2	
 * 
 * 调整截止时间,
 * 
 * 一旦填写该时间,
 * 
 * 则代表从当前时间起到截止时间内,
 * 
 * 该调整持续生效,
 * 
 * 之后到达的该部分货物都会自动进行调整.
 * 
 * 默认该选项为空.
 * 
 * 代表只调整当前选中货物.
 * 
 * 
 * 
 * SR-3	
 * 
 * 外场的查询为公共选择框,
 * 
 * 可以通过输入编号或名称进行查询,
 * 
 * 外场操作员登陆默认显示该人员所在外场相关信息.
 * 
 * 是否可以调整其他外场,需要根据不同人员角色进行权限的控制.
 * 
 * 
 * 1.8	数据元素
 * 
 * 库区编号	货物所在库区的库区号					库存信息
 * 
 * 货物运单号	该批货物的运单号					订单信息
 * 
 * 货物流水号	该货物的流水号					订单信息
 * 
 * 货物出发地	当前货物所在的中转场					
 * 
 * 原到达地	原走货路径的目的地					订单信息
 * 
 * 调整到达地	新走货路径的第一个中转节点					
 *
 * 
 * 
 * 1.9	非功能性需求
 * 
 * 
 * 单位时间使用量	每天处理次小于300次
 * 
 * 
 * 2012年全网估计用户数	操作员数量约100名
 * 
 * 
 * 
 * 响应要求（如果与全系统要求 不一致的话）	响应速度为3
 * 
 * 
 * 使用时间段	中转外场上班时间，分为：白班和晚班
 * 
 * 
 * 高峰使用时间段	22:00-8:00
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 计算并调整走货路径
 * 
 * 1.1	相关业务用例
 * 
 * BUC_FOSS_5.30.10_110上报异常库存
 * 
 * 
 * 
 * 1.2	用例描述
 * 
 * 理货员卸车结束之后，
 * 
 * 提交卸车任务，
 * 
 * 系统比对上一装车环节生成的交接单，
 * 
 * 然后在比对上一装车环节扫描纪录，最终生成差异性报告并上报。
 * 
 * 差异信息包含多货、少货两种情况，
 * 
 * 供相关人员核对和后续处理。
 * 
 * 一旦出现多货,
 * 
 * 多出货物将需要重新安排走货路径.
 * 
 * 本用例会针对货物信息,
 * 
 * 计算新的走货路径并顶替之前的路径.
 * 
 * 接送货开单时,
 * 
 * 会针对该批货物的开单信息,
 * 
 * 生成走货路径.
 * 
 * 保存到开单信息中.
 * 
 * 走货路径查询&修改时,
 * 
 * 会针对一批货物进行人工的调整其走货路径,
 * 
 * 新建保存.
 * 
 * 合车调整修改货物走货路径后,
 * 
 * 在货物出库最终确定选择路径时,
 * 
 * 需要生成新的走货路径并对原路径进行修改替换.
 * 
 * PDA扫描货物后,
 * 
 * 将会把货物的走货路径中没有使用的条目删除.
 * 
 * 确定一批货的唯一走货路径.
 * 
 * 入库时,如本货物路径处于被调整路段,
 * 
 * 切调整处于生效阶段,
 * 
 * 则需要按照调整后的路径进行该货物的走货路径修改.
 * 
 * 修改单生成并且生效后(处理待办事项,打印新标签),
 * 
 * 按照货物的修改目的地,
 * 
 * 重新计算,
 * 
 * 修改货物的走货路径.
 * 
 * 
 * 
 * 1.3	用例条件
 * 
 * 
 * 前置条件	1.	开单时,需要针对货物确定走货路径. 
 * 
 * 或
 * 
 * 
 * 2.	出现异常库存时,需要针对异常货重新修订走货路径.
 * 
 * 
 * 
 * 或
 * 
 * 
 * 3.	调整合车走货路径后,根据出库时的实际情况生成新的走货路径,替换货物原路径.
 * 
 * 
 * 或
 * 
 * 
 * 4.	入库时,如果当前货物的原路径处于路径调整的生效状态,则对该货物的走货路径进行调整.
 * 
 * 
 * 或
 * 
 * 
 * 
 * 5.	修改单生成且生效后,按照货物的新目的地,重新计算并生成走货路径.	接送货-开单
 * 
 * 
 * 
 * 
 *上报异常库存
 *
 *
 *查询&修改走货路
 *
 *
 *后置条件	
 *
 *1.	生成新的走货路径.	
 *
 *查询&修改走货路径
 *
 *
 *1.6	操作步骤
 *
 *
 *1.6.1	开单生成走货路径
 *
 *1	开单模块请求系统计算走货路经，
 *
 *系统根据货物的开单信息,获取货物运单号,
 *
 *流水号,出发营业部,到达营业部，
 *
 *开单时间.	开单信息	
 *
 *
 *
 *2	系统通过开单信息查询基础信息的走货路经模板,
 *
 *传递参数为：出发,到达营业部/虚拟营业部、开单时间	走货路径模板配置.	
 *
 *配置以营业部为单元,
 *
 *根据出发到达营业部,
 *
 *返回走货路径模板，
 *
 *内容包括：整条路径中的全部线路节点、中转场间的线路、以及每段线路的出发到达时间.
 *
 *
 *
 *3	系统根据出发营业部,
 *
 *走货路径模板上的第一个中转外场,
 *
 *查询线路信息，
 *
 *查询走货路径中第一条线路.
 *
 *系统根据走货路径模板上的最后一个中转外场,
 *
 *到达营业部,
 *
 *查询线路信息, 
 *
 *查询走货路径中最后一条线路.	
 *
 *线路	基础资料提供的是营业组到营业组的走货路径模版,
 *
 * 是按照出发组、
 * 
 * 到达组制定走货路径模板的.
 * 
 * 所以始发营业部到第一个中转部门,
 * 
 * 最后一个中转部门到到达营业部的线路未确定.
 * 
 * 根据走货路径模版中提供的通用出发到达时间,
 * 
 * 匹配该段最终选择的线路。
 *
 *
 *4	系统保存完整的走货路径信息，
 *
 *并反馈给开单模块		
 *
 *系统返回走货路径结果给开单信息模块
 *
 *
 *
 *1.6.2	多货修改走货路径
 *
 *
 *1	系统根据多货的货物信息,
 *
 *获取货物运单号,
 *
 *流水号,
 *
 *到达营业部/虚拟营业部.	
 *
 *开单信息	
 *
 *
 *2	系统根据该货物现在所在的中转外场,
 *
 *获取中转场的驻地营业部信息.		
 *
 *多货则该货物本不该出现在该中转场,
 *
 *但是现在已经到达,
 *
 *则需要改变走货路径,
 *
 *以目前位置为起点,到达营业部为终点,
 *
 *重新确定走货路径.
 *
 *
 *
 *3	执行1.6.1的步骤		
 *
 *
 *4	保存新的走货路径,
 *
 *作废原货物走货路径		
 *
 *
 *
 *1.6.3	调整合车货物走货路径A(同一外场合车)
 *
 *
 *1	外场操作员根据需要,
 *
 *提出合车,
 *
 *人工调整中途经过的外场以及线路.		
 *
 *根据该外场,
 *
 *搜索出相应货物的原路径.
 *
 *参考用例”调整合车货物走货路经”
 *
 *
 *
 *2	系统接受多条线路合并的修改走货路径信息.		
 *
 *调整页面可能会将线路A,B 
 *
 *合并至线路C进行统一调配.
 *
 *
 *
 *3	系统将全部被调整线路进行记录		
 *
 *此时不修改货物的实际走货路径.
 *
 *只记录合车调整的动作.
 *
 *
 *
 *4	当有合车操作的货物实际出库装车时,
 *
 *根据实际所选择的路径,
 *
 *记录货物真实走货路径,
 *
 *和系统中的原路径匹配,
 *
 *进行更新和再计算.		
 *
 *此时更新原路径为实际所选择路径,更新后序走货路径.
 *
 *
 *
 *
 *
 *1.6.4	
 *
 *调整合车货物走货路径B(针对某一段路径进行调整不同外场之间合车)
 *
 *序号	基本步骤	相关数据	补充步骤
 *
 *1	外场操作员根据需要,
 *
 *提出合车调整,
 *
 *人工调整中途经过的外场以及线路.	
 *
 *	参考用例”调整合车货物走货路经”
 *
 *人工调整的路径可以是走货路径模板之外的走货方式
 *
 *
 *2	可以选择多个外场和外场之间的线路，重复1步骤		
 *
 *
 *3	系统根据指定的最后一个到达地点及货物的最终到达地点.
 *
 *生成新的走货路径		
 *
 *原货由A-B-C-D,
 *
 *现在人工改为A-E-F,
 *
 *人工指定的最后中转站为F.
 *
 *则系统需要生成F-D的子走货路径.
 *
 *
 *4			以目前位置为起点,到达营业部为终点,重新确定走货路
 *
 *
 *5	执行1.6.1的步骤		
 *
 *
 *6	系统保存新增的走货路径.		
 *
 *目前对于该货物有两条走货路径.替换该货物的原走货路径
 *
 *
 *7	装车后，
 *
 *按照实际装车所走的路径保留最终的走货路径,
 *
 *并且系统作废两条路径中无效的条目.
 *
 *确定唯一走货路径.		
 *
 *操作员对该批货物进行装车扫描时,会调用接口回传最终选择路径,系统根据实际的选择, 作废无效条目.确定该批货物的唯一走货路径.
 *
 *1.6.5	更改单修改走货路径
 *
 *序号	基本步骤	相关数据	补充步骤
 *
 *
 *1	更改单提出后,通过待办事项打印新的货物标签.		
 *
 *此时可能会修改货物的目的地信息
 *
 *
 *2	获取更改信息中的货物目的地,及货物现所在地信息.		
 *
 *货物在途中,则新标签会在下个货物停靠外场或营业部生效.货物所在地信息也使用该外场或营业部.
 *
 *
 *3	系统根据指定新目的地及所在地信息.
 *
 *生成后续的走货路径		
 *
 *
 *4	系统保存新增的走货路径.		
 *
 *替换该货物的原走货路径中未走的部分线路.
 *
 *
 *
 *
 *
 *1.7	业务规则
 *
 *SR-1	
 *
 *所有外场都有其驻地营业部,所以出发或到达地为外场的,将自动转化为该驻地营业部.
 *
 *
 *
 *
 ******************************************************************************/

package com.deppon.foss.module.transfer.scheduling.server.action;
/**
 * 引入包
 */
import java.math.BigDecimal;
/**
 * 引入包
 */
import java.math.RoundingMode;
/**
 * 引入包
 */
import java.util.ArrayList;
/**
 * 引入包
 */
import java.util.List;

import org.springframework.util.CollectionUtils;








/**
 * 引入包
 */
import com.deppon.foss.framework.server.web.action.AbstractAction;
/**
 * 引入包
 */
import com.deppon.foss.framework.server.web.result.json.annotation.JSON;
import com.deppon.foss.module.base.baseinfo.api.server.service.IGoodsAreaService;
/**
 * 引入包
 */
import com.deppon.foss.module.base.baseinfo.api.server.service.IOrgAdministrativeInfoService;
import com.deppon.foss.module.base.baseinfo.api.server.service.commonselector.ICommonTransferCenterService;
import com.deppon.foss.module.base.baseinfo.api.shared.domain.GoodsAreaEntity;
import com.deppon.foss.module.base.baseinfo.api.shared.domain.TransferCenterEntity;
import com.deppon.foss.module.base.baseinfo.api.shared.dto.TransferCenterDto;
import com.deppon.foss.module.base.common.api.server.service.IBusinessLockService;
import com.deppon.foss.module.base.common.api.shared.define.MutexElementType;
import com.deppon.foss.module.base.common.api.shared.dto.MutexElement;
import com.deppon.foss.module.base.dict.api.shared.define.DictionaryValueConstants;
/**
 * 引入包
 */
import com.deppon.foss.module.frameworkimpl.server.context.FossUserContext;
import com.deppon.foss.module.transfer.common.api.shared.dto.BaseDataDictDto;
/**
 * 引入包
 */
import com.deppon.foss.module.transfer.common.api.shared.exception.TfrBusinessException;
/**
 * 引入包
 */
import com.deppon.foss.module.transfer.scheduling.api.define.TransportPathConstants;
import com.deppon.foss.module.transfer.scheduling.api.server.service.IAdjustTransportationPathService;
/**
 * 引入包
 */
import com.deppon.foss.module.transfer.scheduling.api.shared.domain.AdjustEntity;
/**
 * 引入包
 */
import com.deppon.foss.module.transfer.scheduling.api.shared.dto.DepartureDto;
/**
 * 引入包
 */
import com.deppon.foss.module.transfer.scheduling.api.shared.vo.SchedulingVO;
import com.deppon.foss.util.define.FossConstants;
/**
 * 查询&修改走货路径action类
 * 
 * @author huyue
 * @date 2012-10-31 下午5:23:12
 */
public class AdjustTransportationPathAction extends AbstractAction {
	private static final long serialVersionUID = -5182857592065055743L;
	/**
	 * 调整走货路径Service
	 */
	private transient IAdjustTransportationPathService adjustTransportationPathService;
	/**
	 * 综合组织管理相关Service
	 */
	private transient IOrgAdministrativeInfoService orgAdministrativeInfoService;
	/**
	 * 库区Service
	 * */
	private transient IGoodsAreaService goodsAreaService;
	
	/**
	 * 外场service
	 * */
	private ICommonTransferCenterService commonTransferCenterService;
	/**
	 * 调整货物走货路径VO
	 */
	private SchedulingVO schedulingVO = new SchedulingVO();
	private static final int three = 3;
	
	// modify by liangfuxiang 2013-4-24下午1:48:27 begin BUG-7641

	/**
	 * 超时时间为0
	 */
	private static final int TIMEOUT = 0;

	/**
	 * 运单
	 */
	private static final String WAYBILL = "运单";
	/**
	 * 锁
	 */
	private IBusinessLockService businessLockService;

	/**
	 * @param businessLockService the businessLockService to set Date:2013-4-24下午1:48:22
	 */

	public void setBusinessLockService(IBusinessLockService businessLockService) {
		this.businessLockService = businessLockService;
	}

	// modify by liangfuxiang 2013-4-24下午1:48:45 end;
	/**
	 * 获取 调整货物走货路径VO.
	 *
	 * @return the 调整货物走货路径VO
	 */
	public SchedulingVO getSchedulingVO() {
		return schedulingVO;
	}
	/**
	 * 设置 调整货物走货路径VO.
	 *
	 * @param schedulingVO the new 调整货物走货路径VO
	 */
	public void setSchedulingVO(SchedulingVO schedulingVO) {
		this.schedulingVO = schedulingVO;
	}
	/**
	 * 
	 *
	 * @return 
	 */
	public static long getSerialversionuid() {
		return serialVersionUID;
	}
	/**
	 * 设置 调整走货路径Service.
	 *
	 * @param adjustTransportationPathService the new 调整走货路径Service
	 */
	public void setAdjustTransportationPathService(IAdjustTransportationPathService adjustTransportationPathService) {
		this.adjustTransportationPathService = adjustTransportationPathService;
	}
	/**
	 * 设置 综合组织管理相关Service.
	 *
	 * @param orgAdministrativeInfoService the new 综合组织管理相关Service
	 */
	public void setOrgAdministrativeInfoService(IOrgAdministrativeInfoService orgAdministrativeInfoService) {
		this.orgAdministrativeInfoService = orgAdministrativeInfoService;
	}
	
	
	
	
	public void setGoodsAreaService(IGoodsAreaService goodsAreaService) {
		this.goodsAreaService = goodsAreaService;
	}

	
	
	
	public void setCommonTransferCenterService(
			ICommonTransferCenterService commonTransferCenterService) {
		this.commonTransferCenterService = commonTransferCenterService;
	}

	/**
	 * 修改走货路径LIST查询, 匹配运单表,库存表,只精确到库区
	 * 
	 * @author huyue
	 * @date 2012-10-12 下午6:34:58
	 */
	@JSON
	public String queryLevel1() {
		try {
			/**
			 * 分页查询以线路为单位的信息
			 */
			List<AdjustEntity> goodsAreaList = adjustTransportationPathService.queryLevel1(schedulingVO.getAdjustEntity(), this.getLimit(), this.getStart());
			schedulingVO.setAdjustList(goodsAreaList);
			/**
			 * get count
			 */
			Long totalCount = adjustTransportationPathService.getCount(schedulingVO.getAdjustEntity());
			this.setTotalCount(totalCount);
			return returnSuccess();
			/**
			 * 捕获中转异常
			 */
		} catch (TfrBusinessException e) {
			return returnError(e);
		}
	}
	/**
	 * 修改走货路径LIST查询, 匹配运单表,库存表,只精确到waybill
	 * 
	 * @author huyue
	 * @date 2012-10-12 下午8:04:20
	 */
	public String queryLevel2() {
		try {
			/**
			 * 以线路中运单号为单位的信息
			 */
			List<AdjustEntity> wayBillList = adjustTransportationPathService.queryLevel2(schedulingVO.getAdjustEntity());
			schedulingVO.setAdjustList(wayBillList);
			return returnSuccess();
			/**
			 * 捕获中转异常
			 */
		} catch (TfrBusinessException e) {
			return returnError(e);
		}
	}
	/**
	 * 修改走货路径第三层查询,根据运单匹配在库货件号
	 * 
	 * @author huyue
	 * @date 2012-10-12 下午7:52:29
	 */
	public String queryLevel3() {
		try {
			/**
			 * 查询相关货件号list
			 */
			List<AdjustEntity> serialList = adjustTransportationPathService.queryLevel3(schedulingVO.getAdjustEntity());
			schedulingVO.setAdjustList(serialList);
			return returnSuccess();
			/**
			 * 捕获中转异常
			 */
		} catch (TfrBusinessException e) {
			return returnError(e);
		}
	}
	/**
	 * 非合车调整走货路径
	 * 
	 * @author huyue
	 * @date 2012-11-6 下午5:52:54
	 */
	@JSON
	public String modifyPathPrepare() {
		try {
			/**
			 * 首先获取adjustlist
			 */
			List<AdjustEntity> origList = schedulingVO.getAdjustList();
			List<String> waybillList = new ArrayList<String>();
			List<String> areaCodeList = new ArrayList<String>();
			/**
			 * 循环LIST
			 */
			for (int i = 0; i < origList.size(); i++) {
				/**
				 * 如果该条为货区条目.则保存
				 */
				if (null == origList.get(i).getWaybillNo() || origList.get(i).getWaybillNo().equals("")) {
					schedulingVO.setAdjustEntity(origList.get(i));
				} else {
					/**
					 * 如果是运单条目则保存运单号和货区号
					 */
					waybillList.add(origList.get(i).getWaybillNo());
					areaCodeList.add(origList.get(i).getGoodsAreaCode());
				}
			}
			/**
			 * 如果没有展开,查询库区下的运单
			 */
			if (origList.size() == 1) {
				/**
				 * 根据orgCode和goodsAreaCode查询运单为单位的条目
				 */
				List<AdjustEntity> wayBillList = adjustTransportationPathService.queryByGoodsArea(origList.get(0));
				/**
				 * 遍历
				 */
				for (int l = 0; l < wayBillList.size(); l++) {
					waybillList.add(wayBillList.get(l).getWaybillNo());
					areaCodeList.add(wayBillList.get(l).getGoodsAreaCode());
				}
			}
			schedulingVO.setWaybillList(waybillList);
			schedulingVO.setAreaCodeList(areaCodeList);
			return returnSuccess();
			/**
			 * 捕获中转异常
			 */
		} catch (TfrBusinessException e) {
			return returnError(e);
		}
	}
	/**
	 * 根据现部门code 找寻可能到达的部门code list
	 * 
	 * @author huyue
	 * @date 2012-11-6 下午6:05:27
	 */
	public String findObjectiveOrgCode() {
		try {
			/**
			 * 找可能到达的部门code list
			 */
			List<String> nextOrgCode = adjustTransportationPathService.findObjectiveOrgCode(schedulingVO.getChangePathEntity().getOrigOrgCode());
			List<String> nextOrgName = new ArrayList<String>();
			/**
			 * 循环code list获取name
			 */
			for (int i = 0; i < nextOrgCode.size(); i++) {
				nextOrgName.add(orgAdministrativeInfoService.queryOrgAdministrativeInfoNameByCode(nextOrgCode.get(i)));
			}
			schedulingVO.setNextOrgCode(nextOrgCode);
			schedulingVO.setNextOrgName(nextOrgName);
			return returnSuccess();
			/**
			 * 捕获中转异常
			 */
		} catch (TfrBusinessException e) {
			return returnError(e);
		}
	}
	/**
	 * 根据现部门和下一部门找到所有的班次
	 * 
	 * @author huyue
	 * @date 2012-11-6 下午6:31:57
	 */
	public String findDepartMsg() {
		try {
			/**
			 * 找到本部门和下一部门的所有班次
			 */
			List<DepartureDto> departureDto = adjustTransportationPathService.findDepartMsg(schedulingVO.getChangePathEntity().getOrigOrgCode(), schedulingVO.getChangePathEntity().getDestOrgCode());
			schedulingVO.setDepartureDto(departureDto);
			return returnSuccess();
			/**
			 * 捕获中转异常
			 */
		} catch (TfrBusinessException e) {
			return returnError(e);
		}
	}
	/**
	 * 走货路径调整 非合车
	 * 
	 * @author huyue
	 * @date 2012-10-29 下午3:04:49
	 */
	public String modifyPath() {
		
		// modify by liangfuxiang 2013-4-24下午1:36:49 begin BUG-7641 调整走货路径，并发会卡住 增加锁
		//获取运单号
		List<String> waybillList=schedulingVO.getWaybillList();
		
		//运单为空
		if(CollectionUtils.isEmpty(waybillList)){
			//返回异常--运单号信息为空
			return returnError(new TfrBusinessException(TransportPathConstants.WAYBILL_LIST_IS_NULL));
		}

		//锁对象集合
		List<MutexElement> mutexes = new ArrayList<MutexElement>();
		//锁对象
		MutexElement mutexElement=null;
		//遍历
		for(String waybillNo:waybillList){
			mutexElement=new MutexElement(waybillNo,WAYBILL,MutexElementType.WAYBILL_NO);
			mutexes.add(mutexElement);
		}

		// 锁定业务(互斥锁)
		boolean isLocked = businessLockService.lock(mutexes, TIMEOUT);

		// 若为上锁
		if (!isLocked) {
			// 当前有其他用户操作此运单，请稍后再试
			return returnError(new TfrBusinessException(TransportPathConstants.WAYBILL_IS_LOCKED));
		}
		
		// modify by liangfuxiang 2013-4-24下午1:52:34 end;
		try {
			/**
			 * 得到现在用户的code
			 */
			String userCode = FossUserContext.getCurrentUser().getEmployee().getEmpCode();
			/**
			 * 得到现在用户的name
			 */
			String userName = FossUserContext.getCurrentUser().getEmployee().getEmpName();
			/**
			 * 调用非合车调整走货路径service
			 */
			adjustTransportationPathService.modifyPath(schedulingVO.getWaybillList(), schedulingVO.getAreaCodeList(), schedulingVO.getChangePathEntity(), schedulingVO.getChangePathList(), schedulingVO.getAdjustEntity(), userCode, userName);
			
			// modify by liangfuxiang 2013-4-24下午1:51:58 begin BUG-7641 调整走货路径，并发会卡住 增加锁
			//解锁
			businessLockService.unlock(mutexes);
			// modify by liangfuxiang 2013-4-24下午1:51:58 end;
			
			return returnSuccess();
			/**
			 * 捕获中转异常
			 */
		} catch (TfrBusinessException e) {
			// modify by liangfuxiang 2013-4-24下午1:51:58 begin BUG-7641 调整走货路径，并发会卡住 增加锁
			//解锁
			businessLockService.unlock(mutexes);
			// modify by liangfuxiang 2013-4-24下午1:51:58 end;
			return returnError(e);
			/**
			 * 捕获全部异常
			 */
		} catch (Exception e) {
			// modify by liangfuxiang 2013-4-24下午1:51:58 begin BUG-7641 调整走货路径，并发会卡住 增加锁
			//解锁
			businessLockService.unlock(mutexes);
			// modify by liangfuxiang 2013-4-24下午1:51:58 end;
			return returnError(e.getMessage());
		}
	}
	/**
	 * 合车调整走货路径
	 * 
	 * @author huyue
	 * @date 2012-10-29 下午3:57:41
	 */
	public String joinVehiclePrepare() {
		try {
			int count = 0;
			/**
			 * 获取adjustlist
			 */
			List<AdjustEntity> origList = schedulingVO.getAdjustList();
			List<AdjustEntity> newList = new ArrayList<AdjustEntity>();
			List<String> waybillList = new ArrayList<String>();
			List<String> areaCodeList = new ArrayList<String>();
			/**
			 * 先提取货区为单位的条目信息,进行新增
			 */
			for (int i = 0; i < origList.size(); i++) {
				if (null == origList.get(i).getWaybillNo() || origList.get(i).getWaybillNo().equals("")) {
					/**
					 * 运单为空则直接把条目加入新list
					 */
					newList.add(origList.get(i));
					/**
					 * 赋0
					 */
					newList.get(count).setAreaWeightTotal(BigDecimal.ZERO.setScale(three, RoundingMode.HALF_DOWN));
					newList.get(count).setAreaWaybillQty(0);
					count++;
				}
			}
			/**
			 * 循环原路径
			 */
			for (int i = 0; i < origList.size(); i++) {
				/**
				 * 如果运单号不为空则表示该条是二级展开数据.需要进行累积
				 */
				if (origList.get(i).getWaybillNo() != null && !origList.get(i).getWaybillNo().equals("")) {
					/**
					 * 把运单号记录进waybillList
					 */
					waybillList.add(origList.get(i).getWaybillNo());
					/**
					 * 把库区编码记录进areaCodeList
					 */
					areaCodeList.add(origList.get(i).getGoodsAreaCode());
					/**
					 * 循环新路径
					 */
					for (int j = 0; j < newList.size(); j++) {
						/**
						 * 循环查找对应货区
						 */
						if (origList.get(i).getGoodsAreaCode().equals(newList.get(j).getGoodsAreaCode())) {
							/**
							 * 把运单货量增加进货区货量
							 */
							newList.get(j).setAreaWeightTotal(newList.get(j).getAreaWeightTotal().add(origList.get(i).getGoodsWeightTotal()));
							newList.get(j).setAreaWaybillQty(newList.get(j).getAreaWaybillQty() + 1);
						}
					}
				}
			}
			/**
			 * 查询未进行二级展开的部分
			 */
			for (int k = 0; k < newList.size(); k++) {
				if (newList.get(k).getAreaWaybillQty() == 0) {
					/**
					 * 根据orgCode和goodsAreaCode查询运单为单位的条目
					 */
					List<AdjustEntity> wayBillList = adjustTransportationPathService.queryByGoodsArea(newList.get(k));
					/**
					 * 循环运单为单位的list
					 */
					for (int l = 0; l < wayBillList.size(); l++) {
						/**
						 * 把运单号记录进waybillList
						 */
						waybillList.add(wayBillList.get(l).getWaybillNo());
						/**
						 * 把库区编码记录进areaCodeList
						 */
						areaCodeList.add(wayBillList.get(l).getGoodsAreaCode());
						/**
						 * 把运单货量增加进货区货量
						 */
						newList.get(k).setAreaWeightTotal(newList.get(k).getAreaWeightTotal().add(wayBillList.get(l).getGoodsWeightTotal()));
						newList.get(k).setAreaWaybillQty(newList.get(k).getAreaWaybillQty() + 1);
					}
				}
			}
			// 把之前的条目都删除
			schedulingVO.getAdjustList().removeAll(origList);
			schedulingVO.setAdjustList(newList);
			schedulingVO.setWaybillList(waybillList);
			schedulingVO.setAreaCodeList(areaCodeList);
			return returnSuccess();
			/**
			 * 捕获中转异常
			 */
		} catch (TfrBusinessException e) {
			return returnError(e);
		}
	}
	/**
	 * 合车调整走货路径处理,记录至明细表
	 * 
	 * @author huyue
	 * @throws Exception
	 * @throws IllegalAccessException
	 * @date 2012-10-30 下午5:23:09
	 */
	public String joinVehicle() {
		// modify by liangfuxiang 2013-4-24下午1:36:49 begin BUG-7641 调整走货路径，并发会卡住 增加锁
		// 获取运单号
		List<String> waybillList = schedulingVO.getWaybillList();

		// 运单为空
		if (CollectionUtils.isEmpty(waybillList)) {
			// 返回异常--运单号信息为空
			return returnError(new TfrBusinessException(TransportPathConstants.WAYBILL_LIST_IS_NULL));
		}

		// 锁对象集合
		List<MutexElement> mutexes = new ArrayList<MutexElement>();
		// 锁对象
		MutexElement mutexElement = null;
		// 遍历
		for (String waybillNo : waybillList) {
			mutexElement = new MutexElement(waybillNo, WAYBILL, MutexElementType.WAYBILL_NO);
			mutexes.add(mutexElement);
		}

		// 锁定业务(互斥锁)
		boolean isLocked = businessLockService.lock(mutexes, TIMEOUT);

		// 若为上锁
		if (!isLocked) {
			// 当前有其他用户操作此运单，请稍后再试
			return returnError(new TfrBusinessException(TransportPathConstants.WAYBILL_IS_LOCKED));
		}
		
		// modify by liangfuxiang 2013-4-24下午1:55:10 end;

		try {
			/**
			 * 得到现在用户的code
			 */
			String userCode = FossUserContext.getCurrentUser().getEmployee().getEmpCode();
			/**
			 * 得到现在用户的name
			 */
			String userName = FossUserContext.getCurrentUser().getEmployee().getEmpName();
			/**
			 * 调用调整走货路径合车调整Service
			 */
			adjustTransportationPathService.joinVehicle(schedulingVO.getWaybillList(), schedulingVO.getAreaCodeList(), schedulingVO.getChangePathEntity(), schedulingVO.getAdjustEntity(), userCode,
					userName);

			// modify by liangfuxiang 2013-4-24下午1:51:58 begin BUG-7641 调整走货路径，并发会卡住 增加锁
			// 解锁
			businessLockService.unlock(mutexes);
			// modify by liangfuxiang 2013-4-24下午1:51:58 end;

			return returnSuccess();
			/**
			 * 捕获中转异常
			 */
		}
		catch (TfrBusinessException e) {

			// modify by liangfuxiang 2013-4-24下午1:51:58 begin BUG-7641 调整走货路径，并发会卡住 增加锁
			// 解锁
			businessLockService.unlock(mutexes);
			// modify by liangfuxiang 2013-4-24下午1:51:58 end;

			return returnError(e);
			/**
			 * 捕获异常
			 */
		}
		catch (Exception e) {

			// modify by liangfuxiang 2013-4-24下午1:51:58 begin BUG-7641 调整走货路径，并发会卡住 增加锁
			// 解锁
			businessLockService.unlock(mutexes);
			// modify by liangfuxiang 2013-4-24下午1:51:58 end;

			return returnSuccess();
		}
	}
	
	/**
	 * 
	* @Title: findOutOrgCode 
	* @Description: 获取当前登录部门对应的外场编码
	* @return  设定文件 
	* @return String    返回类型 
	* @see findOutOrgCode
	* @author: liangfuxiang liangfux@cn.ibm.com  
	* @version: 2013-6-1 下午3:42:19   
	* @throws
	 */
	@JSON
	public String findOutOrgCode(){
		try {
			String outOrgCode = adjustTransportationPathService.findOutOrgCode();
			schedulingVO.setOutOrgCode(outOrgCode);
			return returnSuccess();
		} catch (TfrBusinessException e) {
			return returnError(e);
		}
	}
	
	
	/**
	* @description 根据当前部门code 以及库区编码 查询库存里下一部门的code以及下一部门的Name(去除重复部门) 用于下拉菜单使用
	* @return
	* @version 1.0
	* @author 14022-foss-songjie
	* @update 2014年2月18日 上午11:31:00
	*/
	@JSON
	public String queryNextOrg(){
		this.setTotalCount(adjustTransportationPathService.queryNextOrgByStockCount(schedulingVO.getAdjustEntity()));
		schedulingVO.setPackageOrgList(adjustTransportationPathService.queryNextOrgByStock(schedulingVO.getAdjustEntity(), start, limit));
		return returnSuccess();
	}
	
	/**
	 * 根据外场编码、库区类型 查询库区编码
	 * @return
	 * @version 1.0
	 * @author 105795-foss-wqh
	 * @update 2014年12月4日 上午11:31:00
	 * */
	@JSON
	public String queryGoodsAreaByType()
	{
		try {
			String outOrgCode = adjustTransportationPathService.findOutOrgCode();
			String goodAreaType=DictionaryValueConstants.BSE_GOODSAREA_TYPE_EXPRESS;
			try {
				List<GoodsAreaEntity> goodsAreaEntityList=goodsAreaService.queryGoodsAreaListByType(outOrgCode,goodAreaType);
				//目前快递库区编码真相唯一 去get(0)就ok
				if(CollectionUtils.isEmpty(goodsAreaEntityList))
				{
					return returnError("部门："+outOrgCode+"  查询快递库区失败！");
				}else{
					
					schedulingVO.setGoodsAreaCode(goodsAreaEntityList.get(0).getGoodsAreaCode());
				}
				
			} catch (Exception e) {
				throw new TfrBusinessException("查询库区：调综合接口异常！");
			}
			
		} catch (TfrBusinessException e) {
			return returnError(e);
			
		}
		
		return returnSuccess();
		
	}
	
	/**
	 * 根据外场编码、库区类型 查询库区编码
	 * @return
	 * @version 1.0
	 * @author 105795-foss-wqh
	 * @update 2014年12月4日 上午11:31:00
	 * */
	@JSON
	public String queryTransferCenterByPackage()
	{
		try {
			TransferCenterDto dto=new TransferCenterDto();
			List<BaseDataDictDto> packageOrgList=new ArrayList<BaseDataDictDto>();
			dto.setActive(FossConstants.YES);
			this.setTotalCount(commonTransferCenterService.queryRecordCount(dto));
			List<TransferCenterEntity> transList=commonTransferCenterService.queryTransferCenterByCondition(dto, limit,start);
		
			if(!CollectionUtils.isEmpty(transList)&&transList.size()>0)
			{
				BaseDataDictDto baseDataDictDto=null;
				for(TransferCenterEntity transferCenterEntity :transList)
				{
					baseDataDictDto=new BaseDataDictDto();
					baseDataDictDto.setValueCode(transferCenterEntity.getCode());
					baseDataDictDto.setValueName(transferCenterEntity.getName());
					packageOrgList.add(baseDataDictDto);
				}
				
				schedulingVO.setPackageOrgList(packageOrgList);
				
			}else{
				throw new TfrBusinessException("没有查询到外场：请联系基础数据配置人员");
			}
			
		} catch (TfrBusinessException e) {
			return returnError(e);
		}
		
		return returnSuccess();
		
		
	}
	
	
	
}