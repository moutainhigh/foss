<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.waybill.dubbo">
	<resultMap id="waybillInfoResultMap" type="com.deppon.foss.module.transfer.dubbo.api.define.WaybillInfoDto">
		<result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
		<result column="TRANSPORT_TYPE" property="transportType"
				jdbcType="VARCHAR" />
		<result column="PRODUCT_CODE" property="productCode" jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_CONTACT" property="deliveryCustomerName"
				jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_PHONE" property="deliveryCustomerPhone"
				jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_MOBILEPHONE" property="deliveryCustomerMobilephone"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_ORG_CODE" property="deliveryCustomerCityCode"
				jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_ADDRESS" property="deliveryCustomerAddress"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CONTACT" property="receiveCustomerName"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_PHONE" property="receiveCustomerPhone"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_MOBILEPHONE" property="receiveCustomerMobilephone"
				jdbcType="VARCHAR" />
		<result column="TARGET_ORG_CODE" property="targetOrgCode"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_ADDRESS" property="receiveCustomerAddress"
				jdbcType="VARCHAR" />
		<result column="GOODS_NAME" property="goodsName" jdbcType="VARCHAR" />
		<result column="GOODS_QTY_TOTAL" property="goodsQtyTotal"
				jdbcType="NUMERIC" />
		<result column="GOODS_WEIGHT_TOTAL" property="goodsWeightTotal"
				jdbcType="DECIMAL" />
		<result column="GOODS_VOLUME_TOTAL" property="goodsVolumeTotal"
				jdbcType="DECIMAL" />
		<result column="TOTAL_FEE" property="totalFee" jdbcType="DECIMAL" />
		<result column="PAID_METHOD" property="paidMethod" jdbcType="VARCHAR" />
		<result column="PRE_PAY_AMOUNT" property="prePayAmount"
				jdbcType="DECIMAL" />
		<result column="TO_PAY_AMOUNT" property="toPayAmount" jdbcType="DECIMAL" />
		<result column="REFUND_TYPE" property="refundType" jdbcType="VARCHAR" />
		<result column="COD_AMOUNT" property="codAmount" jdbcType="DECIMAL" />
		<result column="COD_FEE" property="codFee" jdbcType="DECIMAL" />
		<result column="RECEIVE_METHOD" property="receiveMethod"
				jdbcType="VARCHAR" />
		<result column="PICKUP_FEE" property="pickupFee" jdbcType="DECIMAL" />
		<result column="DELIVERY_GOODS_FEE" property="deliveryGoodsFee"
				jdbcType="DECIMAL" />
		<result column="PACKAGE_FEE" property="packageFee" jdbcType="DECIMAL" />
		<result column="SERVICE_FEE" property="serviceFee" jdbcType="DECIMAL" />
		<result column="TRANSPORT_FEE" property="transportFee"
				jdbcType="DECIMAL" />
		<result column="RECEIVE_ORG_CODE" property="receiveOrgCode"
				jdbcType="VARCHAR" />
		<result column="CUSTOMER_PICKUP_ORG_CODE" property="customerPickupOrgCode"
				jdbcType="VARCHAR" />
		<result column="SIGN_SITUATION" property="signSituation"
				jdbcType="VARCHAR" />
		<result column="DELIVERYMAN_NAME" property="deliverymanName"
				jdbcType="VARCHAR" />
		<result column="SIGN_TIME" property="signTime" jdbcType="TIMESTAMP" />
		<result column="SIGN_NOTE" property="signNote" jdbcType="VARCHAR" />
		<result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
		<result column="INSURANCE_AMOUNT" property="insuranceAmount"
				jdbcType="DECIMAL" />
		<result column="INSURANCE_FEE" property="insuranceFee"
				jdbcType="DECIMAL" />
		<result column="GOODS_PACKAGE" property="goodsPackage"
				jdbcType="VARCHAR" />
		<result column="ACTIVE" property="active" jdbcType="VARCHAR" />
		<result column="OTHER_FEE" property="otherFee" jdbcType="DECIMAL" />
		<result column="OUTER_NOTES" property="outerNotes" jdbcType="VARCHAR"
				typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="DELIVERY_CUSTOMER_CODE" property="deliveryCustomerCode"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CODE" property="receiveCustomerCode"
				jdbcType="VARCHAR" />
		<result column="SETTLE_STATUS" property="settleStatus"
				jdbcType="VARCHAR" />
		<result column="RETURN_BILL_TYPE" property="returnBillType"
				jdbcType="VARCHAR" />
		<result column="TRANSPORTATION_REMARK" property="transportationRemark"
				jdbcType="VARCHAR" typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="BILL_TIME" property="billTime" jdbcType="TIMESTAMP" />
		<result column="LOAD_ORG_CODE" property="loadOrgCode" jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_PROV_CODE" property="deliveryCustomerProvCode"
				jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_CITY_CODE" property="deliveryCustomerCityCode1"
				jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_DIST_CODE" property="deliveryCustomerDistCode"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_PROV_CODE" property="receiveCustomerProvCode"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CITY_CODE" property="receiveCustomerCityCode"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_DIST_CODE" property="receiveCustomerDistCode"
				jdbcType="VARCHAR" />
		<result column="PICKUP_TO_DOOR" property="pickupToDoor"
				jdbcType="VARCHAR" />
		<result column="NOTIFICATION_RESULT" property="notificationResult"
				jdbcType="VARCHAR" />
		<result column="EXPRESS_EMP_CODE" property="startExpressEmpCode"
				jdbcType="VARCHAR" />
		<result column="EXPRESS_EMP_NAME" property="startExpressEmpName"
				jdbcType="VARCHAR" />
		<result column="EXPRESS_ORG_CODE" property="startExpressOrgCode"
				jdbcType="VARCHAR" />
		<result column="EXPRESS_ORG_NAME" property="startExpressOrgName"
				jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_ADDRESS_NOTE" property="receiveCustomerAddressNote"
				jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_ADDRESS_NOTE" property="deliveryCustomerAddressNote"
				jdbcType="VARCHAR" />
		<result column="OPERATION_ORG_NAME" property="complementOperationOrgName"
				jdbcType="VARCHAR" />
		<result column="OPERATION_ORG_CODE" property="complementOperationOrgCode"
				jdbcType="VARCHAR" />
		<result column="PRINCIPAL_ORG_NAME" property="principalOrgName"
				jdbcType="VARCHAR" />
		<result column="PRINCIPAL_NO" property="principalNo" jdbcType="VARCHAR" />
		<result column="emp_name" property="principalName" jdbcType="VARCHAR" />
		<!-- 增加大客户字段 -->
		<result column="DELIVERY_BIG_CUSTOMER" property="isBigDeliverCustomer"
				jdbcType="CHAR" />
		<!-- 增加俩个字段：返货类型和原运单号 -->
		<result column="RETURN_TYPE" property="returnType" jdbcType="VARCHAR" />
		<result column="ORIGINAL_WAYBILL_NO" property="originalWaybillNo"
				jdbcType="VARCHAR" />
		<!-- XULIXIN增加 -->
		<result column="PICKUP_CENTRALIZED" property="pickupCentralized"
				jdbcType="VARCHAR" />
		<result column="CREATE_USER_CODE" property="createUserCode"
				jdbcType="VARCHAR" />
		<result column="CREATE_USER_NAME" property="createUserName"
				jdbcType="VARCHAR" />
		<result column="CREATE_USER_DEPT_NAME" property="createUserDeptName"
				jdbcType="VARCHAR" />
		<result column="CREATE_ORG_CODE" property="createOrgCode"
				jdbcType="VARCHAR" />
		<result column="CREATE_ORG_NAME" property="createOrgName"
				jdbcType="VARCHAR" />
		<result column="DRIVER_CODE" property="driverCode" jdbcType="VARCHAR" />
		<result column="DRIVER_NAME" property="driverName" jdbcType="VARCHAR" />
		<result column="MODIFY_TIME" property="modifyTime" jdbcType="VARCHAR" />
		<result column="MODIFY_USER_CODE" property="modifyUserCode"
				jdbcType="VARCHAR" />
		<result column="MODIFY_USER_NAME" property="modifyUserName"
				jdbcType="VARCHAR" />
		<result column="MODIFY_ORG_CODE" property="modifyOrgCode"
				jdbcType="VARCHAR" />
		<result column="MODIFY_ORG_NAME" property="modifyOrgName"
				jdbcType="VARCHAR" />
		<result column="GOODS_SIZE" property="goodsSize" jdbcType="VARCHAR"
				typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="IS_EXPRESS" property="isExpress" jdbcType="VARCHAR" />
		<result column="PRE_ARRIVE_TIME" property="preArriveTime"
				jdbcType="TIMESTAMP" />
		<collection property="waybillChargeCostDto" resultMap="WaybillChargeCostMap" />
	</resultMap>
	<resultMap id="WaybillChargeCostMap" type="com.deppon.foss.module.transfer.dubbo.api.define.WaybillChargeCostDto">
		<result column="PRICING_ENTRY_CODE" property="costType" jdbcType="VARCHAR" />
		<result column="NAME" property="costName" jdbcType="VARCHAR" />
		<result column="AMOUNT" property="costMoney" jdbcType="DECIMAL" />
	</resultMap>
	<select id="queryWaybillInfoForSOC4dubbo"
		parameterType="com.deppon.foss.module.transfer.dubbo.api.define.WaybillQueryInfoDto"
		resultMap="waybillInfoResultMap">
		select  /*模块：接送货-运单-根据运单集合返回运单详细信息*/
		w.waybill_no ,
		w.transport_type ,
		w.product_code,
		w.delivery_customer_name ,
		w.delivery_customer_contact,
		w.delivery_customer_phone ,
		w.delivery_customer_mobilephone ,
		w.delivery_big_customer ,<!-- 增加发货客户为大客户 -->
		w.receive_org_code ,
		w.delivery_customer_address ,
		w.receive_customer_name ,
		w.receive_customer_contact,
		w.receive_customer_phone ,
		w.receive_customer_mobilephone,
		w.target_org_code,
		w.receive_customer_address,
		w.goods_name,
		w.goods_qty_total,
		w.goods_weight_total,
		w.goods_volume_total,
		w.total_fee/100 as total_fee,
		w.paid_method,
		w.pre_pay_amount/100 as pre_pay_amount,
		w.to_pay_amount/100 as to_pay_amount,
		w.refund_type,
		w.cod_amount/100 as cod_amount,
		w.cod_fee/100 as cod_fee,
		w.receive_method,
		w.pickup_fee/100 as pickup_fee,
		w.delivery_goods_fee/100 as delivery_goods_fee,
		w.package_fee/100 as package_fee,
		w.service_fee/100 as service_fee,
		w.transport_fee/100 as transport_fee,
		w.receive_org_code,
		w.customer_pickup_org_code,
		w.pre_arrive_time,
		r.sign_situation,
		r.deliveryman_name,
		r.sign_time,
		r.sign_note,
		w.order_no,
		w.insurance_amount/100 as insurance_amount,
		w.insurance_fee/100 as insurance_fee,
		w.goods_package,
		w.active,
		w.other_fee/100 as other_fee,
		w.outer_notes,
		w.delivery_customer_code,
		w.receive_customer_code,
		f.settle_status,
		w.return_bill_type,
		w.transportation_remark,
		w.goods_package,
		w.bill_time,
		w.load_org_code ,
		w.delivery_customer_prov_code ,
		w.delivery_customer_city_code ,
		w.delivery_customer_dist_code,
		w.receive_customer_prov_code ,
		w.receive_customer_city_code ,
		w.receive_customer_dist_code,
		w.pickup_to_door,
		w.PICKUP_CENTRALIZED,
		w.CREATE_USER_CODE,
		w.CREATE_USER_NAME,
		w.CREATE_USER_DEPT_NAME,
		w.CREATE_ORG_CODE as CREATE_ORG_CODE,
		bso.name as CREATE_ORG_NAME,
		w.DRIVER_CODE,
		bsem2.emp_name as DRIVER_NAME,
		w.IS_EXPRESS,
		w.MODIFY_TIME,
	    bsem3.emp_code as MODIFY_USER_CODE,
	    bsem3.emp_name as MODIFY_USER_NAME,
	    mbso.UNIFIED_CODE as MODIFY_ORG_CODE,
	    mbso.NAME as MODIFY_ORG_NAME,
	    w.GOODS_SIZE,
		exp.EXPRESS_EMP_CODE ,
		exp.EXPRESS_EMP_NAME,
		exp.EXPRESS_ORG_CODE,
		exp.EXPRESS_ORG_NAME,
		exp.RETURN_TYPE,  
		exp.ORIGINAL_WAYBILL_NO,
		F.RECEIVE_CUSTOMER_ADDRESS_NOTE AS RECEIVE_CUSTOMER_ADDRESS_NOTE,
		F.DELIVERY_CUSTOMER_ADDRESS_NOTE AS DELIVERY_CUSTOMER_ADDRESS_NOTE,
		f.notification_result,
		d.pricing_entry_code,
		e.name,
		d.amount/100 as amount,
		tcg.OPERATION_ORG_NAME,
		tcg.OPERATION_ORG_CODE,
		bso.name as PRINCIPAL_ORG_NAME,
		bso.PRINCIPAL_NO,
		bsem.emp_name
		from pkp.t_srv_waybill w
		left join pkp.t_srv_waybill_charge_detail d on d.waybill_no = w.waybill_no
		and d.active = 'Y'
		<!-- 关联表  wutao-->
		left join pkp.t_srv_waybill_return wr on wr.waybill_no = w.waybill_no
		left join pkp.t_srv_pricing_entry e on e.code = d.pricing_entry_code and
		e.active = 'Y'
		left join pkp.t_srv_waybill_sign_result r on r.waybill_no = w.waybill_no
		and r.active = 'Y'
		inner join pkp.t_srv_actual_freight f on f.waybill_no = w.waybill_no
				left join pkp.T_SRV_WAYBILL_EXPRESS exp on exp.WAYBILL_ID = w.ID
		left join (select tc.* from tfr.t_opt_complement_log tc where tc.operation_time=(
		select max(operation_time) from tfr.t_opt_complement_log where waybill_no=tc.waybill_no))tcg 
		on tcg.waybill_no = w.waybill_no
		left join bse.t_bas_org bso on bso.code=w.CREATE_ORG_CODE and bso.active='Y'
		left join bse.t_bas_org mbso on mbso.code=w.MODIFY_ORG_CODE and mbso.active='Y'
		left join bse.t_bas_employee bsem on bsem.emp_code=bso.PRINCIPAL_NO and bsem.active='Y'
		left join bse.t_bas_employee bsem2 on bsem2.emp_code=w.DRIVER_CODE and bsem2.active='Y'
		left join bse.t_bas_employee bsem3 on bsem3.emp_code=w.MODIFY_USER_CODE and bsem3.active='Y'
		where w.waybill_no in
		<foreach collection="waybillList" open="(" close=")"
			separator="," item="waybillNo">
			<if test="waybillNo!=null and waybillNo != ''">
    	      <![CDATA[	#{waybillNo,jdbcType=VARCHAR} ]]>
			</if>
		</foreach>
		<if test="state!=null and state!= ''">
			and w.active =  <![CDATA[#{state,jdbcType=VARCHAR}]]>
		</if>
	</select>
	<resultMap id="getWaybillSignInfoResultMap"
		type="com.deppon.foss.module.transfer.dubbo.api.define.SignDto">
		<result column="EMP_CODE" property="empCode" jdbcType="VARCHAR" />
		<result column="EMP_NAME" property="empName" jdbcType="VARCHAR" />
		<result column="ORG_CODE" property="orgCode" jdbcType="VARCHAR" />
		<result column="ORG_NAME" property="orgName" jdbcType="VARCHAR" />
		<result column="CREATE_ORG_CODE" property="createOrgCode" jdbcType="VARCHAR" />
		<result column="CREATE_ORG_NAME" property="createOrgName" jdbcType="VARCHAR" />
		<result column="CREATE_USER_NAME" property="createUserName" jdbcType="VARCHAR" />
		<result column="CREATOR_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
	</resultMap>
	<select id="getWaybillSignInfo4dubbo" parameterType="java.util.Map" resultMap="getWaybillSignInfoResultMap">
		select 
			SEND_EXPRESS_ORG_CODE AS ORG_CODE,
			SEND_EXPRESS_ORG_NAME AS ORG_NAME,
			SEND_EXPRESS_EMP_CODE AS EMP_CODE,
			SEND_EXPRESS_EMP_NAME AS EMP_NAME,
			CREATE_ORG_CODE AS CREATE_ORG_CODE,
			CREATE_ORG_NAME AS CREATE_ORG_NAME,
			CREATOR AS CREATE_USER_NAME,
			CREATOR_CODE AS CREATOR_USER_CODE
		from pkp.T_SRV_WAYBILL_SIGN_RESULT
	 	where  WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR} and active='Y'
	</select>
	<resultMap id="WaybillSignDetailMap"
		type="com.deppon.foss.module.transfer.dubbo.api.define.WaybillSignDetailVo">
		<result column="id" property="id" jdbcType="VARCHAR" />
		<result column="order_no" property="orderNo" jdbcType="VARCHAR" />
		<result column="waybill_no" property="waybillNo" jdbcType="VARCHAR" />
		<result column="bill_time" property="billTime" jdbcType="TIMESTAMP" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="delivery_customer_name" property="deliveryCustomerName" jdbcType="VARCHAR" />
		<result column="pre_customer_pickup_time" property="preCustomerPickupTime" jdbcType="TIMESTAMP" />
		<result column="receive_customer_name" property="receiveCustomerName" jdbcType="VARCHAR" />
		<result column="name" property="customerPickupOrgCode" jdbcType="VARCHAR" />
		<result column="goods_qty_total" property="goodsQtyTotal" jdbcType="NUMERIC" />
		<result column="goods_weight_total" property="goodsWeightTotal" jdbcType="DECIMAL" />
		<result column="transport_fee" property="transportFee" jdbcType="DECIMAL" />
		<result column="COD_FEE" property="codFee" jdbcType="DECIMAL" />
		<result column="insurance_fee" property="insuranceFee" jdbcType="DECIMAL" />
		<result column="other_fee" property="otherFee" jdbcType="DECIMAL" />
		<result column="total_fee" property="totalFee" jdbcType="DECIMAL" />
		<result column="sign_status" property="signStatus" jdbcType="VARCHAR" />
		<result column="sign_time" property="signTime" jdbcType="TIMESTAMP" />
		<result column="deliveryman_name" property="deliverymanName" jdbcType="VARCHAR" />
		<result column="sign_note" property="signNote" />
	</resultMap>
	<select id="getWaybillSignList4dubbo" parameterType="java.util.List" resultMap="WaybillSignDetailMap" >
		select 
			SIGN_SITUATION AS SIGN_STATUS,WAYBILL_NO
	 	from pkp.T_SRV_WAYBILL_SIGN_RESULT  
	 	where  WAYBILL_NO in
	 	<foreach collection="list" item="waybillNo" index="index" open="(" separator="," close=")"> 
				#{waybillNo,jdbcType=VARCHAR}
			</foreach>
			and active = 'Y'
	</select>
	<select id="queryWaybillStatus4dubbo" statementType="CALLABLE" resultType="java.util.Map">
	<![CDATA[  
    	{call pkp.foss_procedure_pkg.foss_cc_status_trace(#{waybillNo,mode=IN,jdbcType=VARCHAR},
    		  #{msg,mode=OUT,jdbcType=VARCHAR},
    		  #{v_goods_status,mode=OUT,jdbcType=VARCHAR})
    	}  
	]]>
	</select>
	<resultMap id="OrderOrWaybillNoBaseResultMap" type="com.deppon.foss.module.transfer.dubbo.api.define.WaybillRelateDetailEntity" >
	    <id column="ID" property="id" jdbcType="VARCHAR" />
	    <result column="PARENT_WAYBILL_NO" property="parentWaybillNo" jdbcType="VARCHAR" />
	    <result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
	    <result column="PARENT_ORDER_NO" property="parentOrderNo" jdbcType="VARCHAR" />
	    <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
	    <result column="CREATE_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
	    <result column="MODIFY_USER_CODE" property="modifyUserCode" jdbcType="VARCHAR" />
	    <result column="MODIFY_ORG_CODE" property="modifyOrgCode" jdbcType="VARCHAR" />
	    <result column="WAYBILL_TYPE" property="waybillType" jdbcType="VARCHAR" />
	    <result column="CREATE_ORG_CODE" property="createOrgCode" jdbcType="VARCHAR" />
	    <result column="RECEIVE_ORG_CODE" property="receiveOrgCode" jdbcType="VARCHAR" />
	    <result column="PENDING_TYPE" property="pendingType" jdbcType="VARCHAR" />
	    <result column="ACTIVE" property="active" jdbcType="CHAR" />
	    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
	    <result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
	    <result column="BILL_TIME" property="billTime" jdbcType="TIMESTAMP" />
		<result column="GOODS_WEIGHT_TOTAL" property="goodsWeightTotal" jdbcType="DECIMAL" />
		<result column="GOODS_VOLUME_TOTAL" property="goodsVolumeTotal" jdbcType="DECIMAL" />
		<result column="IS_PIC_PACKAGE" property="isPicPackage" jdbcType="CHAR"/>
		<result column="WEIGHT" property="weight" jdbcType="DECIMAL"/>
		<result column="VOLUME" property="volume" jdbcType="DECIMAL"/>
		<result column="TASK_ID" property="taskId" jdbcType="VARCHAR"/>
    </resultMap>
	<select id="queryWaybillRelateDetailListByOrderOrWaybillNo4dubbo" resultMap="OrderOrWaybillNoBaseResultMap" parameterType="java.util.Map">
	    select 
	    ID, PARENT_WAYBILL_NO, WAYBILL_NO, ACTIVE, CREATE_TIME, MODIFY_TIME, BILL_TIME, CREATE_USER_CODE, 
	    MODIFY_USER_CODE, MODIFY_ORG_CODE, WAYBILL_TYPE, CREATE_ORG_CODE, RECEIVE_ORG_CODE, 
	    ORDER_NO, PENDING_TYPE, PARENT_ORDER_NO, GOODS_WEIGHT_TOTAL, GOODS_VOLUME_TOTAL, IS_PIC_PACKAGE, WEIGHT,VOLUME, TASK_ID
	    from PKP.T_SRV_WAYBILL_RELATE_DETAIL
	    <where>
	      <if test="parentWaybillNo != null" >
	        AND PARENT_WAYBILL_NO = #{parentWaybillNo,jdbcType=VARCHAR}
	      </if>
	      <if test="waybillNo != null" >
	        AND WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
	      </if>
	      <if test="active != null" >
	        AND ACTIVE = #{active,jdbcType=CHAR}
	      </if>
	      <if test="waybillType != null" >
	        AND WAYBILL_TYPE = #{waybillType,jdbcType=VARCHAR}
	      </if>
	      <if test="orderNo != null" >
	        AND ORDER_NO = #{orderNo,jdbcType=VARCHAR}
	      </if>
	      <if test="pendingType != null" >
	        AND PENDING_TYPE = #{pendingType,jdbcType=VARCHAR}
	      </if>
	      <if test="parentOrderNo != null" >
	        AND PARENT_ORDER_NO = #{parentOrderNo,jdbcType=VARCHAR}
	      </if>
	    </where>
    </select>
    <select id="queryWaybillNoListByParentWaybillNo4dubbo" resultType="java.lang.String" parameterType="java.lang.String" >
	    select /*模块：接送货-运单-子母单-根据母单查询所有子运单记录*/
	    WAYBILL_NO from PKP.T_SRV_WAYBILL_RELATE_DETAIL
	    where PARENT_WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
    </select>
    <resultMap id="WaybillNoBaseResultMap"
		type="com.deppon.foss.module.transfer.dubbo.api.define.WaybillExpressEntity">
		<id column="ID" property="id" jdbcType="VARCHAR" />
		<result column="WAYBILL_ID" property="waybillId" jdbcType="VARCHAR" />
		<result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_PROV_CODE" property="deliveryCustomerProvCode"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_CITY_CODE" property="deliveryCustomerCityCode"
			jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_DIST_CODE" property="deliveryCustomerDistCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CODE" property="receiveCustomerCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_NAME" property="receiveCustomerName"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_MOBILEPHONE" property="receiveCustomerMobilephone"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_PHONE" property="receiveCustomerPhone"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CONTACT" property="receiveCustomerContact"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_PROV_CODE" property="receiveCustomerProvCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_CITY_CODE" property="receiveCustomerCityCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_DIST_CODE" property="receiveCustomerDistCode"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_ADDRESS" property="receiveCustomerAddress"
			jdbcType="VARCHAR" />	
		<result column="RECEIVE_METHOD" property="receiveMethod"
			jdbcType="VARCHAR" />
		<result column="TARGET_ORG_CODE" property="targetOrgCode"
			jdbcType="VARCHAR" />
		<result column="BILL_TIME" property="billTime" jdbcType="TIMESTAMP" />
		<result column="CREATE_ORG_CODE" property="createOrgCode"
			jdbcType="VARCHAR" />
		<result column="IS_ADD_CODE" property="isAddCode" jdbcType="CHAR" />
		<result column="ADD_CODE_TIME" property="addCodeTime" jdbcType="TIMESTAMP" />
		<result column="RETURN_TYPE" property="returnType" jdbcType="VARCHAR" />
		<result column="ORIGINAL_WAYBILL_NO" property="originalWaybillNo" jdbcType="VARCHAR" />
		<result column="EXPRESS_EMP_CODE" property="expressEmpCode" jdbcType="VARCHAR" />
		<result column="EXPRESS_EMP_NAME" property="expressEmpName" jdbcType="VARCHAR" />
		<result column="EXPRESS_ORG_CODE" property="expressOrgCode" jdbcType="VARCHAR" />
		<result column="EXPRESS_ORG_NAME" property="expressOrgName" jdbcType="VARCHAR" />
		<result column="PDA_SERIAL" property="pdaSerial" jdbcType="VARCHAR" />
		<result column="BANK_TRADE_SERIAL" property="bankTradeSerail" jdbcType="VARCHAR" />		
		<result column="CUSTOMER_PICKUP_ORG_CODE" property="customerPickupOrgCode" jdbcType="VARCHAR" />
		<result column="CUSTOMER_PICKUP_ORG_NAME" property="customerPickupOrgName" jdbcType="VARCHAR" />	
		<result column="RECEIVE_ORG_CODE" property="receiveOrgCode" jdbcType="VARCHAR" />
		<result column="RECEIVE_ORG_NAME" property="receiveOrgName" jdbcType="VARCHAR" />	
		<result column="CAN_RETURN_CARGO" property="canReturnCargo" jdbcType="VARCHAR" />	
		<result column="LAST_OUTFIELD_CODE" property="lastOutFieldCode" jdbcType="VARCHAR" />	
		<result column="CHANGE_VOLUME" property="changeVolume" jdbcType="VARCHAR" />	
		<result column="VOLUME_WEIGHT" property="volumeWeight" jdbcType="DECIMAL" />	
		<result column="MODIFY_TIME" property="modifyDate" jdbcType="TIMESTAMP" />
		<result column="INNER_PICKUP_FEE_BURDEN_DEPT" property="innerPickupFeeBurdenDept" jdbcType="VARCHAR" />
		<result column="DELIVERY_EMPLOYEE_CODE" property="deliveryEmployeeCode" jdbcType="VARCHAR" />
	</resultMap>
    <select id="queryWaybillReturnByWaybillNo4dubbo" resultMap="WaybillNoBaseResultMap"
		parameterType="com.deppon.foss.module.transfer.dubbo.api.define.WaybillExpressEntity">
		SELECT
			R.WAYBILL_NO,
		    R.RETURN_TYPE,
		    R.ORIGINAL_WAYBILL_NO
	    FROM pkp.t_srv_waybill_return R
	    WHERE R.WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
	    <if test="returnType != null and returnType != '' ">
			AND RETURN_TYPE = #{returnType,jdbcType=VARCHAR},
		</if>
	</select>
	<resultMap id="WaybillQueryCityProvinceDtoResultMap"
		type="com.deppon.foss.module.transfer.dubbo.api.define.WaybillQueryCityProvinceDto">
		<id column="ID" property="id" jdbcType="VARCHAR" />
		<result column="ORG_CODE" property="orgCode" jdbcType="VARCHAR" />
		<result column="ORG_NAME" property="orgName" jdbcType="VARCHAR" />
		<result column="CITY_CODE" property="cityCode"  jdbcType="VARCHAR" />
		<result column="CITY_NAME" property="cityName"  jdbcType="VARCHAR" />
		<result column="PROV_CODE" property="provCode"  jdbcType="VARCHAR" />
		<result column="PROV_NAME" property="provName"  jdbcType="VARCHAR" />
		<result column="COUNTY_CODE" property="countyCode"  jdbcType="VARCHAR" />
		<result column="COUNTY_NAME" property="countyName"  jdbcType="VARCHAR" />
	</resultMap>
	<select id="queryCityProvince4dubbo" resultMap="WaybillQueryCityProvinceDtoResultMap" parameterType="java.lang.String">
		SELECT 
			w.id as ID,
			w.PROV_CODE as PROV_CODE,
			a.NAME as PROV_NAME,
			w.CITY_CODE as CITY_CODE,
			b.NAME as CITY_NAME,
			w.CODE as ORG_CODE,
			w.NAME as ORG_NAME, 
			w.COUNTY_CODE as COUNTY_CODE,
			c.NAME as COUNTY_NAME
		FROM  bse.mv_dest_net w 
			inner join
		 bse.t_bas_district a on w.PROV_CODE=a.CODE     
		    inner join
		 bse.t_bas_district b on w.CITY_CODE=b.CODE
		 	 inner join
		 bse.t_bas_district c on w.COUNTY_CODE=c.CODE
		WHERE w.CODE= #{code,jdbcType=VARCHAR} AND w.ACTIVE='Y'
	</select>
	<select id="queryWaybillByOriginalWaybillNo4dubbo" resultMap="WaybillNoBaseResultMap" parameterType="java.lang.String">
		SELECT 
		    E.ID, 
		    E.WAYBILL_ID, 
		    R.WAYBILL_NO, 
		    E.DELIVERY_CUSTOMER_PROV_CODE,
		    E.DELIVERY_CUSTOMER_CITY_CODE, 
		    E.DELIVERY_CUSTOMER_DIST_CODE, 
		    E.RECEIVE_CUSTOMER_CODE, 
		    E.RECEIVE_CUSTOMER_NAME, 
		    E.RECEIVE_CUSTOMER_MOBILEPHONE, 
		    E.RECEIVE_CUSTOMER_PHONE, 
		    E.RECEIVE_CUSTOMER_CONTACT, 
		    E.RECEIVE_CUSTOMER_PROV_CODE,
		    E.RECEIVE_CUSTOMER_CITY_CODE,
		    E.RECEIVE_CUSTOMER_DIST_CODE,
		    E.RECEIVE_CUSTOMER_ADDRESS,
		    E.RECEIVE_METHOD,
		    E.TARGET_ORG_CODE,
		    E.BILL_TIME,
		    E.CREATE_ORG_CODE,
		    E.IS_ADD_CODE,
		    E.ADD_CODE_TIME,
		    R.RETURN_TYPE,
		    R.ORIGINAL_WAYBILL_NO,
		    E.EXPRESS_EMP_CODE,
		    E.EXPRESS_EMP_NAME,
		    E.EXPRESS_ORG_CODE,
		    E.EXPRESS_ORG_NAME,
		    E.PDA_SERIAL,
		    E.BANK_TRADE_SERIAL,
		    E.CUSTOMER_PICKUP_ORG_CODE,
		    E.CUSTOMER_PICKUP_ORG_NAME,
		    E.RECEIVE_ORG_CODE,
		    E.RECEIVE_ORG_NAME,
		    E.CAN_RETURN_CARGO,
		    E.LAST_OUTFIELD_CODE,
		    E.CHANGE_VOLUME,
		    E.VOLUME_WEIGHT,
		    E.MODIFY_TIME,
		    E.INNER_PICKUP_FEE_BURDEN_DEPT
	    FROM pkp.t_srv_waybill_return R
	    INNER JOIN  PKP.T_SRV_WAYBILL_EXPRESS E ON E.WAYBILL_NO=R.WAYBILL_NO
	    WHERE R.ORIGINAL_WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
	</select>
	<select id="queryFirstsignTime4dubbo" parameterType="java.lang.String" resultType="java.util.Date">
    		select SIGN_TIME 
    		 from pkp.T_SRV_WAYBILL_SIGN_RESULT  
    	<where>
    		<choose>
				<when test="value != null and value != ''">
					and WAYBILL_NO = #{value,jdbcType=VARCHAR}
				</when>
				<otherwise>
					and WAYBILL_NO = ''
				</otherwise>
			</choose>
			 and rownum = 1
    	</where>
    	order by sign_time
	</select>
	<resultMap id="selectByWaybillNoResultMap" type="com.deppon.foss.module.transfer.dubbo.api.define.ActualFreightEntity">
		<id column="ID" property="id" jdbcType="VARCHAR" />
		<result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
		<result column="GOODS_NAME" property="goodsName" jdbcType="VARCHAR" />
		<result column="WEIGHT" property="weight" jdbcType="DECIMAL" />
		<result column="VOLUME" property="volume" jdbcType="DECIMAL" />
		<result column="GOODS_QTY" property="goodsQty" jdbcType="DECIMAL" />
		<result column="DIMENSION" property="dimension" jdbcType="VARCHAR" />
		<result column="INSURANCE_VALUE" property="insuranceValue" jdbcType="DECIMAL" />
		<result column="PACKING_FEE" property="packingFee" jdbcType="DECIMAL" />
		<result column="DELIVER_FEE" property="deliverFee" jdbcType="DECIMAL" />
		<result column="LABOR_FEE" property="laborFee" jdbcType="DECIMAL" />
		<result column="COD_AMOUNT" property="codAmount" jdbcType="DECIMAL" />
		<result column="VALUEADD_FEE" property="valueaddFee" jdbcType="DECIMAL" />
		<result column="FREIGHT" property="freight" jdbcType="DECIMAL" />
		<result column="SETTLE_STATUS" property="settleStatus" jdbcType="CHAR" />
		<result column="SETTLE_TIME" property="settleTime" jdbcType="TIMESTAMP" />
		<result column="NOTIFICATION_RESULT" property="notificationResult" jdbcType="VARCHAR" />
		<result column="NOTIFICATION_TIME" property="notificationTime" jdbcType="TIMESTAMP" />
		<result column="DELIVER_DATE" property="deliverDate" jdbcType="TIMESTAMP" />
		<result column="ACTUAL_DELIVER_TYPE" property="actualDeliverType" jdbcType="VARCHAR" />
		<result column="STORAGE_DAY" property="storageDay" jdbcType="DECIMAL" />
		<result column="STORAGE_CHARGE" property="storageCharge" jdbcType="DECIMAL" />
		<result column="OVERDUE_DAY" property="overdueDay" jdbcType="DECIMAL" />
		<result column="ARRIVE_GOODS_QTY" property="arriveGoodsQty" jdbcType="DECIMAL" />
		<result column="ARRIVE_TIME" property="arriveTime" jdbcType="TIMESTAMP" />
		<result column="ARRANGE_GOODS_QTY" property="arrangeGoodsQty" jdbcType="DECIMAL" />
		<result column="ARRIVE_NOTOUT_GOODS_QTY" property="arriveNotoutGoodsQty" jdbcType="DECIMAL" />
		<result column="EXCEPTION_GOODS_QTY" property="exceptionGoodsQty" jdbcType="DECIMAL" />
		<result column="DELIVER_REGION_CODE" property="deliverRegionCode" jdbcType="VARCHAR" />
		<result column="GENERATE_GOODS_QTY" property="generateGoodsQty" jdbcType="DECIMAL" />
		<result column="PAYMENT_TYPE" property="paymentType" jdbcType="VARCHAR" />
		<result column="START_STOCK_ORG_CODE" property="startStockOrgCode" jdbcType="VARCHAR" />
		<result column="END_STOCK_ORG_CODE" property="endStockOrgCode" jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="VARCHAR" />
		<result column="channelCustId" property="channelCustId" jdbcType="VARCHAR" />
		<result column="DELIVERYMAN_NAME" property="deliverymanName" jdbcType="VARCHAR" />
		<result column="IDENTIFY_TYPE" property="identifyType" jdbcType="VARCHAR" />
		<result column="IDENTIFY_CODE" property="identifyCode" jdbcType="VARCHAR" />
		<result column="GOODS_AREA_CODE" property="goodsAreaCode" jdbcType="VARCHAR" />
		<result column="EVER_TELNOTICE_SUCCESS" property="everTelnoticeSuccess" jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		<result column="INVOICE" property="invoice" jdbcType="VARCHAR" />
		<result column="COD_IDENTIFY_TYPE" property="codIdentifyType" jdbcType="VARCHAR" />
		<result column="COD_IDENTIFY_CODE" property="codIdentifyCode" jdbcType="VARCHAR" /> 
		<result column="isSMS" property="isSMS" jdbcType="VARCHAR" /> 
		<result column="special_offer_NO" property="specialOffer" jdbcType="VARCHAR" />
		<result column="START_BILL_TIME" property="startBillTime" jdbcType="TIMESTAMP" /> 
		<result column="TOGETHER_SEND_CODE" property="togetherSendCode" jdbcType="VARCHAR" /> 
		<result column="TOGETHER_SEND_MARK" property="togetherSendMark" jdbcType="VARCHAR" />  
		<result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
		<result column="WAYBILL_TYPE" property="waybillType" jdbcType="VARCHAR" />
		<result column="BIG_TICKET_GOODS" property="bigTicketGoods" jdbcType="CHAR" />
		<result column="PACKAGE_REMARK" property="packageRemark" jdbcType="VARCHAR" />
		<result column="BUSINESS_ZONE" property="businessZone" jdbcType="CHAR" />
		<result column="RESIDENTIAL_DISTRICT" property="residentialDistrict" jdbcType="CHAR" />
		<result column="WHETHER_ELECTRONIC_INVOICE" property="isElectronicInvoice" jdbcType="CHAR" />
		<result column="EMAIL" property="email" jdbcType="VARCHAR" />
		<result column="INVOICE_MOBILE_PHONE_NO" property="invoiceMobilePhone" jdbcType="VARCHAR" />
		<result column="IS_EXHIBIT_CARGO" property="isExhibitCargo" jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_ADDRESS_NOTE" property="receiveCustomerAddressNote" jdbcType="VARCHAR" />
		<result column="DELIVERY_CUSTOMER_ADDRESS_NOTE" property="deliveryCustomerAddressNote" jdbcType="VARCHAR" />
        <result column="DC_SERVICEFEE" property="dcServicefee" jdbcType="DECIMAL" />
		<result column="IS_BATCH_CREATE_WAYBILL" property="isBatchCreateWaybill" jdbcType="VARCHAR" />
		<result column="RECEIVE_CUSTOMER_VILLAGE_CODE" property="receiveCustomerVillageCode" jdbcType="VARCHAR"/>
		<result column="HOMEDELIVERY" property="homeDelivery" jdbcType="CHAR"/>
		<result column="PARTNER_BILLING_LOGO" property="partnerBillingLogo" jdbcType="VARCHAR" />
		<result column="PARTNER_PHOME" property="partnerPhome" jdbcType="VARCHAR" />
		<result column="PARTNER_NAME" property="partnerName" jdbcType="VARCHAR" />
		<result column="PAPER_BOX_TOTLE_PRICE" property="paperBoxTotlePrice" jdbcType="DECIMAL" />
		<result column="FIBEL_BAG_TOTLE_PRICE" property="fibelBagTotlePrice" jdbcType="DECIMAL" />
		<result column="OTHER_TOTLE" property="otherTotle" jdbcType="DECIMAL" />
		<result column="PACKING_TOTLE" property="packingTotle" jdbcType="DECIMAL" />
		<result column="COMPLAIN_STATUS" property="complainStatus" jdbcType="CHAR" />
		<result column="START_CENTRALIZED_SETTLEMENT" property="startCentralizedSettlement" jdbcType="CHAR" />
		<result column="ARRIVE_CENTRALIZED_SETTLEMENT" property="arriveCentralizedSettlement" jdbcType="CHAR" />
		<result column="START_CONTRACT_ORG_CODE" property="startContractOrgCode" jdbcType="VARCHAR" />
		<result column="ARRIVE_CONTRACT_ORG_CODE" property="arriveContractOrgCode" jdbcType="VARCHAR" />
		<result column="START_REMINDER_ORG_CODE" property="startReminderOrgCode" jdbcType="VARCHAR" />
		<result column="ARRIVE_REMINDER_ORG_CODE" property="arriveReminderOrgCode" jdbcType="VARCHAR" />		
		<result column="TRANSACTION_NUMBER" property="transactionSerialNumber" jdbcType="VARCHAR" />
		<result column="CRM_TRANSPORT_FEE" property="crmTransportFee" jdbcType="DECIMAL" />
		<result column="CRM_WEIGHT" property="crmWeight" jdbcType="DECIMAL" />
		<result column="CRM_VOLUME" property="crmVolume" jdbcType="DECIMAL" />
		<result column="DELIVERY_TIME_INTERVAL" jdbcType="VARCHAR" property="deliveryTimeInterval" />
	    <result column="INVOICE_TYPE" jdbcType="VARCHAR" property="invoiceType" />
	    <result column="DELIVERY_TIME_START" jdbcType="VARCHAR" property="deliveryTimeStart" />
	    <result column="DELIVERY_TIME_OVER" jdbcType="VARCHAR" property="deliveryTimeOver" />
	    <result column="DELIVER_BILL_QTY" jdbcType="DECIMAL" property="deliverBillQty" />
	    <result column="NOTIFICATION_ORG_CODE" jdbcType="VARCHAR" property="notificationOrgCode" />
		 <result column="INTERNAL_DELIVERY_TYPE" property="internalDeliveryType" jdbcType="VARCHAR"/>
		 <result column="EMPLOYEE_NO" property="employeeNo" jdbcType="VARCHAR"/>
		  <result column="SPECIAL_VALUE_ADDED_SERVICE" property="specialValueAddedServiceType" jdbcType="VARCHAR"/>
		  <result column="INDUSTRY_SOURCE_CATEGORY" property="industrySourceCategory" jdbcType="VARCHAR"/>
		  <result column="FLABELLEAVEMONTH" property="flabelleavemonth" jdbcType="VARCHAR"/>
		  <result column="MIN_TRANSPORT_FEE" property="minTransportFee" jdbcType="DECIMAL"/>		  
		   <result column="IS_EXPRESS_FOCUS" property="isExpressFocus" jdbcType="VARCHAR"/>	
	  </resultMap>
	<select id="selectByWaybillNo4dubbo" resultMap="selectByWaybillNoResultMap" parameterType="java.lang.String">
		select  
		ID, WAYBILL_NO, GOODS_NAME, WEIGHT, VOLUME, GOODS_QTY, DIMENSION, INSURANCE_VALUE,
		PACKING_FEE, DELIVER_FEE, LABOR_FEE, COD_AMOUNT, VALUEADD_FEE, FREIGHT, SETTLE_STATUS,
		SETTLE_TIME, NOTIFICATION_RESULT, NOTIFICATION_TIME, DELIVER_DATE, ACTUAL_DELIVER_TYPE,
		STORAGE_DAY, STORAGE_CHARGE, OVERDUE_DAY, ARRIVE_GOODS_QTY, ARRIVE_TIME, ARRANGE_GOODS_QTY,
		ARRIVE_NOTOUT_GOODS_QTY, EXCEPTION_GOODS_QTY, DELIVER_REGION_CODE,
		GENERATE_GOODS_QTY, PAYMENT_TYPE, START_STOCK_ORG_CODE, END_STOCK_ORG_CODE, STATUS,channelCustId,
		DELIVERYMAN_NAME, IDENTIFY_TYPE, IDENTIFY_CODE,GOODS_AREA_CODE,EVER_TELNOTICE_SUCCESS,CREATE_TIME,COD_IDENTIFY_CODE,COD_IDENTIFY_TYPE,
		INVOICE,isSMS,special_offer_NO,START_BILL_TIME,TOGETHER_SEND_CODE,TOGETHER_SEND_MARK,MODIFY_TIME,BIG_TICKET_GOODS,
		START_CENTRALIZED_SETTLEMENT,ARRIVE_CENTRALIZED_SETTLEMENT,START_CONTRACT_ORG_CODE,ARRIVE_CONTRACT_ORG_CODE,START_REMINDER_ORG_CODE,ARRIVE_REMINDER_ORG_CODE,WAYBILL_TYPE,
		INVOICE,isSMS,special_offer_NO,START_BILL_TIME,TOGETHER_SEND_CODE,TOGETHER_SEND_MARK,MODIFY_TIME,BIG_TICKET_GOODS,WAYBILL_TYPE,WHETHER_ELECTRONIC_INVOICE,INVOICE_MOBILE_PHONE_NO,EMAIL,
		RECEIVE_CUSTOMER_ADDRESS_NOTE,DELIVERY_CUSTOMER_ADDRESS_NOTE,IS_EXHIBIT_CARGO,DC_SERVICEFEE/100 DC_SERVICEFEE,
		PAPER_BOX_TOTLE_PRICE,FIBEL_BAG_TOTLE_PRICE,OTHER_TOTLE,PACKING_TOTLE,
		PACKAGE_REMARK, COMPLAIN_STATUS, BUSINESS_ZONE, RESIDENTIAL_DISTRICT, TRANSACTION_NUMBER,
		 CRM_TRANSPORT_FEE,CRM_WEIGHT,CRM_VOLUME,
		 DELIVERY_TIME_INTERVAL, INVOICE_TYPE, DELIVERY_TIME_START, DELIVERY_TIME_OVER, 
   		 DELIVER_BILL_QTY,NOTIFICATION_ORG_CODE,INTERNAL_DELIVERY_TYPE,EMPLOYEE_NO,
		 SPECIAL_VALUE_ADDED_SERVICE,
		 IS_BATCH_CREATE_WAYBILL,RECEIVE_CUSTOMER_VILLAGE_CODE,PARTNER_BILLING_LOGO,PARTNER_PHOME,PARTNER_NAME,
		 HOMEDELIVERY,INDUSTRY_SOURCE_CATEGORY,FLABELLEAVEMONTH,
		  MIN_TRANSPORT_FEE, IS_EXPRESS_FOCUS
		from PKP.T_SRV_ACTUAL_FREIGHT
		where WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
	</select>
	<sql id="queryAppWaybillInfoByCondition_from_where">
		from pkp.t_srv_waybill waybill
		left join bse.t_bas_org depart on waybill.receive_org_code = depart.code
		and depart.active=#{active,jdbcType=VARCHAR}
		left join pkp.t_srv_waybill_sign_result signre on signre.waybill_no =
		waybill.waybill_no and signre.active=#{active,jdbcType=VARCHAR}
		left
		join bse.t_bas_outer_branch agen on waybill.customer_pickup_org_code=
		agen.agent_dept_code and agen.active=#{active,jdbcType=VARCHAR}
		inner
		join pkp.t_srv_actual_freight f on f.waybill_no=waybill.waybill_no
		left join bse.t_bas_org lading on waybill.customer_pickup_org_code =
		lading.code and lading.active=#{active,jdbcType=VARCHAR}
		left join
		bse.t_bas_district depa on
		waybill.DELIVERY_CUSTOMER_CITY_CODE=depa.code and
		depa.active=#{active,jdbcType=VARCHAR}
		left join bse.t_bas_district
		dest on
		waybill.RECEIVE_CUSTOMER_CITY_CODE=dest.code and
		dest.active=#{active,jdbcType=VARCHAR}
		where waybill.active =
		#{active,jdbcType=VARCHAR}
		<if test="deliverMobile!=null and receiveMobile!=null">
			and (waybill.delivery_customer_mobilephone
			=#{deliverMobile,jdbcType=VARCHAR} or
			waybill.receive_customer_mobilephone
			=#{receiveMobile,jdbcType=VARCHAR})
		</if>
		<if test="deliverMobile!=null and receiveMobile==null">
			and waybill.delivery_customer_mobilephone
			=#{deliverMobile,jdbcType=VARCHAR}
		</if>
		<if test="receiveMobile!=null and deliverMobile==null">
			and waybill.receive_customer_mobilephone
			=#{receiveMobile,jdbcType=VARCHAR}
		</if>
		<if test="startDate!=null and endDate!=null">
			and waybill.create_time between
			#{startDate,jdbcType=TIMESTAMP} and
			#{endDate,jdbcType=TIMESTAMP}
		</if>
		<!-- keyWords关键字，进行模糊查询匹配,发货人姓名、电话, 运单号、订单号、发货城市字段 如果keywords关键字不为空,则后面的都要进行查询 -->		
		<if test="keyWords != null and keyWords != ''">
			and (
			<choose>
				<when test=" type=='DELIVER' ">
				  waybill.receive_customer_contact like '%${keyWords}%' <!-- 收货人姓名 -->
				   or  waybill.receive_customer_phone like '%${keyWords}%' <!-- 收货人电话 -->
					or waybill.receive_customer_mobilephone like '%${keyWords}%' <!-- 收货人手机 -->
				   or  dest.name like '%${keyWords}%' <!-- 收货城市 -->
				</when>
				<when test=" type=='RECEIVE' ">
				   waybill.delivery_customer_contact like '%${keyWords}%' <!-- 发货人姓名 -->
				   or  waybill.delivery_customer_phone like '%${keyWords}%' <!-- 发货人电话 -->
					or waybill.delivery_customer_mobilephone like '%${keyWords}%' <!-- 发货人手机 -->
					or depa.name like '%${keyWords}%' <!-- 发货城市 -->
				</when>
				<otherwise>
				    waybill.receive_customer_contact like '%${keyWords}%' <!-- 收货人姓名 -->
				    or waybill.delivery_customer_contact like '%${keyWords}%' <!-- 发货人姓名 -->
				    or  waybill.delivery_customer_phone like '%${keyWords}%' <!-- 发货人电话 -->
					or waybill.delivery_customer_mobilephone like '%${keyWords}%' <!-- 发货人手机 -->
				    or  waybill.receive_customer_phone like '%${keyWords}%' <!-- 收货人电话 -->
					or waybill.receive_customer_mobilephone like '%${keyWords}%' <!-- 收货人手机 -->
					or  dest.name like '%${keyWords}%' <!-- 发货城市 -->
					or depa.name like '%${keyWords}%' <!-- 收货城市 -->
				</otherwise>
			</choose>
			or waybill.waybill_no like '%${keyWords}%'  <!-- 运单号 -->
			or waybill.order_no like '%${keyWords}%' ) <!-- 订单号 -->
		</if>		
		<if test="startDate!=null and endDate!=null">
			and waybill.create_time between #{startDate,jdbcType=TIMESTAMP} and
			#{endDate,jdbcType=TIMESTAMP}
		</if>
		<if test="deliverMobile!=null and receiveMobile!=null and deliverMobile != '' and receiveMobile!='' ">
			and (waybill.delivery_customer_mobilephone =#{deliverMobile,jdbcType=VARCHAR} or waybill.receive_customer_mobilephone =#{receiveMobile,jdbcType=VARCHAR}) 
		</if>
		<if test="deliverMobile!=null and deliverMobile != ''  and receiveMobile==null">
			and waybill.delivery_customer_mobilephone =#{deliverMobile,jdbcType=VARCHAR}
		</if>
		<if test="receiveMobile!=null and receiveMobile!='' and deliverMobile==null">
			and waybill.receive_customer_mobilephone =#{receiveMobile,jdbcType=VARCHAR}
		</if>		
		order by waybill.bill_time desc		
	</sql>
	<select id="queryAppWaybillInfoByCondition4dubbo" parameterType="java.util.Map"
		resultType="com.deppon.foss.module.transfer.dubbo.api.define.CrmWaybillServiceDto">
		select distinct	/*模块：接送货-运单查询服务-APP我的发货单明细查询*/
			waybill.waybill_no waybillNo,
			waybill.create_time createTime,
			waybill.order_no orderNumber,
			waybill.bill_time sendTime,
			depart.name departureDeptName,
			depart.address departureDeptAddr,
			depart.dep_telephone
			departureDeptPhone,
			depart.code departureDeptNumber,
			depart.dep_fax
			departureDeptFax,
			waybill.DELIVERY_CUSTOMER_CONTACT sender,
			waybill.delivery_customer_phone senderPhone,
			waybill.delivery_customer_mobilephone senderMobile,
			waybill.delivery_customer_address senderAddress,
			waybill.receive_customer_contact consignee,
			waybill.receive_customer_phone consigneePhone,
			waybill.receive_customer_mobilephone consigneeMobile,
			waybill.receive_customer_address consigneeAddress,
			waybill.goods_name
			goodName,
			waybill.goods_weight_total weight,
			waybill.goods_volume_total
			cubage,
			waybill.goods_qty_total pieces,
			waybill.goods_package packing,
			waybill.receive_method deliveryType,
			waybill.transport_type tranType,
			waybill.product_code transProperties,
			/* waybill.deliver*/
			waybill.target_org_code destination,
			waybill.paid_method payment,
			waybill.insurance_amount/100 insurance,
			waybill.insurance_fee/100
			insuranceValue,
			waybill.refund_type refundType,
			waybill.cod_amount/100
			refund,
			waybill.cod_fee/100 refundFee,
			waybill.transport_fee/100
			transportFee,
			waybill.delivery_goods_fee/100 deliveryCharge,
			waybill.pickup_fee/100 pickCharge,
			waybill.package_fee/100 packingFee,
			waybill.total_fee/100 totalCharge,
			waybill.other_fee/100 otherFee,
			waybill.return_bill_type returnBillType,
			TO_CHAR(waybill.transportation_remark) tranDesc,
			waybill.paid_method
			paidMethod,
			signre.sign_time signedDate,
			waybill.target_org_code
			ladingStationNumber,
			decode(lading.name,null,agen.agent_dept_name,lading.name)
			ladingStationName,
			decode(lading.name,null,agen.address,lading.name,lading.address)
			ladingStationAddr,
			decode(lading.name,null,agen.contact_phone,lading.name,lading.dep_telephone)
			ladingStationPhone,
			lading.dep_fax ladingStationFax,
			depa.name
			departureCityName,
	    	dest.name destinationCityName,
	    	waybill.PRE_ARRIVE_TIME predictArriveTime,
			F.RECEIVE_CUSTOMER_ADDRESS_NOTE
			receiveCustomerAddressNote,
			F.DELIVERY_CUSTOMER_ADDRESS_NOTE
			deliveryCustomerAddressNote
		<include refid="queryAppWaybillInfoByCondition_from_where" />	
	</select>
	<select id="countQueryAppWaybillInfoByCondition4dubbo" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(1)
		<include refid="queryAppWaybillInfoByCondition_from_where" />
	</select>	
  <resultMap id="queryWaybillRelateDetailResultMap" type="com.deppon.foss.module.transfer.dubbo.api.define.WaybillRelateDetailEntity" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="PARENT_WAYBILL_NO" property="parentWaybillNo" jdbcType="VARCHAR" />
    <result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
    <result column="PARENT_ORDER_NO" property="parentOrderNo" jdbcType="VARCHAR" />
    <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
    <result column="CREATE_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
    <result column="MODIFY_USER_CODE" property="modifyUserCode" jdbcType="VARCHAR" />
    <result column="MODIFY_ORG_CODE" property="modifyOrgCode" jdbcType="VARCHAR" />
    <result column="WAYBILL_TYPE" property="waybillType" jdbcType="VARCHAR" />
    <result column="CREATE_ORG_CODE" property="createOrgCode" jdbcType="VARCHAR" />
    <result column="RECEIVE_ORG_CODE" property="receiveOrgCode" jdbcType="VARCHAR" />
    <result column="PENDING_TYPE" property="pendingType" jdbcType="VARCHAR" />
    <result column="ACTIVE" property="active" jdbcType="CHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="BILL_TIME" property="billTime" jdbcType="TIMESTAMP" />
	<result column="GOODS_WEIGHT_TOTAL" property="goodsWeightTotal" jdbcType="DECIMAL" />
	<result column="GOODS_VOLUME_TOTAL" property="goodsVolumeTotal" jdbcType="DECIMAL" />
	<result column="IS_PIC_PACKAGE" property="isPicPackage" jdbcType="CHAR"/>
	<result column="WEIGHT" property="weight" jdbcType="DECIMAL"/>
	<result column="VOLUME" property="volume" jdbcType="DECIMAL"/>
	<result column="TASK_ID" property="taskId" jdbcType="VARCHAR"/>
  </resultMap>
 	 <!-- 根据运单号集合查询每个运单号的信息 -->
	<select id="queryWaybillRelateDetailByWaybillNums4dubbo" parameterType="java.util.List" resultMap="queryWaybillRelateDetailResultMap">
		 select distinct /*模块：接送货-运单-子母单-根据运单号集合查询运单信息*/
		    ID, PARENT_WAYBILL_NO, WAYBILL_NO, ACTIVE, CREATE_TIME, MODIFY_TIME, BILL_TIME, CREATE_USER_CODE, 
		    MODIFY_USER_CODE, MODIFY_ORG_CODE, WAYBILL_TYPE, CREATE_ORG_CODE, RECEIVE_ORG_CODE, 
		    ORDER_NO, PENDING_TYPE, PARENT_ORDER_NO, GOODS_WEIGHT_TOTAL, GOODS_VOLUME_TOTAL, IS_PIC_PACKAGE, WEIGHT,VOLUME, TASK_ID
		    from pkp.t_srv_waybill_relate_detail 
	    <where>
			active = 'Y'
			and  waybill_no in
			<foreach collection="list" item="waybillNum" index="index" open="(" separator="," close=")">
				#{waybillNum,jdbcType=VARCHAR}
			</foreach>
	    </where>
	</select>	
	<resultMap id="waybillSignResultMap"
		type="com.deppon.foss.module.transfer.dubbo.api.define.WaybillSignResultEntity">
		<id column="ID" property="id" jdbcType="VARCHAR" />
	    <result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
	    <result column="SIGN_SITUATION" property="signSituation" jdbcType="VARCHAR" />
	    <result column="DELIVERYMAN_NAME" property="deliverymanName" jdbcType="VARCHAR" />
	    <result column="SIGN_GOODS_QTY" property="signGoodsQty" jdbcType="DECIMAL" />
	    <result column="SIGN_NOTE" property="signNote" jdbcType="VARCHAR" />
	    <result column="SIGN_TIME" property="signTime" jdbcType="TIMESTAMP" />
	    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
	    <result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
	    <result column="ACTIVE" property="active" jdbcType="CHAR" />
	    <result column="IDENTIFY_TYPE" property="identifyType" jdbcType="VARCHAR" />
	    <result column="IDENTIFY_CODE" property="identifyCode" jdbcType="VARCHAR" />
	    <result column="IS_PDA_SIGN" property="isPdaSign" jdbcType="CHAR" />
	    <result column="SIGN_STATUS" property="signStatus" jdbcType="VARCHAR" />
	    <result column="AGENT_CODE" property="agentCode" jdbcType="VARCHAR" />
	    <result column="IS_RFCING" property="isRfcing" jdbcType="CHAR" />
	    <result column="DELIVER_DATE" property="deliverDate" jdbcType="TIMESTAMP" />
	    <result column="ARRIVE_TIME" property="arriveTime" jdbcType="TIMESTAMP" />
    	<result column="RECEIVE_METHOD" property="receiveMethod" jdbcType="VARCHAR" />
    	<result column="CREATE_ORG_CODE" property="createOrgCode" jdbcType="VARCHAR" />
    	<result column="CREATE_ORG_NAME" property="createOrgName" jdbcType="VARCHAR" />
    	<result column="CREATOR" property="creator" jdbcType="VARCHAR" />
    	<result column="CREATOR_CODE" property="creatorCode" jdbcType="VARCHAR" />
    	<result column="SEND_EXPRESS_ORG_CODE" property="expressOrgCode" jdbcType="VARCHAR" />
    	<result column="SEND_EXPRESS_ORG_NAME" property="expressOrgName" jdbcType="VARCHAR" />
    	<result column="SEND_EXPRESS_EMP_CODE" property="expressEmpCode" jdbcType="VARCHAR" />
    	<result column="SEND_EXPRESS_EMP_NAME" property="expressEmpName" jdbcType="VARCHAR" />
		<result column="TO_PAY_AMOUNT" property="toPayAmount" jdbcType="DECIMAL" />
		<result column="COD_AMOUNT" property="codAmount" jdbcType="DECIMAL" />
		<result column="COD_PAYMENT_TYPE" property="codPaymentType" jdbcType="VARCHAR" />
		<result column="COD_BANK_TRADESERAIL" property="codBankTradeSerail" jdbcType="VARCHAR" />
		<result column="TOTAL_AMOUNT" property="totalAmount" jdbcType="DECIMAL" />
		<result column="TOTAL_PAYMENT_TYPE" property="totalPaymentType" jdbcType="VARCHAR" />
		<result column="IS_PARTNER" property="isPartner" jdbcType="CHAR" />
		<result column="PARTNER_NAME" property="partnerName" jdbcType="VARCHAR" />
		<result column="PARTNER_PHONE" property="partnerPhone" jdbcType="VARCHAR" />
	</resultMap>
	<select id="queryWaybillSignResult4dubbo" parameterType="com.deppon.foss.module.transfer.dubbo.api.define.WaybillSignResultEntity"
		resultMap="waybillSignResultMap">
    		select /*模块：接送货-签收-查询运单签收结果信息 */
			    ID, WAYBILL_NO, SIGN_SITUATION, DELIVERYMAN_NAME, SIGN_GOODS_QTY, SIGN_NOTE, SIGN_TIME, 
			    CREATE_TIME, MODIFY_TIME, ACTIVE, IDENTIFY_TYPE, IDENTIFY_CODE, IS_PDA_SIGN, SIGN_STATUS, 
			    AGENT_CODE, IS_RFCING, DELIVER_DATE, ARRIVE_TIME, RECEIVE_METHOD, CREATE_ORG_CODE, 
			    CREATE_ORG_NAME, CREATOR, CREATOR_CODE
    		from pkp.T_SRV_WAYBILL_SIGN_RESULT  
    	<where>
    		<choose>
				<when test="waybillNo != null and waybillNo != ''">
					and WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
				</when>
				<otherwise>
					and WAYBILL_NO = ''
				</otherwise>
			</choose>
    		<if test="active!=null and active != ''">
    			and ACTIVE = #{active,jdbcType=CHAR}
    		</if>
    	</where>
    	order by sign_time desc
	</select>
  <resultMap id="onlineDetermineResultMap" type="com.deppon.foss.module.transfer.dubbo.api.define.ProductEntity" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="CODE" property="code" jdbcType="VARCHAR" />
    <result column="NAME" property="name" jdbcType="VARCHAR" />
    <result column="ACTIVE" property="active" jdbcType="CHAR" />
    <result column="DESCRIPTION" property="mark" jdbcType="VARCHAR" />
    <result column="VERSION_NO" property="versionNo" jdbcType="DECIMAL" />
    <result column="BEGIN_TIME" property="beginTime" jdbcType="TIMESTAMP" />
    <result column="END_TIME" property="endTime" jdbcType="TIMESTAMP" />
    <result column="TRANSPORT_TYPE" property="transportType" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createDate"  />
    <result column="MODIFY_TIME" property="modifyDate"  />
    <result column="CREATE_USER_CODE" property="createUser" jdbcType="VARCHAR" />
    <result column="MODIFY_USER_CODE" property="modifyUser" jdbcType="VARCHAR" />
    <result column="CREATE_ORG_CODE" property="createOrgCode" jdbcType="VARCHAR" />
    <result column="MODIFY_ORG_CODE" property="modifyOrgCode" jdbcType="VARCHAR" />
    <result column="LEVELS" property="levels" jdbcType="DECIMAL" />
    <result column="PARENT_CODE" property="parentCode" jdbcType="VARCHAR" />
    <result column="REF_ID" property="refId" jdbcType="VARCHAR" />
    <result column="SHORT_NAME" property="shortName" jdbcType="VARCHAR" />
    <result column="PRIORITY" property="priority" jdbcType="VARCHAR" />
    <result column="SEQ" property="seq" jdbcType="INTEGER" />
    <result column="DEST_NET_TYPE" property="destNetType" jdbcType="VARCHAR" />
  </resultMap>
	<select id="onlineDetermineIsExpressByProductCode4dubbo" resultMap="onlineDetermineResultMap" parameterType="map">
		SELECT /** 综合-价格-根据一级产品查询对应的所有效的3级产品类型 **/
		    ID, CODE, NAME, ACTIVE, DESCRIPTION, VERSION_NO, BEGIN_TIME, END_TIME, TRANSPORT_TYPE, 
		    CREATE_TIME, MODIFY_TIME, CREATE_USER_CODE, MODIFY_USER_CODE, CREATE_ORG_CODE, MODIFY_ORG_CODE,
		    LEVELS,PARENT_CODE,REF_ID,SHORT_NAME,PRIORITY,SEQ,DEST_NET_TYPE
	    FROM PKP.T_SRV_PRODUCT A 
	    WHERE 
	    A.LEVELS=#{levels,jdbcType=DECIMAL} AND A.CODE=#{productCode,jdbcType=VARCHAR}
	   <![CDATA[AND A.BEGIN_TIME <= #{billTime,jdbcType=TIMESTAMP} AND A.END_TIME > #{billTime,jdbcType=TIMESTAMP}]]>	
		AND EXISTS (SELECT 1 FROM PKP.T_SRV_PRODUCT L WHERE L.ACTIVE = #{active,jdbcType=VARCHAR}
   		AND L.CODE = A.PARENT_CODE AND L.PARENT_CODE IN 
   		<foreach collection="productCodeList" open="(" close=")" separator="," item="productCodetemp">
			<![CDATA[	#{productCodetemp,jdbcType=VARCHAR}]]>
		</foreach>)
	</select>
  <resultMap id="selectBaseResultMap" type="com.deppon.foss.module.transfer.dubbo.api.define.BillPayableEntity" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="PAYABLE_NO" property="payableNo" jdbcType="VARCHAR" />
    <result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
    <result column="WAYBILL_ID" property="waybillId" jdbcType="VARCHAR" />
    <result column="PAYMENT_NO" property="paymentNo" jdbcType="VARCHAR" />
    <result column="CREATE_TYPE" property="createType" jdbcType="VARCHAR" />
    <result column="BILL_TYPE" property="billType" jdbcType="VARCHAR" />
    <result column="SOURCE_BILL_NO" property="sourceBillNo" jdbcType="VARCHAR" />
    <result column="SOURCE_BILL_TYPE" property="sourceBillType" jdbcType="VARCHAR" />
    <result column="COD_TYPE" property="codType" jdbcType="VARCHAR" />
    <result column="PAYABLE_ORG_CODE" property="payableOrgCode" jdbcType="VARCHAR" />
    <result column="PAYABLE_ORG_NAME" property="payableOrgName" jdbcType="VARCHAR" />
    <result column="PAYABLE_COM_CODE" property="payableComCode" jdbcType="VARCHAR" />
    <result column="PAYABLE_COM_NAME" property="payableComName" jdbcType="VARCHAR" />
    <result column="ORIG_ORG_CODE" property="origOrgCode" jdbcType="VARCHAR" />
    <result column="ORIG_ORG_NAME" property="origOrgName" jdbcType="VARCHAR" />
    <result column="DEST_ORG_CODE" property="destOrgCode" jdbcType="VARCHAR" />
    <result column="DEST_ORG_NAME" property="destOrgName" jdbcType="VARCHAR" />
    <result column="CUSTOMER_CODE" property="customerCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="AMOUNT" property="amount" jdbcType="DECIMAL" />
    <result column="VERIFY_AMOUNT" property="verifyAmount" jdbcType="DECIMAL" />
    <result column="UNVERIFY_AMOUNT" property="unverifyAmount" jdbcType="DECIMAL" />
    <result column="CURRENCY_CODE" property="currencyCode" jdbcType="VARCHAR" />
    <result column="PRODUCT_CODE" property="productCode" jdbcType="VARCHAR" />
    <result column="PRODUCT_ID" property="productId" jdbcType="VARCHAR" />
    <result column="ACCOUNT_DATE" property="accountDate" jdbcType="TIMESTAMP" />
    <result column="BUSINESS_DATE" property="businessDate" jdbcType="TIMESTAMP" />
    <result column="SIGN_DATE" property="signDate" jdbcType="TIMESTAMP" />
    <result column="EFFECTIVE_DATE" property="effectiveDate" jdbcType="TIMESTAMP" />
    <result column="CREATE_USER_NAME" property="createUserName" jdbcType="VARCHAR" />
    <result column="CREATE_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
    <result column="CREATE_ORG_CODE" property="createOrgCode" jdbcType="VARCHAR" />
    <result column="CREATE_ORG_NAME" property="createOrgName" jdbcType="VARCHAR" />
    <result column="ACTIVE" property="active" jdbcType="CHAR" />
    <result column="IS_RED_BACK" property="isRedBack" jdbcType="CHAR" />
    <result column="IS_INIT" property="isInit" jdbcType="CHAR" />
    <result column="VERSION_NO" property="versionNo" jdbcType="DECIMAL" />
    <result column="EFFECTIVE_STATUS" property="effectiveStatus" jdbcType="CHAR" />
    <result column="EFFECTIVE_USER_NAME" property="effectiveUserName" jdbcType="VARCHAR" />
    <result column="EFFECTIVE_USER_CODE" property="effectiveUserCode" jdbcType="VARCHAR" />
    <result column="FROZEN_STATUS" property="frozenStatus" jdbcType="CHAR" />
    <result column="FROZEN_TIME" property="frozenTime" jdbcType="TIMESTAMP" />
    <result column="FROZEN_USER_NAME" property="frozenUserName" jdbcType="VARCHAR" />
    <result column="FROZEN_USER_CODE" property="frozenUserCode" jdbcType="VARCHAR" />
    <result column="PAY_STATUS" property="payStatus" jdbcType="CHAR" />
    <result column="STATEMENT_BILL_NO" property="statementBillNo" jdbcType="VARCHAR" />
    <result column="CUSTOMER_CONTACT" property="customerContact" jdbcType="VARCHAR" />
    <result column="CUSTOMER_CONTACT_NAME" property="customerContactName" jdbcType="VARCHAR" />
    <result column="CUSTOMER_PHONE" property="customerPhone" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="MODIFY_USER_NAME" property="modifyUserName" jdbcType="VARCHAR" />
    <result column="MODIFY_USER_CODE" property="modifyUserCode" jdbcType="VARCHAR" />
    <result column="WORKFLOW_NO" property="workflowNo" jdbcType="VARCHAR" />
    <result column="LGDRIVER_CODE" property="lgdriverCode" jdbcType="VARCHAR" />
    <result column="LGDRIVER_NAME" property="lgdriverName" jdbcType="VARCHAR" />
    <result column="PAYER_TYPE" property="payerType" jdbcType="VARCHAR" />
    <result column="PAYABLE_TYPE" property="payableType" jdbcType="VARCHAR" />
    <result column="DELIVER_FEE" property="deliverFee" jdbcType="DECIMAL" />
    <result column="OUTGOING_FEE" property="outgoingFee" jdbcType="DECIMAL" />
    <result column="AUDIT_USER_CODE" property="auditUserCode" jdbcType="VARCHAR" />
    <result column="AUDIT_USER_NAME" property="auditUserName" jdbcType="VARCHAR" />
    <result column="AUDIT_DATE" property="auditDate" jdbcType="TIMESTAMP" />
    <result column="APPROVE_STATUS" property="approveStatus" jdbcType="VARCHAR" />
    <result column="NOTES" property="notes" jdbcType="VARCHAR" />
    <result column="PAYEE_NAME" property="payeeName" jdbcType="VARCHAR" />
    <result column="BANK_HQ_CODE" property="bankHqCode" jdbcType="VARCHAR" />
    <result column="BANK_HQ_NAME" property="bankHqName" jdbcType="VARCHAR" />
    <result column="ACCOUNT_NO" property="accountNo" jdbcType="VARCHAR" />
    <result column="PROVINCE_CODE" property="provinceCode" jdbcType="VARCHAR" />
    <result column="PROVINCE_NAME" property="provinceName" jdbcType="VARCHAR" />
    <result column="CITY_CODE" property="cityCode" jdbcType="VARCHAR" />
    <result column="CITY_NAME" property="cityName" jdbcType="VARCHAR" />
    <result column="BANK_BRANCH_CODE" property="bankBranchCode" jdbcType="VARCHAR" />
    <result column="BANK_BRANCH_NAME" property="bankBranchName" jdbcType="VARCHAR" />
    <result column="PAYMENT_NOTES" property="paymentNotes" jdbcType="VARCHAR" />
    <result column="PAYMENT_AMOUNT" property="paymentAmount" jdbcType="DECIMAL" />
    <result column="LAST_PAYMENT_TIME" property="lastPaymentTime" jdbcType="TIMESTAMP" /><!-- 最后付款日期 -->
    <result column="PAYMENT_CATEGORIES" property="paymentCategories" jdbcType="VARCHAR" /><!-- 支付类别 -->
    <result column="IS_WRITEOFF" property="isWriteoff" jdbcType="CHAR" /><!-- 是否核销 -->
    <result column="ACCOUNT_TYPE" property="accountType" jdbcType="VARCHAR" /><!-- 账户类型-->
    <result column="COD_AGENCY_FEE" property="codAgencyFee" jdbcType="DECIMAL" />
    <result column="EXTERNAL_INSURANCE_FEE" property="externalInsuranceFee" jdbcType="DECIMAL" />
    <result column="EXPRESS_ORIG_ORG_CODE" property="expressOrigOrgCode" jdbcType="VARCHAR" />
    <result column="EXPRESS_ORIG_ORG_NAME" property="expressOrigOrgName" jdbcType="VARCHAR" />
    <result column="EXPRESS_DEST_ORG_CODE" property="expressDestOrgCode" jdbcType="VARCHAR" />
    <result column="EXPRESS_DEST_ORG_NAME" property="expressDestOrgName" jdbcType="VARCHAR" />
    <result column="INVOICE_MARK" property="invoiceMark" jdbcType="VARCHAR" /> 
    <result column="COSTDEPT_CODE" property="costDeptCode" jdbcType="VARCHAR" /> 
    <result column="COSTDEPT_NAME" property="costDeptName" jdbcType="VARCHAR" /> 
    <result column="COST_DATE" property="costDate" jdbcType="TIMESTAMP" /> 
    <result column="VEHICLE_NO" property="vehicleNo" jdbcType="VARCHAR" /> 
    <result column="DRIVER_NAME" property="driverName" jdbcType="VARCHAR" /> 
    <result column="DRIVER_PHONE" property="driverPhone" jdbcType="VARCHAR" /> 
    <result column="RENTCAR_USE_TYPE" property="rentCarUseType" jdbcType="VARCHAR" /> 
    <result column="COST_TYPE" property="costType" jdbcType="VARCHAR" />
    <result column="VAT_INVOICE" property="vatInvoice" jdbcType="VARCHAR" />
    <result column="TAXPAYER_NUMBER" property="taxpayerNumber" jdbcType="VARCHAR" />
    <result column="TAX_AMOUNT" property="taxAmount" jdbcType="VARCHAR" />
    <result column="TAX" property="tax" jdbcType="VARCHAR" />
    <result column="BUSINESS_OF_DATE" property="businessOfDate" jdbcType="TIMESTAMP" />
    <result column="ACCRUED_STATE" property="accruedState" jdbcType="VARCHAR" />
    <result column="WITHHOLDING_STATUS" property="withholdingStatus" jdbcType="VARCHAR" />
    <result column="UNIFIED_SETTLEMENT" property="unifiedSettlement" jdbcType="VARCHAR"/>
    <result column="CONTRACT_ORG_CODE" property="contractOrgCode" jdbcType="VARCHAR"/>
    <result column="CONTRACT_ORG_NAME" property="contractOrgName" jdbcType="VARCHAR"/>
    <result column="PAYMENT_WORKFLOW_NO" property="paymentWorkflowNo" jdbcType="VARCHAR"/>
    <result column="PAYMENT_TRANSFER" property="paymentTransfer" jdbcType="VARCHAR"/>
    <result column="CLAIMWAY" property="claimWay" jdbcType="VARCHAR"/>
    <result column="EXPENSE_BEAR_CODE" property="expenseBearCode" jdbcType="VARCHAR" />
  </resultMap>
  <select id="selectByWaybillNosAndByBillTypes4dubbo" resultMap="selectBaseResultMap" parameterType="java.util.Map" >
	    SELECT /*结算-应付单-根据运单号和单据类型查询应付单*/
		    ID, PAYABLE_NO, WAYBILL_NO, WAYBILL_ID, PAYMENT_NO, CREATE_TYPE, BILL_TYPE, SOURCE_BILL_NO, SOURCE_BILL_TYPE,COD_TYPE,
		    PAYABLE_ORG_CODE, PAYABLE_ORG_NAME, PAYABLE_COM_CODE, PAYABLE_COM_NAME, ORIG_ORG_CODE, 
		    ORIG_ORG_NAME, DEST_ORG_CODE, DEST_ORG_NAME, CUSTOMER_CODE, CUSTOMER_NAME, AMOUNT/100 AMOUNT, 
		    VERIFY_AMOUNT/100 VERIFY_AMOUNT, UNVERIFY_AMOUNT/100 UNVERIFY_AMOUNT, CURRENCY_CODE,PRODUCT_CODE,PRODUCT_ID, ACCOUNT_DATE, BUSINESS_DATE, SIGN_DATE, 
		    EFFECTIVE_DATE, CREATE_USER_NAME, CREATE_USER_CODE, CREATE_ORG_CODE, CREATE_ORG_NAME, 
		    ACTIVE, IS_RED_BACK, IS_INIT, VERSION_NO, EFFECTIVE_STATUS, EFFECTIVE_USER_NAME, 
		    EFFECTIVE_USER_CODE, FROZEN_STATUS, FROZEN_TIME, FROZEN_USER_NAME, FROZEN_USER_CODE, 
		    PAY_STATUS, STATEMENT_BILL_NO,  CUSTOMER_CONTACT, 
		    CUSTOMER_CONTACT_NAME, CUSTOMER_PHONE, CREATE_TIME, MODIFY_TIME, 
		    MODIFY_USER_NAME, MODIFY_USER_CODE, 
		    WORKFLOW_NO, LGDRIVER_CODE, LGDRIVER_NAME, PAYER_TYPE, PAYABLE_TYPE, DELIVER_FEE/100 DELIVER_FEE, 
		    OUTGOING_FEE/100 OUTGOING_FEE, AUDIT_USER_CODE, AUDIT_USER_NAME, AUDIT_DATE, APPROVE_STATUS, NOTES
		    ,PAYEE_NAME,BANK_HQ_CODE,BANK_HQ_NAME,ACCOUNT_NO,PROVINCE_CODE,PROVINCE_NAME,
		    CITY_CODE,CITY_NAME,BANK_BRANCH_CODE,BANK_BRANCH_NAME,PAYMENT_NOTES,PAYMENT_AMOUNT/100 PAYMENT_AMOUNT
		    ,LAST_PAYMENT_TIME,PAYMENT_CATEGORIES,IS_WRITEOFF,ACCOUNT_TYPE,COD_AGENCY_FEE/100,EXTERNAL_INSURANCE_FEE/100,
		    EXPRESS_ORIG_ORG_CODE,EXPRESS_ORIG_ORG_NAME,EXPRESS_DEST_ORG_CODE,EXPRESS_DEST_ORG_NAME,INVOICE_MARK,
		    UNIFIED_SETTLEMENT,CONTRACT_ORG_CODE,CONTRACT_ORG_NAME,EXPENSE_BEAR_CODE
	    FROM STL.T_STL_BILL_PAYABLE  WHERE
		WAYBILL_NO IN
		<foreach collection="waybillNos"  index="index" item="item"  open="(" separator="," close=")">  
			     #{item} 
		</foreach>
		AND BILL_TYPE IN
		<foreach collection="billTypes"  index="index" item="item"  open="(" separator="," close=")">  
			     #{item} 
		</foreach>
		<if test="active!=null and active!='' ">
			AND ACTIVE=#{active}
		</if>
  </select>
  <select id="queryWaybillInfo4dubbo"
		parameterType="com.deppon.foss.module.transfer.dubbo.api.define.WaybillQueryInfoDto"
		resultMap="waybillInfoResultMap">
		select  /*模块：接送货-运单-根据运单集合返回运单详细信息*/
		w.waybill_no ,
		w.transport_type ,
		w.product_code,
		w.delivery_customer_name ,
		w.delivery_customer_contact,
		w.delivery_customer_phone ,
		w.delivery_customer_mobilephone ,
		w.delivery_big_customer ,<!-- 增加发货客户为大客户 -->
		w.receive_org_code ,
		w.delivery_customer_address ,
		w.receive_customer_name ,
		w.receive_customer_contact,
		w.receive_customer_phone ,
		w.receive_customer_mobilephone,
		w.target_org_code,
		w.receive_customer_address,
		w.goods_name,
		w.goods_qty_total,
		w.goods_weight_total,
		w.goods_volume_total,
		w.total_fee/100 as total_fee,
		w.paid_method,
		w.pre_pay_amount/100 as
		pre_pay_amount,
		w.to_pay_amount/100 as to_pay_amount,
		w.refund_type,
		w.cod_amount/100 as cod_amount,
		w.cod_fee/100 as cod_fee,
		w.receive_method,
		w.pickup_fee/100 as pickup_fee,
		w.delivery_goods_fee/100 as delivery_goods_fee,
		w.package_fee/100 as
		package_fee,
		w.service_fee/100 as service_fee,
		w.transport_fee/100 as
		transport_fee,
		w.receive_org_code,
		w.customer_pickup_org_code,
		w.pre_arrive_time,
		r.sign_situation,
		r.deliveryman_name,
		r.sign_time,
		r.sign_note,
		w.order_no,
		w.insurance_amount/100 as insurance_amount,
		w.insurance_fee/100 as insurance_fee,
		w.goods_package,
		w.active,
		w.other_fee/100 as other_fee,
		w.outer_notes,
		w.delivery_customer_code,
		w.receive_customer_code,
		f.settle_status,
		w.return_bill_type,
		w.transportation_remark,
		w.goods_package,
		w.bill_time,
		w.load_org_code ,
		w.delivery_customer_prov_code ,
		w.delivery_customer_city_code ,
		w.delivery_customer_dist_code,
		w.receive_customer_prov_code ,
		w.receive_customer_city_code ,
		w.receive_customer_dist_code,
		w.pickup_to_door,

		w.PICKUP_CENTRALIZED,
		w.CREATE_USER_CODE,
		w.CREATE_USER_NAME,
		w.CREATE_USER_DEPT_NAME,

		w.CREATE_ORG_CODE as
		CREATE_ORG_CODE,
		bso.name as CREATE_ORG_NAME,
		w.DRIVER_CODE,
		bsem2.emp_name as DRIVER_NAME,
		w.IS_EXPRESS,
		w.MODIFY_TIME,
	    bsem3.emp_code as MODIFY_USER_CODE,
	    bsem3.emp_name as MODIFY_USER_NAME,
	    mbso.UNIFIED_CODE as MODIFY_ORG_CODE,
	    mbso.NAME as MODIFY_ORG_NAME,
	    w.GOODS_SIZE,
		exp.EXPRESS_EMP_CODE ,
		exp.EXPRESS_EMP_NAME,
		exp.EXPRESS_ORG_CODE,
		exp.EXPRESS_ORG_NAME,
		F.RECEIVE_CUSTOMER_ADDRESS_NOTE AS RECEIVE_CUSTOMER_ADDRESS_NOTE,
		F.DELIVERY_CUSTOMER_ADDRESS_NOTE AS DELIVERY_CUSTOMER_ADDRESS_NOTE,
		f.notification_result,
		d.pricing_entry_code,
		e.name,
		d.amount/100 as
		amount,
		tcg.OPERATION_ORG_NAME,
		tcg.OPERATION_ORG_CODE,
		bso.name as
		PRINCIPAL_ORG_NAME,
		bso.PRINCIPAL_NO,
		bsem.emp_name,
		wr.RETURN_TYPE,  <!-- 添加新字段，返货类型 -->
		wr.ORIGINAL_WAYBILL_NO,  <!-- 添加新字段，原运单号 -->
        w.pre_customer_pickup_time, <!-- 添加新字段，预计派送/提货时间 -->
        f.STATUS <!-- 添加新字段，运单状态 -->
        from pkp.t_srv_waybill w
		left join pkp.t_srv_waybill_charge_detail d on
		d.waybill_no = w.waybill_no
		and d.active = 'Y'
		<!-- 关联表 wutao -->
		left join pkp.t_srv_waybill_return wr on wr.waybill_no = w.waybill_no
		left join pkp.t_srv_pricing_entry e on e.code = d.pricing_entry_code
		and
		e.active = 'Y'
		left join pkp.t_srv_waybill_sign_result r on
		r.waybill_no = w.waybill_no
		and r.active = 'Y'
		inner join
		pkp.t_srv_actual_freight f on f.waybill_no = w.waybill_no
		left join
		pkp.T_SRV_WAYBILL_EXPRESS exp on exp.WAYBILL_ID = w.ID
		left join
		(select tc.* from tfr.t_opt_complement_log tc where
		tc.operation_time=(
		select max(operation_time) from
		tfr.t_opt_complement_log where waybill_no=tc.waybill_no))tcg
		on	tcg.waybill_no = w.waybill_no
		left join bse.t_bas_org bso on
		bso.code=w.CREATE_ORG_CODE and bso.active='Y'
		left join bse.t_bas_org
		mbso on mbso.code=w.MODIFY_ORG_CODE and mbso.active='Y'
		left join
		bse.t_bas_employee bsem on bsem.emp_code=bso.PRINCIPAL_NO and
		bsem.active='Y'
		left join bse.t_bas_employee bsem2 on
		bsem2.emp_code=w.DRIVER_CODE and bsem2.active='Y'
		left join
		bse.t_bas_employee bsem3 on bsem3.emp_code=w.MODIFY_USER_CODE and
		bsem3.active='Y'
		where w.waybill_no in
		<foreach collection="waybillList" open="(" close=")"
			separator="," item="waybillNo">
			<if test="waybillNo!=null and waybillNo != ''">
    	      <![CDATA[	#{waybillNo,jdbcType=VARCHAR} ]]>
			</if>
		</foreach>
		<if test="state!=null and state!= ''">
			and w.active =  <![CDATA[#{state,jdbcType=VARCHAR}]]>
		</if>
	</select>
	<select id="queryWaybillExpressByNo4dubbo" resultMap="WaybillNoBaseResultMap" parameterType="java.lang.String">
		SELECT 
		ID, 
		WAYBILL_ID, 
		WAYBILL_NO, 
		DELIVERY_CUSTOMER_PROV_CODE,
		DELIVERY_CUSTOMER_CITY_CODE, 
		DELIVERY_CUSTOMER_DIST_CODE, 
		RECEIVE_CUSTOMER_CODE, 
		RECEIVE_CUSTOMER_NAME, 
		RECEIVE_CUSTOMER_MOBILEPHONE, 
		RECEIVE_CUSTOMER_PHONE, 
		RECEIVE_CUSTOMER_CONTACT, 
		RECEIVE_CUSTOMER_PROV_CODE,
		RECEIVE_CUSTOMER_CITY_CODE,
		RECEIVE_CUSTOMER_DIST_CODE,
		RECEIVE_CUSTOMER_ADDRESS,
		RECEIVE_METHOD,
		TARGET_ORG_CODE,
		BILL_TIME,
		CREATE_ORG_CODE,
		IS_ADD_CODE,
		ADD_CODE_TIME,
		RETURN_TYPE,
		ORIGINAL_WAYBILL_NO,
		EXPRESS_EMP_CODE,
		EXPRESS_EMP_NAME,
		EXPRESS_ORG_CODE,
		EXPRESS_ORG_NAME,
		PDA_SERIAL,
		BANK_TRADE_SERIAL,
		CUSTOMER_PICKUP_ORG_CODE,
		CUSTOMER_PICKUP_ORG_NAME,
		RECEIVE_ORG_CODE,
		RECEIVE_ORG_NAME,
		CAN_RETURN_CARGO,
		LAST_OUTFIELD_CODE,
		CHANGE_VOLUME,
		VOLUME_WEIGHT,
		MODIFY_TIME,
		INNER_PICKUP_FEE_BURDEN_DEPT,
		DELIVERY_EMPLOYEE_CODE 
		FROM PKP.T_SRV_WAYBILL_EXPRESS WHERE WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
	</select>
	<select id="queryExpressWaybillByOriginalWaybillNo4dubbo" resultMap="WaybillNoBaseResultMap" parameterType="java.lang.String">
		SELECT 
	    E.RETURN_TYPE,
	    E.ORIGINAL_WAYBILL_NO,
        E.WAYBILL_NO
        from Pkp.T_Srv_Waybill_Express E Left Join Pkp.T_Srv_Actual_Freight t
			    On E.Waybill_No = T.Waybill_No
				 Where E.Original_Waybill_No = #{waybillNo,jdbcType=VARCHAR}
			   And T.Status Not In ('OBSOLETE', 'ABORTED')
	</select>
</mapper>