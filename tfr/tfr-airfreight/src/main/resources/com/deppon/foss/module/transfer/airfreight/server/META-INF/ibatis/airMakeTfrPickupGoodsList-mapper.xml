<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
	"-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="foss.airfreight" >
	<!-- 航空正单明细T_OPT_AIR_WAYBILL_DETAIL -->
	<resultMap  id="airTransPickupBillResultMap" type="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirWaybillDetailEntity">
		<id  property="id" column="ID"/>
		<result property="airWaybillId" column="AIR_WAYBILL_ID"/>
		<result property="waybillNo" column="WAYBILL_NO"/>
		<result property="arrvRegionName" column="ARRV_REGION_NAME"/>
		<result property="grossWeight" column="GROSS_WEIGHT"/>
		<result property="billingWeight" column="BILLING_WEIGHT"/>
		<result property="weight" column="GROSS_WEIGHT"/>
		<result property="volume" column="VOLUME"/>
		<result property="goodsQty" column="GOODS_QTY"/>
		<result property="airPickQty" column="AIRPICK_QTY"/>
		<result property="goodsName" column="GOODS_NAME"/>
		<result property="createTime" column="CREATE_TIME"/>
		<result property="deliverFee" column="DELIVER_FEE"/>
		<result property="arrivalFee" column="ARRIVAL_FEE"/>
		<result property="pickupType" column="PICKUP_TYPE"/>
		<result property="collectionFee" column="COLLECTION_FEE"/>
		<result property="receiverContactPhone" column="RECEIVER_CONTACT_PHONE"/>
		<result property="receiverAddress" column="RECEIVER_ADDRESS"/>
		<result property="receiverName" column="RECEIVER_NAME"/>
		<result property="notes" column="TRANSPORTATION_REMARK"/>
		<result property="transportType" column="product_code"/>
		
	</resultMap>
	
	<!-- 获取航空正单 -->
	<resultMap  id="airTransPickupReceiverNameResultMap" type="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirWaybillEntity">
		 <id  property="id" column="ID"/>
		<result property="airLineTwoletter" column="AIR_LINE_TWOLETTER"/>
		<result property="airWaybillNo" column="AIR_WAYBILL_NO"/>
		<result property="deptRegionCode" column="DEPT_REGION_CODE"/>
		<result property="deptRegionName" column="DEPT_REGION_NAME"/>
		<result property="arrvRegionCode" column="ARRV_REGION_CODE"/>
		<result property="arrvRegionName" column="ARRV_REGION_NAME"/>
		<result property="airAssembleType" column="AIR_ASSEMBLE_TYPE"/>
		<result property="destOrgCode" column="DEST_ORG_CODE"/>
		<result property="dedtOrgName" column="DEDT_ORG_NAME"/>
		<result property="receiverCode" column="RECEIVER_CODE"/>
		<result property="receiverName" column="RECEIVER_NAME"/>
		<result property="receiverContactPhone" column="RECEIVER_CONTACT_PHONE"/>
		<result property="accountItem" column="ACCOUNT_ITEM"/>
		<result property="billingAgency" column="BILLING_AGENCY"/>
		<result property="receiverAddress" column="RECEIVER_ADDRESS"/>
		<result property="storageItem" column="STORAGE_ITEM"/>
		<result property="flightNo" column="FLIGHT_NO"/>
		<result property="flightDate" column="FLIGHT_DATE"/>
		<result property="takeOffTime" column="TAKE_OFF_TIME"/>
		<result property="arriveTime" column="ARRIVE_TIME"/>
		<result property="rateClass" column="RATE_CLASS"/>
		<result property="paymentType" column="PAYMENT_TYPE"/>
		<result property="grossWeight" column="GROSS_WEIGHT"/>
		<result property="billingWeight" column="BILLING_WEIGHT"/>
		<result property="fee" column="FEE"/>
		<result property="agenctCode" column="AGENCT_CODE"/>
		<result property="agencyName" column="AGENCY_NAME"/>
		<result property="declareValue" column="DECLARE_VALUE"/>
		<result property="itemCode" column="ITEM_CODE"/>
		<result property="goodsQty" column="GOODS_QTY"/>
		<result property="volume" column="VOLUME"/>
		<result property="airFee" column="AIR_FEE"/>
		<result property="extraFee" column="EXTRA_FEE"/>
		<result property="goodsName" column="GOODS_NAME"/>
		<result property="packageStruction" column="PACKAGE_STRUCTION"/>
		<result property="groundFee" column="GROUND_FEE"/>
		<result property="fuelSurcharge" column="FUEL_SURCHARGE"/>
		<result property="transportInsurance" column="TRANSPORT_INSURANCE"/>
		<result property="inseranceFee" column="INSERANCE_FEE"/>
		<result property="feeTotal" column="FEE_TOTAL"/>
		<result property="feePlain" column="FEE_PLAIN"/>
		<result property="billingFee" column="BILLING_FEE"/>
		<result property="shipperCode" column="SHIPPER_CODE"/>
		<result property="shipperName" column="SHIPPER_NAME"/>
		<result property="shipperAddress" column="SHIPPER_ADDRESS"/>
		<result property="shipperContactPhone" column="SHIPPER_CONTACT_PHONE"/>
		<result property="pickupType" column="PICKUP_TYPE"/>
		<result property="createOrgCode" column="CREATE_ORG_CODE"/>
		<result property="createOrgName" column="CREATE_ORG_NAME"/>
		<result property="createUserCode" column="CREATE_USER_CODE"/>
		<result property="createUserName" column="CREATE_USER_NAME"/>
		<result property="createTime" column="CREATE_TIME"/>
		<result property="modifyUserCode" column="MODIFY_USER_CODE"/>
		<result property="modifyUserName" column="MODIFY_USER_NAME"/>
		<result property="modifyTime" column="MODIFY_TIME"/>
		<result property="handoverState" column="HANDOVER_STATE"/>
		<result property="currencyCode" column="CURRENCY_CODE"/>
		<result property="isNotPayment" column="IS_NOT_PAYMENT"/>
		<result property="jointTicketNo" column="JOINT_TICKET_NO"/>
	</resultMap>
	<!-- 查询合大票清单明细 -->
	<resultMap id="airPickupReceiverNameResultMap" type="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillDetailEntity">
		<id  property="id" column="ID"/>
		<result property="airPickupbillId" column="AIR_PICKUPBILL_ID"/>
		<result property="waybillNo" column="WAYBILL_NO"/>
		<result property="arrvRegionName" column="ARRV_REGION_NAME"/>
		<result property="goodsName" column="GOODS_NAME"/>
		<result property="goodsQty" column="GOODS_QTY"/>
		<result property="airPickQty" column="AIRPICK_QTY"/>
		<result property="weight" column="WEIGHT"/>
		<result property="billingWeight" column="BILLING_WEIGHT"/>
		<result property="beTransfer" column="BE_TRANSFER"/>
		<result property="pickupType" column="PICKUP_TYPE"/>
		<result property="deliverFee" column="DELIVER_FEE"/>
		<result property="arrivalFee" column="ARRIVAL_FEE"/>
		<result property="collectionFee" column="COLLECTION_FEE"/>
		<result property="notes" column="NOTES"/>
		<result property="airWaybillNo" column="AIR_WAYBILL_NO"/>
		<result property="currencyCode" column="CURRENCY_CODE"/>
		<result property="createTime" column="CREATE_TIME"/>
		<result property="receiverContactPhone" column="RECEIVER_CONTACT_PHONE"/>
		<result property="receiverAddress" column="RECEIVER_ADDRESS"/>
		<result property="receiverName" column="RECEIVER_NAME"/>
	</resultMap>
	
	<!-- 查询合大票清单 -->
	<resultMap id="airPickupResultMap" type="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillEntity">
		<id  property="id" column="ID"/>
		<result property="airLineCode" column="AIR_LINE_CODE"/>
		<result property="airLineName" column="AIR_LINE_NAME"/>
		<result property="airWaybillNo" column="AIR_WAYBILL_NO"/>
		<result property="destOrgCode" column="DEST_ORG_CODE"/>
		<result property="destOrgName" column="DEST_ORG_NAME"/>
		<result property="flightNo" column="FLIGHT_NO"/>
		<result property="arrvRegionCode" column="ARRV_REGION_CODE"/>
		<result property="arrvRegionName" column="ARRV_REGION_NAME"/>
		<result property="flightDate" column="FLIGHT_DATE"/>
		<result property="createUserCode" column="CREATE_USER_CODE"/>
		<result property="createUserName" column="CREATE_USER_NAME"/>
		<result property="origOrgCode" column="ORIG_ORG_CODE"/>
		<result property="origOrgName" column="ORIG_ORG_NAME"/>
		<result property="createTime" column="CREATE_TIME"/>
		<result property="modifyUserCode" column="MODIFY_USER_CODE"/>
		<result property="modifyUserName" column="MODIFY_USER_NAME"/>
		<result property="modifyTime" column="MODIFY_TIME"/>
		<result property="waybillQtyTotal" column="WAYBILL_QTY_TOTAL"/>
		<result property="goodsQtyTotal" column="GOODS_QTY_TOTAL"/>
		<result property="grossWeightTotal" column="GROSS_WEIGHT_TOTAL"/>
		<result property="deliverFeeTotal" column="DELIVER_FEE_TOTAL"/>
		<result property="arrivalFeeTotal" column="ARRIVAL_FEE_TOTAL"/>
		<result property="collectionFeeTotal" column="COLLECTION_FEE_TOTAL"/>
		<result property="currencyCode" column="CURRENCY_CODE"/>
		<result property="status" column="STATUS"/>
	</resultMap>
	
	<!-- 中转提货清单 -->
	<resultMap id="airTransPickupbillEntityResultMap"  type="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirTransPickupbillEntity">
		<result property="id" column="ID"/>
		<result property="airTransferPickupbillNo" column="AIR_TRANSFER_PICKUPBILL_NO"/>
		<result property="arrvRegionCode" column="ARRV_REGION_CODE"/>
		<result property="arrvRegionName" column="ARRV_REGION_NAME"/>
		<result property="destOrgCode" column="DEST_ORG_CODE"/>
		<result property="destOrgName" column="DEST_ORG_NAME"/>
		<result property="transferFlightNo" column="TRANSFER_FLIGHT_NO"/>
		<result property="transferDate" column="TRANSFER_DATE"/>
		<result property="airLineCode" column="AIR_LINE_CODE"/>
		<result property="airLineName" column="AIR_LINE_NAME"/>
		<result property="airWaybillNo" column="AIR_WAYBILL_NO"/>
		<result property="createUserCode" column="CREATE_USER_CODE"/>
		<result property="createUserName" column="CREATE_USER_NAME"/>
		<result property="createOrgCode" column="CREATE_ORG_CODE"/>
		<result property="createOrgName" column="CREATE_ORG_NAME"/>
		<result property="createTime" column="CREATE_TIME"/>
		<result property="modifyUserCode" column="MODIFY_USER_CODE"/>
		<result property="modifyUserName" column="MODIFY_USER_NAME"/>
		<result property="modifyTime" column="MODIFY_TIME"/>
		<result property="waybillQtyTotal" column="WAYBILL_QTY_TOTAL"/>
		<result property="goodsQtyTotal" column="GOODS_QTY_TOTAL"/>
		<result property="grossWeightTotal" column="GROSS_WEIGHT_TOTAL"/>
		<result property="deliverFeeTotal" column="DELIVER_FEE_TOTAL"/>
		<result property="arrivalFeeTotal" column="ARRIVAL_FEE_TOTAL"/>
		<result property="collectionFeeTotal" column="COLLECTION_FEE_TOTAL"/>
		<result property="currencyCode" column="CURRENCY_CODE"/>
	</resultMap>
	
	
	<!-- 中转提货清单明细 -->
	<resultMap id="airTransPickupbillDetailEntityResultMap"  type="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirTransPickupDetailEntity">
		<id  property="id" column="ID"/>
		<result property="airTransferPickupbillId" column="AIR_TRANSFER_PICKUPBILL_ID"/>
		<result property="waybillNo" column="WAYBILL_NO"/>
		<result property="arrvRegionName" column="ARRV_REGION_NAME"/>
		<result property="goodsName" column="GOODS_NAME"/>
		<result property="goodsQty" column="GOODS_QTY"/>
		<result property="weight" column="WEIGHT"/>
		<result property="billingWeight" column="BILLING_WEIGHT"/>
		<result property="pickupType" column="PICKUP_TYPE"/>
		<result property="deliverFee" column="DELIVER_FEE"/>
		<result property="arrivalFee" column="ARRIVAL_FEE"/>
		<result property="collectionFee" column="COLLECTION_FEE"/>
		<result property="airWaybillNo" column="AIR_WAYBILL_NO"/>
		<result property="createTime" column="CREATE_TIME"/>
		<result property="currencyCode" column="CURRENCY_CODE"/>
		<result property="receiverContactPhone" column="RECEIVER_CONTACT_PHONE"/>
		<result property="receiverAddress" column="RECEIVER_ADDRESS"/>
		<result property="receiverName" column="RECEIVER_NAME"/>
		<result property="beTransfer" column="BE_TRANSFER"/>
		<result property="notes" column="NOTES"/>
	</resultMap>
	   <!-- 运单流水明细 -->
    <resultMap id="SerialNoMap"
               type="com.deppon.foss.module.transfer.airfreight.api.shared.domain.SerialEntity">
        <result property="id" column="ID"/>
        <result property="serialNo" column="SERIAL_NO"/>
        <result property="waybillNo" column="WAYBILL_NO"/>
        <result property="airWaybillNo" column="air_waybill_no"/>
       
    </resultMap>
	<!-- 合大票清单共用sql-->
	<sql id="select_t_opt_air_pickupbill">
		ID,
		AIR_LINE_CODE,
		AIR_LINE_NAME,
		AIR_WAYBILL_NO,
		DEST_ORG_CODE,
		DEST_ORG_NAME,
		FLIGHT_NO,
		ARRV_REGION_CODE,
		ARRV_REGION_NAME,
		FLIGHT_DATE,
		CREATE_USER_CODE,
		CREATE_USER_NAME,
		ORIG_ORG_CODE,
		ORIG_ORG_NAME,
		CREATE_TIME,
		MODIFY_USER_CODE,
		MODIFY_USER_NAME,
		MODIFY_TIME,
		WAYBILL_QTY_TOTAL,
		GOODS_QTY_TOTAL,
		GROSS_WEIGHT_TOTAL,
		DELIVER_FEE_TOTAL/100 AS DELIVER_FEE_TOTAL,
		ARRIVAL_FEE_TOTAL/100 AS ARRIVAL_FEE_TOTAL,
		COLLECTION_FEE_TOTAL/100 AS COLLECTION_FEE_TOTAL,
		CURRENCY_CODE,
		STATUS
	</sql>
	
	<!--合大票明细共用sql -->
	<sql id="select_t_opt_air_pickupbill_detail">
		DETAIL.AIR_PICKUPBILL_ID, 
		DETAIL.ID, 
		DETAIL.WAYBILL_NO, 
		DETAIL.ARRV_REGION_NAME, 
		DETAIL.GOODS_NAME, 
		DETAIL.GOODS_QTY, 
		DETAIL.WEIGHT, 
		DETAIL.BILLING_WEIGHT, 
		DETAIL.BE_TRANSFER, 
		DETAIL.PICKUP_TYPE, 
		DETAIL.DELIVER_FEE/100 AS DELIVER_FEE, 
		DETAIL.ARRIVAL_FEE/100 AS ARRIVAL_FEE, 
		DETAIL.COLLECTION_FEE/100 AS COLLECTION_FEE, 
		DETAIL.NOTES, 
		DETAIL.AIR_WAYBILL_NO, 
		DETAIL.CURRENCY_CODE, 
		DETAIL.CREATE_TIME, 
		DETAIL.RECEIVER_CONTACT_PHONE, 
		DETAIL.RECEIVER_ADDRESS, 
		DETAIL.RECEIVER_NAME
	</sql>
	
	<!-- 中转提货清单共用sql -->
	<sql id="select_t_opt_air_trans_pickupbill_view">
		ID, 
		AIR_TRANSFER_PICKUPBILL_NO, 
		ARRV_REGION_CODE, 
		ARRV_REGION_NAME, 
		DEST_ORG_CODE, 
		DEST_ORG_NAME, 
		TRANSFER_FLIGHT_NO, 
		TRANSFER_DATE, 
		AIR_LINE_CODE, 
		AIR_LINE_NAME, 
		AIR_WAYBILL_NO, 
		CREATE_USER_CODE, 
		CREATE_USER_NAME, 
		CREATE_ORG_CODE, 
		CREATE_ORG_NAME, 
		CREATE_TIME, 
		MODIFY_USER_CODE, 
		MODIFY_USER_NAME, 
		MODIFY_TIME, 
		WAYBILL_QTY_TOTAL, 
		GOODS_QTY_TOTAL, 
		GROSS_WEIGHT_TOTAL, 
		DELIVER_FEE_TOTAL/100 AS DELIVER_FEE_TOTAL, 
		ARRIVAL_FEE_TOTAL/100 AS ARRIVAL_FEE_TOTAL, 
		COLLECTION_FEE_TOTAL/100 AS COLLECTION_FEE_TOTAL, 
		CURRENCY_CODE
	</sql>
	
	<!-- 中转提货清单明细共用sql -->
	<sql id="select_air_transfer_pickupbill_detail_view">
		ID, 
		AIR_TRANSFER_PICKUPBILL_ID, 
		WAYBILL_NO, 
		ARRV_REGION_NAME, 
		GOODS_NAME, 
		GOODS_QTY, 
		WEIGHT, 
		BILLING_WEIGHT, 
		PICKUP_TYPE, 
		DELIVER_FEE/100 AS DELIVER_FEE, 
		ARRIVAL_FEE/100 AS ARRIVAL_FEE, 
		COLLECTION_FEE/100 AS COLLECTION_FEE, 
		NOTES, 
		AIR_WAYBILL_NO, 
		CREATE_TIME, 
		CURRENCY_CODE, 
		RECEIVER_CONTACT_PHONE, 
		RECEIVER_ADDRESS, 
		RECEIVER_NAME, 
		BE_TRANSFER
	</sql>
	
	<sql id="insert_air_transfer_pickupbill_detail">
		ID, 
		AIR_TRANSFER_PICKUPBILL_ID, 
		WAYBILL_NO, 
		ARRV_REGION_NAME, 
		GOODS_NAME, 
		GOODS_QTY, 
		WEIGHT, 
		BILLING_WEIGHT, 
		PICKUP_TYPE, 
		DELIVER_FEE, 
		ARRIVAL_FEE, 
		COLLECTION_FEE, 
		NOTES, 
		AIR_WAYBILL_NO, 
		CREATE_TIME, 
		CURRENCY_CODE, 
		RECEIVER_CONTACT_PHONE, 
		RECEIVER_ADDRESS, 
		RECEIVER_NAME, 
		BE_TRANSFER
	</sql>
	
	<!-- 航空正单共用sql -->
	<sql id="select_t_opt_air_waybill_view">
		ID,
		AIR_LINE_TWOLETTER,
		AIR_WAYBILL_NO,
		DEPT_REGION_CODE,
		DEPT_REGION_NAME,
		ARRV_REGION_CODE,
		ARRV_REGION_NAME,
		AIR_ASSEMBLE_TYPE,
		DEST_ORG_CODE,
		DEDT_ORG_NAME,
		RECEIVER_CODE,
		RECEIVER_NAME,
		RECEIVER_CONTACT_PHONE,
		ACCOUNT_ITEM,
		BILLING_AGENCY,
		RECEIVER_ADDRESS,
		STORAGE_ITEM,
		FLIGHT_NO,
		FLIGHT_DATE,
		TAKE_OFF_TIME,
		ARRIVE_TIME,
		RATE_CLASS,
		PAYMENT_TYPE,
		GROSS_WEIGHT,
		BILLING_WEIGHT,
		FEE/100 AS FEE,
		AGENCT_CODE,
		AGENCY_NAME,
		DECLARE_VALUE,
		ITEM_CODE,
		GOODS_QTY,
		VOLUME,
		AIR_FEE/100 AS AIR_FEE,
		EXTRA_FEE/100 AS EXTRA_FEE,
		GOODS_NAME,
		PACKAGE_STRUCTION,
		GROUND_FEE/100 AS GROUND_FEE,
		FUEL_SURCHARGE,
		TRANSPORT_INSURANCE,
		INSERANCE_FEE/100 AS INSERANCE_FEE,
		FEE_TOTAL,
		FEE_PLAIN,
		BILLING_FEE/100 AS BILLING_FEE,
		SHIPPER_CODE,
		SHIPPER_NAME,
		SHIPPER_ADDRESS,
		SHIPPER_CONTACT_PHONE,
		PICKUP_TYPE,
		CREATE_ORG_CODE,
		CREATE_ORG_NAME,
		CREATE_USER_CODE,
		CREATE_USER_NAME,
		CREATE_TIME,
		MODIFY_USER_CODE,
		MODIFY_USER_NAME,
		MODIFY_TIME,
		HANDOVER_STATE,
		CURRENCY_CODE,
		IS_NOT_PAYMENT,
		JOINT_TICKET_NO	
	</sql>
	<!-- 合票清单共用查询条件 -->
	<sql id="query_t_opt_air_pickupbill">
		   	    <if test="beginInTime !=null and endInTime !=null">
		   			<![CDATA[AND CREATE_TIME >= #{beginInTime} AND CREATE_TIME <= #{endInTime} ]]>
				</if>
				<if test="airLineName !=null and airLineName !='' ">
					AND AIR_LINE_CODE = #{airLineName,jdbcType=VARCHAR} 
				</if>
				<if test="airWaybillNo !=null and airWaybillNo !='' ">
					AND AIR_WAYBILL_NO = #{airWaybillNo,jdbcType=VARCHAR}
				</if>
				<if test="arrvRegionCode !=null and arrvRegionCode !='' ">
				 	AND ARRV_REGION_CODE = #{arrvRegionCode,jdbcType=VARCHAR}
				</if>
				<if test="arrvRegionName !=null and arrvRegionName !='' ">
				 	AND ARRV_REGION_NAME = #{arrvRegionName,jdbcType=VARCHAR}
				</if>
				<if test="destOrgCode !=null and destOrgCode !='' ">
					AND DEST_ORG_CODE = #{destOrgCode,jdbcType=VARCHAR}
				</if>
				<if test="destOrgName !=null and destOrgName !='' ">
					AND DEST_ORG_NAME = #{destOrgName,jdbcType=VARCHAR}
				</if>
				<if test="deptCode !=null and deptCode !='' ">
				 	AND ORIG_ORG_CODE = #{deptCode,jdbcType=VARCHAR}
			</if>
		<!-- 判断合大票提交状态 2016年9月8日09:43:56 wwb 311396 -->	
			<if test="status !=null and status !=''">
				AND STATUS = #{status,jdbcType=VARCHAR}
			</if>
	</sql>
	
	<!-- 根据航空公司名称,正单号查询航空正单明细 -->
	<select id="queryAirPickupbillList" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultMap="airTransPickupBillResultMap">
	  	SELECT  A.ID ID,
		       A.AIR_WAYBILL_ID AIR_WAYBILL_ID,
		       A.WAYBILL_NO WAYBILL_NO,
		       A.ARRV_REGION_NAME ARRV_REGION_NAME,
		       A.GROSS_WEIGHT GROSS_WEIGHT,
		       WAYBILL.Bill_Weight BILLING_WEIGHT,
		       WAYBILL.Goods_Volume_Total VOLUME,
		       A.Goods_Qty GOODS_QTY,
		       A.Goods_Qty AIRPICK_QTY,
		       WAYBILL.GOODS_NAME GOODS_NAME,
		       A.CREATE_TIME,
		       A.ARRV_REGION_NAME,
		       WAYBILL.Delivery_Goods_Fee/100 AS DELIVER_FEE,
		       WAYBILL.To_Pay_Amount/100 AS ARRIVAL_FEE,
		       WAYBILL.Receive_Method PICKUP_TYPE,
		       WAYBILL.Cod_Amount/100 AS COLLECTION_FEE,
		       WAYBILL.RECEIVE_CUSTOMER_MOBILEPHONE|| ' # ' ||WAYBILL.RECEIVE_CUSTOMER_PHONE AS RECEIVER_CONTACT_PHONE,
		       waybill.receive_customer_prov_code||'#'||waybill.receive_customer_city_code||'#'||waybill.receive_customer_dist_code||'#'||waybill.receive_customer_address RECEIVER_ADDRESS,
		       DECODE(WAYBILL.RECEIVE_CUSTOMER_CONTACT,'',WAYBILL.RECEIVE_CUSTOMER_NAME,WAYBILL.RECEIVE_CUSTOMER_CONTACT) RECEIVER_NAME,
       		   WAYBILL.TRANSPORTATION_REMARK,
       		   waybill.product_code
       FROM TFR.T_OPT_AIR_WAYBILL_DETAIL A
       LEFT JOIN PKP.T_SRV_WAYBILL WAYBILL ON A.WAYBILL_NO=WAYBILL.WAYBILL_NO
       										and WAYBILL.Active='Y'
	  	<where>
	  		A.AIR_WAYBILL_ID IN (
	  			SELECT B.ID FROM TFR.T_OPT_AIR_WAYBILL B
	  			<where>
	  					AND B.AIR_WAYBILL_NO = #{airWaybillNo}
	  				<if test="airLineTwoletter !=null and airLineTwoletter !='' ">
	  					AND B.AIR_LINE_TWOLETTER = #{airLineTwoletter}
	  				</if>
	  				<if test="deptCode !=null and deptCode !='' ">
	  					AND B.CREATE_ORG_CODE = #{deptCode}
	  				</if>
	  				<if test="flightNo !=null and flightNo !='' ">
	  					AND B.FLIGHT_NO = #{flightNo}
	  				</if>
	  				<if test="flightDate !=null">
	  					AND B.FLIGHT_DATE = #{flightDate}
	  				</if>
	  				<if test="arrvRegionName !=null and arrvRegionName !='' ">
	  					AND B.ARRV_REGION_NAME = #{arrvRegionName}
	  				</if>
	  				<if test="deptOrgName !=null and deptOrgName !='' ">
	  					AND B.DEDT_ORG_NAME =  #{deptOrgName}
	  				</if>
	  			</where>
	  		)
	  	</where>
	</select>
	
	<!-- 根据航空公司名称,正单号查询航空正单包明细 -->
	<select id="queryAirPackageList" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultMap="airTransPickupBillResultMap">
	  	SELECT A.ID ID,
		       A.AIR_WAYBILL_ID AIR_WAYBILL_ID,
		       A.WAYBILL_NO WAYBILL_NO,
		       A.ARRV_REGION_NAME ARRV_REGION_NAME,
		       A.GROSS_WEIGHT GROSS_WEIGHT,
		       A.BILLING_WEIGHT,
		       A.VOLUME,
		       A.GOODS_QTY,
		       A.GOODS_QTY AS AIRPICK_QTY,
		       A.GOODS_NAME,
		       A.CREATE_TIME,
		       A.ARRV_REGION_NAME,
		       A.DELIVER_FEE/100 AS DELIVER_FEE,
		       A.ARRIVAL_FEE/100 AS ARRIVAL_FEE,
		       A.PICKUP_TYPE,
		       A.COLLECTION_FEE/100 AS COLLECTION_FEE,
		       A.RECEIVER_CONTACT_PHONE,
		       A.RECEIVER_ADDRESS,
		       A.RECEIVER_NAME,
		       A.product_code
		  FROM TFR.T_OPT_AIR_WAYBILL_DETAIL A
	  	<where>
	  		A.AIR_WAYBILL_ID IN (
	  			SELECT B.ID FROM TFR.T_OPT_AIR_WAYBILL B
	  			<where>
	  					AND B.AIR_WAYBILL_NO = #{airWaybillNo}
	  				<if test="airLineTwoletter !=null and airLineTwoletter !='' ">
	  					AND B.AIR_LINE_TWOLETTER = #{airLineTwoletter}
	  				</if>
	  				<if test="deptCode !=null and deptCode !='' ">
	  					AND B.CREATE_ORG_CODE = #{deptCode}
	  				</if>
	  				<if test="flightNo !=null and flightNo !='' ">
	  					AND B.FLIGHT_NO = #{flightNo}
	  				</if>
	  				<if test="flightDate !=null">
	  					AND B.FLIGHT_DATE = #{flightDate}
	  				</if>
	  				<if test="arrvRegionName !=null and arrvRegionName !='' ">
	  					AND B.ARRV_REGION_NAME = #{arrvRegionName}
	  				</if>
	  				<if test="deptOrgName !=null and deptOrgName !='' ">
	  					AND B.DEDT_ORG_NAME =  #{deptOrgName}
	  				</if>
	  			</where>
	  		)
	  	</where>
	</select>
	
	 <!-- 查询已保存的的运单号 -->
    <select id="queryWaybillNoList1" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT
        A.WAYBILL_NO 
        FROM TFR.T_OPT_AIR_WAYBILL_DETAIL A,
        TFR.T_OPT_AIR_WAYBILL B
        <where>
        A.AIR_WAYBILL_ID = B.ID
        AND B.AIR_WAYBILL_NO = #{airWaybillNo}
        </where> 
    </select>
	
	<!-- 根据运单号新增一条航空正单明细  (未签收的运单)-->
	<select id="addWaybillNoInfo" parameterType="map" resultMap="airTransPickupBillResultMap">
		SELECT
	 		A.ID,
	 		A.MAKE_WAYBILL_WAY,
  			A.AIR_WAYBILL_ID,
  	 	    A.WAYBILL_NO,
  			A.ARRV_REGION_NAME,
  			A.GROSS_WEIGHT,
  			WAYBILL.Bill_Weight BILLING_WEIGHT,
  			WAYBILL.Goods_Volume_Total VOLUME,
		    A.Goods_Qty GOODS_QTY,
		    A.GOODS_QTY AIRPICK_QTY,
		    WAYBILL.GOODS_NAME GOODS_NAME,
  			WAYBILL.Delivery_Goods_Fee/100 AS DELIVER_FEE,
		    WAYBILL.To_Pay_Amount/100 AS ARRIVAL_FEE,
		    WAYBILL.Cod_Amount/100 AS COLLECTION_FEE,
  			WAYBILL.Receive_Method PICKUP_TYPE,
  			NVL(WAYBILL.RECEIVE_CUSTOMER_MOBILEPHONE,WAYBILL.RECEIVE_CUSTOMER_PHONE) RECEIVER_CONTACT_PHONE,
	        waybill.receive_customer_prov_code||'#'||waybill.receive_customer_city_code||'#'||waybill.receive_customer_dist_code||'#'||waybill.receive_customer_address RECEIVER_ADDRESS,
	        DECODE(WAYBILL.RECEIVE_CUSTOMER_NAME,'',WAYBILL.RECEIVE_CUSTOMER_CONTACT,WAYBILL.RECEIVE_CUSTOMER_NAME)  RECEIVER_NAME,
	        waybill.product_code
		FROM TFR.T_OPT_AIR_WAYBILL_DETAIL A , TFR.T_OPT_AIR_WAYBILL B,PKP.T_SRV_WAYBILL WAYBILL
		<where>
			A.AIR_WAYBILL_ID = B.ID
			AND A.WAYBILL_NO=WAYBILL.WAYBILL_NO
			AND NOT EXISTS(SELECT 1 FROM PKP.T_SRV_WAYBILL_SIGN_RESULT R WHERE A.WAYBILL_NO = R.WAYBILL_NO AND R.ACTIVE='Y' )
			AND WAYBILL.Active='Y'
			AND A.WAYBILL_NO = #{waybillNo}
			AND B.CREATE_ORG_CODE = #{deptCode}
		</where> 
	</select>
	
	<!-- 根据包号新增一条航空正单明细  (未签收的运单)-->
	<select id="addPackageNoInfo" parameterType="map" resultMap="airTransPickupBillResultMap">
		SELECT
	 		   A.ID,
		       A.MAKE_WAYBILL_WAY,
		       A.AIR_WAYBILL_ID,
		       A.WAYBILL_NO,
		       A.ARRV_REGION_NAME,
		       A.GROSS_WEIGHT,
		       A.BILLING_WEIGHT,
		       A.VOLUME,
		       A.GOODS_QTY,
		       A.GOODS_QTY AS AIRPICK_QTY,
		       A.GOODS_NAME,
		       A.DELIVER_FEE,
		       A.ARRIVAL_FEE,
		       A.COLLECTION_FEE,
		       A.PICKUP_TYPE,
		       A.RECEIVER_CONTACT_PHONE,
		       A.RECEIVER_ADDRESS,
		       A.Receiver_Name,
		       A.product_code
		FROM TFR.T_OPT_AIR_WAYBILL_DETAIL A , TFR.T_OPT_AIR_WAYBILL B
		<where>
			A.AIR_WAYBILL_ID = B.ID
			AND A.WAYBILL_NO = #{waybillNo}
			AND B.CREATE_ORG_CODE = #{deptCode}
		</where> 
	</select>
	
	<!-- 根据航空正单ID查询收货人、电话、地址-->
	<select id="queryReceiverNameInfo" parameterType="String" resultMap="airTransPickupReceiverNameResultMap">
		SELECT 
			<include refid="select_t_opt_air_waybill_view"/>
				FROM TFR.T_OPT_AIR_WAYBILL WHERE ID = #{airWaybillId}
	</select>
	
	<!-- 新增合票清单 -->
	<insert id="addAirPickupBill" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillEntity">
		INSERT INTO TFR.T_OPT_AIR_PICKUPBILL(
			ID,
			AIR_LINE_CODE,
			AIR_LINE_NAME,
			AIR_WAYBILL_NO,
			DEST_ORG_CODE,
			DEST_ORG_NAME,
			FLIGHT_NO,
			ARRV_REGION_CODE,
			ARRV_REGION_NAME,
			FLIGHT_DATE,
			CREATE_USER_CODE,
			CREATE_USER_NAME,
			ORIG_ORG_CODE,
			ORIG_ORG_NAME,
			CREATE_TIME,
			MODIFY_USER_CODE,
			MODIFY_USER_NAME,
			MODIFY_TIME,
			WAYBILL_QTY_TOTAL,
			GOODS_QTY_TOTAL,
			GROSS_WEIGHT_TOTAL,
			DELIVER_FEE_TOTAL,
			ARRIVAL_FEE_TOTAL,
			COLLECTION_FEE_TOTAL,
			CURRENCY_CODE,
			STATUS
		) VALUES(
			#{id jdbcType=VARCHAR},
			#{airLineCode jdbcType=VARCHAR},
			#{airLineName jdbcType=VARCHAR},
			#{airWaybillNo jdbcType=VARCHAR},
			#{destOrgCode jdbcType=VARCHAR},
			#{destOrgName jdbcType=VARCHAR},
			#{flightNo jdbcType=VARCHAR},
			#{arrvRegionCode jdbcType=VARCHAR},
			#{arrvRegionName jdbcType=VARCHAR},
			#{flightDate jdbcType=TIMESTAMP},
			#{createUserCode jdbcType=VARCHAR},
			#{createUserName jdbcType=VARCHAR},
			#{origOrgCode jdbcType=VARCHAR},
			#{origOrgName jdbcType=VARCHAR},
			#{createTime jdbcType=TIMESTAMP},
			#{modifyUserCode jdbcType=VARCHAR},
			#{modifyUserName jdbcType=VARCHAR},
			#{modifyTime jdbcType=TIMESTAMP},
			#{waybillQtyTotal jdbcType=NUMERIC},
			#{goodsQtyTotal jdbcType=NUMERIC},
			#{grossWeightTotal jdbcType=NUMERIC},
			#{deliverFeeTotal jdbcType=NUMERIC}*100,
			#{arrivalFeeTotal jdbcType=NUMERIC}*100,
			#{collectionFeeTotal jdbcType=NUMERIC}*100,
			#{currencyCode jdbcType=CHAR},
			#{status jdbcType=CHAR}
		)
	</insert>
	
	<!-- 新增合票清单明细  批量 -->
	<insert id="addAirWaybillDetail" parameterType="java.util.List">
		begin
   		 <foreach collection="list" item="item"  separator=";">
   		 	INSERT INTO TFR.T_OPT_AIR_PICKUPBILL_DETAIL(
   		 		AIR_PICKUPBILL_ID, 
				ID, 
				WAYBILL_NO, 
				ARRV_REGION_NAME, 
				GOODS_NAME, 
				GOODS_QTY, 
				WEIGHT, 
				BILLING_WEIGHT, 
				BE_TRANSFER, 
				PICKUP_TYPE, 
				DELIVER_FEE, 
				ARRIVAL_FEE, 
				COLLECTION_FEE, 
				NOTES, 
				AIR_WAYBILL_NO, 
				CURRENCY_CODE, 
				CREATE_TIME, 
				RECEIVER_CONTACT_PHONE, 
				RECEIVER_ADDRESS, 
				RECEIVER_NAME
   		 	) VALUES(
   		 		#{item.airPickupbillId jdbcType=VARCHAR},
   		 		#{item.id jdbcType=VARCHAR},
   		 		#{item.waybillNo jdbcType=VARCHAR},
   		 		#{item.arrvRegionName jdbcType=VARCHAR},
   		 		#{item.goodsName jdbcType=VARCHAR},
   		 		#{item.airPickQty jdbcType=NUMERIC},
   		 		#{item.weight jdbcType=NUMERIC},
   		 		#{item.billingWeight jdbcType=NUMERIC},
   		 		#{item.beTransfer jdbcType=CHAR},
   		 		#{item.pickupType jdbcType=NUMERIC},
   		 		#{item.deliverFee jdbcType=NUMERIC}*100,
   		 		#{item.arrivalFee jdbcType=NUMERIC}*100,
   		 		#{item.collectionFee jdbcType=NUMERIC}*100,
   		 		#{item.notes jdbcType=VARCHAR},
   		 		#{item.airWaybillNo jdbcType=VARCHAR},
   		 		#{item.currencyCode jdbcType=CHAR},
   		 		#{item.createTime jdbcType=TIMESTAMP},
   		 		#{item.receiverContactPhone jdbcType=VARCHAR},
   		 		#{item.receiverAddress jdbcType=VARCHAR},
   		 		#{item.receiverName jdbcType=VARCHAR}
   		 	)
   		 </foreach> 
   		 ;end;
	</insert>
	
	<!-- 新增合票清单明细  单条-->
	<insert id="addAirPickupbillDetailEntity" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillDetailEntity">
   		 	INSERT INTO TFR.T_OPT_AIR_PICKUPBILL_DETAIL(
   		 		AIR_PICKUPBILL_ID, 
				ID, 
				WAYBILL_NO, 
				ARRV_REGION_NAME, 
				GOODS_NAME, 
				GOODS_QTY, 
				WEIGHT, 
				BILLING_WEIGHT, 
				BE_TRANSFER, 
				PICKUP_TYPE, 
				DELIVER_FEE, 
				ARRIVAL_FEE, 
				COLLECTION_FEE, 
				NOTES, 
				AIR_WAYBILL_NO, 
				CURRENCY_CODE, 
				CREATE_TIME, 
				RECEIVER_CONTACT_PHONE, 
				RECEIVER_ADDRESS, 
				RECEIVER_NAME
   		 	) VALUES(
   		 		#{airPickupbillId jdbcType=VARCHAR},
   		 		#{id jdbcType=VARCHAR},
   		 		#{waybillNo jdbcType=VARCHAR},
   		 		#{arrvRegionName jdbcType=VARCHAR},
   		 		#{goodsName jdbcType=VARCHAR},
   		 		#{goodsQty jdbcType=NUMERIC},
   		 		#{weight jdbcType=NUMERIC},
   		 		#{billingWeight jdbcType=NUMERIC},
   		 		#{beTransfer jdbcType=CHAR},
   		 		#{pickupType jdbcType=NUMERIC},
   		 		#{deliverFee jdbcType=NUMERIC}*100,
   		 		#{arrivalFee jdbcType=NUMERIC}*100,
   		 		#{collectionFee jdbcType=NUMERIC}*100,
   		 		#{notes jdbcType=VARCHAR},
   		 		#{airWaybillNo jdbcType=VARCHAR},
   		 		#{currencyCode jdbcType=CHAR},
   		 		#{createTime jdbcType=TIMESTAMP},
   		 		#{receiverContactPhone jdbcType=VARCHAR},
   		 		#{receiverAddress jdbcType=VARCHAR},
   		 		#{receiverName jdbcType=VARCHAR}
   		 	)
	</insert>
	
	
	
	<!-- 根据航航空公司名称、正单号查询合大票清单明细数据 -->
	<select id="queryMakeJointlargeList" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultMap="airPickupReceiverNameResultMap">
	 SELECT 
			C.AIR_PICKUPBILL_ID,
			C.ID,
			C.WAYBILL_NO,
			C.ARRV_REGION_NAME,
			C.GOODS_NAME,
			C.GOODS_QTY as AIRPICK_QTY,<!-- 清单件数 -->
			C.GOODS_QTY as GOODS_QTY,<!-- 开单件数 -->
			C.WEIGHT,
			C.BILLING_WEIGHT,
			C.BE_TRANSFER,
			C.PICKUP_TYPE,
			C.NOTES,
			C.AIR_WAYBILL_NO,
			C.CURRENCY_CODE,
			C.CREATE_TIME,
			C.RECEIVER_CONTACT_PHONE,
			C.RECEIVER_ADDRESS,
			C.RECEIVER_NAME,
			WAYBILL.To_Pay_Amount/100 ARRIVAL_FEE,
      		WAYBILL.Cod_Amount/100 AS COLLECTION_FEE,
      		WAYBILL.Delivery_Goods_Fee/100 AS DELIVER_FEE
       FROM TFR.T_OPT_AIR_PICKUPBILL_DETAIL C
 inner join pkp.t_srv_waybill waybill on c.waybill_no = waybill.waybill_no
                                     and waybill.active = 'Y'	
	  <where>
	  	C.ID IN(SELECT B.ID FROM TFR.T_OPT_AIR_PICKUPBILL A, 
	  			TFR.T_OPT_AIR_PICKUPBILL_DETAIL B
	  			<where>
	  				A.ID = B.AIR_PICKUPBILL_ID
	  				<if test="airLineTwoletter != null and airLineTwoletter != '' ">
	  					AND A.AIR_LINE_CODE = #{airLineTwoletter}
	  				</if>
	  				<if test="airWaybillNo != null and airWaybillNo != '' ">
	  					 AND A.AIR_WAYBILL_NO = #{airWaybillNo}
	  				</if>
	  				<if test="origOrgCode != null and origOrgCode != '' ">
	  					AND A.ORIG_ORG_CODE = #{origOrgCode}
	  				</if>
	  				AND B.BE_TRANSFER = #{beTransfer}
	  				<!-- 合大票添加为提交状态 2016年9月8日09:43:56 wwb 311396 -->
	  				and nvl(a.status, 'Y') != 'N'
	  			</where>
	  	)
	  </where>
	</select>
	
	<!-- 根据运单号新增合大票清单明细 -->
	<select id="addAirPickupbillDetailInfo" parameterType="String" resultMap="airPickupReceiverNameResultMap">
		SELECT C.AIR_PICKUPBILL_ID,
			C.ID,
			C.WAYBILL_NO,
			C.ARRV_REGION_NAME,
			C.GOODS_NAME,
			C.GOODS_QTY,
			C.WEIGHT,
			C.BILLING_WEIGHT,
			C.BE_TRANSFER,
			C.PICKUP_TYPE,
			C.DELIVER_FEE/100 AS DELIVER_FEE,
			C.ARRIVAL_FEE/100 AS ARRIVAL_FEE,
			C.COLLECTION_FEE/100 AS COLLECTION_FEE,
			C.NOTES,
			C.AIR_WAYBILL_NO,
			C.CURRENCY_CODE,
			C.CREATE_TIME,
			C.RECEIVER_CONTACT_PHONE,
			C.RECEIVER_ADDRESS,
			C.RECEIVER_NAME	
		    FROM TFR.T_OPT_AIR_PICKUPBILL_DETAIL C 
		     <!-- 合大票添加为提交状态 2016年9月8日09:43:56 wwb 311396 -->
		    left join TFR.T_OPT_AIR_PICKUPBILL p on c.air_pickupbill_id = p.id  
		    WHERE C.WAYBILL_NO = #{waybillNo}
		     and nvl(p.status , 'Y') != 'N'
	</select>
	
	<!-- 根据正单号获取合大票清单 -->
	<select id="queryAirPickupbillEntity" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillEntity" resultMap="airPickupResultMap">
		SELECT
		<include refid="select_t_opt_air_pickupbill"/>
		FROM TFR.T_OPT_AIR_PICKUPBILL WHERE AIR_WAYBILL_NO = #{airWayBillNo jdbcType=VARCHAR}
	</select>
	
	<!-- 根据dto获取合大票清单 -->
	<select id="queryAirPickupbillEntityByDto" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultMap="airPickupResultMap">
		SELECT
		<include refid="select_t_opt_air_pickupbill"/>
		FROM TFR.T_OPT_AIR_PICKUPBILL 
		WHERE 1=1 
		<if test="airWaybillNo != null and airWaybillNo != '' ">
	  		AND AIR_WAYBILL_NO = #{airWaybillNo}
	  	</if>
	  	<if test="airLineTwoletter != null and airLineTwoletter != '' ">
	  		AND AIR_LINE_CODE = #{airLineTwoletter}
	  	</if>
	  	<if test="origOrgCode != null and origOrgCode != '' ">
	  		AND ORIG_ORG_CODE = #{origOrgCode}
	  	</if>
	  	<!-- 合大票添加为提交状态 2016年9月8日09:43:56 wwb 311396 -->
	  	and nvl(STATUS, 'Y') != 'N'
	</select>
	
	<!-- 根据id获取合大票清单 -->
	<select id="queryAirPickupbillEntityById" parameterType="String" resultMap="airPickupResultMap">
		SELECT
		<include refid="select_t_opt_air_pickupbill"/>
		FROM TFR.T_OPT_AIR_PICKUPBILL WHERE ID = #{id}
	</select>
	
	<!-- 新增中转提货清单 -->
	<insert id="addAirTransPickupBill" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillEntity">
   		 	INSERT INTO TFR.T_OPT_AIR_TRANS_PICKUPBILL(
   		 		ID, 
				AIR_TRANSFER_PICKUPBILL_NO, 
				ARRV_REGION_CODE, 
				ARRV_REGION_NAME, 
				DEST_ORG_CODE, 
				DEST_ORG_NAME, 
				TRANSFER_FLIGHT_NO, 
				TRANSFER_DATE, 
				AIR_LINE_CODE, 
				AIR_LINE_NAME, 
				AIR_WAYBILL_NO, 
				CREATE_USER_CODE, 
				CREATE_USER_NAME, 
				CREATE_ORG_CODE, 
				CREATE_ORG_NAME, 
				CREATE_TIME, 
				MODIFY_USER_CODE, 
				MODIFY_USER_NAME, 
				MODIFY_TIME, 
				WAYBILL_QTY_TOTAL, 
				GOODS_QTY_TOTAL, 
				GROSS_WEIGHT_TOTAL, 
				DELIVER_FEE_TOTAL, 
				ARRIVAL_FEE_TOTAL, 
				COLLECTION_FEE_TOTAL, 
				CURRENCY_CODE
   		 	)VALUES(
  		 		#{id jdbcType=VARCHAR},
				#{airTransferPickupbillNo jdbcType=VARCHAR},
				#{arrvRegionCode jdbcType=VARCHAR},
				#{arrvRegionName jdbcType=VARCHAR},
				#{destOrgCode jdbcType=VARCHAR},
				#{destOrgName jdbcType=VARCHAR},
				#{transferFlightNo jdbcType=VARCHAR},
				#{transferDate jdbcType=TIMESTAMP},
				#{airLineCode jdbcType=VARCHAR},
				#{airLineName jdbcType=VARCHAR},
				#{airWaybillNo jdbcType=VARCHAR},
				#{createUserCode jdbcType=VARCHAR},
				#{createUserName jdbcType=VARCHAR},
				#{createOrgCode jdbcType=VARCHAR},
				#{createOrgName jdbcType=VARCHAR},
				#{createTime jdbcType=TIMESTAMP},
				#{modifyUserCode jdbcType=VARCHAR},
				#{modifyUserName jdbcType=VARCHAR},
				#{modifyTime jdbcType=TIMESTAMP},
				#{waybillQtyTotal jdbcType=NUMERIC},
				#{goodsQtyTotal jdbcType=NUMERIC},
				#{grossWeightTotal jdbcType=NUMERIC},
				#{deliverFeeTotal jdbcType=NUMERIC}*100,
				#{arrivalFeeTotal jdbcType=NUMERIC}*100,
				#{collectionFeeTotal jdbcType=NUMERIC}*100,
				#{currencyCode jdbcType=CHAR}
   		 	)
	</insert>
	<!-- 新增中转提货清单明细  批量-->
	<insert id="addAirTransPickupDetail" parameterType="java.util.List">
		begin
   		 <foreach collection="list" item="item"  separator=";">
   		 	INSERT INTO TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL(
   		 		<include refid="insert_air_transfer_pickupbill_detail"/>
   		 	)VALUES(
   		 		#{item.id jdbcType=VARCHAR},
   		 		#{item.airPickupbillId jdbcType=VARCHAR},
   		 		#{item.waybillNo jdbcType=VARCHAR},
   		 		#{item.arrvRegionName jdbcType=VARCHAR},
   		 		#{item.goodsName jdbcType=VARCHAR},
   		 		#{item.goodsQty jdbcType=NUMERIC},
   		 		#{item.weight jdbcType=NUMERIC},
   		 		#{item.billingWeight jdbcType=NUMERIC},
   		 		#{item.pickupType jdbcType=NUMERIC},
   		 		#{item.deliverFee jdbcType=NUMERIC}*100,
   		 		#{item.arrivalFee jdbcType=NUMERIC}*100,
   		 		#{item.collectionFee jdbcType=NUMERIC}*100,
   		 		#{item.notes jdbcType=VARCHAR},
   		 		#{item.airWaybillNo jdbcType=VARCHAR},
   		 		#{item.createTime jdbcType=TIMESTAMP},
   		 		#{item.currencyCode jdbcType=CHAR},
   		 		#{item.receiverContactPhone jdbcType=VARCHAR},
   		 		#{item.receiverAddress jdbcType=VARCHAR},
   		 		#{item.receiverName jdbcType=VARCHAR},
   		 		#{item.beTransfer jdbcType=CHAR}
   		 	)
   		 </foreach> 
   		 ;end;
	</insert>
	
	<!-- 新增中转提货清单明细   单条-->
	<insert id="addAirTransPickupDetailEntity" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillDetailEntity">
   		 	INSERT INTO TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL(
   		 		<include refid="insert_air_transfer_pickupbill_detail"/>
   		 	)VALUES(
   		 		#{id jdbcType=VARCHAR},
   		 		#{airPickupbillId jdbcType=VARCHAR},
   		 		#{waybillNo jdbcType=VARCHAR},
   		 		#{arrvRegionName jdbcType=VARCHAR},
   		 		#{goodsName jdbcType=VARCHAR},
   		 		#{goodsQty jdbcType=NUMERIC},
   		 		#{weight jdbcType=NUMERIC},
   		 		#{billingWeight jdbcType=NUMERIC},
   		 		#{pickupType jdbcType=NUMERIC},
   		 		#{deliverFee jdbcType=NUMERIC}*100,
   		 		#{arrivalFee jdbcType=NUMERIC}*100,
   		 		#{collectionFee jdbcType=NUMERIC}*100,
   		 		#{notes jdbcType=VARCHAR},
   		 		#{airWaybillNo jdbcType=VARCHAR},
   		 		#{createTime jdbcType=TIMESTAMP},
   		 		#{currencyCode jdbcType=CHAR},
   		 		#{receiverContactPhone jdbcType=VARCHAR},
   		 		#{receiverAddress jdbcType=VARCHAR},
   		 		#{receiverName jdbcType=VARCHAR},
   		 		#{beTransfer jdbcType=CHAR}
   		 	)
	</insert>
	
	<!-- 根据运单号查询合大票清单明细数据添加到中转提货清单明细列表中 -->
	<select id="waybillNoAddToTransferDetail" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultMap="airPickupReceiverNameResultMap">
		SELECT
			<include refid="select_t_opt_air_pickupbill_detail"/>
		 		FROM TFR.T_OPT_AIR_PICKUPBILL_DETAIL DETAIL
				LEFT JOIN TFR.T_OPT_AIR_PICKUPBILL PICKUPBILL ON DETAIL.AIR_PICKUPBILL_ID=PICKUPBILL.ID
				WHERE DETAIL.BE_TRANSFER = #{beTransfer}
				AND PICKUPBILL.ORIG_ORG_CODE = #{origOrgCode}
				AND DETAIL.WAYBILL_NO = #{waybillNo}
					<!-- 合大票添加为提交状态 2016年9月8日09:43:56 wwb 311396 -->
				and nvl(PICKUPBILL.status, 'Y') != 'N'
	</select>
	
	<!--根据中转提货清单明细id集合，查询出所有的中转提货清单  -->
	<select id="queryAirTransPickupbillByIds" parameterType="list" resultMap="airTransPickupbillEntityResultMap">
	      select 
	        <include refid="select_t_opt_air_trans_pickupbill_view"/>
		  FROM TFR.T_OPT_AIR_TRANS_PICKUPBILL t WHERE t.id in 
	        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
	          #{item}
	       </foreach>
	</select>
	
	
	<!-- 根据正单号查询中转提货清单 -->
	<select id="queryAirTransPickupbillEntity" parameterType="String" resultMap="airTransPickupbillEntityResultMap">
		SELECT 
			<include refid="select_t_opt_air_trans_pickupbill_view"/>
		 FROM TFR.T_OPT_AIR_TRANS_PICKUPBILL WHERE AIR_WAYBILL_NO = #{airWayBillNo}
	</select>
	
	<!-- 根据中转单号查询中转提货清单 -->
	<select id="queryAirTransPickupbillEntityByNo" parameterType="String" resultMap="airTransPickupbillEntityResultMap">
		SELECT 
			<include refid="select_t_opt_air_trans_pickupbill_view"/>
		 FROM TFR.T_OPT_AIR_TRANS_PICKUPBILL WHERE AIR_TRANSFER_PICKUPBILL_NO = #{transferNo}
	</select>
	
	<!-- 根据中转提货清单id查询中转提货清单 -->
	<select id="queryAirTransPickupbillEntityById" parameterType="String" resultMap="airTransPickupbillEntityResultMap">
		SELECT 
			<include refid="select_t_opt_air_trans_pickupbill_view"/>
		 FROM TFR.T_OPT_AIR_TRANS_PICKUPBILL WHERE ID = #{airTransferPickUpBillId}
	</select>
	
	<!-- 根据正单号查询中转提货清单明细 -->
	<select id="queryAirTransPickupDetailList" parameterType="String" resultMap="airTransPickupbillDetailEntityResultMap">
		SELECT 
			<include refid="select_air_transfer_pickupbill_detail_view"/>
			FROM TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL WHERE AIR_WAYBILL_NO = #{airWayBillNo}
	</select>
	
	<!-- 根据中转单号查询中转提货清单明细 -->
	<select id="queryAirTransPickupDetailListByNo" parameterType="String" resultMap="airTransPickupbillDetailEntityResultMap">
		SELECT 
				DE.ID, 
				DE.AIR_TRANSFER_PICKUPBILL_ID, 
				DE.WAYBILL_NO, 
				DE.ARRV_REGION_NAME, 
				DE.GOODS_NAME, 
				DE.GOODS_QTY, 
				DE.WEIGHT, 
				DE.BILLING_WEIGHT, 
				DE.PICKUP_TYPE, 
				DE.DELIVER_FEE/100 AS DELIVER_FEE, 
				DE.ARRIVAL_FEE/100 AS ARRIVAL_FEE, 
				DE.COLLECTION_FEE/100 AS COLLECTION_FEE, 
				DE.NOTES, 
				DE.AIR_WAYBILL_NO, 
				DE.CREATE_TIME, 
				DE.CURRENCY_CODE, 
				DE.RECEIVER_CONTACT_PHONE, 
				DE.RECEIVER_ADDRESS, 
				DE.RECEIVER_NAME, 
				DE.BE_TRANSFER
		   FROM TFR.T_OPT_AIR_TRANS_PICKUPBILL PI
      LEFT JOIN TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL DE ON PI.ID=DE.AIR_TRANSFER_PICKUPBILL_ID	
		  WHERE PI.AIR_TRANSFER_PICKUPBILL_NO = #{transferNo}
		    AND DE.ID is not null
	</select>
	
	<!--根据制单时间、航空公司、正单号、目的站、到达网点、空运总调(合票清单录入人所属部门)-->
	<select id="queryMakePickGoods" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultMap="airPickupResultMap">
		SELECT 
		<include refid="select_t_opt_air_pickupbill"/>
		FROM TFR.T_OPT_AIR_PICKUPBILL 
		<where>
			<include refid="query_t_opt_air_pickupbill"/>
		</where>
		ORDER BY CREATE_TIME DESC 
	</select>
	
	<!-- 获取总记录数 -->
	<select id="getMakePickGoodsCount" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultType="Long">
		SELECT COUNT(ID) FROM TFR.T_OPT_AIR_PICKUPBILL 
		<where>
			<include refid="query_t_opt_air_pickupbill"/>
			<!-- 合大票添加为提交状态 2016年9月8日09:43:56 wwb 311396 -->
			and nvl(status,'Y') != 'N'
		</where>
	</select>
	
	<!-- 根据正单号查询合大票清单中是否存在记录 -->
	<select id="checkExistAirTransPickupBill" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultType="int">
		SELECT COUNT(ID) FROM TFR.T_OPT_AIR_PICKUPBILL A
		WHERE A.AIR_WAYBILL_NO = #{airWaybillNo}
		AND A.AIR_LINE_CODE = #{airLineTwoletter}
		AND A.ORIG_ORG_CODE = #{deptCode}
	</select>
	
	
	<!-- 批量修改合大票明细 批量-->
	<update id="modifyAirPickupbillDetailList" parameterType="list">
		  begin
	   	<foreach collection="list" item="item"  separator=";">
	   	 UPDATE TFR.T_OPT_AIR_PICKUPBILL_DETAIL A
	   		<set>
	   		    <![CDATA[ 
	   				A.BILLING_WEIGHT = #{item.billingWeight jdbcType=NUMERIC},
	   				A.DELIVER_FEE = #{item.deliverFee jdbcType=NUMERIC}*100,
	   				A.ARRIVAL_FEE = #{item.arrivalFee jdbcType=NUMERIC}*100,
	   				A.COLLECTION_FEE = #{item.collectionFee jdbcType=NUMERIC}*100,
	   				A.GOODS_QTY = #{item.airPickQty jdbcType=NUMERIC},
	   				A.RECEIVER_NAME = #{item.receiverName jdbcType=VARCHAR},
	   				A.BE_TRANSFER = #{item.beTransfer jdbcType=VARCHAR},
	   				A.RECEIVER_CONTACT_PHONE = #{item.receiverContactPhone jdbcType=VARCHAR},
	   				A.RECEIVER_ADDRESS = #{item.receiverAddress jdbcType=VARCHAR},
	   				A.NOTES = #{item.notes jdbcType=VARCHAR}
	   		    ]]>
	   		</set>
		     WHERE A.ID = #{item.id}
   		 </foreach>
   		;end; 
	</update>
	
	<!-- 批量修改合大票明细 单条-->
	<update id="modifyAirPickupbillDetailEntity" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillDetailEntity">
	   	 UPDATE TFR.T_OPT_AIR_PICKUPBILL_DETAIL A
	   		<set>
	   		    <![CDATA[ 
	   				A.BILLING_WEIGHT = #{item.billingWeight jdbcType=NUMERIC},
	   				A.DELIVER_FEE = #{item.deliverFee jdbcType=NUMERIC}*100,
	   				A.ARRIVAL_FEE = #{item.arrivalFee jdbcType=NUMERIC}*100,
	   				A.GOODS_QTY = #{item.airPickQty jdbcType=NUMERIC},
	   				A.RECEIVER_NAME = #{item.receiverName jdbcType=VARCHAR},
	   				A.BE_TRANSFER = #{item.beTransfer jdbcType=VARCHAR},
	   				A.RECEIVE_CUSTOMER_PHONE = #{item.receiverContactPhone jdbcType=VARCHAR},
	   				A.RECEIVER_ADDRESS = #{item.receiverAddress jdbcType=VARCHAR},
	   				A.NOTES = #{item.notes jdbcType=VARCHAR}
	   		    ]]>
	   		</set>
		     WHERE A.ID = #{id}
	</update>

    <!--根据正单号 删除合票清单 -->
    <delete id="deleteAirPickupBillByAirWaybill" parameterType="String">
       DELETE FROM TFR.T_OPT_AIR_PICKUPBILL p
       <where>
          p.air_waybill_no=#{airWaybillNo}
       </where>
    </delete>
    
    <!-- 根据合票id删除合票 -->
     <delete id="deleteAirPickupBillById" parameterType="String">
       DELETE FROM TFR.T_OPT_AIR_PICKUPBILL p
       <where>
          p.id=#{id}
       </where>
    </delete>
    
	<!-- 批量删除合大票明细 -->
	<delete id="deleteAirPickupbillDetailList" parameterType="java.util.List">
		DELETE FROM TFR.T_OPT_AIR_PICKUPBILL_DETAIL A 
		<where>
			A.ID IN
			<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			 	#{item}
			</foreach>
		</where>
	</delete>
	
		<!-- 批量删除合大票流水 -->
	<delete id="deleteAirPickupbillSerialList" parameterType="java.util.List">
		DELETE FROM TFR.t_Opt_Air_Pickupbill_Serial A 
		<where>
			A.AIR_PIACKUP_DETIAL_ID IN
			<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			 	#{item}
			</foreach>
		</where>
	</delete>
	
	<!-- 查询_修改中转货清单查询 -->
	<select id="queryTfrPickupBill" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultMap="airTransPickupbillEntityResultMap">
		    SELECT 
		    A.ID, 
			A.AIR_TRANSFER_PICKUPBILL_NO, 
			A.ARRV_REGION_CODE, 
			A.ARRV_REGION_NAME, 
			A.DEST_ORG_CODE, 
			A.DEST_ORG_NAME, 
			A.TRANSFER_FLIGHT_NO, 
			A.TRANSFER_DATE, 
			A.AIR_LINE_CODE, 
			A.AIR_LINE_NAME, 
			A.AIR_WAYBILL_NO, 
			A.CREATE_USER_CODE, 
			A.CREATE_USER_NAME, 
			A.CREATE_ORG_CODE, 
			A.CREATE_ORG_NAME, 
			A.CREATE_TIME, 
			A.MODIFY_USER_CODE, 
			A.MODIFY_USER_NAME, 
			A.MODIFY_TIME, 
			A.WAYBILL_QTY_TOTAL, 
			A.GOODS_QTY_TOTAL, 
			A.GROSS_WEIGHT_TOTAL, 
			A.DELIVER_FEE_TOTAL/100 AS DELIVER_FEE_TOTAL, 
			A.ARRIVAL_FEE_TOTAL/100 AS ARRIVAL_FEE_TOTAL, 
			A.COLLECTION_FEE_TOTAL/100 AS COLLECTION_FEE_TOTAL, 
			A.CURRENCY_CODE FROM 
			TFR.T_OPT_AIR_TRANS_PICKUPBILL A,TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL B
		<where>
			A.ID = B.AIR_TRANSFER_PICKUPBILL_ID
			AND B.BE_TRANSFER='Y'
			<if test="origOrgCode !=null and origOrgCode !='' ">
				AND A.CREATE_ORG_CODE = #{origOrgCode}
			</if>
			<if test="deptOrgName !=null and deptOrgName !='' ">
				AND A.DEST_ORG_NAME = #{deptOrgName}
			</if>
			<if test="beginInTime !=null and endInTime !=null ">  
				<![CDATA[ AND A.CREATE_TIME >=#{beginInTime} AND A.CREATE_TIME <=#{endInTime} ]]>
			</if>
			<if test="airTransferPickupbillNo !=null and airTransferPickupbillNo !='' ">
				AND A.AIR_TRANSFER_PICKUPBILL_NO = #{airTransferPickupbillNo}
			</if>
			<if test="destOrgCode !=null and destOrgCode !='' ">
				AND A.DEST_ORG_CODE = #{destOrgCode}
			</if>
			<if test="destOrgName !=null and destOrgName !='' ">
				AND A.DEST_ORG_NAME = #{destOrgName}
			</if>
			<if test="arrvRegionCode !=null and arrvRegionCode !='' ">
				AND A.ARRV_REGION_CODE = #{arrvRegionCode}
			</if>
			<if test="arrvRegionName !=null and arrvRegionName !='' ">
				AND A.ARRV_REGION_NAME = #{arrvRegionName}
			</if>
			<if test="flightNo !=null and flightNo !='' ">
				AND A.TRANSFER_FLIGHT_NO = #{flightNo}
			</if>
			<if test="beTransfer !=null and beTransfer !='' ">
				AND A.be_Transfer = #{beTransfer}
			</if>
		</where>
		ORDER BY A.CREATE_TIME DESC
	</select>
	
	<!-- 查询中转货清单  综合查询显示运单内部轨迹 -->
	<select id="queryTfrPickupBillListForViewTrack" parameterType="String" resultMap="airTransPickupbillEntityResultMap">
		SELECT 
        	PB.ID, 
	        PB.AIR_TRANSFER_PICKUPBILL_NO, 
	        PB.ARRV_REGION_CODE, 
	        PB.ARRV_REGION_NAME, 
	        PB.DEST_ORG_CODE, 
	        PB.DEST_ORG_NAME, 
	        PB.TRANSFER_FLIGHT_NO, 
	        PB.TRANSFER_DATE, 
	        PB.AIR_LINE_CODE, 
	        PB.AIR_LINE_NAME, 
	        PB.AIR_WAYBILL_NO, 
	        PB.CREATE_USER_CODE, 
	        PB.CREATE_USER_NAME, 
	        PB.CREATE_ORG_CODE, 
	      	PB.CREATE_ORG_NAME, 
	      	PB.CREATE_TIME, 
	      	PB.MODIFY_USER_CODE, 
	      	PB.MODIFY_USER_NAME, 
	      	PB.MODIFY_TIME, 
	      	PB.WAYBILL_QTY_TOTAL, 
	      	DE.GOODS_QTY AS GOODS_QTY_TOTAL, 
	      	DE.WEIGHT AS GROSS_WEIGHT_TOTALL, 
      		DE.DELIVER_FEE/100 AS DELIVER_FEE_TOTAL, 
	      	DE.ARRIVAL_FEE/100 AS ARRIVAL_FEE_TOTAL, 
	      	DE.COLLECTION_FEE/100 AS COLLECTION_FEE_TOTAL, 
	      	PB.CURRENCY_CODE 
      	FROM TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL DE
    		LEFT JOIN TFR.T_OPT_AIR_TRANS_PICKUPBILL PB ON PB.ID = DE.AIR_TRANSFER_PICKUPBILL_ID
		WHERE DE.BE_TRANSFER='Y' AND DE.WAYBILL_NO = #{waybillNo}
    	ORDER BY DE.CREATE_TIME DESC
	</select>
	
	<!-- 根据中转提货清单id查询中转提货明细信息 -->
	<select id="queryTfrPickupBillDetail" parameterType="String" resultMap="airTransPickupbillDetailEntityResultMap">
		SELECT
				A.ID, 
				A.AIR_TRANSFER_PICKUPBILL_ID, 
				A.WAYBILL_NO, 
				A.ARRV_REGION_NAME, 
				A.GOODS_NAME, 
				A.GOODS_QTY, 
				A.WEIGHT, 
				A.BILLING_WEIGHT, 
				A.PICKUP_TYPE, 
				A.DELIVER_FEE/100 AS DELIVER_FEE, 
				A.ARRIVAL_FEE/100 AS ARRIVAL_FEE, 
				A.COLLECTION_FEE/100 AS COLLECTION_FEE, 
				A.NOTES, 
				A.AIR_WAYBILL_NO, 
				A.CREATE_TIME, 
				A.CURRENCY_CODE, 
				A.RECEIVER_CONTACT_PHONE, 
				A.RECEIVER_ADDRESS, 
				A.RECEIVER_NAME, 
				A.BE_TRANSFER
		 FROM TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL A
		 WHERE A.AIR_TRANSFER_PICKUPBILL_ID = #{airTransferPickupbillId}
		 AND A.BE_TRANSFER='Y'
	</select>
	
	
	<!--根据运单号和正单号查询出中转提货清单明细  -->
	<select id="queryTransPickupbillDetailList" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirTransPickupDetailEntity" 
	resultMap="airTransPickupbillDetailEntityResultMap">
	   select 
	    <include refid="select_air_transfer_pickupbill_detail_view"/>
	   from tfr.t_opt_air_trans_pickup_detail d
	   where d.waybill_no=#{waybillNo} and d.air_waybill_no=#{airWaybillNo}
	</select>
	
	
	
	<!-- 根据运单号和正单号删除中转提货清单明细 -->
	<delete id="deleteTransPickbillDetailByWaybillAndAirWaybill" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirTransPickupDetailEntity">
	     delete from tfr.t_opt_air_trans_pickup_detail d 
	       where d.waybill_no=#{waybillNo} and d.air_waybill_no=#{airWaybillNo}
	</delete>
	
	<!-- 根据中转提货清单id查询明细  -->
	<select id="queryToAddTfrPickupBillDetail" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultMap="airPickupReceiverNameResultMap">
		SELECT
				B.AIR_PICKUPBILL_ID, 
				B.ID, 
				B.WAYBILL_NO, 
				B.ARRV_REGION_NAME, 
				B.GOODS_NAME, 
				B.GOODS_QTY, 
				B.WEIGHT, 
				B.BILLING_WEIGHT, 
				B.BE_TRANSFER, 
				B.PICKUP_TYPE, 
				B.DELIVER_FEE/100 AS DELIVER_FEE, 
				B.ARRIVAL_FEE/100 AS ARRIVAL_FEE, 
				B.COLLECTION_FEE/100 AS COLLECTION_FEE, 
				B.NOTES, 
				B.AIR_WAYBILL_NO, 
				B.CURRENCY_CODE, 
				B.CREATE_TIME, 
				B.RECEIVER_CONTACT_PHONE, 
				B.RECEIVER_ADDRESS, 
				B.RECEIVER_NAME 
		 FROM TFR.T_OPT_AIR_PICKUPBILL A ,TFR.T_OPT_AIR_PICKUPBILL_DETAIL B 
		<where>
			B.AIR_PICKUPBILL_ID = A.ID
			AND NOT EXISTS (SELECT 1
          		FROM PKP.T_SRV_WAYBILL_SIGN_RESULT R
         		WHERE B.WAYBILL_NO = R.WAYBILL_NO
           		AND R.ACTIVE = 'Y')
			<if test="waybillNo !=null and waybillNo !='' ">
				AND B.WAYBILL_NO = #{waybillNo} 
			</if>
			<if test="arrvRegionName !=null and arrvRegionName !='' ">
				AND B.ARRV_REGION_NAME = #{arrvRegionName} 
			</if>
			<if test="flightNo !=null and flightNo!='' ">
				AND A.FLIGHT_NO = #{flightNo}
			</if>
			<if test="destOrgName !=null and destOrgName !='' ">
				AND A.DEST_ORG_NAME = #{destOrgName}
			</if>
			<!-- 合大票添加为提交状态 2016年9月8日09:43:56 wwb 311396 -->
			and nvl(a.status, 'Y') != 'N'
		</where>
	</select>
	
	<!-- 批量修改中转提货清单明细 -->
	<update id="modifyAirTransPickupDetailList" parameterType="list">
		  begin
	   	<foreach collection="list" item="item"  separator=";">
	   	 UPDATE TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL A
	   		<set>
	   		    <![CDATA[ 
	   				A.BILLING_WEIGHT = #{item.billingWeight jdbcType=NUMERIC},
	   				A.DELIVER_FEE = #{item.deliverFee jdbcType=NUMERIC}*100,
	   				A.GOODS_QTY = #{item.goodsQty jdbcType=NUMERIC},
	   				A.RECEIVER_NAME = #{item.receiverName jdbcType=VARCHAR},
	   				A.RECEIVER_CONTACT_PHONE = #{item.receiverContactPhone jdbcType=VARCHAR},
	   				A.RECEIVER_ADDRESS = #{item.receiverAddress jdbcType=VARCHAR},
	   				A.NOTES = #{item.notes jdbcType=VARCHAR}
	   		    ]]>
	   		</set>
		     WHERE A.ID = #{item.id}
   		 </foreach>
   		;end; 
	</update>
	
	<!--批量 更改中转提货清单 -->
	<update id="modifyAirTransPickupbillList" parameterType="list">
	 begin
	 	<foreach collection="list" item="item"  separator=";">
	   update tfr.t_opt_air_trans_pickupbill p
	     <set>
	        <!-- 总票数 -->
	         p.WAYBILL_QTY_TOTAL=#{item.waybillQtyTotal jdbcType=NUMERIC},
	         <!-- 总件数 -->
		     p.GOODS_QTY_TOTAL=#{item.goodsQtyTotal  jdbcType=NUMERIC},
		     <!-- 总计毛重 -->
		     p.GROSS_WEIGHT_TOTAL=#{item.grossWeightTotal  jdbcType=NUMERIC},
		     <!-- 总送货费 -->
		     p.DELIVER_FEE_TOTAL=#{item.deliverFeeTotal  jdbcType=NUMERIC}*100,
		     <!-- 到付总费用 -->
		     p.ARRIVAL_FEE_TOTAL=#{item.arrivalFeeTotal  jdbcType=NUMERIC}*100,
		     <!-- 总代收货款 -->
		     p.COLLECTION_FEE_TOTAL=#{item.collectionFeeTotal  jdbcType=NUMERIC}*100
	     </set>
	     where p.id=#{item.id} 
	   </foreach>
	   ;end;   
	</update>
	
	
	
	<!--根据正单号删除中转提货清单 ，1 由于存在一个合票做了多个中转  2 一个中转提货单据中可能存在多个合票 此方法慎用-->
	<delete id="deleteTransPickupBillByAirWaybill" parameterType="String">
	   tfr.t_opt_air_trans_pickupbill p
	    <where>
	       p.air_waybill_no=#{airWaybillNo}
	    </where>
	</delete>
	
	<!--根据提货清单Id删除中转提货清单 -->
	<delete id="deleteTransPickupBillById" parameterType="String">
	   delete from tfr.t_opt_air_trans_pickupbill p
	    <where>
	       p.id=#{id}
	    </where>
	</delete>
	
	<!-- 批量删除中转提货清单明细 -->
	<delete id="delTransPickupDetailList" parameterType="list">
		DELETE FROM TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL A 
			<where>
			A.ID IN
			<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			 	#{item}
			</foreach>
		</where>
	</delete>
	
	
	<!--根据id查询待导出的合中转提货清单明细list-->
	<select id="queryTransPickupDetailWithExportEdi" parameterType="list" resultMap="airTransPickupbillDetailEntityResultMap">
		SELECT
			<include refid="select_air_transfer_pickupbill_detail_view"/> 
		 	FROM TFR.T_OPT_AIR_TRANS_PICKUP_DETAIL 
				WHERE ID IN 
					<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
				 		#{item}
					</foreach>
	</select>
	
	<!-- 根据运单号查询空运运单费用及出港信息 -->
	<select id="queryAirPickupbill" parameterType="String" resultMap="airPickupResultMap">
		SELECT
			<include refid="select_t_opt_air_pickupbill"/> 
		 	FROM TFR.T_OPT_AIR_PICKUPBILL WHERE ID IN (
				SELECT AIR_PICKUPBILL_ID FROM TFR.T_OPT_AIR_PICKUPBILL_DETAIL WHERE WAYBILL_NO=#{waybillNo}
			)
			<!-- 合大票添加为提交状态 2016年9月8日09:43:56 wwb 311396 -->
			and nvl(status, 'Y') != 'N'
		 ORDER BY CREATE_TIME DESC
	</select>
	
	<!-- 根据运单号查询空运运单合票信息  供综合查询显示内部轨迹-->
	<select id="queryAirPickupbillListForViewTrack" parameterType="String" resultMap="airPickupResultMap">
		SELECT
	    	PB.ID,
			PB.AIR_LINE_CODE,
			PB.AIR_LINE_NAME,
			PB.AIR_WAYBILL_NO,
		    PB.DEST_ORG_CODE,
		    PB.DEST_ORG_NAME,
		    PB.FLIGHT_NO,
		    PB.ARRV_REGION_CODE,
		    PB.ARRV_REGION_NAME,
		    PB.FLIGHT_DATE,
		    PB.CREATE_USER_CODE,
		    PB.CREATE_USER_NAME,
		    PB.ORIG_ORG_CODE,
		    PB.ORIG_ORG_NAME,
		    PB.CREATE_TIME,
		    PB.MODIFY_USER_CODE,
		    PB.MODIFY_USER_NAME,
		    PB.MODIFY_TIME,
		    PB.WAYBILL_QTY_TOTAL,
		    DE.GOODS_QTY AS GOODS_QTY_TOTAL,
		    DE.WEIGHT AS GROSS_WEIGHT_TOTAL,
		    DE.DELIVER_FEE/100 AS DELIVER_FEE_TOTAL,
		    DE.ARRIVAL_FEE/100 AS ARRIVAL_FEE_TOTAL,
		    DE.COLLECTION_FEE/100 AS COLLECTION_FEE_TOTAL,
			PB.CURRENCY_CODE 
    	FROM TFR.T_OPT_AIR_PICKUPBILL_DETAIL DE
        	LEFT JOIN  TFR.T_OPT_AIR_PICKUPBILL PB ON DE.AIR_PICKUPBILL_ID = PB.ID
    	WHERE DE.WAYBILL_NO = #{waybillNo}
    	<!-- 合大票添加为提交状态 2016年9月8日09:43:56 wwb 311396 -->
    	and nvl(PB.status, 'Y') != 'N'
    	ORDER BY DE.CREATE_TIME DESC
	</select>
	
	<!-- 根据合大票id查询合大票运单明细-->
	<select id="queryAirPickupbillDetailListByPrimaryId" parameterType="String" resultMap="airPickupReceiverNameResultMap">
		SELECT
	    	<include refid="select_t_opt_air_pickupbill_detail"/>
    	FROM TFR.T_OPT_AIR_PICKUPBILL_DETAIL DETAIL
    	WHERE DETAIL.AIR_PICKUPBILL_ID = #{airPickupbillId}
	</select>
	
	<!-- 批量更新合大票明细表中的到付款和代收货款 -->
	<update id="updateAirupbillNoList" parameterType="list">
		     UPDATE TFR.T_OPT_AIR_PICKUPBILL_DETAIL SET COLLECTION_FEE=0, 
		     ARRIVAL_FEE=0 WHERE 
		     WAYBILL_NO IN
		     <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
				 #{item}
		     </foreach>
	</update>
	
	
	<!--根据正单号list查询合大票清单 -->
	<select id="batchSearchPickupbill" parameterType="string" resultMap="airPickupResultMap">
		SELECT 
		<include refid="select_t_opt_air_pickupbill"/> 
			FROM TFR.T_OPT_AIR_PICKUPBILL BILL 
			<where>
				BILL.AIR_WAYBILL_NO = #{airWaybillNo} 
			</where>
	</select>
	<!-- 2013-07-25 wqh BUG-47499 	合大票清单修改后时间不更新   -->
	<!-- 修改合大票-->
	<update id="modifyAirPickupbill" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillEntity">
	   	 UPDATE TFR.T_OPT_AIR_PICKUPBILL A
	   		<set>
	   		    <![CDATA[ 
	   				A.DEST_ORG_CODE = #{destOrgCode jdbcType=VARCHAR},
	   				A.DEST_ORG_NAME = #{destOrgName jdbcType=VARCHAR},
	   				A.MODIFY_TIME = #{modifyTime jdbcType=TIMESTAMP},
	   				A.FLIGHT_DATE = #{flightDate jdbcType=TIMESTAMP},
	   				A.MODIFY_USER_CODE = #{modifyUserCode jdbcType=VARCHAR},
	   				A.MODIFY_USER_NAME = #{modifyUserName jdbcType=VARCHAR},
	   				A.WAYBILL_QTY_TOTAL = #{waybillQtyTotal jdbcType=NUMERIC},
		            A.GOODS_QTY_TOTAL = #{airPickQtyTotal jdbcType=NUMERIC},
		            A.GROSS_WEIGHT_TOTAL = 	#{grossWeightTotal jdbcType=NUMERIC},
		            A.DELIVER_FEE_TOTAL = #{deliverFeeTotal jdbcType=NUMERIC}*100,
		            A.ARRIVAL_FEE_TOTAL = #{arrivalFeeTotal jdbcType=NUMERIC}*100,
		            A.COLLECTION_FEE_TOTAL = #{collectionFeeTotal jdbcType=NUMERIC}*100,
		            A.STATUS = #{status, jdbcType=VARCHAR}
	   		    ]]>
	   		</set>
		     WHERE A.ID = #{id}
	</update>
	
	<!-- 修改合大票 明细 ，用于接送货做更改单时同步修改合大票明细信息-->
	<update id="updatePickupDetailFromModifyWaybill" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillDetailEntity">
	   	 UPDATE TFR.T_OPT_AIR_PICKUPBILL_DETAIL D 
	   		 <trim prefix="SET" suffixOverrides=",">
	   		 	<if test="deliverFee !=null and deliverFee !='' ">
					 D.WAYBILL_NO = #{waybillNo},
				</if>
				<!-- 去掉送货费的修改zwd 20141124
	   			 <if test="deliverFee !=null and deliverFee !='' ">
					 D.DELIVER_FEE = #{deliverFee}*100,
				</if> -->
	   			<if test="arrivalFee !=null and arrivalFee !='' ">
					 D.ARRIVAL_FEE = #{arrivalFee}*100,
				</if>
				<if test="collectionFee !=null and collectionFee !='' ">
					 D.COLLECTION_FEE = #{collectionFee}*100,
				</if>
				<if test="goodsName !=null and goodsName !='' ">
					 D.GOODS_NAME = #{goodsName},
				</if>
				<if test="goodsQty !=null and goodsQty !='' ">
					 D.GOODS_QTY = #{goodsQty},
				</if>
				<if test="weight !=null and weight !='' ">
					 D.WEIGHT = #{weight},
				</if>
				<if test="billingWeight !=null and billingWeight !='' ">
					 D.BILLING_WEIGHT = #{billingWeight},
				</if>
				<if test="pickupType !=null and pickupType !='' ">
					 D.PICKUP_TYPE = #{pickupType},
				</if>
				<if test="receiverContactPhone !=null and receiverContactPhone !='' ">
					 D.RECEIVER_CONTACT_PHONE = #{receiverContactPhone},
				</if>
				<if test="receiverAddress !=null and receiverAddress !='' ">
					 D.RECEIVER_ADDRESS = #{receiverAddress},
				</if>
				<if test="receiverName !=null and receiverName !='' ">
					 D.RECEIVER_NAME = #{receiverName}
				</if>
	   		 </trim>
		     WHERE D.WAYBILL_NO = #{waybillNo}
	</update>
	
	<!-- 根据运单号查询对应的合票清单 -->
	<select id="queryAirPickupbillListByWaybillNo" parameterType="String" resultMap="airPickupResultMap">
		SELECT
		        A.ID,
			    A.AIR_LINE_CODE,
			    A.AIR_LINE_NAME,
			    A.AIR_WAYBILL_NO,
			    A.DEST_ORG_CODE,
			    A.DEST_ORG_NAME,
			    A.FLIGHT_NO,
			    A.ARRV_REGION_CODE,
			    A.ARRV_REGION_NAME,
			    A.FLIGHT_DATE,
			    A.CREATE_USER_CODE,
			    A.CREATE_USER_NAME,
			    A.ORIG_ORG_CODE,
			    A.ORIG_ORG_NAME,
			    A.CREATE_TIME,
			    A.MODIFY_USER_CODE,
			    A.MODIFY_USER_NAME,
			    A.MODIFY_TIME,
			    A.WAYBILL_QTY_TOTAL,
			    A.GOODS_QTY_TOTAL,
			    A.GROSS_WEIGHT_TOTAL,
			    A.DELIVER_FEE_TOTAL/100 AS DELIVER_FEE_TOTAL,
			    A.ARRIVAL_FEE_TOTAL/100 AS ARRIVAL_FEE_TOTAL,
			    A.COLLECTION_FEE_TOTAL/100 AS COLLECTION_FEE_TOTAL,
			  	A.Currency_Code
		from tfr.t_opt_air_pickupbill A
		inner join tfr.t_opt_air_pickupbill_detail B
         on B.air_pickupbill_id=A.id
        where B.waybill_no=#{waybillNo}  
        <!-- 合大票添加为提交状态 2016年9月8日09:43:56 wwb 311396 -->
        and nvl(a.status, 'Y') != 'N'
	</select>
	<!-- 新增合票清单日志   单条-->
	<insert id="addAirPickupbillLog" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.AirPickupbillLogEntity">
   		 	INSERT INTO TFR.t_opt_air_pickupbill_log(
   		 		ID,
   		 		PICKUPBILL_ID,
   		 		AIR_WAYBILL_NO,
   		 		OPERATE_TYPE,
   		 		OPERATOR_CODE,
   		 		OPERATOR_NAME,
   		 		OPERATE_TIME,
   		 		OPTCONTENT,
   		 		ORIG_ORG_CODE,
   		 		ORIG_ORG_NAME
   		 	)VALUES(
   		 		#{id jdbcType=VARCHAR},
   		 		#{airPickupbillId jdbcType=VARCHAR},
   		 		#{airWaybillNo jdbcType=VARCHAR},
   		 		#{operateType jdbcType=VARCHAR},
   		 		#{operateCode jdbcType=VARCHAR},
   		 		#{operateName jdbcType=VARCHAR},
   		 		#{operateTime jdbcType=TIMESTAMP},
   		 		#{operateContent jdbcType=VARCHAR},
   		 		#{opterateOrgCode jdbcType=VARCHAR},
   		 		#{opterateOrgName jdbcType=VARCHAR}
   		 	)
	</insert>
	
	<!-- 根据id删除中转清单 -->
     <delete id="deleteTfrAirPickupbillById" parameterType="String">
       DELETE FROM TFR.t_opt_air_trans_pickupbill p
       <where>
          p.id=#{id}
       </where>
    </delete>
    
    <!-- 运单号查询所有中转提货清单 -->
	<select id="queryAirTransPickupbillByWaybillNo" parameterType="String" resultMap="airTransPickupbillEntityResultMap">
		 select 
		    A.ID, 
			A.AIR_TRANSFER_PICKUPBILL_NO, 
			A.ARRV_REGION_CODE, 
			A.ARRV_REGION_NAME, 
			A.DEST_ORG_CODE, 
			A.DEST_ORG_NAME, 
			A.TRANSFER_FLIGHT_NO, 
			A.TRANSFER_DATE, 
			A.AIR_LINE_CODE, 
			A.AIR_LINE_NAME, 
			A.AIR_WAYBILL_NO, 
			A.CREATE_USER_CODE, 
			A.CREATE_USER_NAME, 
			A.CREATE_ORG_CODE, 
			A.CREATE_ORG_NAME, 
			A.CREATE_TIME, 
			A.MODIFY_USER_CODE, 
			A.MODIFY_USER_NAME, 
			A.MODIFY_TIME, 
			A.WAYBILL_QTY_TOTAL, 
			A.GOODS_QTY_TOTAL, 
			A.GROSS_WEIGHT_TOTAL, 
			A.DELIVER_FEE_TOTAL/100 AS DELIVER_FEE_TOTAL, 
			A.ARRIVAL_FEE_TOTAL/100 AS ARRIVAL_FEE_TOTAL, 
			A.COLLECTION_FEE_TOTAL/100 AS COLLECTION_FEE_TOTAL, 
			A.CURRENCY_CODE
		  from tfr.t_opt_air_trans_pickupbill A
		  join tfr.t_opt_air_trans_pickup_detail B
		    on A.id = B.air_transfer_pickupbill_id
		 where B.waybill_no =#{waybillNo} 
	</select>
    
    	<!-- 校验运单号是否存在记录 -->
	<select id="checkWayBillIsExits" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.dto.AirTransPickupBillDto" resultType="int">
		SELECT COUNT(W.ID) FROM pkp.t_srv_waybill W
		WHERE W.waybill_no = #{waybillNo}
		AND w.active ='Y'
	</select>
	<!--合大票清单新增时  根据运单号查询 未制作合大票流水信息 -->
	<select id="findLeftSerial" parameterType="map" resultMap="SerialNoMap">
		select
			g.serial_no AS SERIAL_NO,
			g.id AS ID,
			g.waybill_no AS WAYBILL_NO 
		from pkp.t_srv_labeled_good g 
		where g.waybill_no=#{waybillNo,jdbcType=VARCHAR} and g.active='Y'
			and g.serial_no not in  (
   				select 
   						ps.serial_no 
   				from tfr.t_opt_air_pickupbill_serial ps
  				where ps.waybill_no=#{waybillNo,jdbcType=VARCHAR}
  				union all
  				select
					WS.serial_no AS SERIAL_NO
				from TFR.t_Opt_Air_Waybill_Serialno WS 
				where ws.waybill_no=#{waybillNo,jdbcType=VARCHAR}
  				 )
	</select>
	
	<!-- 合大票清单修改时 根据运单号查询 未制作合大票流水信息 -->
	<select id="findLeftSerialForModify" parameterType="map" resultMap="SerialNoMap">
		select
			g.serial_no AS SERIAL_NO,
			g.id AS ID,
			g.waybill_no AS WAYBILL_NO 
		from pkp.t_srv_labeled_good g 
		where g.waybill_no=#{waybillNo,jdbcType=VARCHAR} and g.active='Y'
			and g.serial_no not in  (
   				select ps.serial_no
                             from tfr.t_opt_air_pickupbill_serial ps
                            where ps.waybill_no = #{waybillNo,jdbcType=VARCHAR}
  				 )
	</select>
	
	<!-- 根据运单号查询已制作 流水信息 -->
	<select id="findRightSerial_Left" parameterType="map" resultMap="SerialNoMap">
		select
			ps.serial_no AS SERIAL_NO,
			ps.waybill_no AS WAYBILL_NO 
		from TFR.T_OPT_AIR_PICKUPBILL_SERIAL ps 
    	inner join tfr.t_Opt_Air_Pickupbill_Detail pd
    	on 		pd.id=ps.air_piackup_detial_id
   		and 	pd.waybill_no=ps.waybill_no
   		where 
   				ps.waybill_no=#{waybillNo,jdbcType=VARCHAR}
    		and pd.air_waybill_no=#{airWaybillNo,jdbcType=VARCHAR}
    		
    	union all
    	
    	select
			WS.serial_no AS SERIAL_NO,
			WS.waybill_no AS WAYBILL_NO
		from TFR.t_Opt_Air_Waybill_Serialno WS 
		INNER JOIN TFR.T_OPT_AIR_WAYBILL_DETAIL D
		ON WS.AIR_WAYBILL_DETAIL_ID=D.ID
		AND WS.WAYBILL_NO=D.WAYBILL_NO
		INNER JOIN TFR.t_Opt_Air_Waybill AW 
		ON AW.ID=D.AIR_WAYBILL_ID
		where ws.waybill_no=#{waybillNo,jdbcType=VARCHAR}
		and AW.AIR_WAYBILL_NO=#{airWaybillNo,jdbcType=VARCHAR}
	</select>
	
		<!-- 根据运单号查询已制作 流水信息 -->
	<select id="findRightSerial_Right" parameterType="map" resultMap="SerialNoMap">
		select
			pd.air_waybill_no,
			ps.serial_no AS SERIAL_NO,
			ps.waybill_no AS WAYBILL_NO 
		from TFR.T_OPT_AIR_PICKUPBILL_SERIAL ps 
    	inner join tfr.t_Opt_Air_Pickupbill_Detail pd
    	on 		pd.id=ps.air_piackup_detial_id
   		and 	pd.waybill_no=ps.waybill_no
   		where 
   				ps.waybill_no=#{waybillNo,jdbcType=VARCHAR}
   		<if test="airWaybillNo !=null and airWaybillNo !='' ">
			and pd.air_waybill_no=#{airWaybillNo,jdbcType=VARCHAR}
		</if>
    		
	</select>
	
		<!-- 新增合票清单流水   单条-->
	<insert id="saveSerialNo" parameterType="com.deppon.foss.module.transfer.airfreight.api.shared.domain.SerialEntity">
   		 	INSERT INTO TFR.T_OPT_AIR_PICKUPBILL_SERIAL(
   		 		ID,
   		 		AIR_PIACKUP_DETIAL_ID,
   		 		WAYBILL_NO,
   		 		SERIAL_NO,
   		 		CREATE_TIME,
   		 		NOTES
   		 	)VALUES(
   		 		#{id jdbcType=VARCHAR},
   		 		#{airPickUpDetialId jdbcType=VARCHAR},
   		 		#{waybillNo jdbcType=VARCHAR},
   		 		#{serialNo jdbcType=VARCHAR},
   		 		sysdate,
   		 		#{notes jdbcType=VARCHAR}
   		 	)
	</insert>
	
		<!-- 根据运单号和流水号 查询该流水号是否制作合大票 -->
	<select id="querySerialIsExist" parameterType="map" resultType="int">
		select
			count(ps.id)
		from TFR.T_OPT_AIR_PICKUPBILL_SERIAL ps 
		where ps.waybill_no=#{waybillNo,jdbcType=VARCHAR}
		<if test="serialNo !=null and serialNo !='' ">
			and ps.serial_no=#{serialNo,jdbcType=VARCHAR}
		</if>
	</select>
	
		<!-- 新增合大票清单流水  批量-->
	<insert id="addAirPickupbillSerialist" parameterType="java.util.List">
		begin
   		 <foreach collection="list" item="item"  separator=";">
   		 	INSERT INTO TFR.T_OPT_AIR_PICKUPBILL_SERIAL(
   		 		 ID,
   		 		AIR_PIACKUP_DETIAL_ID,
   		 		WAYBILL_NO,
   		 		SERIAL_NO,
   		 		CREATE_TIME,
   		 		NOTES
   		 	)VALUES(
   		 	   	#{item.id jdbcType=VARCHAR},
   		 		#{item.airPickUpDetialId jdbcType=VARCHAR},
   		 		#{item.waybillNo jdbcType=VARCHAR},
   		 		#{item.serialNo jdbcType=VARCHAR},
   		 		sysdate,
   		 		#{item.notes jdbcType=VARCHAR}
   		 	)
   		 </foreach> 
   		 ;end;
	</insert>
		<!-- 删除合大票清单流水  批量-->
	<delete id="deleteAirPickupbillSerialist" parameterType="java.util.List">
		begin
   		 <foreach collection="list" item="item"  separator=";">
   		 	delete from  TFR.T_OPT_AIR_PICKUPBILL_SERIAL s
   		 	where s.WAYBILL_NO =#{item.waybillNo jdbcType=VARCHAR}
   		 	and s.SERIAL_NO =#{item.serialNo jdbcType=VARCHAR}
   		 	and s.AIR_PIACKUP_DETIAL_ID = #{item.airPickUpDetialId jdbcType=VARCHAR}
   		 </foreach> 
   		 ;end;
	</delete>
	
	<!-- 根据运单号查询航空正单流水表 得到航空正单流水信息列表 -->
	<select id="getAirWaySerialListByWaybill" parameterType="map" resultType="String">
		select
			WS.serial_no
		from TFR.t_Opt_Air_Waybill_Serialno WS 
		INNER JOIN TFR.T_OPT_AIR_WAYBILL_DETAIL D
		ON WS.AIR_WAYBILL_DETAIL_ID=D.ID
		AND WS.WAYBILL_NO=D.WAYBILL_NO
		INNER JOIN TFR.t_Opt_Air_Waybill AW 
		ON AW.ID=D.AIR_WAYBILL_ID
		where ws.waybill_no=#{waybillNo,jdbcType=VARCHAR}
		<if test="airWaybillNo !=null and airWaybillNo !='' ">
			and AW.AIR_WAYBILL_NO=#{airWaybillNo,jdbcType=VARCHAR}
		</if>
	</select>
	
	<!-- 根据运单号查询合大票清单明细 -->
	<select id="getAirPickupbillDetailInfo" parameterType="String" resultMap="airPickupReceiverNameResultMap">
		SELECT C.AIR_PICKUPBILL_ID,
			C.ID,
			C.WAYBILL_NO,
			C.ARRV_REGION_NAME,
			C.GOODS_NAME,
			C.GOODS_QTY AS AIRPICK_QTY,
			C.GOODS_QTY AS GOODS_QTY,
			C.WEIGHT,
			C.BILLING_WEIGHT,
			C.BE_TRANSFER,
			C.PICKUP_TYPE,
			C.DELIVER_FEE/100 AS DELIVER_FEE,
			C.ARRIVAL_FEE/100 AS ARRIVAL_FEE,
			C.COLLECTION_FEE/100 AS COLLECTION_FEE,
			C.NOTES,
			C.AIR_WAYBILL_NO,
			C.CURRENCY_CODE,
			C.CREATE_TIME,
			C.RECEIVER_CONTACT_PHONE,
			C.RECEIVER_ADDRESS,
			C.RECEIVER_NAME	
		    FROM TFR.T_OPT_AIR_PICKUPBILL_DETAIL C 
		WHERE C.WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
	</select>
	
	<!-- 根据合大票明细id查询合大票清单明细 311396 wwb -->
	<select id="getAirPickupbillDetailInfoById" parameterType="String" resultMap="airPickupReceiverNameResultMap">
		SELECT 
		<include refid="select_t_opt_air_pickupbill_detail"/>
		    FROM TFR.T_OPT_AIR_PICKUPBILL_DETAIL DETAIL 
		WHERE DETAIL.id = #{id,jdbcType=VARCHAR}
	</select>
	
	<!-- 合大票清单新增时 根据运单号查询 未制作合大票流水信息  352203 wx-->
	<select id="findLeftSerialForModify1" parameterType="map" resultMap="SerialNoMap">
		select
			g.serial_no AS SERIAL_NO,
			g.id AS ID,
			g.waybill_no AS WAYBILL_NO
		from pkp.t_srv_labeled_good g
		where g.waybill_no=#{waybillNo,jdbcType=VARCHAR} and g.active='Y'
			and g.serial_no not in (
				select
					ps.serial_no
				from tfr.t_opt_air_pickupbill_serial ps
				where ps.waybill_no=#{waybillNo,jdbcType=VARCHAR}
				)
	</select>
	
	<!-- 根据运单号查询正单流水  352203 wx-->
	<select id="findPickupbillSerial" parameterType="map" resultMap="SerialNoMap">
		select
			g.serial_no AS SERIAL_NO,
			g.id AS ID,
			g.waybill_no AS WAYBILL_NO
		from pkp.t_srv_labeled_good g
		where g.waybill_no=#{waybillNo,jdbcType=VARCHAR} and g.active='Y'
	</select>
	
	<!-- 根据运单查询已使用的运单流水 352203 wx-->
	<select id="findWaybillSerial" parameterType="map" resultMap="SerialNoMap">
		select
			ps.serial_no AS SERIAL_NO,
			ps.waybill_no AS WAYBILL_NO
		from TFR.T_OPT_AIR_PICKUPBILL_SERIAL ps
		where ps.waybill_no=#{waybillNo,jdbcType=VARCHAR}
	</select>
</mapper>
