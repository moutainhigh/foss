/**
 *  initial comments.
 *  
 *  SR1	页面红色符号“*” 元素都为必填项。
 *  
 *  SR2	提交前系统校验“货物类型名称”如已存在则提示“货物类型已存在！
 *  
 *  	”系统提交失败。其中校验忽略大小写及左右空格。
 *  SR3	提交前系统校验“类型代码”如已存在则提示“类型代码已存在！”系统提交失败。其中校验忽略大小写及左右空格。
 *  
 *  SR4	类型代码生成规则： 参照产品定义中的生成规则，也是由管理员按照协商规则来录入暂规则定位: H+5个数字如：H00001
 *  
 *  SR5	提交货物类型时可选择是否激活来确定该货物类型是否立即可使用，若没有在新增时做激活操作后续在货物类型列表中也可针对未
 *  	做激活的货物类型记录做激活操作。
 *  
 *  SR6	在录入完货物类型信息前台根据所录入的货物编号与名称安全通过校验后，检查是否选择了立即激活,
 *  做激活的货物类型会和去所有已激活的产品进行自动绑定生成条目信息。生成的条目信息如下：产品编号，货物编号，条目名称=产品名称（货物名称），条目编号=由大写字母T+五位数字组成，如：T00001记录每增一条自增1。
 *
 *   *  SR1	页面红色符号“*” 元素都为必填项。
 *  
 *  SR2	提交前系统校验“货物类型名称”如已存在则提示“货物类型已存在！
 *  
 *  	”系统提交失败。其中校验忽略大小写及左右空格。
 *  SR3	提交前系统校验“类型代码”如已存在则提示“类型代码已存在！”系统提交失败。其中校验忽略大小写及左右空格。
 *  
 *  SR4	类型代码生成规则： 参照产品定义中的生成规则，也是由管理员按照协商规则来录入暂规则定位: H+5个数字如：H00001
 *  
 *  SR5	提交货物类型时可选择是否激活来确定该货物类型是否立即可使用，若没有在新增时做激活操作后续在货物类型列表中也可针对未
 *  	做激活的货物类型记录做激活操作。
 *  
 *  SR6	在录入完货物类型信息前台根据所录入的货物编号与名称安全通过校验后，检查是否选择了立即激活,
 *  做激活的货物类型会和去所有已激活的产品进行自动绑定生成条目信息。生成的条目信息如下：产品编号，货物编号，条目名称=产品名称（货物名称），条目编号=由大写字母T+五位数字组成，如：T00001记录每增一条自增1。
 * *  SR1	页面红色符号“*” 元素都为必填项。
 *  
 *  SR2	提交前系统校验“货物类型名称”如已存在则提示“货物类型已存在！
 *  
 *  	”系统提交失败。其中校验忽略大小写及左右空格。
 *  SR3	提交前系统校验“类型代码”如已存在则提示“类型代码已存在！”系统提交失败。其中校验忽略大小写及左右空格。
 *  
 *  SR4	类型代码生成规则： 参照产品定义中的生成规则，也是由管理员按照协商规则来录入暂规则定位: H+5个数字如：H00001
 *  
 *  SR5	提交货物类型时可选择是否激活来确定该货物类型是否立即可使用，若没有在新增时做激活操作后续在货物类型列表中也可针对未
 *  	做激活的货物类型记录做激活操作。
 *  
 *  SR6	在录入完货物类型信息前台根据所录入的货物编号与名称安全通过校验后，检查是否选择了立即激活,
 *  做激活的货物类型会和去所有已激活的产品进行自动绑定生成条目信息。生成的条目信息如下：产品编号，货物编号，条目名称=产品名称（货物名称），条目编号=由大写字母T+五位数字组成，如：T00001记录每增一条自增1。
 * *  SR1	页面红色符号“*” 元素都为必填项。
 *  
 *  SR2	提交前系统校验“货物类型名称”如已存在则提示“货物类型已存在！
 *  
 *  	”系统提交失败。其中校验忽略大小写及左右空格。
 *  SR3	提交前系统校验“类型代码”如已存在则提示“类型代码已存在！”系统提交失败。其中校验忽略大小写及左右空格。
 *  
 *  SR4	类型代码生成规则： 参照产品定义中的生成规则，也是由管理员按照协商规则来录入暂规则定位: H+5个数字如：H00001
 *  
 *  SR5	提交货物类型时可选择是否激活来确定该货物类型是否立即可使用，若没有在新增时做激活操作后续在货物类型列表中也可针对未
 *  	做激活的货物类型记录做激活操作。
 *  
 *  SR6	在录入完货物类型信息前台根据所录入的货物编号与名称安全通过校验后，检查是否选择了立即激活,
 *  做激活的货物类型会和去所有已激活的产品进行自动绑定生成条目信息。生成的条目信息如下：产品编号，货物编号，条目名称=产品名称（货物名称），条目编号=由大写字母T+五位数字组成，如：T00001记录每增一条自增1。
 * *  SR1	页面红色符号“*” 元素都为必填项。
 *  
 *  SR2	提交前系统校验“货物类型名称”如已存在则提示“货物类型已存在！
 *  
 *  	”系统提交失败。其中校验忽略大小写及左右空格。
 *  SR3	提交前系统校验“类型代码”如已存在则提示“类型代码已存在！”系统提交失败。其中校验忽略大小写及左右空格。
 *  
 *  SR4	类型代码生成规则： 参照产品定义中的生成规则，也是由管理员按照协商规则来录入暂规则定位: H+5个数字如：H00001
 *  
 *  SR5	提交货物类型时可选择是否激活来确定该货物类型是否立即可使用，若没有在新增时做激活操作后续在货物类型列表中也可针对未
 *  	做激活的货物类型记录做激活操作。
 *  
 *  SR6	在录入完货物类型信息前台根据所录入的货物编号与名称安全通过校验后，检查是否选择了立即激活,
 *  做激活的货物类型会和去所有已激活的产品进行自动绑定生成条目信息。生成的条目信息如下：产品编号，货物编号，条目名称=产品名称（货物名称），条目编号=由大写字母T+五位数字组成，如：T00001记录每增一条自增1。
 *
 */
/*******************************************************************************
 * Copyright 2013 BSE TEAM
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *    http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 * PROJECT NAME	: pkp-pricing
 * 
 * FILE PATH        	: src/main/java/com/deppon/foss/module/pickup/pricing/server/action/GoodTypeAction.java
 * 
 * FILE NAME        	: GoodTypeAction.java
 * 
 * AUTHOR			: FOSS综合管理开发组
 * 
 * HOME PAGE		:  http://www.deppon.com
 * 
 * COPYRIGHT		: Copyright (c) 2013  Deppon All Rights Reserved.
 ******************************************************************************/
package com.deppon.foss.module.pickup.pricing.server.action;
import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.deppon.foss.framework.exception.BusinessException;
import com.deppon.foss.framework.server.web.action.AbstractAction;
import com.deppon.foss.framework.server.web.result.json.annotation.JSON;
import com.deppon.foss.module.pickup.pricing.api.server.service.IPriceEntryService;
import com.deppon.foss.module.pickup.pricing.api.shared.domain.PriceEntity;
import com.deppon.foss.module.pickup.pricing.api.shared.exception.MessageType;
import com.deppon.foss.module.pickup.pricing.api.shared.vo.PriceEntryVo;
/**
 * 
 * 其他费用计价条目维护
 * @author DP-Foss-YueHongJie
 * @date 2013-3-29 下午5:41:07
 * @version 1.0
 */
public class PriceEntryAction extends AbstractAction {
    	
	/**
	 * 序列化。
	 */
        private static final long serialVersionUID = -3394101122803465667L;
	/**
	 * 
	 * 日志处理
	 *
	 */
	private static final Logger LOGGER = LoggerFactory.getLogger(AirPricePlanAction.class);
	/**
	 * 
	 * VO
	 * 
	 */
	private PriceEntryVo priceEntryVo = new PriceEntryVo();
	/**
	 * 
	 * <p>获得VO</p> 
	 * @author DP-Foss-YueHongJie
	 * @date 2013-3-17 上午10:43:42
	 * @return
	 * @see
	 */
	public PriceEntryVo getPriceEntryVo() {
	    return priceEntryVo;
	}
	/**
	 * 
	 * <p>设置VO</p> 
	 * @author DP-Foss-YueHongJie
	 * @date 2013-3-17 上午10:43:56
	 * @param goodVo
	 * @see
	 */
	public void setPriceEntryVo(PriceEntryVo priceEntryVo) {
	    this.priceEntryVo = priceEntryVo;
	}
	/**
	 *
	 * 服务
	 *
	 */
	private IPriceEntryService priceEntryService;
	/**
	 * 
	 * <p>注入服务</p> 
	 * 
	 * @author DP-Foss-YueHongJie
	 * 
	 * @date 2013-3-17 上午10:44:24
	 * 
	 * @param goodsTypeService
	 * 
	 * @see
	 */
	public void setPriceEntryService(IPriceEntryService priceEntryService) {
		this.priceEntryService = priceEntryService;
	}
	/**
	 * 
	 * <p>查询计价条目信息</p> 
	 * @author DP-Foss-YueHongJie
	 * @date 2013-4-1 上午9:37:31
	 * @return
	 * @see
	 */
	@JSON
	public String searchPriceEntryByCondition() {
		try {
			List<PriceEntity> priceEntryList = priceEntryService.findPriceEntityPagingByCondition(priceEntryVo.getPriceEntity(), start, limit);//根据条件查询
			priceEntryVo.setPriceEntryList(priceEntryList);
			this.setTotalCount(priceEntryService.countPriceEntityPagingByCondition(priceEntryVo.getPriceEntity()));//查询总个数
			return returnSuccess();
		} catch (BusinessException e) {
		    	LOGGER.error("查询计价条目信息: "+e.getMessage());
			return returnError(e);
		}
	}
	/**
	 * 
	 * <p>新增计价条目</p> 
	 * @author DP-Foss-YueHongJie
	 * @date 2013-4-1 上午9:36:47
	 * @return
	 * @see
	 */
	@JSON
	public String addPriceEntry() {
		try {
			priceEntryService.addPriceEntry(priceEntryVo.getPriceEntity());
			return returnSuccess(MessageType.SAVE_SUCCESS);
		} catch (BusinessException e) {
		    	LOGGER.error("新增计价条目: "+e.getMessage());
			return returnError(e);
		}
	}
	/**
	 * 
	 * <p>修改计价条目</p> 
	 * @author DP-Foss-YueHongJie
	 * @date 2013-4-1 上午9:36:17
	 * @return
	 * @see
	 */
	@JSON
	public String updatePriceEntry() {
		try {
			priceEntryService.modifyPriceEntity(priceEntryVo.getPriceEntity());
			return returnSuccess(MessageType.UPDATE_SUCCESS);
		} catch (BusinessException e) {
		    	LOGGER.error("修改计价条目: "+e.getMessage());
			return returnError(e);
		}
	}
 
	/**
	 * 
	 * <p>根据Id查询计价条目</p> 
	 * @author DP-Foss-YueHongJie
	 * @date 2013-4-1 上午9:35:05
	 * @return
	 * @see
	 */
	@JSON
	public String findPriceEntryById() {
		try {
		    	PriceEntity priceEntity = priceEntryService.findPriceEntityById(priceEntryVo.getPriceEntity().getId());
			priceEntryVo.setPriceEntity(priceEntity);
			return returnSuccess();
		} catch (BusinessException e) {
		    	LOGGER.error("根据Id查询计价条目: "+e.getMessage());
			return returnError(e);
		}
	}
	
	/**
	 * 
	 * <p>查询父级费用,用于提供给combox设置</p> 
	 * @author DP-Foss-YueHongJie
	 * @date 2013-4-1 上午9:35:05
	 * @return
	 * @see
	 */
	@SuppressWarnings({ "rawtypes", "unchecked" })
	@JSON
	public String findParentPriceEntry() {
		try {
		    List priceEntryList = priceEntryService.findParentPriceEntitys();
			priceEntryVo.setPriceEntryList(priceEntryList);
			return returnSuccess();
		} catch (BusinessException e) {
		    	LOGGER.error("查询归属级别费用出错: "+e.getMessage());
			return returnError(e);
		}
	}
	
	
}