<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.pkp.WaybillPictureEntityMapper" >
  <resultMap id="BaseResultMap" type="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="WAYBILL_UUID" property="waybillUuid" jdbcType="VARCHAR" />
    <result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
    <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
    <result column="DRIVER_CODE" property="driverCode" jdbcType="VARCHAR" />
    <result column="BIG_GOODS_FLAG" property="bigGoodsFlag" jdbcType="VARCHAR" />
    <result column="CASH_PAY_FLAG" property="cashPayFlag" jdbcType="VARCHAR" />
    <result column="FILE_PATH" property="filePath" jdbcType="VARCHAR" />
    <result column="PENDGING_TYPE" property="pendgingType" jdbcType="VARCHAR" />
    <result column="ACTIVE" property="active" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="CREATE_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
    <result column="MODIFY_USER_CODE" property="modifyUserCode" jdbcType="VARCHAR" />
    <result column="BELONG_ORG_CODE" property="belongOrgCode" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="CLOB"  />
  	<result column="EQUIPMENT_NO" property="equipmentNo" jdbcType="VARCHAR" />
    <result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
 	<result column="RECEIVE_ORG_CODE" property="receiveOrgCode" jdbcType="VARCHAR" />
 	<result column="START_BILL_TIME" property="startBillTime" jdbcType="TIMESTAMP" />
 	<result column="END_BILL_TIME" property="endBillTime" jdbcType="TIMESTAMP" />
  	<result column="BAIDU_ID" property="baiDuId" jdbcType="VARCHAR" />
    <result column="BILL_ORGCODE" property="billOrgCode" jdbcType="VARCHAR" />
    <result column="IS_BIG_UP" property="isBigUp" jdbcType="CHAR" /><!-- 是否大件上楼加收 -->
 	<result column="FH_OT_OVER_QTY" property="fhToOtOverQty" jdbcType="NUMERIC" /><!-- 500KG到1000KG超重件数 -->
 	<result column="OT_TT_OVER_QTY" property="otToTtOverQty" jdbcType="NUMERIC" /><!-- 1000KG到2000KG超重件数 -->
  	<result column="SERVICE_RATE" property="serviceRate" jdbcType="DECIMAL" /><!-- 劳务费费率 -->
    <result column="SERVICE_FEE" property="serviceFee" jdbcType="DECIMAL" /><!-- 劳务费 -->
    <result column="TRUCK_CODE" property="truckCode" jdbcType="VARCHAR" /><!-- 车牌号 -->
    <result column="MOBILE_PHONE" property="mobilephone" jdbcType="VARCHAR" /><!-- 司机手机 -->
    <result column="CLERK_EMP" property="clearEmp" jdbcType="VARCHAR" /><!-- 理货员 -->
    <result column="CLERK_DEPT" property="clearDept" jdbcType="VARCHAR" /><!-- 理货员所在部门 -->
    <result column="IS_EXCEPTION" property="isException" jdbcType="VARCHAR" /><!-- 是否异常 -->
    <result column="MAKEUP_TIME" property="makeupTime" jdbcType="TIMESTAMP" /><!-- 补录时间 -->
	<result column="RECEIVE_ORG_NAME" property="receiveorgname" jdbcType="VARCHAR"/><!--收获部门 -->
    <result column="Bill_Time" property="billtime" jdbcType="TIMESTAMP"/><!-- 开单时间 -->
    <result column="OPERATOR_NAME" property="operatorname" jdbcType="VARCHAR"/><!-- 开单人姓名 -->
    <result column="DRIVER_NAME" property="driverName" jdbcType="VARCHAR" /><!-- 司机姓名 -->
    <result column="LOCAL" property="local" jdbcType="VARCHAR"/><!--是否异地单-->
    <result column="LOCAL_BILLGROUP_CODE" property="localBillGroupCode" jdbcType="VARCHAR" /><!-- 本属开单组 -->
    <result column="IS_EXHIBIT_CARGO" property="isExhibitCargo" jdbcType="CHAR" /><!-- 是否是展货 -->
    <result column="SPECIAL_CUSTOMER" property="specialCustomer" jdbcType="CHAR" /><!-- 特殊客户 -->
    </resultMap>
  <resultMap id="BaseResultList"
		type="com.deppon.foss.module.pickup.waybill.shared.dto.WaybillPictureDto">
		<id column="ID" property="id" jdbcType="VARCHAR" />
		<result column="GOODS_NAME" property="goodsname" jdbcType="VARCHAR"/>
		<result column="DELIVERY_CUSTOMER_CODE" property="deliverycustomercode" jdbcType="VARCHAR"/>
		<result column="Delivery_Customer_Phone" property="deliveryCustomerPhone" jdbcType="VARCHAR"/>
		<result column="Delivery_Customer_Contact" property="deliveryCustomerContact" jdbcType="VARCHAR" />
		<result column="Delivery_Customer_Mobilephone" property="deliveryCustomerMobilephone" jdbcType="VARCHAR"/>
		<result column="Receive_Customer_Contact" property="receiveCustomerContact" jdbcType="VARCHAR"/>
		<result column="Receive_Customer_Mobilephone" property="receiveCustomerMobilephone" jdbcType="VARCHAR"/>
		<result column="Receive_Customer_Address" property="receiveCustomerAddress" jdbcType="VARCHAR"/>
		<result column="Receive_Customer_Phone" property="receiveCustomerPhone" jdbcType="VARCHAR"/>
		<result column="Target_Org_Code" property="targetOrgCode" jdbcType="VARCHAR"/>
		<result column="Inner_Notes" property="innerNotes" jdbcType="VARCHAR"/>
		<result column="Paper_Num" property="strpaperNum" jdbcType="VARCHAR"/>
		<result column="Goods_Qty_Total" property="goodsQtyTotal" jdbcType="INTEGER"/>
		<result column="Goods_Weight_Total" property="dgoodsWeightTotal" jdbcType="DECIMAL"/>
		<result column="Goods_Volume_Total" property="dgoodsVolumeTotal" jdbcType="DECIMAL"/>
		<result column="Insurance_Amount" property="insuranceAmount" jdbcType="INTEGER"/>
		<result column="Cod_Amount" property="codAmount" jdbcType="INTEGER"/>
		<result column="Product_Code" property="productCode" jdbcType="VARCHAR"/>
		<result column="Receive_Method" property="receiveMethod" jdbcType="VARCHAR"/>
		<result column="Order_Paid_Method" property="orderPaidMethod" jdbcType="VARCHAR"/>
		<result column="Goods_Size" property="goodsSize" jdbcType="CLOB"/>
		<result column="Return_Bill_Type" property="returnBillType" jdbcType="VARCHAR"/>
		<result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
		<result column="CHECKBILL_STATUS" property="checkbillstatus"
			jdbcType="CHAR" />
		<result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
		<result column="DRIVER_CODE" property="driverCode" jdbcType="VARCHAR" />
		<result column="DRIVER_NAME" property="driverName" jdbcType="VARCHAR" />
		<result column="Bill_Time" property="billtime" jdbcType="TIMESTAMP" />
		<result column="OPERATOR_NAME" property="operatorname"
			jdbcType="VARCHAR" />
		<result column="TRUCK_CODE" property="truckCode" jdbcType="VARCHAR" />
		<result column="FILE_PATH" property="filePath" jdbcType="VARCHAR" />
		<result column="PENDGING_TYPE" property="pendgingType"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_ORG_NAME" property="receiveorgname"
			jdbcType="VARCHAR" />
		<result column="RECEIVE_ORG_CODE" property="receiveOrgCode"
			jdbcType="VARCHAR" />
		<result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
		<!--是否异地单-->
		<result column="LOCAL" property="local" jdbcType="VARCHAR"/>
		<!-- 本属开单组 -->
    	<result column="LOCAL_BILLGROUP_CODE" property="localBillGroupCode" jdbcType="VARCHAR" />
    	<!-- 胡金洋20160514图片审单添加   退款类型、收款账号、包装手续费、包装备注、装卸费-->
    	<result column="REFUND_TYPE" property="refundType" jdbcType="VARCHAR" />
    	<result column="ACCOUNT_CODE" property="accountCode" jdbcType="VARCHAR" />
    	<result column="PACKAGE_FEE" property="packageFee" jdbcType="VARCHAR" />
    	<result column="PACKAGE_REMARK" property="packageRemark" jdbcType="VARCHAR" />
    	<result column="DC_SERVICEFEE" property="dcServicefee" jdbcType="VARCHAR" />
	</resultMap>
  <resultMap id="PictureWaybillResultMap" type="com.deppon.foss.module.pickup.waybill.shared.vo.SearchPictureVo" >
  		<result column="ID" property="id" jdbcType="VARCHAR" />
	    <result column="WAYBILL_UUID" property="waybillUuid" jdbcType="VARCHAR" />
	  	<result column="NO" property="no" jdbcType="INTEGER" />
	    <result column="WAYBILL_NO" property="waybillNo" jdbcType="VARCHAR" />
	    <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
	    <result column="ACTIVE" property="active" jdbcType="VARCHAR" />
	    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
	    <result column="RECEIVE_ORG_CODE" property="receiveOrgCode" jdbcType="VARCHAR" />
	    <result column="DRIVER_CODE" property="driverWorkNo" jdbcType="VARCHAR" />
	    <result column="DRIVER_NAME" property="driverName" jdbcType="VARCHAR" />
	    <result column="VEHICLE_NO" property="vehicleNo" jdbcType="VARCHAR" />
	    <result column="RECEIVE_ORG_NAME" property="receiveOrgName" jdbcType="VARCHAR" />
	    <result column="FILE_PATH" property="filePath" jdbcType="VARCHAR" />
	    <result column="CREATE_USER_CODE" property="createUserCode" jdbcType="VARCHAR" />
    	<result column="MODIFY_USER_CODE" property="modifyUserCode" jdbcType="VARCHAR" />
    	<result column="BIG_GOODS_FLAG" property="bigGoodsFlag" jdbcType="VARCHAR" />
    	<result column="REMARK" property="reMark" jdbcType="CLOB" />
	    <result column="EQUIPMENT_NO" property="equipmentNo" jdbcType="VARCHAR" />
	    <result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
	    <result column="OPERATOR_NAME" property="operatorName" jdbcType="VARCHAR" />
	    <result column="CASH_PAY_FLAG" property="cashPayFlag" jdbcType="VARCHAR" />
  		<result column="PRODUCT_CODE" property="transportType" jdbcType="VARCHAR" />
	    <result column="IMG_UPLOAD_TIME" property="imgUploadTime" jdbcType="TIMESTAMP" />
	    <result column="CUSTOMER_PICKUP_ORG_NAME" property="distStation" jdbcType="VARCHAR" />
	    <result column="ORG_NAME" property="outerName" jdbcType="VARCHAR" />
	    <result column="outerCode" property="outerOptCode" jdbcType="VARCHAR" />
	    <result column="LOCAL" property="isLocal" jdbcType="VARCHAR" />
	    <result column="LOCAL_BILLGROUP_CODE" property="localBillGroupCode" jdbcType="VARCHAR" />
	    <result column="BELONG_ORG_CODE" property="belongOrgCode" jdbcType="VARCHAR" />
    </resultMap>
  	<resultMap id="WaybillPushMessageResultMap" type="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPushMessageEntity" >
  		<result column="ID" property="id" jdbcType="VARCHAR" />
	    <result column="waybillCode" property="waybillCode" jdbcType="VARCHAR" />
	  	<result column="pushMessage" property="pushMessage" jdbcType="VARCHAR" />
	    <result column="billTime" property="billTime" jdbcType="TIMESTAMP" />
	    <result column="createUserCode" property="createUserCode" jdbcType="VARCHAR" />
	    <result column="createUserName" property="createUserName" jdbcType="VARCHAR" />
	    <result column="createDeptCode" property="createDeptCode" jdbcType="VARCHAR" />
	    <result column="createDeptName" property="createDeptName" jdbcType="VARCHAR" />
	    <result column="phone" property="phone" jdbcType="VARCHAR" />
	    <result column="driverName" property="driverName" jdbcType="VARCHAR" />
    </resultMap>
    <resultMap id="WaybillPictureSendSmsResultMap" type="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureSendSmsEntity" >
  		<result column="ID" property="id" jdbcType="VARCHAR" />
	    <result column="waybill_no" property="waybillNo" jdbcType="VARCHAR" />
	    <result column="job_id" property="jobId" jdbcType="VARCHAR" />
	  	<result column="sms_msg" property="smsMessage" jdbcType="VARCHAR" />
	    <result column="phone" property="phone" jdbcType="VARCHAR" />
	    <result column="create_Time" property="createTime" jdbcType="TIMESTAMP" />
	    <result column="create_User_Code" property="createUserCode" jdbcType="VARCHAR" />
	    <result column="create_User_Name" property="createUserName" jdbcType="VARCHAR" />
	    <result column="create_org_Code" property="createOrgCode" jdbcType="VARCHAR" />
	    <result column="create_org_Name" property="createOrgName" jdbcType="VARCHAR" />
    </resultMap>
    <resultMap id="WaybillPicturePushMessageResultMap" type="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPicturePushMessageEntity" >
  		<result column="ID" property="id" jdbcType="VARCHAR" />
	    <result column="waybill_no" property="waybillNo" jdbcType="VARCHAR" />
	    <result column="job_id" property="jobId" jdbcType="VARCHAR" />
	  	<result column="push_description" property="description" jdbcType="VARCHAR" />
	    <result column="baidu_Id" property="baiduId" jdbcType="VARCHAR" />
	    <result column="create_Time" property="createTime" jdbcType="TIMESTAMP" />
	    <result column="create_User_Code" property="createUserCode" jdbcType="VARCHAR" />
	    <result column="create_User_Name" property="createUserName" jdbcType="VARCHAR" />
	    <result column="create_org_Code" property="createOrgCode" jdbcType="VARCHAR" />
	    <result column="create_org_Name" property="createOrgName" jdbcType="VARCHAR" />
    </resultMap>
    <resultMap id="WaybillPicturePushLogMap" type="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPicturePushLogEntity" >
  		<result column="ID" property="id" jdbcType="VARCHAR" />
	    <result column="waybill_no" property="waybillNo" jdbcType="VARCHAR" />
	    <result column="job_id" property="jobId" jdbcType="VARCHAR" />
	  	<result column="push_type" property="pushType" jdbcType="VARCHAR" />
	    <result column="PUSH_MESSAGE" property="content" jdbcType="CLOB" />
	    <result column="create_Time" property="createTime" jdbcType="TIMESTAMP" />
	    <result column="operate_result" property="operateResult" jdbcType="VARCHAR" />
	    <result column="fail_reason" property="failReason" jdbcType="VARCHAR" />
    </resultMap>
    
    <resultMap id="SubCenterBillOrgDtoMap" type="com.deppon.foss.module.pickup.waybill.shared.dto.SubCenterBillOrgDto" >
    
  		<result column="billingGroupCode" property="billOrgCode" jdbcType="VARCHAR" />
	    <result column="billCount" property="billCount" jdbcType="INTEGER" />
	    <result column="billingAmount" property="peakValue" jdbcType="INTEGER" />
	  	<result column="curPercent" property="curPercent" jdbcType="VARCHAR" />
	  	<result column="localPercent" property="localPercent" jdbcType="VARCHAR" />
	    <result column="isLocal" property="isLocal" jdbcType="VARCHAR" />
	    <result column="queryDate" property="queryDate" jdbcType="VARCHAR" />
    </resultMap>
    
  <sql id="Base_Column_List" >
    ID,WAYBILL_UUID ,WAYBILL_NO,ORDER_NO,DRIVER_CODE ,BIG_GOODS_FLAG,CASH_PAY_FLAG ,FILE_PATH ,
    PENDGING_TYPE ,ACTIVE ,CREATE_TIME,MODIFY_TIME ,CREATE_USER_CODE,MODIFY_USER_CODE,
    belong_org_code,REMARK,EQUIPMENT_NO,OPERATOR,RECEIVE_ORG_CODE,START_BILL_TIME,
    END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,IS_BIG_UP,FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,
    SERVICE_FEE,truck_Code,MOBILE_PHONE,CLERK_EMP,CLERK_DEPT,IS_EXCEPTION,MAKEUP_TIME,LOCAL,LOCAL_BILLGROUP_CODE,
    IS_EXHIBIT_CARGO /** 是否是会展货 */,SPECIAL_CUSTOMER/**是否特殊客户*/
    
  </sql>
  <!--新增 -->
  <insert id="insertWaybillPicture" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" >
    insert into PKP.T_SRV_PIC_WAYBILL_PENDING (ID,WAYBILL_UUID ,WAYBILL_NO,ORDER_NO,DRIVER_CODE ,BIG_GOODS_FLAG,CASH_PAY_FLAG ,FILE_PATH ,
    PENDGING_TYPE ,ACTIVE ,CREATE_TIME,MODIFY_TIME ,CREATE_USER_CODE,MODIFY_USER_CODE,
    BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,
    BAIDU_ID,bill_OrgCode,IS_BIG_UP,FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,truck_Code,mobile_Phone,local,local_BillGroup_Code,IS_EXHIBIT_CARGO,SPECIAL_CUSTOMER/**是否特殊客户*/)
    values (#{id,jdbcType=VARCHAR}, #{waybillUuid,jdbcType=VARCHAR}, #{waybillNo,jdbcType=VARCHAR},#{orderNo,jdbcType=VARCHAR},
    #{driverCode,jdbcType=VARCHAR},#{bigGoodsFlag,jdbcType=VARCHAR},#{cashPayFlag,jdbcType=VARCHAR},#{filePath,jdbcType=VARCHAR},#{pendgingType,jdbcType=VARCHAR},
    #{active,jdbcType=VARCHAR},#{createTime,jdbcType=TIMESTAMP},#{modifyTime,jdbcType=TIMESTAMP},#{createUserCode,jdbcType=VARCHAR},#{modifyUserCode,jdbcType=VARCHAR}
    ,#{belongOrgCode,jdbcType=VARCHAR},#{remark,jdbcType=VARCHAR,typeHandler=org.apache.ibatis.type.ClobTypeHandler},#{equipmentNo,jdbcType=VARCHAR},#{operator,jdbcType=VARCHAR},
    #{receiveOrgCode,jdbcType=VARCHAR},#{startBillTime,jdbcType=TIMESTAMP},#{endBillTime,jdbcType=TIMESTAMP},#{baiDuId,jdbcType=VARCHAR},#{billOrgCode,jdbcType=VARCHAR}
    ,#{isBigUp,jdbcType=CHAR},#{fhToOtOverQty,jdbcType=NUMERIC},#{otToTtOverQty,jdbcType=NUMERIC},#{serviceRate,jdbcType=DECIMAL},
    #{serviceFee,jdbcType=DECIMAL},#{truckCode,jdbcType=VARCHAR},#{mobilephone,jdbcType=VARCHAR},#{local,jdbcType=VARCHAR},#{localBillGroupCode,jdbcType=VARCHAR},#{isExhibitCargo,jdbcType=CHAR},
    #{specialCustomer,jdbcType=CHAR})
  </insert>
  
  <update id="updateWaybillPictureByEntity" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" >
    update PKP.T_SRV_PIC_WAYBILL_PENDING
    <set >
      <if test="waybillNo != null" >
        WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR},
      </if>
      <if test="orderNo != null" >
        ORDER_NO = #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="driverCode != null" >
        DRIVER_CODE = #{driverCode,jdbcType=VARCHAR},
      </if>
      <if test="bigGoodsFlag != null" >
        BIG_GOODS_FLAG = #{bigGoodsFlag,jdbcType=VARCHAR},
      </if>
      <if test="cashPayFlag != null" >
        CASH_PAY_FLAG = #{cashPayFlag,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null" >
        FILE_PATH = #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="pendgingType != null" >
        PENDGING_TYPE = #{pendgingType,jdbcType=VARCHAR},
      </if>
      <if test="active != null" >
        ACTIVE = #{active,jdbcType=VARCHAR},
      </if>
      <if test="modifyTime != null" >
        MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyUserCode != null" >
        MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
      </if>
      <if test="belongOrgCode != null" >
        BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        REMARK = #{remark,jdbcType=VARCHAR,typeHandler=org.apache.ibatis.type.ClobTypeHandler},
      </if>
      <if test="receiveOrgCode != null" >
        RECEIVE_ORG_CODE = #{receiveOrgCode,jdbcType=VARCHAR},
      </if>
       <if test="startBillTime != null" >
        START_BILL_TIME = #{startBillTime,jdbcType=TIMESTAMP},
      </if>
       <if test="endBillTime != null" >
        END_BILL_TIME = #{endBillTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isBigUp != null">
      	IS_BIG_UP = #{isBigUp,jdbcType=CHAR},
      </if>
      <if test="fhToOtOverQty != null">
      	FH_OT_OVER_QTY = #{fhToOtOverQty,jdbcType=NUMERIC},
      </if>
      <if test="otToTtOverQty != null">
      	OT_TT_OVER_QTY = #{otToTtOverQty,jdbcType=NUMERIC},
      </if>
      <if test="serviceRate != null">
      	SERVICE_RATE = #{serviceRate,jdbcType=DECIMAL},
      </if>
      <if test="serviceFee != null">
      	SERVICE_FEE = #{serviceFee,jdbcType=DECIMAL},
      </if>
    </set>
    <where>
		<if test="id != null and id != '' ">
			and ID = #{id,jdbcType=VARCHAR}
		</if>
		<if test="active != null and active != '' ">
			and ACTIVE = #{active,jdbcType=VARCHAR}
		</if>
		<if test="waybillNo != null and waybillNo != '' ">
			and WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
		</if>
		<if test="waybillUuid != null and waybillUuid != '' ">
			and WAYBILL_UUID = #{waybillUuid,jdbcType=VARCHAR}
		</if>
	</where>
  </update>
  
  <delete id="deleteWaybillPictureByWaybillNo" parameterType="java.util.Map" >
    delete from PKP.T_SRV_PIC_WAYBILL_PENDING
    where WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
  </delete>
  
  <delete id="deleteWaybillPictureById" parameterType="java.util.Map" >
    delete from PKP.T_SRV_PIC_WAYBILL_PENDING
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  
  <select id="queryWaybillPictureByEntity" resultMap="BaseResultMap" parameterType="com.deppon.foss.module.pickup.waybill.shared.dto.WaybillPictureDto" >
    select 
    <include refid="Base_Column_List" />
    from PKP.T_SRV_PIC_WAYBILL_PENDING p
    <where>
		<if test="id != null and id != '' ">
			and p.ID = #{id,jdbcType=VARCHAR}
		</if>
		<if test="active != null and active != '' ">
			and p.ACTIVE = #{active,jdbcType=VARCHAR}
		</if>
		<if test="waybillNo != null and waybillNo != '' ">
			and p.WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
		</if>
		<if test="waybillUuid != null and waybillUuid != '' ">
			and p.WAYBILL_UUID = #{waybillUuid,jdbcType=VARCHAR}
		</if>
		<if test="driverCode != null and driverCode != '' ">
			and p.DRIVER_CODE = #{driverCode,jdbcType=VARCHAR}
		</if>
		<if test="belongOrgCode != null and belongOrgCode != '' ">
			and p.BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
		</if>
		<if test="pendgingType != null and pendgingType != '' ">
			and p.PENDGING_TYPE = #{pendgingType,jdbcType=VARCHAR}
		</if>
		<if test="excludePendgingType != null and excludePendgingType != '' ">
			and p.PENDGING_TYPE not in (#{excludePendgingType,jdbcType=VARCHAR})
		</if>
		<if test="includePendgingType != null and includePendgingType != '' ">
			and p.PENDGING_TYPE not in (#{includePendgingType,jdbcType=VARCHAR})
		</if>
		<if test="createTimeStart != null and createTimeStart !=''">	
			<![CDATA[ and p.CREATE_TIME  >=  ]]>
			#{createTimeStart, jdbcType=TIMESTAMP}
		</if>
		<if test="createTimeEnd !=null and createTimeEnd != ''">	
			<![CDATA[ and p.CREATE_TIME  <=  ]]>
			#{createTimeEnd, jdbcType=TIMESTAMP}
		</if>
		<if test="orderNo !=null and orderNo != ''">	
			<![CDATA[ and p.ORDER_NO =  ]]>
			#{orderNo, jdbcType=TIMESTAMP}
		</if>
	</where>
	order by CREATE_TIME ASC
  </select>
  <select id="queryWaybillPictureByEntitycount" resultType="Long" parameterType="com.deppon.foss.module.pickup.waybill.shared.dto.WaybillPictureDto" >
    SELECT 
       count(*)
           FROM PKP.T_SRV_PIC_WAYBILL_PENDING P
           LEFT JOIN PKP.T_SRV_WAYBILL W ON W.WAYBILL_NO = P.WAYBILL_NO
                                        AND W.ACTIVE = 'Y'
           LEFT JOIN BSE.T_BAS_EMPLOYEE E ON E.EMP_CODE = P.DRIVER_CODE
                                         AND E.ACTIVE = 'Y'
           LEFT JOIN BSE.T_BAS_ORG ORG ON ORG.CODE = P.RECEIVE_ORG_CODE
                                      AND ORG.ACTIVE = 'Y'
    <where>
		<if test="waybillNo != null and waybillNo != '' ">
			and p.WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
		</if>
		and p.BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
		<if test="checkbillstatus != null and checkbillstatus != '' ">
			and p.CHECKBILL_STATUS = #{checkbillstatus,jdbcType=VARCHAR}
		</if>
		<if test="checkbillstatus == null ">
			and p.CHECKBILL_STATUS is null
		</if>
		<![CDATA[ and p.CREATE_TIME  >=  ]]>
		#{createTimeStart, jdbcType=TIMESTAMP}
		<![CDATA[ and p.CREATE_TIME  <=  ]]>
		#{createTimeEnd, jdbcType=TIMESTAMP}
		<if test="operator != null and operator != ''">
		  and p.operator = (#{operator,jdbcType=VARCHAR})
		</if>
	  	and  P.ACTIVE = 'Y'
	  	AND P.PENDGING_TYPE IN ( 'PDA_PENDING', 'PDA_ACTIVE')
	</where>
	order by P.CREATE_TIME DESC
  </select>
    <update id="updatePictureWaybillById" parameterType="com.deppon.foss.module.pickup.waybill.shared.dto.WaybillPictureDto" >
          update  pkp.t_srv_pic_waybill_pending  
          <set>
          <if test="checkbillstatus != '' ">
            CHECKBILL_STATUS = #{checkbillstatus,jdbcType=CHAR},
          </if>
          </set>
        WHERE ID = #{id,jdbcType=VARCHAR} AND ACTIVE='Y'
          AND PENDGING_TYPE IN ( 'PDA_PENDING', 'PDA_ACTIVE')
    </update>
 <select id="queryWaybillPictureByEntityList" resultMap="BaseResultList" parameterType="com.deppon.foss.module.pickup.waybill.shared.dto.WaybillPictureDto" >
	SELECT
	w.Delivery_Customer_Contact Delivery_Customer_Contact, 
	w.delivery_customer_phone  Delivery_Customer_Phone,
	w.receive_customer_phone  Receive_Customer_Phone ,
	w.DELIVERY_CUSTOMER_MOBILEPHONE DELIVERY_CUSTOMER_MOBILEPHONE, 
	w.RECEIVE_CUSTOMER_CONTACT RECEIVE_CUSTOMER_CONTACT, 
	w.RECEIVE_CUSTOMER_MOBILEPHONE RECEIVE_CUSTOMER_MOBILEPHONE, 
	(select t.name from bse.t_Bas_District t where t.code = w.RECEIVE_CUSTOMER_PROV_CODE and t.active ='Y')||
    (select t.name from bse.t_Bas_District t where t.code = w.RECEIVE_CUSTOMER_CITY_CODE and t.active ='Y')||
    (select t.name from bse.t_Bas_District t where t.code = w.RECEIVE_CUSTOMER_DIST_CODE and t.active ='Y')||
    w.RECEIVE_CUSTOMER_ADDRESS RECEIVE_CUSTOMER_ADDRESS,
	w.Target_Org_Code Target_Org_Code, 
	w.INNER_NOTES INNER_NOTES, 
	w.goods_package PAPER_NUM,
	w.GOODS_NAME GOODS_NAME,
	w.DELIVERY_CUSTOMER_CODE DELIVERY_CUSTOMER_CODE,
	w.GOODS_QTY_TOTAL GOODS_QTY_TOTAL,
	w.GOODS_WEIGHT_TOTAL GOODS_WEIGHT_TOTAL ,
	w.GOODS_VOLUME_TOTAL GOODS_VOLUME_TOTAL, 
	w.INSURANCE_AMOUNT/100 INSURANCE_AMOUNT, 
	w.COD_AMOUNT COD_AMOUNT,
	w.PRODUCT_CODE PRODUCT_CODE,
	w.Receive_Method Receive_Method , 
	w.PAID_METHOD ORDER_PAID_METHOD, 
	w.Goods_Size Goods_Size,
	w.Return_Bill_Type Return_Bill_Type, 
	P.ID ID,
	P.WAYBILL_NO WAYBILL_NO,
	P.ORDER_NO ORDER_NO,
	P.FILE_PATH FILE_PATH,
	P.RECEIVE_ORG_CODE RECEIVE_ORG_CODE,
	ORG.NAME RECEIVE_ORG_NAME,
	W.Bill_Time Bill_Time,
	W.create_user_code OPERATOR,
	W.create_user_name OPERATOR_NAME,
	p.pendging_type PENDGING_TYPE ,
	P.DRIVER_CODE DRIVER_CODE,
	E.EMP_NAME DRIVER_NAME,
	p.truck_code TRUCK_CODE,
	p.checkbill_status CHECKBILL_STATUS,
	p.LOCAL,
	p.LOCAL_BILLGROUP_CODE,
	<!-- 胡金洋20160514图片审单添加   退款类型、收款账号、包装手续费、包装备注、装卸费-->
	(CASE WHEN W.REFUND_TYPE = 'RA' THEN '审核退' WHEN  W.REFUND_TYPE = 'R1' THEN '即日退' WHEN W.REFUND_TYPE = 'R3' THEN '三日退' ELSE '' END) REFUND_TYPE,
  W.ACCOUNT_CODE,
  W.PACKAGE_FEE,
  F.PACKAGE_REMARK,
  F.DC_SERVICEFEE
	
	FROM PKP.T_SRV_PIC_WAYBILL_PENDING P
	LEFT JOIN PKP.T_SRV_WAYBILL W ON W.WAYBILL_NO = P.WAYBILL_NO
	AND W.ACTIVE = 'Y'
	LEFT JOIN  PKP.T_SRV_ACTUAL_FREIGHT F ON F.WAYBILL_NO=P.WAYBILL_NO 
	LEFT JOIN BSE.T_BAS_EMPLOYEE E ON E.EMP_CODE = P.DRIVER_CODE
	AND E.ACTIVE = 'Y'
	LEFT JOIN BSE.T_BAS_ORG ORG ON ORG.CODE = P.RECEIVE_ORG_CODE
	AND ORG.ACTIVE = 'Y'
    <where>
		<if test="waybillNo != null and waybillNo != '' ">
			and p.WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR}
		</if>
		and p.BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
		<if test="checkbillstatus != null and checkbillstatus != '' ">
			and p.CHECKBILL_STATUS = #{checkbillstatus,jdbcType=CHAR}
		</if>
		<if test="checkbillstatus == null">
			and p.CHECKBILL_STATUS is  null
		</if>
		<![CDATA[ and p.CREATE_TIME  >=  ]]>
		#{createTimeStart, jdbcType=TIMESTAMP}
		<![CDATA[ and p.CREATE_TIME  <=  ]]>
		#{createTimeEnd, jdbcType=TIMESTAMP}
		<if test="operator != null and operator != ''">
		  and p.operator = (#{operator,jdbcType=VARCHAR})
		</if>
	    and  P.ACTIVE = 'Y'
	    AND P.PENDGING_TYPE IN ( 'PDA_PENDING', 'PDA_ACTIVE')
	</where>
	order by P.CREATE_TIME DESC
  </select>
   <select id="findWaybillPictureOne" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
		SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
  		CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
  		CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
  		RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,IS_BIG_UP,
	 	FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,IS_EXHIBIT_CARGO /** 是否是会展货 */
		FROM (SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
  		CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
  		CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
  		RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,IS_BIG_UP,
  		FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,TRUCK_CODE,MOBILE_PHONE,
  		IS_EXHIBIT_CARGO /** 是否是会展货 */
		FROM PKP.T_SRV_PIC_WAYBILL_PENDING
  		WHERE ACTIVE = 'Y' 
  		AND PENDGING_TYPE = 'PENDING'
  		AND REMARK  IS  NULL 
  		<!--20160528   hujinyang新增 -->
        <if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
		</if>
  		AND BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
  		ORDER BY CREATE_TIME ASC)
  		WHERE ROWNUM = 1  
  </select>
  
    <select id="findWaybillPictureByReturnType" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
		<![CDATA[SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
        CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
        CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
        RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,IS_BIG_UP,
        FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,
        IS_EXHIBIT_CARGO /** 是否是会展货 */
        FROM (SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
        CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
        CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
        RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,IS_BIG_UP,
        FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,TRUCK_CODE,MOBILE_PHONE,
        IS_EXHIBIT_CARGO /** 是否是会展货 */
        FROM PKP.T_SRV_PIC_WAYBILL_PENDING p
        WHERE ACTIVE = 'Y' 
        AND PENDGING_TYPE = 'PENDING'
        AND REMARK  IS  NULL 
        ]]>
        <!--20160528   hujinyang新增 -->
        <if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
		</if>
		<![CDATA[
		and 0 < (select count(*) from PKP.T_SRV_PIC_WAYBILL_PENDING pp where pp.waybill_no=p.waybill_no and pp.pendging_type='RETURN')
        AND BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
        ORDER BY CREATE_TIME ASC)
        WHERE ROWNUM = 1 
        ]]>
  </select>
  
  <select id="findWaybillPictureAndGigGoodsFlagAndCashPayFlag" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
  		SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
   		CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
   		CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
   		RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,IS_BIG_UP,
	 	FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,
   		IS_EXHIBIT_CARGO /** 是否是会展货 */
   		FROM (SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
   		CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
   		CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
   		RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,
   		IS_BIG_UP,FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,TRUCK_CODE,MOBILE_PHONE,
   		IS_EXHIBIT_CARGO /** 是否是会展货 */
  		FROM PKP.T_SRV_PIC_WAYBILL_PENDING
  		WHERE ACTIVE = 'Y' 
  		AND PENDGING_TYPE = 'PENDING'
  		AND REMARK  IS  NULL 
  		<!--20160528   hujinyang新增 -->
        <if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
		</if>
	  	AND (BIG_GOODS_FLAG = 'Y' OR CASH_PAY_FLAG = 'Y')
	  	AND BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
  		ORDER BY CREATE_TIME ASC)
  		WHERE ROWNUM = 1
  </select>
  
  <select id="findWaybillPictureAndIsExhibitCargo" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
  		SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
   		CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
   		CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
   		RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,IS_BIG_UP,
	 	FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,
   		IS_EXHIBIT_CARGO /** 是否是会展货 */
   		FROM (SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
   		CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
   		CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
   		RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,
   		IS_BIG_UP,FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,TRUCK_CODE,MOBILE_PHONE,
   		IS_EXHIBIT_CARGO /** 是否是会展货 */
  		FROM PKP.T_SRV_PIC_WAYBILL_PENDING
  		WHERE ACTIVE = 'Y' 
  		AND PENDGING_TYPE = 'PENDING'
  		AND REMARK  IS  NULL 
  		<!--20160528   hujinyang新增 -->
        <if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
		</if>
	  	AND IS_EXHIBIT_CARGO = 'Y' 
	  	AND BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
  		ORDER BY CREATE_TIME ASC)
  		WHERE ROWNUM = 1
  </select>

   <select id="findWaybillPictureByOperator" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
  			SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
	 	   	CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
	 	   	CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
	 	   	RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,IS_BIG_UP,
	 	   	FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,IS_EXHIBIT_CARGO /** 是否是会展货 */
	 	   	FROM (SELECT ID,WAYBILL_UUID,WAYBILL_NO,ORDER_NO,DRIVER_CODE,BIG_GOODS_FLAG,
	 	   	CASH_PAY_FLAG,FILE_PATH,PENDGING_TYPE,ACTIVE,CREATE_TIME,MODIFY_TIME,
	 	   	CREATE_USER_CODE,MODIFY_USER_CODE,BELONG_ORG_CODE,REMARK,EQUIPMENT_NO,OPERATOR,
	 	   	RECEIVE_ORG_CODE,START_BILL_TIME,END_BILL_TIME,BAIDU_ID,BILL_ORGCODE,IS_BIG_UP,
	 	   	FH_OT_OVER_QTY,OT_TT_OVER_QTY,SERVICE_RATE,SERVICE_FEE,TRUCK_CODE,MOBILE_PHONE,
	 	   	IS_EXHIBIT_CARGO /** 是否是会展货 */
	  		FROM PKP.T_SRV_PIC_WAYBILL_PENDING
	  		WHERE ACTIVE = 'Y' 
  			AND PENDGING_TYPE = 'DISTRIBUTED'
  			AND OPERATOR = #{operator,jdbcType=VARCHAR}
  			AND REMARK  IS  NULL 
  			<!--20160528   hujinyang新增 -->
  			<if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
			</if>
			 
  			AND BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
  			ORDER BY CREATE_TIME ASC)
  			WHERE ROWNUM = 1 
  </select>
  
  <select id="findWaybillPictureCount" resultType="Integer" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity">
  		<![CDATA[
	  		SELECT COUNT(*)
	  		FROM PKP.T_SRV_PIC_WAYBILL_PENDING
	  		WHERE ACTIVE = 'Y' 
	  		AND (PENDGING_TYPE = 'PENDING' OR (PENDGING_TYPE = 'DISTRIBUTED' AND OPERATOR = #{operator,jdbcType=VARCHAR}))
	  		AND BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
  		]]>
  </select>
  
  <update id="updateWaybillPicture" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" >
  	update PKP.T_SRV_PIC_WAYBILL_PENDING
  	<set >
  	  <if test="waybillUuid != null">
		WAYBILL_UUID = #{waybillUuid,jdbcType=VARCHAR},
	  </if>
      <if test="waybillNo != null" >
        WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR},
      </if>
      <if test="orderNo != null" >
        ORDER_NO = #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="driverCode != null" >
        DRIVER_CODE = #{driverCode,jdbcType=VARCHAR},
      </if>
      <if test="bigGoodsFlag != null" >
        BIG_GOODS_FLAG = #{bigGoodsFlag,jdbcType=VARCHAR},
      </if>
      <if test="cashPayFlag != null" >
        CASH_PAY_FLAG = #{cashPayFlag,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null" >
        FILE_PATH = #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="pendgingType != null" >
        PENDGING_TYPE = #{pendgingType,jdbcType=VARCHAR},
      </if>
      <if test="active != null" >
        ACTIVE = #{active,jdbcType=VARCHAR},
      </if>
      <if test="modifyTime != null" >
        MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyUserCode != null" >
        MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
      </if>
      <if test="belongOrgCode != null" >
        BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        REMARK = #{remark,jdbcType=VARCHAR,typeHandler=org.apache.ibatis.type.ClobTypeHandler},
      </if>
      <if test="receiveOrgCode != null" >
        RECEIVE_ORG_CODE = #{receiveOrgCode,jdbcType=VARCHAR},
      </if>
       <if test="startBillTime != null" >
        START_BILL_TIME = #{startBillTime,jdbcType=TIMESTAMP},
      </if>
       <if test="endBillTime != null" >
        END_BILL_TIME = #{endBillTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operator != null" >
        OPERATOR = #{operator,jdbcType=TIMESTAMP},
      </if>
       <if test="isBigUp != null">
      	IS_BIG_UP = #{isBigUp,jdbcType=CHAR},
      </if>
      <if test="fhToOtOverQty != null">
      	FH_OT_OVER_QTY = #{fhToOtOverQty,jdbcType=NUMERIC},
      </if>
      <if test="otToTtOverQty != null">
      	OT_TT_OVER_QTY = #{otToTtOverQty,jdbcType=NUMERIC},
      </if>
      <if test="serviceRate != null">
      	SERVICE_RATE = #{serviceRate,jdbcType=DECIMAL},
      </if>
      <if test="serviceFee != null">
      	SERVICE_FEE = #{serviceFee,jdbcType=DECIMAL},
      </if>
      <if test="local != null">
      	LOCAL = #{local,jdbcType=CHAR},
      </if>
    </set>
    WHERE ID = #{id,jdbcType=VARCHAR} AND ACTIVE='Y'
  </update>
  
   <update id="updatePictureWaybillByWaybillno" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" >
  	update PKP.T_SRV_PIC_WAYBILL_PENDING
  	<set >
  	  <if test="waybillUuid != null">
		WAYBILL_UUID = #{waybillUuid,jdbcType=VARCHAR},
	  </if>
      <if test="waybillNo != null" >
        WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR},
      </if>
      <if test="orderNo != null" >
        ORDER_NO = #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="driverCode != null" >
        DRIVER_CODE = #{driverCode,jdbcType=VARCHAR},
      </if>
      <if test="bigGoodsFlag != null" >
        BIG_GOODS_FLAG = #{bigGoodsFlag,jdbcType=VARCHAR},
      </if>
      <if test="cashPayFlag != null" >
        CASH_PAY_FLAG = #{cashPayFlag,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null" >
        FILE_PATH = #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="pendgingType != null" >
        PENDGING_TYPE = #{pendgingType,jdbcType=VARCHAR},
      </if>
      <if test="active != null" >
        ACTIVE = #{active,jdbcType=VARCHAR},
      </if>
      <if test="modifyTime != null" >
        MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyUserCode != null" >
        MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
      </if>
      <if test="belongOrgCode != null" >
        BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        REMARK = #{remark,jdbcType=VARCHAR,typeHandler=org.apache.ibatis.type.ClobTypeHandler},
      </if>
      <if test="receiveOrgCode != null" >
        RECEIVE_ORG_CODE = #{receiveOrgCode,jdbcType=VARCHAR},
      </if>
       <if test="startBillTime != null" >
        START_BILL_TIME = #{startBillTime,jdbcType=TIMESTAMP},
      </if>
       <if test="endBillTime != null" >
        END_BILL_TIME = #{endBillTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operator != null" >
        OPERATOR = #{operator,jdbcType=TIMESTAMP},
      </if>
      <if test="billOrgCode !=null">
        bill_OrgCode = #{billOrgCode,jdbcType=VARCHAR},
      </if>
      <if test="isBigUp !=null">
      	IS_BIG_UP = #{isBigUp,jdbcType=CHAR},
      </if>
      <if test="fhToOtOverQty !=null">
      	FH_OT_OVER_QTY =#{fhToOtOverQty,jdbcType=NUMERIC},
      </if>
      <if test="otToTtOverQty !=null">
       OT_TT_OVER_QTY =#{otToTtOverQty,jdbcType=NUMERIC},
      </if>
      <if test="serviceRate !=null">
       SERVICE_RATE =#{serviceRate,jdbcType=DECIMAL},
      </if>
      <if test="serviceFee !=null">
      	SERVICE_FEE =#{serviceFee,jdbcType=DECIMAL},
      </if>
      <if test="truckCode !=null">
      	TRUCK_CODE =#{truckCode,jdbcType=VARCHAR},
      </if>
      <if test="mobilephone !=null">
      	mobile_phone =#{mobilephone,jdbcType=VARCHAR},
      </if>
      <if test="clearEmp !=null">
		CLERK_EMP =#{clearEmp,jdbcType=VARCHAR},
	 </if>
	  <if test="clearDept !=null">
		CLERK_DEPT =#{clearDept,jdbcType=VARCHAR},
	 </if>
	 <if test="isException !=null">
		IS_EXCEPTION =#{isException,jdbcType=VARCHAR},
	 </if>
	 <if test="makeupTime !=null">
		MAKEUP_TIME  =#{makeupTime,jdbcType=TIMESTAMP},
	 </if>
	  <if test="local != null">
      	LOCAL = #{local,jdbcType=CHAR},
      </if>
    </set>
    WHERE WAYBILL_NO = #{waybillNo,jdbcType=VARCHAR} AND ACTIVE='Y'
  </update>
  
  <select id="searchPictureWaybillByCondiction" resultMap="PictureWaybillResultMap"
		parameterType="com.deppon.foss.module.pickup.waybill.shared.dto.SearchPictureWaybillCondiction">
		SELECT
		ROWNUM NO,
		X.ID,
		X.WAYBILL_UUID,
		X.WAYBILL_NO,
		X.ORDER_NO,
		X.FILE_PATH,
		X.ACTIVE,
		X.DRIVER_CODE,
		X.DRIVER_NAME,
		X.VEHICLE_NO,
		X.RECEIVE_ORG_CODE,
		X.RECEIVE_ORG_NAME,
		X.CREATE_TIME,
		X.CREATE_USER_CODE,
		X.MODIFY_USER_CODE,
		X.BIG_GOODS_FLAG,
		X.REMARK,
		X.EQUIPMENT_NO,
		X.OPERATOR,
		X.OPERATOR_NAME,
		X.CASH_PAY_FLAG,
		X.IMG_UPLOAD_TIME,
		X.PRODUCT_CODE,
		X.CUSTOMER_PICKUP_ORG_NAME,
		X.ORG_NAME,
		X.outerCode,
		X.LOCAL_BILLGROUP_CODE,
		X.BELONG_ORG_CODE
		FROM (
		SELECT
		P.ID ID,
		P.WAYBILL_UUID WAYBILL_UUID,
		P.WAYBILL_NO WAYBILL_NO,
		P.ORDER_NO ORDER_NO,
		P.FILE_PATH FILE_PATH,
		P.PENDGING_TYPE ACTIVE,
		P.DRIVER_CODE DRIVER_CODE,
		E.EMP_NAME DRIVER_NAME,
		p.truck_code VEHICLE_NO,
		P.RECEIVE_ORG_CODE RECEIVE_ORG_CODE,
		ORG.NAME RECEIVE_ORG_NAME,
		NVL(P.MODIFY_TIME,P.CREATE_TIME) CREATE_TIME,
		P.CREATE_USER_CODE CREATE_USER_CODE,
		P.MODIFY_USER_CODE MODIFY_USER_CODE,
		P.BIG_GOODS_FLAG BIG_GOODS_FLAG,
		P.REMARK REMARK,
		P.EQUIPMENT_NO EQUIPMENT_NO,
		/**修改当运单表中没有创建人，取图片开单表的数据*/
		nvl(W.CREATE_USER_CODE,P.OPERATOR) OPERATOR,
		EM.EMP_NAME OPERATOR_NAME,
		P.CASH_PAY_FLAG CASH_PAY_FLAG,
		P.CREATE_TIME IMG_UPLOAD_TIME,
		W.PRODUCT_CODE,
        TORG.NAME CUSTOMER_PICKUP_ORG_NAME,
        ORG.NAME ORG_NAME,
        W.CREATE_USER_CODE outerCode,
         (case when PENDGING_TYPE = 'PENDING' and p.remark is not null then  1  when PENDGING_TYPE = 'PDA_PENDING' and p.remark is not null then  2 else 3 end)  orderRed,
        P.LOCAL_BILLGROUP_CODE  LOCAL_BILLGROUP_CODE,
        P.BELONG_ORG_CODE BELONG_ORG_CODE
		FROM PKP.T_SRV_PIC_WAYBILL_PENDING P
		LEFT JOIN PKP.T_SRV_WAYBILL W ON W.WAYBILL_NO = P.WAYBILL_NO AND W.ACTIVE='Y'
		LEFT JOIN BSE.T_BAS_EMPLOYEE E ON E.EMP_CODE = P.DRIVER_CODE AND E.ACTIVE='Y'
		/**修改当运单表中没有创建人，取图片开单表的数据*/
		LEFT JOIN BSE.T_BAS_EMPLOYEE EM ON EM.EMP_CODE = nvl(W.CREATE_USER_CODE,P.OPERATOR) AND EM.ACTIVE='Y'
		LEFT JOIN BSE.T_BAS_ORG ORG ON ORG.CODE=P.RECEIVE_ORG_CODE AND ORG.ACTIVE='Y'
		LEFT JOIN BSE.T_BAS_ORG TORG ON TORG.CODE = W.CUSTOMER_PICKUP_ORG_CODE AND TORG.ACTIVE = 'Y' 
		<include refid="pictureWaybillQueryCondition" />
		Order By orderRed ASC,P.CREATE_TIME DESC
		) X
  </select>
  
  <sql id="pictureWaybillQueryCondition">
		<where>
			<![CDATA[ P.PENDGING_TYPE <> 'CANCEL' AND P.ACTIVE='Y' ]]>
			<!-- 运单号 -->
			<if test="mixNo != null">
				and p.WAYBILL_NO = #{mixNo,jdbcType=VARCHAR}
			</if>
			<!-- 订单号 -->
			<if test="orderNo != null">
				and p.ORDER_NO = #{orderNo,jdbcType=VARCHAR}
			</if>
			<!-- 开单人 -->
			<if test="operator != null">
				and p.OPERATOR = #{operator,jdbcType=VARCHAR}
			</if>
			<!-- 收货部门 -->
			<if test="receiveOrgCode != null">
				<if test="isAll == 'Y'.toString()">
					<![CDATA[
						AND (nvl(w.create_org_code,P.BELONG_ORG_CODE) =  #{receiveOrgCode,jdbcType=VARCHAR} 
						or
					  (P.LOCAL_BILLGROUP_CODE=  #{receiveOrgCode,jdbcType=VARCHAR} and  P.PENDGING_TYPE='WAYBILL_EXCEPTION')
					  	OR 
					  P.LOCAL_BILLGROUP_CODE= #{receiveOrgCode,jdbcType=VARCHAR}
					  )
					  
					]]>
				</if>
				<if test="isAll == 'N'.toString()">
						AND P.RECEIVE_ORG_CODE =  #{receiveOrgCode,jdbcType=VARCHAR}
				</if>
			</if>
			
			<!-- 运单图片类型 -->
			<if test="waybillPictureType != null and waybillPictureType.size() > 0">
				AND P.PENDGING_TYPE IN
				<foreach collection="waybillPictureType" open="(" close=")" separator=","	item="picType">
							#{picType,jdbcType=VARCHAR}
				</foreach>
			</if>
			
			<!-- 运输性质 -->
			<if test="transType != null">
				AND W.PRODUCT_CODE  =#{transType,jdbcType=VARCHAR}
			</if>
			
			<!-- 开妈时间 -->
			<if test="createStartTime != null">
				<![CDATA[AND NVL(P.MODIFY_TIME,P.CREATE_TIME) >= #{createStartTime,jdbcType=TIMESTAMP}]]>
			</if>
			<!-- 结束时间 -->
			<if test="createEndTime != null">
				<![CDATA[AND NVL(P.MODIFY_TIME,P.CREATE_TIME) <= #{createEndTime,jdbcType=TIMESTAMP}]]>
			</if>
			<if test="driverWorkNo != null">
				AND P.DRIVER_CODE = #{driverWorkNo,jdbcType=VARCHAR}
			</if>
			<if test="driverName != null">
				AND E.EMP_NAME = #{driverName,jdbcType=VARCHAR}
			</if>
		</where>
	</sql>
	
	<insert id="insertWaybillPDAWoodenRequireEntity" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.PDAWoodenRequireEntity" >
    	insert into  PKP.T_SRV_WOODENREQUIRE ( ID ,
                                           waybill_no ,
                                           operator_code,  
                                           outer_code ,
                                           IS_BIG_UP ,
                                           FH_OT_OVER_QTY,
                                           OT_TT_OVER_QTY,
                                           GOODS_WEIGHT_TOTAL,
                                           GOODS_VOLUME_TOTAL,
                                           WOODEN_NUM,
                                           GOODSNUM,
                                           LENGTH,
                                           WIDTH,
                                           HEIGHT,
                                           PACKTYPE,
                                           CREATE_TIME)
                               values (#{id,jdbcType=VARCHAR},
                                       #{waybillNo,jdbcType=VARCHAR}, 
                                       #{operatorCode,jdbcType=VARCHAR},
                                       #{outerCode,jdbcType=VARCHAR},
                                       #{isBigUp,jdbcType=VARCHAR},
                                       #{fhToOtOverQty,jdbcType=NUMERIC},
                                       #{otToTtOverQty,jdbcType=NUMERIC},
                                       #{goodsWeightTotal,jdbcType=DECIMAL},
                                       #{goodsVolumeTotal,jdbcType=DECIMAL},
                                       #{woodenStockNum,jdbcType=NUMERIC},
                                       #{goodsNum,jdbcType=NUMERIC},
                                       #{length,jdbcType=DECIMAL},
                                       #{width,jdbcType=DECIMAL},
                                       #{height,jdbcType=DECIMAL},
                                       #{packType,jdbcType=VARCHAR},
                                       SYSDATE )
  </insert>
  <insert id="insertWaybillPushMessageEntity" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPushMessageEntity" >
    	insert into  PKP.T_SRV_WAYBILLpushMessage ( ID ,
                                           waybillCode ,
	                                       pushMessage,  
	                                       pushStatus ,
                                           createTime ,
                                           billTime,
                                           createUserCode,
                                           createUserName,
                                           createDeptCode,
                                           createDeptName,
                                           phone,
                                           driverName,
                                           active)
                               values (#{id,jdbcType=VARCHAR},
                                       #{waybillCode,jdbcType=VARCHAR}, 
                                       #{pushMessage,jdbcType=VARCHAR},
                                       #{pushStatus,jdbcType=VARCHAR},
                                       SYSDATE,
                                       #{billTime,jdbcType=TIMESTAMP},
                                       #{createUserCode,jdbcType=VARCHAR},
                                       #{createUserName,jdbcType=VARCHAR},
                                       #{createDeptCode,jdbcType=VARCHAR},
                                       #{createDeptName,jdbcType=VARCHAR},
                                       #{phone,jdbcType=VARCHAR},
                                       #{driverName,jdbcType=VARCHAR},
                                       'Y' )
  </insert>
  <delete id="delWaybillPushMessageEntity" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPushMessageEntity" >
    delete from PKP.T_SRV_WAYBILLpushMessage
    where waybillCode = #{waybillCode,jdbcType=VARCHAR}
  </delete>
  <select id="queryWaybillPushMessageEntity" resultMap="WaybillPushMessageResultMap" parameterType="java.lang.Integer" >
		select p.*
		FROM PKP.T_SRV_WAYBILLpushMessage P where <![CDATA[ p.createtime <= SYSDATE-#{min}/60/24 and  p.createTime>=trunc(SYSDATE)]]> 
  </select>
  
  <insert id="insertWaybillPicturePushMessage" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPicturePushMessageEntity" >
    	insert into  pkp.t_srv_pic_push_msg 
	    	(id,
	    	 job_id,
		     waybill_no,
		     baidu_id,
		     push_description,
		     create_time,
		     create_user_code,
		     create_user_name,
		     create_org_code,
		     create_org_name)
         values (#{id,jdbcType=VARCHAR},
         	 #{jobId,jdbcType=VARCHAR},
             #{waybillNo,jdbcType=VARCHAR}, 
             #{baiduId,jdbcType=VARCHAR},
             #{description,jdbcType=VARCHAR},
             #{createTime,jdbcType=TIMESTAMP},
             #{createUserCode,jdbcType=VARCHAR},
             #{createUserName,jdbcType=VARCHAR},
             #{createOrgCode,jdbcType=VARCHAR},
             #{createOrgName,jdbcType=VARCHAR})
  </insert>
  <insert id="insertWaybillPictureSendSms" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureSendSmsEntity" >
    	insert into  pkp.t_srv_pic_send_msg 
	    	(id,
	    	 job_id,
		     waybill_no,
		     sms_msg,
		     phone,
		     create_time,
		     create_user_code,
		     create_user_name,
		     create_org_code,
		     create_org_name)
         values (#{id,jdbcType=VARCHAR},
         	 #{jobId,jdbcType=VARCHAR},
             #{waybillNo,jdbcType=VARCHAR}, 
             #{smsMessage,jdbcType=VARCHAR},
             #{phone,jdbcType=VARCHAR},
             #{createTime,jdbcType=TIMESTAMP},
             #{createUserCode,jdbcType=VARCHAR},
             #{createUserName,jdbcType=VARCHAR},
             #{createOrgCode,jdbcType=VARCHAR},
             #{createOrgName,jdbcType=VARCHAR})
  </insert>
  <delete id="deleteWaybillPicturePushMessage" parameterType="java.lang.String" >
    delete from PKP.t_srv_pic_push_msg
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteWaybillPictureSendSms" parameterType="java.lang.String" >
    delete from PKP.t_srv_pic_send_msg
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <update id="updatePushMessageByRowNum" parameterType="com.deppon.foss.module.pickup.waybill.shared.vo.WaybillPicturePushVo" >  
  	update PKP.t_srv_pic_push_msg 	
	  	<set>
	      	JOB_ID=#{jobId,jdbcType=VARCHAR}
	    </set>
		<where>
			rownum <![CDATA[ <=]]> #{queryNum,jdbcType=VARCHAR} 
			<if test="queryJobId != null">
				AND JOB_ID=#{queryJobId,jdbcType=VARCHAR}
			</if>
			<if test="id != null">
				AND id=#{id,jdbcType=VARCHAR}
			</if>
		</where>
		
  </update>
  <update id="updateSendSmsByRowNum" parameterType="com.deppon.foss.module.pickup.waybill.shared.vo.WaybillPicturePushVo" >  
  	update PKP.t_srv_pic_send_msg 	
	  	<set>
	      	JOB_ID=#{jobId,jdbcType=VARCHAR}
	    </set>
		<where>
			rownum <![CDATA[ <=]]> #{queryNum,jdbcType=VARCHAR} 
			<if test="queryJobId != null">
				AND JOB_ID=#{queryJobId,jdbcType=VARCHAR}
			</if>
			<if test="id != null">
				AND id=#{id,jdbcType=VARCHAR}
			</if>
		</where>
  </update>
  <select id="queryWaybillPicturePushMessageByJobId" resultMap="WaybillPicturePushMessageResultMap" parameterType="java.lang.String" >
		select p.*
		FROM PKP.t_srv_pic_push_msg  P 
		where job_id=#{queryJobId,jdbcType=VARCHAR}
  </select>
  <select id="queryWaybillPictureSendSmsByJobId" resultMap="WaybillPictureSendSmsResultMap" parameterType="java.lang.String" >
		select p.*
		FROM PKP.T_SRV_PIC_SEND_MSG  P 
		where job_id=#{queryJobId,jdbcType=VARCHAR}
  </select>
  
  <!--新增 日志-->
  <insert id="insertWaybillPicturePushLog" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPicturePushLogEntity" >
    insert into pkp.t_srv_pic_push_log
		  (id,
		   job_id,
		   waybill_no,
		   push_type,
		   PUSH_MESSAGE,
		   CREATE_TIME,
		   create_user_code,
		   operate_result,
		   FAIL_REASON)
		values
		  (#{id,jdbcType=VARCHAR},
		  #{jobId,jdbcType=VARCHAR},
		  #{waybillNo,jdbcType=VARCHAR},
		  #{pushType,jdbcType=VARCHAR},
		  #{content,jdbcType=CLOB},
		  #{createTime,jdbcType=TIMESTAMP},
		  #{createUserCode,jdbcType=VARCHAR},
		  #{operateResult,jdbcType=VARCHAR},
		  #{failReason,jdbcType=VARCHAR})
  </insert>
  <select id="queryPicBillOrgAndNotCount" parameterType="java.util.Map" resultType="com.deppon.foss.module.pickup.waybill.shared.dto.CenterBillOrgDto">
	  SELECT PWP.BELONG_ORG_CODE billOrgCode,
	       COUNT(PWP.BELONG_ORG_CODE) billCount
	  FROM PKP.T_SRV_PIC_WAYBILL_PENDING PWP
	 WHERE PWP.ACTIVE = #{active}
	   AND PWP.PENDGING_TYPE = #{pendgingType}
	   AND PWP.BELONG_ORG_CODE IN
	   		<foreach collection="orgCodes" open="(" close=")" separator=","	item="code">
							#{code,jdbcType=VARCHAR}
			</foreach>
	 GROUP BY PWP.BELONG_ORG_CODE
  </select>
   <select id="queryOuterWaybillPicturePushLog" resultType="com.deppon.foss.module.pickup.waybill.api.shared.dto.WaybillPicturePushLogDto" parameterType="map" >
	select distinct wr.id id ,wr.waybill_no waybillNo, 
	  wr.outer_code orgCode, wr.operator_code operatorCode,org.name orgName
	  from pkp.t_srv_woodenrequire wr,bse.t_bas_org org 
	  where  org.active='Y' and wr.outer_code=org.code 
	  and wr.waybill_no  in 
	  <foreach collection="waybillNos" index="index" item="waybillNo" open="(" separator="," close=")">   
	        #{waybillNo}   
	  </foreach>  
  </select>
  
  <select id="iteratorQueryDepartmentCodeLists" parameterType="com.deppon.foss.module.pickup.waybill.shared.dto.OrgCodeTreeByCodeAndCondition" resultType="String">
	 
	 SELECT DISTINCT A.code  FROM BSE.T_BAS_ORG A
	 
	  <where>
		<if test="active != null and active != '' ">
			and A.Active = #{active,jdbcType=VARCHAR}
		</if>
		<if test="active == null or active == '' ">
			and A.Active = 'Y'
		</if>
		
		<if test="billingGroup != null and billingGroup != '' ">
			and a.billing_group = #{billingGroup,jdbcType=VARCHAR}
		</if>
		
		<if test="isManageDepartment != null and isManageDepartment != '' ">
			and a.Is_Manage_Department = #{isManageDepartment,jdbcType=VARCHAR}
		</if>
		
		<if test="division != null and division != '' ">
			and a.division = #{division,jdbcType=CHAR}
		</if>
		
		<if test="code != null and code != ''">
		
			<if test="isDownQuery == null or isDownQuery == ''">
				START WITH a.code = #{code,jdbcType=VARCHAR} CONNECT BY PRIOR a.code=a.parent_org_code 
			</if>
			
			<if test="isDownQuery != null and isDownQuery != ''">
				START WITH a.code = #{code,jdbcType=VARCHAR} CONNECT BY PRIOR a.parent_org_code=a.code 
			</if>
			
		</if>

		<if test="active != null and active != '' ">
			and A.Active = #{active,jdbcType=VARCHAR}
		</if>
		<if test="active == null or active == '' ">
			and A.Active = 'Y'
		</if>
	  </where>
	 
  </select>
  
  <select id="queryDistributeInfoBySql" parameterType="java.util.Map" resultMap="SubCenterBillOrgDtoMap">
	 
  with t as(select m.billing_group_code billingGroupCode,
               m.billing_amount billingAmount,
               sysdate queryDate,
               (select count(1)
                  from pkp.t_Srv_Pic_Waybill_Pending p
                 where p.active = 'Y'
                   and p.pendging_type = #{pendgingType,jdbcType=VARCHAR}
                   and p.belong_org_code = m.billing_group_code) billCount         
                  ,(case when m.billing_group_code =#{orgCode,jdbcType=VARCHAR} then 'Y' else 'N' end) isLocal
          FROM BSE.T_BAS_FOCUS_RECORD_MANAGEMENT M
         where 1 = 1
          
           AND to_char(m.start_date, 'hh24:mi')
           <![CDATA[
				 <
			]]>
               to_char(sysdate, 'hh24:mi')
           AND to_char(m.end_date, 'hh24:mi') > to_char(sysdate, 'hh24:mi')
            AND m.billing_amount > 0
           AND M.ACTIVE = 'Y'
         group by m.billing_group_code,
                  m.billing_amount,
                  m.start_date,
                  m.end_date) 	 
	 SELECT billingGroupCode,billingAmount,queryDate,billCount,isLocal,curPercent
	 
	 ,(select t.billCount/t.billingAmount from t where  t.billingGroupCode=#{orgCode,jdbcType=VARCHAR}) localPercent
	  FROM
	 ( select t.billingGroupCode,t.billingAmount,t.queryDate,t.billCount,t.isLocal,t.billCount/t.billingAmount  curPercent  
	  from  t
	  WHERE EXISTS (SELECT 1 FROM t WHERE t.billingGroupCode=#{orgCode,jdbcType=VARCHAR})
	  ORDER BY t.isLocal DESC,t.billCount/t.billingAmount
	  ) m WHERE 
	  curPercent
	  <![CDATA[
	  <
	  ]]>1
  
  </select>
  
  <!-- 分单逻辑优化 排序sql开始 -->
  <select id="findWaybillPictureByCash" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
	SELECT /**查询本地【现金】运单**/
	ID,
	WAYBILL_UUID,
	WAYBILL_NO,
	ORDER_NO,
	DRIVER_CODE,
	BIG_GOODS_FLAG,
	CASH_PAY_FLAG,
	FILE_PATH,
	PENDGING_TYPE,
	ACTIVE,
	CREATE_TIME,
	MODIFY_TIME,
	CREATE_USER_CODE,
	MODIFY_USER_CODE,
	BELONG_ORG_CODE,
	REMARK,
	EQUIPMENT_NO,
	OPERATOR,
	RECEIVE_ORG_CODE,
	START_BILL_TIME,
	END_BILL_TIME,
	BAIDU_ID,
	BILL_ORGCODE,
	IS_BIG_UP,
	FH_OT_OVER_QTY,
	OT_TT_OVER_QTY,
	SERVICE_RATE,
	SERVICE_FEE,
	SPECIAL_CUSTOMER,
	IS_EXHIBIT_CARGO, /** 是否是会展货 */
	Local_Billgroup_Code
	FROM (SELECT t.ID,
	t.WAYBILL_UUID,
	t.WAYBILL_NO,
	t.ORDER_NO,
	t.DRIVER_CODE,
	t.BIG_GOODS_FLAG,
	t.CASH_PAY_FLAG,
	t.FILE_PATH,
	t.PENDGING_TYPE,
	t.ACTIVE,
	t.CREATE_TIME,
	t.MODIFY_TIME,
	t.CREATE_USER_CODE,
	t.MODIFY_USER_CODE,
	t.BELONG_ORG_CODE,
	t.REMARK,
	t.EQUIPMENT_NO,
	t.OPERATOR,
	t.RECEIVE_ORG_CODE,
	t.START_BILL_TIME,
	t.END_BILL_TIME,
	t.BAIDU_ID,
	t.BILL_ORGCODE,
	t.IS_BIG_UP,
	t.FH_OT_OVER_QTY,
	t.OT_TT_OVER_QTY,
	t.SERVICE_RATE,
	t.SERVICE_FEE,
	t.TRUCK_CODE,
	t.MOBILE_PHONE,
	t.IS_EXHIBIT_CARGO,
	t.SPECIAL_CUSTOMER,
	t.Local_Billgroup_Code
	FROM PKP.T_SRV_PIC_WAYBILL_PENDING t
	WHERE 
		t.ACTIVE = 'Y'
	and t.remark is null
	AND t.PENDGING_TYPE = 'PENDING'
	AND t.LOCAL = 'Y'
    AND t.cash_pay_flag = 'Y'
	<if test="belongOrgCode != null and belongOrgCode != '' ">
	AND t.BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
	AND t.LOCAL_BILLGROUP_CODE = #{belongOrgCode,jdbcType=VARCHAR}
	</if>
	<if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
			</if>
	ORDER BY t.CREATE_TIME ASC)
	WHERE ROWNUM = 1
  </select>
  
  <select id="findWaybillPictureByAir" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
	SELECT /**查询本地【空运】运单**/
	ID,
	WAYBILL_UUID,
	WAYBILL_NO,
	ORDER_NO,
	DRIVER_CODE,
	BIG_GOODS_FLAG,
	CASH_PAY_FLAG,
	FILE_PATH,
	PENDGING_TYPE,
	ACTIVE,
	CREATE_TIME,
	MODIFY_TIME,
	CREATE_USER_CODE,
	MODIFY_USER_CODE,
	BELONG_ORG_CODE,
	REMARK,
	EQUIPMENT_NO,
	OPERATOR,
	RECEIVE_ORG_CODE,
	START_BILL_TIME,
	END_BILL_TIME,
	BAIDU_ID,
	BILL_ORGCODE,
	IS_BIG_UP,
	FH_OT_OVER_QTY,
	OT_TT_OVER_QTY,
	SERVICE_RATE,
	SERVICE_FEE,
	SPECIAL_CUSTOMER,
	IS_EXHIBIT_CARGO, /** 是否是会展货 */
	Local_Billgroup_Code
	FROM (SELECT t.ID,
	t.WAYBILL_UUID,
	t.WAYBILL_NO,
	t.ORDER_NO,
	t.DRIVER_CODE,
	t.BIG_GOODS_FLAG,
	t.CASH_PAY_FLAG,
	t.FILE_PATH,
	t.PENDGING_TYPE,
	t.ACTIVE,
	t.CREATE_TIME,
	t.MODIFY_TIME,
	t.CREATE_USER_CODE,
	t.MODIFY_USER_CODE,
	t.BELONG_ORG_CODE,
	t.REMARK,
	t.EQUIPMENT_NO,
	t.OPERATOR,
	t.RECEIVE_ORG_CODE,
	t.START_BILL_TIME,
	t.END_BILL_TIME,
	t.BAIDU_ID,
	t.BILL_ORGCODE,
	t.IS_BIG_UP,
	t.FH_OT_OVER_QTY,
	t.OT_TT_OVER_QTY,
	t.SERVICE_RATE,
	t.SERVICE_FEE,
	t.TRUCK_CODE,
	t.MOBILE_PHONE,
	t.IS_EXHIBIT_CARGO,
	t.SPECIAL_CUSTOMER,
	t.Local_Billgroup_Code
	FROM PKP.T_SRV_PIC_WAYBILL_PENDING t
	WHERE 
		t.ACTIVE = 'Y'
	and t.remark is null
	AND t.PENDGING_TYPE = 'PENDING'
	AND t.LOCAL = 'Y'
    AND t.SPECIAL_CUSTOMER = 'Y'
	<if test="belongOrgCode != null and belongOrgCode != '' ">
	AND t.BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR}
	AND t.LOCAL_BILLGROUP_CODE = #{belongOrgCode,jdbcType=VARCHAR}
	</if>
	<if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
			</if>
	ORDER BY t.CREATE_TIME ASC)
	WHERE ROWNUM = 1 
  </select>
  
  <select id="findWaybillPictureByExhibitCargo" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
	SELECT /**查询【展会】运单**/
	ID,
	WAYBILL_UUID,
	WAYBILL_NO,
	ORDER_NO,
	DRIVER_CODE,
	BIG_GOODS_FLAG,
	CASH_PAY_FLAG,
	FILE_PATH,
	PENDGING_TYPE,
	ACTIVE,
	CREATE_TIME,
	MODIFY_TIME,
	CREATE_USER_CODE,
	MODIFY_USER_CODE,
	BELONG_ORG_CODE,
	REMARK,
	EQUIPMENT_NO,
	OPERATOR,
	RECEIVE_ORG_CODE,
	START_BILL_TIME,
	END_BILL_TIME,
	BAIDU_ID,
	BILL_ORGCODE,
	IS_BIG_UP,
	FH_OT_OVER_QTY,
	OT_TT_OVER_QTY,
	SERVICE_RATE,
	SERVICE_FEE,
	SPECIAL_CUSTOMER,
	IS_EXHIBIT_CARGO, /** 是否是会展货 */
	Local_Billgroup_Code
	FROM (SELECT t.ID,
	t.WAYBILL_UUID,
	t.WAYBILL_NO,
	t.ORDER_NO,
	t.DRIVER_CODE,
	t.BIG_GOODS_FLAG,
	t.CASH_PAY_FLAG,
	t.FILE_PATH,
	t.PENDGING_TYPE,
	t.ACTIVE,
	t.CREATE_TIME,
	t.MODIFY_TIME,
	t.CREATE_USER_CODE,
	t.MODIFY_USER_CODE,
	t.BELONG_ORG_CODE,
	t.REMARK,
	t.EQUIPMENT_NO,
	t.OPERATOR,
	t.RECEIVE_ORG_CODE,
	t.START_BILL_TIME,
	t.END_BILL_TIME,
	t.BAIDU_ID,
	t.BILL_ORGCODE,
	t.IS_BIG_UP,
	t.FH_OT_OVER_QTY,
	t.OT_TT_OVER_QTY,
	t.SERVICE_RATE,
	t.SERVICE_FEE,
	t.TRUCK_CODE,
	t.MOBILE_PHONE,
	t.IS_EXHIBIT_CARGO,
	t.SPECIAL_CUSTOMER,
	t.Local_Billgroup_Code
	FROM PKP.T_SRV_PIC_WAYBILL_PENDING t
	WHERE 
		t.ACTIVE = 'Y'
	and t.remark is null
	<if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
			</if>
	AND t.PENDGING_TYPE = 'PENDING'
    AND t.IS_EXHIBIT_CARGO = 'Y'
    AND t.CASH_PAY_FLAG != 'Y'
    AND t.SPECIAL_CUSTOMER !='Y'
	ORDER BY t.CREATE_TIME ASC)
	WHERE ROWNUM = 1
  </select>
  <select id="findWaybillPictureByLocal" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
  select  /**如果有本地运单，和图片开单设置的时间进行比较*/
  	ID,
	WAYBILL_UUID,
	WAYBILL_NO,
	ORDER_NO,
	DRIVER_CODE,
	BIG_GOODS_FLAG,
	CASH_PAY_FLAG,
	FILE_PATH,
	PENDGING_TYPE,
	ACTIVE,
	CREATE_TIME,
	MODIFY_TIME,
	CREATE_USER_CODE,
	MODIFY_USER_CODE,
	BELONG_ORG_CODE,
	REMARK,
	EQUIPMENT_NO,
	OPERATOR,
	RECEIVE_ORG_CODE,
	START_BILL_TIME,
	END_BILL_TIME,
	BAIDU_ID,
	BILL_ORGCODE,
	IS_BIG_UP,
	FH_OT_OVER_QTY,
	OT_TT_OVER_QTY,
	SERVICE_RATE,
	SERVICE_FEE,
	SPECIAL_CUSTOMER,
	IS_EXHIBIT_CARGO, /** 是否是会展货 */
	Local_Billgroup_Code
  from (select t.ID,
	t.WAYBILL_UUID,
	t.WAYBILL_NO,
	t.ORDER_NO,
	t.DRIVER_CODE,
	t.BIG_GOODS_FLAG,
	t.CASH_PAY_FLAG,
	t.FILE_PATH,
	t.PENDGING_TYPE,
	t.ACTIVE,
	t.CREATE_TIME,
	t.MODIFY_TIME,
	t.CREATE_USER_CODE,
	t.MODIFY_USER_CODE,
	t.BELONG_ORG_CODE,
	t.REMARK,
	t.EQUIPMENT_NO,
	t.OPERATOR,
	t.RECEIVE_ORG_CODE,
	t.START_BILL_TIME,
	t.END_BILL_TIME,
	t.BAIDU_ID,
	t.BILL_ORGCODE,
	t.IS_BIG_UP,
	t.FH_OT_OVER_QTY,
	t.OT_TT_OVER_QTY,
	t.SERVICE_RATE,
	t.SERVICE_FEE,
	t.TRUCK_CODE,
	t.MOBILE_PHONE,
	t.IS_EXHIBIT_CARGO,
	t.SPECIAL_CUSTOMER,
	t.Local_Billgroup_Code
          from pkp.t_srv_pic_waybill_pending t
         where t.pendging_type = 'PENDING'
           and t.active = 'Y'
           and t.remark is null
           <if test="waybillPictureEntity.belongOrgCode != null and waybillPictureEntity.belongOrgCode != '' ">
           and t.LOCAL_BILLGROUP_CODE = #{waybillPictureEntity.belongOrgCode,jdbcType=VARCHAR}
           </if>
           <if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
			</if>
           and trunc((sysdate - cast(t.create_time as date)) * 24 * 60 * 60) >  #{totalSecond,jdbcType=NUMERIC}
         ORDER BY t.CREATE_TIME ASC)
 WHERE ROWNUM = 1
  </select>
  
  <select id="findWaybillPictureByOther" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity" resultMap="BaseResultMap">
   select /**如果没有超时的本地运单，按顺序取开单池中图片*/
  	ID,
	WAYBILL_UUID,
	WAYBILL_NO,
	ORDER_NO,
	DRIVER_CODE,
	BIG_GOODS_FLAG,
	CASH_PAY_FLAG,
	FILE_PATH,
	PENDGING_TYPE,
	ACTIVE,
	CREATE_TIME,
	MODIFY_TIME,
	CREATE_USER_CODE,
	MODIFY_USER_CODE,
	BELONG_ORG_CODE,
	REMARK,
	EQUIPMENT_NO,
	OPERATOR,
	RECEIVE_ORG_CODE,
	START_BILL_TIME,
	END_BILL_TIME,
	BAIDU_ID,
	BILL_ORGCODE,
	IS_BIG_UP,
	FH_OT_OVER_QTY,
	OT_TT_OVER_QTY,
	SERVICE_RATE,
	SERVICE_FEE,
	SPECIAL_CUSTOMER,
	IS_EXHIBIT_CARGO, /** 是否是会展货 */
	Local_Billgroup_Code
  from (
       select t.ID,
	t.WAYBILL_UUID,
	t.WAYBILL_NO,
	t.ORDER_NO,
	t.DRIVER_CODE,
	t.BIG_GOODS_FLAG,
	t.CASH_PAY_FLAG,
	t.FILE_PATH,
	t.PENDGING_TYPE,
	t.ACTIVE,
	t.CREATE_TIME,
	t.MODIFY_TIME,
	t.CREATE_USER_CODE,
	t.MODIFY_USER_CODE,
	t.BELONG_ORG_CODE,
	t.REMARK,
	t.EQUIPMENT_NO,
	t.OPERATOR,
	t.RECEIVE_ORG_CODE,
	t.START_BILL_TIME,
	t.END_BILL_TIME,
	t.BAIDU_ID,
	t.BILL_ORGCODE,
	t.IS_BIG_UP,
	t.FH_OT_OVER_QTY,
	t.OT_TT_OVER_QTY,
	t.SERVICE_RATE,
	t.SERVICE_FEE,
	t.TRUCK_CODE,
	t.MOBILE_PHONE,
	t.IS_EXHIBIT_CARGO,
	t.SPECIAL_CUSTOMER,
	t.Local_Billgroup_Code
         from pkp.t_srv_pic_waybill_pending t
        where t.pendging_type = 'PENDING'
          and t.active = 'Y'
          and t.remark is null
          <if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
			</if>
          and (t.cash_pay_flag != 'Y' or t.cash_pay_flag is  null)
          and (t.SPECIAL_CUSTOMER !='Y' OR  t.special_customer is  null)
        ORDER BY t.CREATE_TIME ASC
        )
 WHERE ROWNUM = 1
 </select>
 
  <select id="getPictureWaybillLocalCount" resultType="Integer" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity">
	  		SELECT  /**图片开单查询本地未补录订单*/
	  		COUNT(*)
	  		FROM PKP.T_SRV_PIC_WAYBILL_PENDING
	  		WHERE ACTIVE = 'Y' 
	  		and remark is null
	  		AND (PENDGING_TYPE = 'PENDING' OR (PENDGING_TYPE = 'DISTRIBUTED' AND OPERATOR = #{operator,jdbcType=VARCHAR}))
	  		AND (LOCAL_BILLGROUP_CODE = #{belongOrgCode,jdbcType=VARCHAR} or BELONG_ORG_CODE = #{belongOrgCode,jdbcType=VARCHAR})
	  		
  </select>
  <select id="getPictureWaybillAllCount" resultType="Integer">
  		<![CDATA[
	  		SELECT  /**图片开单查询全国未补录订单*/
	  		COUNT(*)
	  		FROM PKP.T_SRV_PIC_WAYBILL_PENDING
	  		WHERE ACTIVE = 'Y'
	  		 and remark is null
	  		AND (PENDGING_TYPE = 'PENDING' OR (PENDGING_TYPE = 'DISTRIBUTED' AND OPERATOR = #{operator,jdbcType=VARCHAR}))
  		]]>
  </select>
  
  <select id="getPictureWaybillByDistributer" resultMap="BaseResultMap" parameterType="com.deppon.foss.module.pickup.waybill.shared.domain.WaybillPictureEntity">
 select /**优先分配异常关闭的运单到对应开单员*/
  	ID,
	WAYBILL_UUID,
	WAYBILL_NO,
	ORDER_NO,
	DRIVER_CODE,
	BIG_GOODS_FLAG,
	CASH_PAY_FLAG,
	FILE_PATH,
	PENDGING_TYPE,
	ACTIVE,
	CREATE_TIME,
	MODIFY_TIME,
	CREATE_USER_CODE,
	MODIFY_USER_CODE,
	BELONG_ORG_CODE,
	REMARK,
	EQUIPMENT_NO,
	OPERATOR,
	RECEIVE_ORG_CODE,
	START_BILL_TIME,
	END_BILL_TIME,
	BAIDU_ID,
	BILL_ORGCODE,
	IS_BIG_UP,
	FH_OT_OVER_QTY,
	OT_TT_OVER_QTY,
	SERVICE_RATE,
	SERVICE_FEE,
	SPECIAL_CUSTOMER,
	IS_EXHIBIT_CARGO, /** 是否是会展货 */
	Local_Billgroup_Code
  from ( 
		select t.ID,
			t.WAYBILL_UUID,
			t.WAYBILL_NO,
			t.ORDER_NO,
			t.DRIVER_CODE,
			t.BIG_GOODS_FLAG,
			t.CASH_PAY_FLAG,
			t.FILE_PATH,
			t.PENDGING_TYPE,
			t.ACTIVE,
			t.CREATE_TIME,
			t.MODIFY_TIME,
			t.CREATE_USER_CODE,
			t.MODIFY_USER_CODE,
			t.BELONG_ORG_CODE,
			t.REMARK,
			t.EQUIPMENT_NO,
			t.OPERATOR,
			t.RECEIVE_ORG_CODE,
			t.START_BILL_TIME,
			t.END_BILL_TIME,
			t.BAIDU_ID,
			t.BILL_ORGCODE,
			t.IS_BIG_UP,
			t.FH_OT_OVER_QTY,
			t.OT_TT_OVER_QTY,
			t.SERVICE_RATE,
			t.SERVICE_FEE,
			t.TRUCK_CODE,
			t.MOBILE_PHONE,
			t.IS_EXHIBIT_CARGO,
			t.SPECIAL_CUSTOMER,
			t.Local_Billgroup_Code
		  from pkp.t_srv_pic_waybill_pending t
		 where t.operator = #{operator,jdbcType=VARCHAR}
		   and t.pendging_type = 'DISTRIBUTED'
		   and t.remark is null
		   and t.active = 'Y'
		   
		   <if test="excludedWaybillNos != null and excludedWaybillNos.size() > 0 ">
  				AND WAYBILL_NO NOT IN
				<foreach collection="excludedWaybillNos" open="(" close=")" separator=","	item="waybillNo">
							#{waybillNo,jdbcType=VARCHAR}
				</foreach>
			</if>
		 ORDER BY t.CREATE_TIME ASC)
  WHERE ROWNUM = 1
  </select>
  <!-- 分单逻辑优化 排序sql结束 -->
  
  
</mapper>