<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="foss.pkp.TempRentalEntityMapper">
	<resultMap id="BaseResultMap"
		type="com.deppon.foss.module.transfer.scheduling.api.shared.domain.RentalMarkEntity">
		<result column="BILLNO" property="billNo" jdbcType="VARCHAR" /><!-- 单号 -->
		<result column="BILLTYPE" property="billType" jdbcType="VARCHAR" /><!-- 单据类型 -->
		<result column="VEHICLENO" property="vehicleNo" jdbcType="VARCHAR" /><!-- 车牌号 -->
		<result column="DRIVER" property="driverName" jdbcType="VARCHAR" /><!-- 司机姓名 -->
		<result column="DEPARTURENAME" property="origOrgName" jdbcType="VARCHAR" /><!-- 出发部门 -->
		<result column="ARRIVEORG" property="destOrgName" jdbcType="VARCHAR" /><!-- 到达部门 -->
		<result column="WEIGHT" property="weight" jdbcType="NUMERIC" /><!-- 重量 -->
		<result column="VOLUME" property="volume" jdbcType="NUMERIC" /><!-- 体积 -->
		<result column="GOODSNAME" property="goodsName" jdbcType="VARCHAR" /><!-- 货物品名 -->
		<result column="GOODSPACKAGE" property="packing" jdbcType="VARCHAR" /><!-- 包装 -->
		<result column="PICKUPTODOOR" property="isDoorDeliver" jdbcType="VARCHAR" /><!-- 是否上门接货 -->
		<result column="DELIVERYCUSTOMERNAME" property="customerName" jdbcType="VARCHAR" /><!-- 发货客户名称 -->
		<result column="DELIVERYCUSTOMERADDRESS" property="sendAddress" jdbcType="VARCHAR" /><!-- 发货地址 -->
		<result column="TARGETORGCODE" property="destination" jdbcType="VARCHAR" /><!-- 目的站 -->
		<result column="RECEIVEMETHOD" property="pickUpWay" jdbcType="VARCHAR" /><!-- 提货方式 -->
		<result column="RECEIVECUSTOMERCONTACT" property="receiptContacts" jdbcType="VARCHAR" /><!-- 收货联系人 -->
		<result column="RECEIVECUSTOMERADDRESS" property="receiptAddress" jdbcType="VARCHAR" /><!-- 收货地址 -->
		<result column="BILLGENERATETIME" property="billCreateTime" jdbcType="TIMESTAMP" /><!-- 单据生成时间 -->
		<result column="TEMPRENTALMARKNO" property="rentalNum" jdbcType="VARCHAR" /><!-- 租车编号 -->
		<result column="RENTALUSETYPE" property="rentalUse" jdbcType="VARCHAR" /><!-- 租车用途 -->
		<result column="MARKDEPARTNAME" property="markDeptName" jdbcType="VARCHAR" /><!-- 租车标记部门 -->
		<result column="MARKOPERATER" property="markOperator" jdbcType="VARCHAR" /><!-- 租车标记操作人 -->
		<result column="MARKOPERATETIME" property="createDate" jdbcType="TIMESTAMP" /><!-- 租车标记时间 -->
		<result column="RECEIVEMETHODNAME" property="pickUpWayName" jdbcType="VARCHAR" /><!-- 提货方式描述 -->
		<result column="INVITEVEHICLENO" property="inviteVehicleNo" jdbcType="VARCHAR" /><!-- 租车编号 -->
		<result column="RENTAL_AMOUNT" property="rentalAmount" jdbcType="DECIMAL" /><!-- 租车金额 -->
		<result column="consultPriceNo" property="consultPriceNo" jdbcType="VARCHAR"/><!--询价编号-->
	</resultMap>

	<sql id="Base_Column_List_By_WayBillnober">
		W.WAYBILL_NO BILLNO,
		'expressbill' BILLTYPE,
		M.VEHICLE_NO VEHICLENO,
		M.DRIVER_NAME DRIVER,
		W.RECEIVE_ORG_NAME DEPARTURENAME,
		W.CUSTOMER_PICKUP_ORG_NAME ARRIVEORG,
		W.GOODS_WEIGHT_TOTAL WEIGHT,
		W.GOODS_VOLUME_TOTAL VOLUME,
		W.GOODS_NAME GOODSNAME,
		W.GOODS_PACKAGE GOODSPACKAGE,
		W.PICKUP_TO_DOOR PICKUPTODOOR,
		W.DELIVERY_CUSTOMER_NAME DELIVERYCUSTOMERNAME,
		W.DELIVERY_CUSTOMER_ADDRESS DELIVERYCUSTOMERADDRESS,
		W.TARGET_ORG_CODE TARGETORGCODE,
		W.RECEIVE_METHOD RECEIVEMETHOD,
		W.RECEIVE_CUSTOMER_CONTACT RECEIVECUSTOMERCONTACT,
		W.RECEIVE_CUSTOMER_ADDRESS RECEIVECUSTOMERADDRESS,
		W.CREATE_TIME BILLGENERATETIME,
		M.TEMPRENTAL_MARK_NO TEMPRENTALMARKNO,
		M.RENTAL_CAR_USETYPE RENTALUSETYPE,
		M.MARK_DEPART_NAME MARKDEPARTNAME,
		M.CREATE_USER_NAME MARKOPERATER,
		M.CREATE_DATE MARKOPERATETIME,
		DIC.VALUE_NAME RECEIVEMETHODNAME,
		M.INVITE_VEHICLENO INVITEVEHICLENO,
		M.RENTAL_AMOUNT/100 RENTAL_AMOUNT
	</sql>
	
	<sql id="Base_Column_List_By_WayBill">
		W.WAYBILL_NO BILLNO,
		'waybill' BILLTYPE,
		M.VEHICLE_NO VEHICLENO,
		M.DRIVER_NAME DRIVER,
		W.RECEIVE_ORG_NAME DEPARTURENAME,
		W.CUSTOMER_PICKUP_ORG_NAME ARRIVEORG,
		W.GOODS_WEIGHT_TOTAL WEIGHT,
		W.GOODS_VOLUME_TOTAL VOLUME,
		W.GOODS_NAME GOODSNAME,
		W.GOODS_PACKAGE GOODSPACKAGE,
		W.PICKUP_TO_DOOR PICKUPTODOOR,
		W.DELIVERY_CUSTOMER_NAME DELIVERYCUSTOMERNAME,
		W.DELIVERY_CUSTOMER_ADDRESS DELIVERYCUSTOMERADDRESS,
		W.TARGET_ORG_CODE TARGETORGCODE,
		W.RECEIVE_METHOD RECEIVEMETHOD,
		W.RECEIVE_CUSTOMER_CONTACT RECEIVECUSTOMERCONTACT,
		W.RECEIVE_CUSTOMER_ADDRESS RECEIVECUSTOMERADDRESS,
		W.CREATE_TIME BILLGENERATETIME,
		M.TEMPRENTAL_MARK_NO TEMPRENTALMARKNO,
		M.RENTAL_CAR_USETYPE RENTALUSETYPE,
		M.MARK_DEPART_NAME MARKDEPARTNAME,
		M.CREATE_USER_NAME MARKOPERATER,
		M.CREATE_DATE MARKOPERATETIME,
		DIC.VALUE_NAME RECEIVEMETHODNAME,
		M.INVITE_VEHICLENO INVITEVEHICLENO,
		M.RENTAL_AMOUNT/100 RENTAL_AMOUNT,
		M.consultPriceNo consultPriceNo
	</sql>

	<sql id="Base_Column_List_By_DeliverBill">
		D.DELIVERBILL_NO BILLNO,
		'deliverbill' BILLTYPE,
		D.VEHICLE_NO VEHICLENO,
		D.DRIVER_NAME DRIVER,
		D.OPERATE_ORG_NAME DEPARTURENAME,
		'' ARRIVEORG,
		D.WEIGHT_TOTAL WEIGHT,
		D.VOLUME_TOTAL VOLUME,
		'' GOODSNAME,
		'' GOODSPACKAGE,
		'' PICKUPTODOOR,
		'' DELIVERYCUSTOMERNAME,
		'' DELIVERYCUSTOMERADDRESS,
		'' TARGETORGCODE, 
		'' RECEIVEMETHOD,
		'' RECEIVECUSTOMERCONTACT,
		'' RECEIVECUSTOMERADDRESS,
		D.SUBMIT_TIME BILLGENERATETIME,
		M.TEMPRENTAL_MARK_NO TEMPRENTALMARKNO,
		M.RENTAL_CAR_USETYPE RENTALUSETYPE,
		M.MARK_DEPART_NAME MARKDEPARTNAME,
		M.CREATE_USER_NAME MARKOPERATER,
		M.CREATE_DATE MARKOPERATETIME,
		'' RECEIVEMETHODNAME,
		M.INVITE_VEHICLENO INVITEVEHICLENO,
		M.RENTAL_AMOUNT/100 RENTAL_AMOUNT,
		M.consultPriceNo consultPriceNo
	</sql>

	<!-- where begin -->
	<!-- type 1：营业部 2：驻地营业部 3：车队 4:上级部门为车队 -->
	<!-- 营业部：按时间段查询运单 -->
	<sql id="query_selectByWayBill_condition_date_1">
		<where>
			W.ACTIVE = 'Y' AND W.IS_WHOLE_VEHICLE = 'N' AND 
			<!-- startTime -->
			<if test="startTime != null">
				<![CDATA[W.CREATE_TIME >= #{startTime,jdbcType=TIMESTAMP} AND ]]>
			</if>
			<!-- endTime -->
			<if test="endTime != null">
				<![CDATA[W.CREATE_TIME <= #{endTime,jdbcType=TIMESTAMP} AND ]]>
			</if>
			<!-- 车牌号 -->
			<if test="vehicleNo != null">
				M.VEHICLE_NO = #{vehicleNo,jdbcType=VARCHAR} AND
			</if>
			<!-- 租车编号 -->
			<if test="TemprentalMarkNo != null">
				M.TEMPRENTAL_MARK_NO = #{TemprentalMarkNo,jdbcType=VARCHAR} AND
			</if>
			<!-- 开单部门 -->
			<if test="createOrgCode != null">
				W.RECEIVE_ORG_CODE = #{createOrgCode,jdbcType=VARCHAR} AND
			</if>
			<![CDATA[
					((W.RECEIVE_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} AND (W.GOODS_NAME < '待补录' OR W.GOODS_NAME > '待补录')) 
			 		 OR  
			 		 (W.CUSTOMER_PICKUP_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} AND
			 			0 < (SELECT COUNT(OPT.ID) FROM TFR.T_OPT_IN_STOCK OPT
				         		WHERE OPT.WAYBILL_NO = W.WAYBILL_NO 
				         		AND OPT.IS_VALID = 'Y'
				         		AND OPT.ORG_CODE=W.CUSTOMER_PICKUP_ORG_CODE
			                )
						AND 
						0 >= (SELECT COUNT(ARR.ID) FROM PKP.T_SRV_ARRIVESHEET ARR/*派送拉回的运单无法查出 */
					             WHERE ARR.STATUS = 'REFUSE'
					               AND ARR.ACTIVE = 'Y'
					               AND ARR.DESTROYED = 'N'
					               AND ARR.WAYBILL_NO = W.WAYBILL_NO) 
						AND
					    0 >= (SELECT COUNT(D.ID) FROM PKP.T_SRV_DELIVERBILL D, PKP.T_SRV_DELIVERBILL_DETAIL DT/*已做过派送单（该派送单未被作废）的运单无法查出*/
					             WHERE D.ID = DT.T_SRV_DELIVERBILL_ID
					               AND D.STATUS = 'CANCELED'
					               AND DT.WAYBILL_NO = W.WAYBILL_NO)
					 )
			        ) 
	        ]]>
		</where>
	</sql>
	<!-- 驻地营业部 ：按时间段查运单 -->
	<sql id="query_selectByWayBill_condition_date_2">
		<where>
			W.ACTIVE = 'Y' AND W.IS_WHOLE_VEHICLE = 'N' AND 
			<!-- startTime -->
			<if test="startTime != null">
				<![CDATA[W.CREATE_TIME >= #{startTime,jdbcType=TIMESTAMP} AND ]]>
			</if>
			<!-- endTime -->
			<if test="endTime != null">
				<![CDATA[W.CREATE_TIME <= #{endTime,jdbcType=TIMESTAMP} AND ]]>
			</if>
			<!-- 车牌号 -->
			<if test="vehicleNo != null">
				M.VEHICLE_NO = #{vehicleNo,jdbcType=VARCHAR} AND
			</if>
			<!-- 租车编号 -->
			<if test="TemprentalMarkNo != null">
				M.TEMPRENTAL_MARK_NO = #{TemprentalMarkNo,jdbcType=VARCHAR} AND
			</if>
			<!-- 开单部门 -->
			<if test="createOrgCode != null">
				W.RECEIVE_ORG_CODE = #{createOrgCode,jdbcType=VARCHAR} AND
			</if>
				<![CDATA[
					((W.RECEIVE_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} AND (W.GOODS_NAME < '待补录' OR W.GOODS_NAME > '待补录'))
			 		  OR  
			 		 (W.CUSTOMER_PICKUP_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} AND
		 			 	0 < (SELECT COUNT(OPT.ID) FROM TFR.T_OPT_IN_STOCK OPT
			         		WHERE OPT.WAYBILL_NO = W.WAYBILL_NO 
			         		AND OPT.IS_VALID = 'Y'
		         			AND OPT.ORG_CODE = (SELECT T.TRANSFER_CENTER FROM BSE.T_BAS_SALES_DEPARTMENT T WHERE T.CODE=#{currentOrg,jdbcType=VARCHAR} AND T.ACTIVE='Y' ))
							AND
							0 >= (SELECT COUNT(ARR.ID) FROM PKP.T_SRV_ARRIVESHEET ARR/*派送拉回的运单无法查出*/
								 WHERE ARR.STATUS = 'REFUSE'
								   AND ARR.ACTIVE = 'Y'
								   AND ARR.DESTROYED = 'N'
								   AND ARR.WAYBILL_NO = W.WAYBILL_NO) AND
							 0 >= (SELECT COUNT(D.ID) FROM PKP.T_SRV_DELIVERBILL D, 
								  PKP.T_SRV_DELIVERBILL_DETAIL DT/*已做过派送单（该派送单未被作废）的运单无法查出*/
								  WHERE D.ID = DT.T_SRV_DELIVERBILL_ID
									AND D.STATUS = 'CANCELED'
									AND DT.WAYBILL_NO = W.WAYBILL_NO)
					  )
		         	 ) 	
	        	]]>
		</where>
	</sql>

	<!-- 车队：按时间段查运单 -->
	<sql id="query_selectByWayBill_condition_date_3_4">
		<where>
			W.ACTIVE = 'Y' AND W.IS_WHOLE_VEHICLE = 'N' AND 
			<!-- startTime -->
			<if test="startTime != null">
				<![CDATA[W.CREATE_TIME >= #{startTime,jdbcType=TIMESTAMP} AND ]]>
			</if>
			<!-- endTime -->
			<if test="endTime != null">
				<![CDATA[W.CREATE_TIME <= #{endTime,jdbcType=TIMESTAMP} AND ]]>
			</if>
			<!-- 车牌号 -->
			<if test="vehicleNo != null">
				M.VEHICLE_NO = #{vehicleNo,jdbcType=VARCHAR} AND
			</if>
			<!-- 租车编号 -->
			<if test="TemprentalMarkNo != null">
				M.TEMPRENTAL_MARK_NO = #{TemprentalMarkNo,jdbcType=VARCHAR} AND
			</if>
			<!-- 开单部门 -->
			<if test="createOrgCode != null">
				W.RECEIVE_ORG_CODE = #{createOrgCode,jdbcType=VARCHAR} AND
			</if>
			
			<if test="orgs != null and orgs.size() > 0">
				
				((W.RECEIVE_ORG_CODE IN
				<foreach collection="orgs" open="(" close=")" separator=","	item="org">
					#{org,jdbcType=VARCHAR}
				</foreach>
				<![CDATA[
			 		AND (W.GOODS_NAME < '待补录' OR W.GOODS_NAME > '待补录')) 
				]]>
			</if>
			<if test="orgs != null and orgs.size() > 0">
				OR (W.CUSTOMER_PICKUP_ORG_CODE IN
				<foreach collection="orgs" open="(" close=")" separator=","	item="org">
					#{org,jdbcType=VARCHAR}
				</foreach>
				<![CDATA[
			        AND
			 		0 < (SELECT COUNT(OPT.ID) FROM TFR.T_OPT_IN_STOCK OPT
			         		WHERE OPT.WAYBILL_NO = W.WAYBILL_NO 
			         		AND OPT.IS_VALID = 'Y'
							AND OPT.ORG_CODE = W.CUSTOMER_PICKUP_ORG_CODE
			        ) AND 
					0 >= (SELECT COUNT(ARR.ID) FROM PKP.T_SRV_ARRIVESHEET ARR/* 派送拉回的运单无法查出 */
					             WHERE ARR.STATUS = 'REFUSE'
					               AND ARR.ACTIVE = 'Y'
					               AND ARR.DESTROYED = 'N'
					               AND ARR.WAYBILL_NO = W.WAYBILL_NO) 
					AND
					0 >= (SELECT COUNT(D.ID)
					              FROM PKP.T_SRV_DELIVERBILL D, PKP.T_SRV_DELIVERBILL_DETAIL DT/* 已做过派送单（该派送单未被作废）的运单无法查出 */
					             WHERE D.ID = DT.T_SRV_DELIVERBILL_ID
					               AND D.STATUS = 'CANCELED'
					               AND DT.WAYBILL_NO = W.WAYBILL_NO)
				
				))
				]]>
			</if>
			
		</where>
	</sql>
	<!-- 营业部：按运单号查询运单 -->
	<sql id="query_selectByWayBill_condition_billnos_1">
		<where>
			W.ACTIVE = 'Y' AND W.IS_WHOLE_VEHICLE = 'N' AND 
			<if test="billList != null and billList.size()>0">
				W.WAYBILL_NO IN
				<foreach collection="billList" open="(" close=")" separator=","	item="waybillId">
					#{waybillId,jdbcType=VARCHAR}
				</foreach>
				AND
			</if>
			<![CDATA[
					((W.RECEIVE_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} AND (W.GOODS_NAME < '待补录' OR W.GOODS_NAME > '待补录')) 
			 		 OR  
			 		 (W.CUSTOMER_PICKUP_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} AND
			 			0 < (SELECT COUNT(OPT.ID) FROM TFR.T_OPT_IN_STOCK OPT
			         		WHERE OPT.WAYBILL_NO = W.WAYBILL_NO 
			         		AND OPT.IS_VALID = 'Y' 
			         		AND OPT.ORG_CODE=W.CUSTOMER_PICKUP_ORG_CODE)
					 AND 0 >= (SELECT COUNT(ARR.ID) FROM PKP.T_SRV_ARRIVESHEET ARR/* 派送拉回的运单无法查出 */
					             WHERE ARR.STATUS = 'REFUSE'
					               AND ARR.ACTIVE = 'Y'
					               AND ARR.DESTROYED = 'N'
					               AND ARR.WAYBILL_NO = W.WAYBILL_NO) 
					 AND 0 >= (SELECT COUNT(D.ID) FROM PKP.T_SRV_DELIVERBILL D, PKP.T_SRV_DELIVERBILL_DETAIL DT/* 已做过派送单（该派送单未被作废）的运单无法查出 */
					             WHERE D.ID = DT.T_SRV_DELIVERBILL_ID
					               AND D.STATUS = 'CANCELED'
					               AND DT.WAYBILL_NO = W.WAYBILL_NO)			  
					)
			       ) 
	        	]]>
		</where>
	</sql>
	<!-- 驻地营业部 ：按运单号查询运单 -->
	<sql id="query_selectByWayBill_condition_billnos_2">
		<where>
			W.ACTIVE = 'Y' AND W.IS_WHOLE_VEHICLE = 'N' AND 
			<if test="billList != null and billList.size()>0">
				W.WAYBILL_NO IN
				<foreach collection="billList" open="(" close=")" separator=","	item="waybillId">
					#{waybillId,jdbcType=VARCHAR}
				</foreach>
				AND
			</if>
				<![CDATA[
					((W.RECEIVE_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} AND (W.GOODS_NAME < '待补录' OR W.GOODS_NAME > '待补录')) 
					 OR  
			 		 (W.CUSTOMER_PICKUP_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} 
			 		   AND 0 < (SELECT COUNT(OPT.ID) FROM TFR.T_OPT_IN_STOCK OPT
					         		WHERE OPT.WAYBILL_NO = W.WAYBILL_NO 
					         		AND OPT.IS_VALID = 'Y'
				         			AND OPT.ORG_CODE = (SELECT T.TRANSFER_CENTER FROM BSE.T_BAS_SALES_DEPARTMENT T WHERE T.CODE=#{currentOrg,jdbcType=VARCHAR} AND T.ACTIVE='Y' ))
					   AND 0 >= (SELECT COUNT(ARR.ID) FROM PKP.T_SRV_ARRIVESHEET ARR/*派送拉回的运单无法查出*/
									 WHERE ARR.STATUS = 'REFUSE'
									   AND ARR.ACTIVE = 'Y'
									   AND ARR.DESTROYED = 'N'
									   AND ARR.WAYBILL_NO = W.WAYBILL_NO) 
					   AND 0 >= (SELECT COUNT(D.ID) FROM PKP.T_SRV_DELIVERBILL D, 
								  PKP.T_SRV_DELIVERBILL_DETAIL DT/*已做过派送单（该派送单未被作废）的运单无法查出*/
								  WHERE D.ID = DT.T_SRV_DELIVERBILL_ID
									AND D.STATUS = 'CANCELED'
									AND DT.WAYBILL_NO = W.WAYBILL_NO)
					  )
		         	 ) 	
	        	]]>
		</where>
	</sql>
	
	
	<!--按运单号查询运单 -->
	<sql id="query_selectByDeliverBill_condition_billnos1_2_3_4">
	<where>
			W.ACTIVE = 'Y' AND W.IS_WHOLE_VEHICLE = 'N' AND 
			<if test="billList != null and billList.size()>0">
				W.WAYBILL_NO IN
				<foreach collection="billList" open="(" close=")" separator=","	item="waybillId">
					#{waybillId,jdbcType=VARCHAR}
				</foreach>
				AND
			</if>
			<![CDATA[
					(((W.GOODS_NAME < '待补录' OR W.GOODS_NAME > '待补录')) 
			 		 AND  
			 		 ((20>(sysdate-(w.bill_time+0))))
			         AND
			 		 (
			 			0 < (SELECT COUNT(OPT.ID) FROM TFR.T_OPT_IN_STOCK OPT
			         		WHERE OPT.WAYBILL_NO = W.WAYBILL_NO 
			         		AND OPT.IS_VALID = 'Y' 
			         		)
					 AND 0 <= (SELECT COUNT(ARR.ID) FROM PKP.T_SRV_ARRIVESHEET ARR/* 派送拉回的运单可以查出 */
					             WHERE ARR.STATUS = 'REFUSE'
					               AND ARR.ACTIVE = 'Y'
					               AND ARR.DESTROYED = 'N'
					               AND ARR.WAYBILL_NO = W.WAYBILL_NO) 
					 AND 0 <= (SELECT COUNT(D.ID) FROM PKP.T_SRV_DELIVERBILL D, PKP.T_SRV_DELIVERBILL_DETAIL DT/* 未被作废的运单可以查出 */
					             WHERE D.ID = DT.T_SRV_DELIVERBILL_ID
					               AND D.STATUS = 'CANCELED'
					               AND DT.WAYBILL_NO = W.WAYBILL_NO)			  
					)
			       ) 
	        	]]>
		</where>
	</sql>
	
	<!-- 车队：按运单号查询运单 -->
	<sql id="query_selectByWayBill_condition_billnos_3_4">
		<where>
			W.ACTIVE = 'Y' AND W.IS_WHOLE_VEHICLE = 'N' AND 
			<if test="billList != null and billList.size()>0">
				W.WAYBILL_NO IN
				<foreach collection="billList" open="(" close=")" separator=","	item="waybillId">
					#{waybillId,jdbcType=VARCHAR}
				</foreach>
				AND
			</if>
			
			<if test="orgs != null and orgs.size() > 0">
				((W.RECEIVE_ORG_CODE IN
				<foreach collection="orgs" open="(" close=")" separator=","	item="org">
					#{org,jdbcType=VARCHAR}
				</foreach>
				<![CDATA[
			 		AND (W.GOODS_NAME < '待补录' OR W.GOODS_NAME > '待补录')) 
				]]>
			</if>
			<if test="orgs != null and orgs.size() > 0">
				OR (W.CUSTOMER_PICKUP_ORG_CODE IN
				<foreach collection="orgs" open="(" close=")" separator=","	item="org">
					#{org,jdbcType=VARCHAR}
				</foreach>
				<![CDATA[
			        AND	0 < (SELECT COUNT(OPT.ID) FROM TFR.T_OPT_IN_STOCK OPT
				         		WHERE OPT.WAYBILL_NO = W.WAYBILL_NO 
				         		AND OPT.IS_VALID = 'Y'
								AND OPT.ORG_CODE = W.CUSTOMER_PICKUP_ORG_CODE) 
			        AND 0 >= (SELECT COUNT(ARR.ID) FROM PKP.T_SRV_ARRIVESHEET ARR/* 派送拉回的运单无法查出 */
					             WHERE ARR.STATUS = 'REFUSE'
					               AND ARR.ACTIVE = 'Y'
					               AND ARR.DESTROYED = 'N'
					               AND ARR.WAYBILL_NO = W.WAYBILL_NO) 
					AND 0 >= (SELECT COUNT(D.ID)
					              FROM PKP.T_SRV_DELIVERBILL D, PKP.T_SRV_DELIVERBILL_DETAIL DT/* 已做过派送单（该派送单未被作废）的运单无法查出 */
					             WHERE D.ID = DT.T_SRV_DELIVERBILL_ID
					               AND D.STATUS = 'CANCELED'
					               AND DT.WAYBILL_NO = W.WAYBILL_NO)
				
					))
				]]>
			</if>
		</where>
	</sql>
	<!-- 营业部或驻地营业部：按时间段查询派送单 -->
	<sql id="query_selectByDeliverBill_condition_date_1_2">
		<where>
			(D.STATUS = 'CONFIRMED' OR D.STATUS = 'SIGNINFO_CONFIRMED') 
			<!-- startTime -->
			<if test="startTime != null">
				<![CDATA[ AND D.SUBMIT_TIME >= #{startTime,jdbcType=TIMESTAMP}]]>
			</if>
			<!-- endTime -->
			<if test="endTime != null">
				<![CDATA[ AND D.SUBMIT_TIME <= #{endTime,jdbcType=TIMESTAMP}]]>
			</if>
			<!-- vehicleNo -->
			<if test="vehicleNo != null">
				 AND D.VEHICLE_NO = #{vehicleNo,jdbcType=VARCHAR}
			</if>
			<!-- 租车编号 -->
			<if test="TemprentalMarkNo != null">
				 AND M.TEMPRENTAL_MARK_NO = #{TemprentalMarkNo,jdbcType=VARCHAR}
			</if>
			<!-- 创建部门-->
			<if test="createOrgCode != null">
				 AND D.CREATE_ORG_CODE = #{createOrgCode,jdbcType=VARCHAR}
			</if>
			<![CDATA[
				 AND (D.CREATE_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} OR D.OPERATE_ORG_CODE = #{currentOrg,jdbcType=VARCHAR})
			]]>
		</where>
	</sql>
	<!-- 车队：按时间段查派送单 -->
	<sql id="query_selectByDeliverBill_condition_date_3_4">
		<where>
			(D.STATUS = 'CONFIRMED' OR D.STATUS = 'SIGNINFO_CONFIRMED') 
			<!-- startTime -->
			<if test="startTime != null">
				<![CDATA[AND D.SUBMIT_TIME >= #{startTime,jdbcType=TIMESTAMP}]]>
			</if>
			<!-- endTime -->
			<if test="endTime != null">
				<![CDATA[AND D.SUBMIT_TIME <= #{endTime,jdbcType=TIMESTAMP} ]]>
			</if>
			<!-- vehicleNo -->
			<if test="vehicleNo != null">
				 AND D.VEHICLE_NO = #{vehicleNo,jdbcType=VARCHAR} 
			</if>
			<!-- 租车编号 -->
			<if test="TemprentalMarkNo != null">
				 AND M.TEMPRENTAL_MARK_NO = #{TemprentalMarkNo,jdbcType=VARCHAR}
			</if>
			<!-- 创建部门-->
			<if test="createOrgCode != null">
				 AND D.CREATE_ORG_CODE = #{createOrgCode,jdbcType=VARCHAR}
			</if>

			<if test="orgs != null and orgs.size() > 0">
				 AND D.CREATE_ORG_CODE IN
				<foreach collection="orgs" open="(" close=")" separator="," item="org">
					#{org,jdbcType=VARCHAR}
				</foreach>
			</if>
		</where>
	</sql>

	<!-- 营业部或驻地营业部：按派送单号查询派送单 -->
	<sql id="query_selectByDeliverBill_condition_billnos_1_2">
		<where>
			(D.STATUS = 'CONFIRMED' OR D.STATUS = 'SIGNINFO_CONFIRMED') AND 
			<if test="billList != null and billList.size()>0">
				<![CDATA[ D.DELIVERBILL_NO IN ]]>
				<foreach collection="billList" open="(" close=")" separator=","	item="deliverBillId">
					#{deliverBillId,jdbcType=VARCHAR}
				</foreach>
				AND
			</if>
			<![CDATA[
				(D.CREATE_ORG_CODE = #{currentOrg,jdbcType=VARCHAR} OR D.OPERATE_ORG_CODE = #{currentOrg,jdbcType=VARCHAR})
			]]>
		</where>
	</sql>

	<!-- 车队：按派送单号查询派送单 -->
	<sql id="query_selectByDeliverBill_condition_billnos_3_4">
		<where>
			(D.STATUS = 'CONFIRMED' OR D.STATUS = 'SIGNINFO_CONFIRMED') 
			<if test="billList != null and billList.size()>0">
				<![CDATA[AND D.DELIVERBILL_NO IN ]]>
				<foreach collection="billList" open="(" close=")" separator=","	item="deliverBillId">
					#{deliverBillId,jdbcType=VARCHAR}
				</foreach>
			</if>

			<if test="orgs != null and orgs.size() > 0">
				AND D.CREATE_ORG_CODE IN
				<foreach collection="orgs" open="(" close=")" separator=","	item="org">
					#{org,jdbcType=VARCHAR}
				</foreach>
			</if>
		</where>
	</sql>

	<!-- where end -->

	<!-- select begin -->
	<!-- 营业部：按运单号查询运单 -->
	<select id="selectWayBillByBills_1" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			 SELECT 
			<include refid="Base_Column_List_By_WayBill" />
			<![CDATA[
			FROM PKP.T_SRV_WAYBILL W 
			INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED') 
			LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
			LEFT JOIN BSE.T_BAS_DATA_DICTIONARY_VALUE DIC
			   ON DIC.VALUE_CODE = W.RECEIVE_METHOD
			      AND DIC.TERMS_CODE IN ('PICKUPGOODSHIGHWAYS','PICKUPGOODSAIR')
			      AND DIC.ACTIVE='Y'
			      
			]]>
		<include refid="query_selectByWayBill_condition_billnos_1" />
			ORDER BY W.WAYBILL_NO
	</select>
	<!-- 驻地营业部：按运单号查询运单 -->
	<select id="selectWayBillByBills_2" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			SELECT 
		<include refid="Base_Column_List_By_WayBill" />
		<![CDATA[
			FROM PKP.T_SRV_WAYBILL W 
			INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED')
			LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
			LEFT JOIN BSE.T_BAS_DATA_DICTIONARY_VALUE DIC
			   ON DIC.VALUE_CODE = W.RECEIVE_METHOD
			      AND DIC.TERMS_CODE IN ('PICKUPGOODSHIGHWAYS','PICKUPGOODSAIR')
			      AND DIC.ACTIVE='Y'
		]]>	
		<include refid="query_selectByWayBill_condition_billnos_2" />
			ORDER BY W.WAYBILL_NO
	</select>
	<!-- 车队：按运单号查询运单 -->
	<select id="selectWayBillByBills_3_4" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			 SELECT 
		<include refid="Base_Column_List_By_WayBill" />
		<![CDATA[
			FROM PKP.T_SRV_WAYBILL W 
			INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED')
			LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
			LEFT JOIN BSE.T_BAS_DATA_DICTIONARY_VALUE DIC
			   ON DIC.VALUE_CODE = W.RECEIVE_METHOD
			      AND DIC.TERMS_CODE IN ('PICKUPGOODSHIGHWAYS','PICKUPGOODSAIR')
			      AND DIC.ACTIVE='Y'
		]]>
		<include refid="query_selectByWayBill_condition_billnos_3_4" />
			ORDER BY W.WAYBILL_NO
	</select>

	<!-- 营业部：按时间段查询运单 -->
	<select id="selectWayBillByDate_1" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			SELECT 
		<include refid="Base_Column_List_By_WayBill" />
		<![CDATA[
			FROM PKP.T_SRV_WAYBILL W 
			INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED')
			LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
			LEFT JOIN BSE.T_BAS_DATA_DICTIONARY_VALUE DIC
			   ON DIC.VALUE_CODE = W.RECEIVE_METHOD
			      AND DIC.TERMS_CODE IN ('PICKUPGOODSHIGHWAYS','PICKUPGOODSAIR')
			      AND DIC.ACTIVE='Y'
		]]>
		<include refid="query_selectByWayBill_condition_date_1" />
			ORDER BY W.WAYBILL_NO
	</select>
	
	<!-- 驻地营业部：按时间段查询运单 -->
	<select id="selectWayBillByDate_2" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			 SELECT 
		<include refid="Base_Column_List_By_WayBill" />
		<![CDATA[
			FROM PKP.T_SRV_WAYBILL W 
			INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED')
			LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
			LEFT JOIN BSE.T_BAS_DATA_DICTIONARY_VALUE DIC
			   ON DIC.VALUE_CODE = W.RECEIVE_METHOD
			      AND DIC.TERMS_CODE IN ('PICKUPGOODSHIGHWAYS','PICKUPGOODSAIR')
			      AND DIC.ACTIVE='Y'
		]]>
		<include refid="query_selectByWayBill_condition_date_2" />
			ORDER BY W.WAYBILL_NO
	</select>
	
	<!-- 车队：按时间段查询运单 -->
	<select id="selectWayBillByDate_3_4" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			 SELECT 
		<include refid="Base_Column_List_By_WayBill" />
		<![CDATA[
			FROM PKP.T_SRV_WAYBILL W 
			INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED')
			LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
			LEFT JOIN BSE.T_BAS_DATA_DICTIONARY_VALUE DIC
			   ON DIC.VALUE_CODE = W.RECEIVE_METHOD
			      AND DIC.TERMS_CODE IN ('PICKUPGOODSHIGHWAYS','PICKUPGOODSAIR')
			      AND DIC.ACTIVE='Y'
		]]>
		<include refid="query_selectByWayBill_condition_date_3_4" />
			ORDER BY W.WAYBILL_NO
	</select>

	<!-- 营业部或驻地营业部：按派送单号查询派送单 -->
	<select id="selectByDeliverBills_1_2" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			 SELECT
		<include refid="Base_Column_List_By_DeliverBill" />
			 FROM PKP.T_SRV_DELIVERBILL D
			 INNER JOIN BSE.T_BAS_LEASED_TRUCK LT ON LT.VEHICLE_NO=D.VEHICLE_NO AND LT.ACTIVE='Y'
			 LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = D.DELIVERBILL_NO 
		<include refid="query_selectByDeliverBill_condition_billnos_1_2" />
			 ORDER BY D.DELIVERBILL_NO
	</select>

	<!-- 车队：按派送单号查询派送单 -->
	<select id="selectByDeliverBills_3_4" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			 SELECT
		<include refid="Base_Column_List_By_DeliverBill" />
			 FROM PKP.T_SRV_DELIVERBILL D
			 INNER JOIN BSE.T_BAS_LEASED_TRUCK LT ON LT.VEHICLE_NO=D.VEHICLE_NO AND LT.ACTIVE='Y'
			 LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = D.DELIVERBILL_NO 
		<include refid="query_selectByDeliverBill_condition_billnos_3_4" />
			 ORDER BY D.DELIVERBILL_NO
	</select>
	
	
	<select id="selectWaybillnoBills" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			 SELECT
		<include refid="Base_Column_List_By_WayBillnober" />,(
		<![CDATA[CASE WHEN  W.PRODUCT_CODE  IN ('RCP','EPEP','PACKAGE') THEN 'Y' ELSE 'N' END) AS ISEXPRESSWAYBILL
			 FROM PKP.T_SRV_WAYBILL W 
      INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED') 
      LEFT JOIN (
                 SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
			LEFT JOIN BSE.T_BAS_DATA_DICTIONARY_VALUE DIC
			   ON DIC.VALUE_CODE = W.RECEIVE_METHOD
			      AND DIC.TERMS_CODE IN ('PICKUPGOODSHIGHWAYS','PICKUPGOODSAIR')
			      AND DIC.ACTIVE='Y'
			      ]]>
		<include refid="query_selectByDeliverBill_condition_billnos1_2_3_4" />
			 ORDER BY W.WAYBILL_NO
	</select>
	
	<!-- 营业部或驻地营业部：按时间段查询派送单 -->
	<select id="selectByDeliverByDate_1_2" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			SELECT
		<include refid="Base_Column_List_By_DeliverBill" />
			 FROM PKP.T_SRV_DELIVERBILL D
			 INNER JOIN BSE.T_BAS_LEASED_TRUCK LT ON LT.VEHICLE_NO=D.VEHICLE_NO AND LT.ACTIVE='Y'
			 LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = D.DELIVERBILL_NO 
		<include refid="query_selectByDeliverBill_condition_date_1_2" />
			 ORDER BY D.DELIVERBILL_NO
	</select>

	<!-- 车队：按时间段查询派送单 -->
	<select id="selectByDeliverByDate_3_4" resultMap="BaseResultMap"
		parameterType="java.util.Map">
			SELECT
		<include refid="Base_Column_List_By_DeliverBill" />
			 FROM PKP.T_SRV_DELIVERBILL D
			 INNER JOIN BSE.T_BAS_LEASED_TRUCK LT ON LT.VEHICLE_NO=D.VEHICLE_NO AND LT.ACTIVE='Y'
			 LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT,
		              TM.CONSULT_PRICE_NO consultPriceNo
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
		            left join TFR.T_OPT_CONSULTPRICEINFO CP on CP.CONSULT_PRICE_NO=TM.consult_price_no
         		   )M   ON M.BILL_NO = D.DELIVERBILL_NO 
		<include refid="query_selectByDeliverBill_condition_date_3_4" />
			ORDER BY D.DELIVERBILL_NO
	</select>
	
	<!-- 按时间段查询运单总数 -->
	<select id="getTotalWayBillByDate" resultType="Long"
		parameterType="java.util.Map">
		<![CDATA[
			SELECT COUNT(W.ID) TOTAL 
			FROM PKP.T_SRV_WAYBILL W 
			INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED')
			LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
        ]]>
			
		<if test="type == 1">
			<include refid="query_selectByWayBill_condition_date_1" />
		</if>
		<if test="type == 2">
			<include refid="query_selectByWayBill_condition_date_2" />
		</if>
		<if test="type == 3 or type == 4">
			<include refid="query_selectByWayBill_condition_date_3_4" />
		</if>
		
	</select>

	<!-- 按单号查询运单总数 -->
	<select id="getTotalWayBillByBillNos" resultType="Long"
		parameterType="java.util.Map">
		<![CDATA[
			SELECT COUNT(W.ID) TOTAL 
			FROM PKP.T_SRV_WAYBILL W 
			INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED')
			LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
		]]>
		<if test="type == 1">
			<include refid="query_selectByWayBill_condition_billnos_1" />
		</if>
		<if test="type == 2">
			<include refid="query_selectByWayBill_condition_billnos_2" />
		</if>
		<if test="type == 3 or type == 4">
			<include refid="query_selectByWayBill_condition_billnos_3_4" />
		</if>
	</select>
	
	<!-- 按单号查询运单总数 -->
	<select id="getWayBillByBillNos" resultType="Long"
		parameterType="java.util.Map">
		<![CDATA[
			SELECT COUNT(W.ID) TOTAL 
			FROM PKP.T_SRV_WAYBILL W 
			INNER JOIN  PKP.T_SRV_ACTUAL_FREIGHT AF ON AF.WAYBILL_NO = W.WAYBILL_NO AND (AF.STATUS <> 'OBSOLETE' AND AF.STATUS <> 'ABORTED')
			LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
         		   )M   ON M.BILL_NO = W.WAYBILL_NO 
		]]>
		<if test="type == 1 or type == 2 or type == 3 or type == 4">
			<include refid="query_selectByDeliverBill_condition_billnos1_2_3_4" />
		</if>
	</select>
	<!-- 按时间段查询派送单总数 -->
	<select id="getTotalDeliverBillByDate" resultType="Long"
		parameterType="java.util.Map">
			 SELECT COUNT(D.ID) TOTAL 
			 FROM PKP.T_SRV_DELIVERBILL D
			 INNER JOIN BSE.T_BAS_LEASED_TRUCK LT ON LT.VEHICLE_NO=D.VEHICLE_NO AND LT.ACTIVE='Y'
			 LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
         		   )M   ON M.BILL_NO = D.DELIVERBILL_NO 
			    
		<if test="type == 1 or type == 2">
			<include refid="query_selectByDeliverBill_condition_date_1_2" />
		</if>
		<if test="type == 3 or type == 4">
			<include refid="query_selectByDeliverBill_condition_date_3_4" />
		</if>
	</select>

	<!-- 按单号查询派送单总数 -->
	<select id="getTotalDeliverBillByBillNos" resultType="Long"
		parameterType="java.util.Map">
			 SELECT COUNT(D.ID) TOTAL 
			 FROM PKP.T_SRV_DELIVERBILL D
			 INNER JOIN BSE.T_BAS_LEASED_TRUCK LT ON LT.VEHICLE_NO=D.VEHICLE_NO AND LT.ACTIVE='Y'
			 LEFT JOIN (
		             SELECT  
		              TM.BILL_NO BILL_NO ,
		              TT.TEMPRENTAL_MARK_NO  TEMPRENTAL_MARK_NO,
		              TT.RENTAL_CAR_USETYPE RENTAL_CAR_USETYPE,
		              TT.CREATE_DATE CREATE_DATE,
		              TT.MARK_DEPART_NAME MARK_DEPART_NAME,
		              TT.MARK_DEPART_CODE MARK_DEPART_CODE,
		              TT.CREATE_USER_NAME  CREATE_USER_NAME, 
		              TT.VEHICLE_NO  VEHICLE_NO,
		              TT.DRIVER_NAME DRIVER_NAME,
		              TT.INVITE_VEHICLENO  INVITE_VEHICLENO,
		              TT.RENTAL_AMOUNT RENTAL_AMOUNT
		       	    FROM TFR.T_OPT_TEMPRENTALMARK_DETAIL TM  
		            INNER JOIN TFR.T_OPT_TEMPRENTALMARK TT ON TT.TEMPRENTAL_MARK_NO=TM.TEMPRENTAL_MARK_NO AND TT.ID=TM.TEMPRENTALMARK_ID AND TT.ACTIVE='Y'
         		   )M   ON M.BILL_NO = D.DELIVERBILL_NO 
			    
		<if test="type == 1 or type == 2">
			<include refid="query_selectByDeliverBill_condition_billnos_1_2" />
		</if>
		<if test="type == 3 or type == 4">
			<include refid="query_selectByDeliverBill_condition_billnos_3_4" />
		</if>
	</select>

	<!-- select end -->

</mapper>