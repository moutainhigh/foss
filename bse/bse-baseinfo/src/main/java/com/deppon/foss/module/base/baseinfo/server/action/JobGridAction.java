package com.deppon.foss.module.base.baseinfo.server.action;

import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.deppon.foss.framework.server.web.action.AbstractAction;
import com.deppon.foss.module.base.baseinfo.api.server.service.IJobGridService;
import com.deppon.foss.module.base.baseinfo.api.shared.domain.JobGridClusterEntity;
import com.deppon.foss.module.base.baseinfo.api.shared.domain.JobGridLoggingsEntity;
import com.deppon.foss.module.base.baseinfo.api.shared.domain.JobGridSchedulesEntity;
import com.deppon.foss.module.base.baseinfo.api.shared.exception.JobGridException;
import com.deppon.foss.module.base.baseinfo.api.shared.vo.JobGridVo;

/**
 * 定时任务监控action
 * 
 * @author 107046-FOSS-zengxiantao
 * @date 2013-05-09
 * @since
 */
public class JobGridAction extends AbstractAction {

	private static final long serialVersionUID = 8685185662704962323L;

	private static final Logger logger = LoggerFactory.getLogger(JobGridAction.class);

	private IJobGridService jobGridService;
	
	private JobGridVo jobGridVo = new JobGridVo();

	public JobGridVo getJobGridVo() {
		return jobGridVo;
	}

	public void setJobGridVo(JobGridVo jobGridVo) {
		this.jobGridVo = jobGridVo;
	}

	public void setJobGridService(IJobGridService jobGridService) {
		this.jobGridService = jobGridService;
	}
	
    /**
     * 查询任务信息（分页）
     * @author 曾宪涛
     * @date 2013-05-14
     * @return
     */
    public String queryJobGridSchedules() {
    	try {
    		JobGridSchedulesEntity entity = jobGridVo.getJobGridSchedulesEntity();
    		setTotalCount(jobGridService.getJobGridSchedulesCount(entity));		
    		List<JobGridSchedulesEntity> list =  jobGridService.getJobGridSchedulesRecords(entity, start, limit);
    		jobGridVo.setJobGridSchedulesEntityList(list);
    	    return returnSuccess();
    	} catch (JobGridException e) {
    		logger.debug(e.getErrorCode(), e);
    	    return returnError(e.getErrorCode());
    	}
    }
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    public String addJobGridSchedule() {
		try {
			JobGridSchedulesEntity jobGridEntity = jobGridVo.getJobGridSchedulesEntity();
			jobGridService.addJobGridSchedule(jobGridEntity);
		    return returnSuccess();
		} catch (JobGridException e) {
			logger.debug(e.getErrorCode(), e);
    	    return returnError(e.getErrorCode());
		}
    }
    
    public String updateJobGridSchedule() {
		try {
			JobGridSchedulesEntity jobGridEntity = jobGridVo.getJobGridSchedulesEntity();
			jobGridService.modifyJobGridSchedule(jobGridEntity);
		    return returnSuccess();
		} catch (JobGridException e) {
			logger.debug(e.getErrorCode(), e);
    	    return returnError(e.getErrorCode());
		}
    }
    
    public String queryJobGridLoggings() {
    	try {
    		JobGridLoggingsEntity entity = jobGridVo.getJobGridLoggingsEntity();
    		setTotalCount(jobGridService.getJobGridLoggingsCount(entity));
    		List<JobGridLoggingsEntity> list = jobGridService.getJobGridLoggingsRecords(entity, start, limit);
    		jobGridVo.setJobGridLoggingsEntityList(list);
    	    return returnSuccess();
    	} catch (JobGridException e) {
    		logger.debug(e.getErrorCode(), e);
    	    return returnError(e.getErrorCode());
    	}
    }
    /**
     * 查询任务分组
     * <p>TODO(方法详细描述说明、方法参数的具体涵义)</p> 
     * @author 268984 
     * @date 2016-3-19 下午3:58:06
     * @return
     * @see
     */
    public String queryJobGridCluSelector()
    {
    	List<JobGridClusterEntity> result = jobGridService.queryJobGridCluSelector(jobGridVo.getSelectorParam(),jobGridVo.getJobGridClusterEntity(),start,limit);
        jobGridVo.setJobGridClusterEntityList(result);
        setTotalCount(jobGridService.queryJobGridCluSelectorCount(jobGridVo.getSelectorParam(),jobGridVo.getJobGridClusterEntity().getBlongModule()));
        return returnSuccess();
    }
     /**
      * 新增任务分组
      * <p>TODO(方法详细描述说明、方法参数的具体涵义)</p> 
      * @author 268984 
      * @date 2016-3-19 下午3:58:06
      * @return
      * @see
      */
    public String addJobGridCluSchedule()
    {
    	JobGridClusterEntity jobGridCluster = jobGridVo.getJobGridClusterEntity();
        if(1 == jobGridService.addJobGridCluSchedule(jobGridCluster))
            return returnSuccess();
        return returnSuccess();
    }
    /*************************************************** 任务调度 ***************************************************/
	/**
	 * 启动任务
	 * 
	 * @author 曾宪涛
	 * @version 1.0 2013-05-09
	 * @return
	 */
    public String startupTask() {
    	try {
    		String id = jobGridVo.getJobGridSchedulesEntity().getId();
    		String blongModule = jobGridVo.getJobGridSchedulesEntity().getBlongModule();
    		jobGridService.modifyActiveOfJobGridSchedule(id,blongModule, 1);
    		return returnSuccess();
    	} catch (JobGridException e) {
    		logger.debug(e.getErrorCode(), e);
    	    return returnError(e.getErrorCode());
		}
    }
    
	/**
	 * 停止任务
	 * 
	 * @author 曾宪涛
	 * @version 1.0 2013-05-09
	 * @return
	 */
    public String stopTask() {
    	try {
    		String id = jobGridVo.getJobGridSchedulesEntity().getId();
    		String blongModule = jobGridVo.getJobGridSchedulesEntity().getBlongModule();
    		jobGridService.modifyActiveOfJobGridSchedule(id,blongModule,0);
    		return returnSuccess();
    	} catch (JobGridException e) {
    		logger.debug(e.getErrorCode(), e);
    	    return returnError(e.getErrorCode());
		}
    }

}
